(this["webpackJsonpjsapi-create-react-app"]=this["webpackJsonpjsapi-create-react-app"]||[]).push([[37],{566:function(t,e,i){"use strict";i.d(e,"a",(function(){return m})),i.d(e,"b",(function(){return x})),i.d(e,"c",(function(){return y})),i.d(e,"d",(function(){return p})),i.d(e,"e",(function(){return l})),i.d(e,"f",(function(){return b})),i.d(e,"g",(function(){return a})),i.d(e,"h",(function(){return c}));var s=i(13),r=i(564),n=i(646);function o(t,e=!1){const i=r.e.SIZE_FIELD_STOPS|r.e.SIZE_MINMAX_VALUE|r.e.SIZE_SCALE_STOPS|r.e.SIZE_UNIT_VALUE,s=(t&(r.f.FIELD_TARGETS_OUTLINE|r.f.MINMAX_TARGETS_OUTLINE|r.f.SCALE_TARGETS_OUTLINE|r.f.UNIT_TARGETS_OUTLINE))>>>4;return e?i&s:i&~s}function a(t,e,i,s,n){switch(t){case r.d.FILL:return m.from(e,s);case r.d.LINE:return y.from(e,i);case r.d.MARKER:return p.from(e);case r.d.TEXT:return b.from(e);case r.d.LABEL:return x.from(e,n);default:throw new Error(`Unable to createMaterialKey for unknown geometryType ${t}`)}}function c(t){switch(l.load(t).geometryType){case r.d.MARKER:return new p(t);case r.d.FILL:return new m(t);case r.d.LINE:return new y(t);case r.d.TEXT:return new b(t);case r.d.LABEL:return new x(t)}}class l{constructor(t){this._data=0,this._data=t}static load(t){const e=this.shared;return e.data=t,e}set data(t){this._data=t}get data(){return this._data}get geometryType(){return this.bits(8,11)}set geometryType(t){this.setBits(t,8,11)}get mapAligned(){return!!this.bit(20)}set mapAligned(t){this.setBit(20,t)}get sdf(){return!!this.bit(11)}set sdf(t){this.setBit(11,t)}get pattern(){return!!this.bit(12)}set pattern(t){this.setBit(12,t)}get textureBinding(){return this.bits(0,8)}set textureBinding(t){this.setBits(t,0,8)}get geometryTypeString(){switch(this.geometryType){case r.d.FILL:return"fill";case r.d.MARKER:return"marker";case r.d.LINE:return"line";case r.d.TEXT:return"text";case r.d.LABEL:return"label";default:throw new s.a(`Unable to handle unknown geometryType: ${this.geometryType}`)}}setBit(t,e){const i=1<<t;e?this._data|=i:this._data&=~i}bit(t){return(this._data&1<<t)>>t}setBits(t,e,i){for(let s=e,r=0;s<i;s++,r++)this.setBit(s,0!=(t&1<<r))}bits(t,e){let i=0;for(let s=t,r=0;s<e;s++,r++)i|=this.bit(s)<<r;return i}hasVV(){return!1}setVV(t,e){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf}}getVariationHash(){return this._data&~(7&this.textureBinding)}}l.shared=new l(0);const h=t=>class extends t{get vvSizeMinMaxValue(){return 0!==this.bit(16)}set vvSizeMinMaxValue(t){this.setBit(16,t)}get vvSizeScaleStops(){return 0!==this.bit(17)}set vvSizeScaleStops(t){this.setBit(17,t)}get vvSizeFieldStops(){return 0!==this.bit(18)}set vvSizeFieldStops(t){this.setBit(18,t)}get vvSizeUnitValue(){return 0!==this.bit(19)}set vvSizeUnitValue(t){this.setBit(19,t)}hasVV(){return super.hasVV()||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}setVV(t,e){super.setVV(t,e);const i=o(t,e)&t;this.vvSizeMinMaxValue=!!(i&r.e.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(i&r.e.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(i&r.e.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(i&r.e.SIZE_SCALE_STOPS)}},u=t=>class extends t{get vvRotation(){return 0!==this.bit(15)}set vvRotation(t){this.setBit(15,t)}hasVV(){return super.hasVV()||this.vvRotation}setVV(t,e){super.setVV(t,e),this.vvRotation=!e&&!!(t&r.e.ROTATION)}},f=t=>class extends t{get vvColor(){return 0!==this.bit(13)}set vvColor(t){this.setBit(13,t)}hasVV(){return super.hasVV()||this.vvColor}setVV(t,e){super.setVV(t,e),this.vvColor=!e&&!!(t&r.e.COLOR)}},d=t=>class extends t{get vvOpacity(){return 0!==this.bit(14)}set vvOpacity(t){this.setBit(14,t)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(t,e){super.setVV(t,e),this.vvOpacity=!e&&!!(t&r.e.OPACITY)}};class m extends(f(d(l))){static load(t){const e=this.shared;return e.data=t,e}static from(t,e){const i=this.load(0);return i.geometryType=r.d.FILL,e?i.dotDensity=!0:i.setVV(t,!1),i.data}getVariation(){return{...super.getVariation(),dotDensity:this.dotDensity,vvColor:this.vvColor,vvOpacity:this.vvOpacity}}get dotDensity(){return!!this.bit(15)}set dotDensity(t){this.setBit(15,t)}}m.shared=new m(0);class p extends(f(d(u(h(l))))){static load(t){const e=this.shared;return e.data=t,e}static from(t){const e=this.load(0);return e.geometryType=r.d.MARKER,e.setVV(t,!1),e.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}p.shared=new p(0);class y extends(f(d(h(l)))){static load(t){const e=this.shared;return e.data=t,e}static from(t,e){const i=this.load(0);return i.geometryType=r.d.LINE,i.setVV(t,e),i.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}y.shared=new y(0);class b extends(f(d(u(h(l))))){static load(t){const e=this.shared;return e.data=t,e}static from(t){const e=this.load(t);return e.geometryType=r.d.TEXT,e.setVV(t,!1),e.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}b.shared=new b(0);class x extends(h(l)){static load(t){const e=this.shared;return e.data=t,e}static from(t,e){const i=this.load(0);return i.geometryType=r.d.LABEL,i.setVV(t,!1),i.mapAligned=!!Object(n.a)(e),i.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}x.shared=new x(0)},571:function(t,e,i){"use strict";var s=i(2),r=i(63),n=i(564),o=i(584),a=i(655),c=i(622);class l{static executeEffects(t,e){const i=Object(o.c)(e);let s=new a.a(i);for(const r of t){const t=Object(c.a)(r);t&&(s=t.execute(s,r,1.3333333333333333))}return s}static next(t){const e=t.next();return Object(o.d)(e),e}}e.a=class{get needsPixelBuffer(){return!!this.effects||this.geometryType===n.d.MARKER||this.geometryType===n.d.TEXT||this.geometryType===n.d.LABEL}writeMesh(t,e,i,n,o){if(Object(s.h)(this.effects))return this.writeMeshWithGeometry(t,e,i,n,o);const a=l.executeEffects(this.effects,i.readLegacyGeometry());let c=l.next(a);for(;c;)this.writeMeshWithGeometry(t,e,i,Object(r.c)(c),o,c),c=l.next(a)}writeMeshWithGeometry(t,e,i,s,r,n){}bindFeature(t,e,i){}}},572:function(t,e,i){"use strict";function s(t,e){if(null!==e){t.push(e.length);for(const i of e)i.serialize(t);return t}t.push(0)}function r(t,e,i){const s=t.readInt32(),r=new Array(s);for(let n=0;n<r.length;n++)r[n]=e.deserialize(t,i);return r}i.d(e,"a",(function(){return r})),i.d(e,"b",(function(){return s}))},573:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var s=i(13);function r(t,e){if(t&&"name"in t){const i=t;return e&&e.error(new s.a(i.name,i.message,i.details)),!1}return!0}},575:function(t,e,i){"use strict";var s=i(6),r=i(448),n=i(427),o=i(651),a=i(572);const c=s.a.getLogger("esri/views/2d/engine/webgl/collisions/Metric");class l{constructor(t,e,i,s,r){this.id=t,this.range=e,this.boxes=null,this.minZoom=-1,this.size=0,this.directionX=0,this.directionY=0,this.offsetX=0,this.offsetY=0,this.placementPadding=0,this.anchor=Object(n.b)(i,s),this.baseZoom=r}add(t,e,i){t.x=t.x+e,t.y=t.y+i,this.bounds?this.boxes?(this.boxes.push(t),this.bounds.extend(t)):(this.boxes=[this.bounds,t],this.bounds=this.bounds.clone(),this.bounds.extend(t)):this.bounds=t}computeIndex(){const t=this.anchor[0],e=this.anchor[1],i=Math.floor(t/r.d),s=Math.floor(e/r.d);this.xBucket=i,this.yBucket=s;const n=r.F/r.d;if(this.hasVV)return this.xOverflow=n,void(this.yOverflow=n);this.xOverflow=Math.min(n,Math.ceil(2*this.bounds.width/r.d)),this.yOverflow=Math.min(n,Math.ceil(2*this.bounds.height/r.d))}findCollisionDelta(t){const e=this.bounds.findCollisionDelta(t.bounds),i=this.boxes&&this.boxes.length,s=t.boxes&&t.boxes.length;return Math.abs(e)>r.f||!i&&!s?e:i&&s?this._boxesToBoxes(t):i?this._boxesToBox(t):this._boxToBoxes(t)}computeVVOffset(t,e){e||c.error("mapview-labeling",`Unable to compute label offset. Expected an evaluator function but found ${e}`);let i=this.size;if(this.hasVV){const s=e(t);i=isNaN(s)||null==s||s===1/0?this.size:s}this._computeOffset(i)}setPlacementOffset(t,e,i,s,r){this.hasVV=t,this.size=e,this.placementPadding=Math.round(i),this.directionX=s,this.directionY=r}clone(){const t=new l(this.id,this.range,this.anchor[0],this.anchor[1],this.baseZoom);return t.minZoom=this.minZoom,this.bounds&&(t.bounds=this.bounds.clone()),this.boxes&&(t.boxes=this.boxes.map((t=>t.clone()))),t.xBucket=this.xBucket,t.yBucket=this.yBucket,t.xOverflow=this.xOverflow,t.yOverflow=this.yOverflow,t.hasVV=this.hasVV,t.size=this.size,t.directionX=this.directionX,t.directionY=this.directionY,t.offsetX=this.offsetX,t.offsetY=this.offsetY,t}_boxToBoxes(t){let e=-1/0;for(const i of t.boxes){const t=this.bounds.findCollisionDelta(i);e=Math.max(t,e)}return e}_boxesToBox(t){let e=this.boxes[0].findCollisionDelta(t.bounds);for(let i=1;i<this.boxes.length;i++){const s=this.boxes[i].findCollisionDelta(t.bounds);e=Math.max(s,e)}return e}_boxesToBoxes(t){let e=-1/0;for(let i=0;i<this.boxes.length;i++){const s=this.boxes[i];for(const i of t.boxes){const t=s.findCollisionDelta(i);e=Math.max(t,e)}}return e}_computeOffset(t){this.offsetX=this.directionX*(t/2+this.placementPadding),this.offsetY=this.directionY*(t/2+this.placementPadding)}serialize(t){return t.push(this.id),this.bounds.serialize(t),t.push(this.range.from),t.push(this.range.count),t.push(this.anchor[0]),t.push(this.anchor[1]),t.push(this.baseZoom),t.push(this.hasVV?1:0),t.push(this.size),t.writeF32(this.directionX),t.writeF32(this.directionY),t.push(this.offsetX),t.push(this.offsetY),t.push(this.placementPadding),Object(a.b)(t,this.boxes),t}static deserialize(t){const e=t.readInt32(),i=o.a.deserialize(t),s={from:t.readInt32(),count:t.readInt32()},r=t.readInt32(),n=t.readInt32(),c=t.readInt32(),h=t.readInt32(),u=t.readInt32(),f=t.readF32(),d=t.readF32(),m=t.readInt32(),p=t.readInt32(),y=t.readInt32(),b=Object(a.a)(t,o.a),x=new l(e,s,r,n,c);return x.bounds=i,x.boxes=b,x.setPlacementOffset(!!h,u,y,f,d),x.offsetX=m,x.offsetY=p,x.computeIndex(),h||x._computeOffset(u),x}}e.a=l},576:function(t,e,i){"use strict";var s=i(565),r=class{constructor(){this.vertexData=new Map,this.vertexCount=0,this.indexData=[]}clear(){this.vertexData.clear(),this.vertexCount=0,this.indexData=[]}update(t,e,i){for(const s in t)this.vertexData.set(s,t[s]);for(const s in this.vertexData)null===t[s]&&this.vertexData.delete(s);this.vertexCount=e,this.indexData=i}};class n{constructor(t,e,i,s=0,r=0){this.id=t,this.geometryType=e,this.materialKey=i,this.minZoom=s,this.maxZoom=r,this.meshData=null,this.symbolLevel=0,this.zOrder=0,this.vertexFrom=0,this.vertexCount=0,this.indexFrom=0,this.indexCount=0}get sortKey(){return void 0===this._sortKey&&this._computeSortKey(),this._sortKey}clone(){return this.copy()}copy(){const t=new n(this.id,this.geometryType,this.materialKey);return t.vertexFrom=this.vertexFrom,t.vertexCount=this.vertexCount,t.indexFrom=this.indexFrom,t.indexCount=this.indexCount,t.zOrder=this.zOrder,t.symbolLevel=this.symbolLevel,t.meshData=this.meshData,t.minZoom=this.minZoom,t.maxZoom=this.maxZoom,t}setMeshDataFromBuffers(t,e,i){const n=new r;for(const r in e){const i=e[r].stride,o=e[r].data,a=[],c=Object(s.o)(i);for(let e=0;e<i*t.vertexCount/c;++e)a[e]=o[e+i*t.vertexFrom/c];n.vertexData.set(r,a)}n.indexData.length=0;for(let s=0;s<t.indexCount;++s)n.indexData[s]=i[s+t.indexFrom]-t.vertexFrom;n.vertexCount=t.vertexCount,this.meshData=n}readMeshDataFromBuffers(t,e){this.meshData?this.meshData.clear():this.meshData=new r;for(const i in t){const e=t[i].stride,r=t[i].data,n=[],o=Object(s.o)(e);for(let t=0;t<e*this.vertexCount/o;++t)n[t]=r[t+e*this.vertexFrom/o];this.meshData.vertexData.set(i,n)}this.meshData.indexData.length=0;for(let i=0;i<this.indexCount;++i)this.meshData.indexData[i]=e[i+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount}writeMeshDataToBuffers(t,e,i,r){for(const n in e){const i=e[n].stride,r=this.meshData.vertexData.get(n),o=e[n].data,a=Object(s.o)(i);for(let e=0;e<i*this.meshData.vertexCount/a;++e)o[e+i*t/a]=r[e]}for(let s=0;s<this.meshData.indexData.length;++s)r[s+i]=this.meshData.indexData[s]+t;this.vertexFrom=t,this.vertexCount=this.meshData.vertexCount,this.indexFrom=i,this.indexCount=this.meshData.indexData.length}static writeAllMeshDataToBuffers(t,e,i){let s=0,r=0;for(const n of t)n.writeMeshDataToBuffers(s,e,r,i),s+=n.vertexCount,r+=n.indexCount}_computeSortKey(){this._sortKey=(31&this.symbolLevel)<<12|(127&this.zOrder)<<4|7&this.geometryType}serialize(t){return t.push(this.geometryType),t.push(this.materialKey),t.push(this.vertexFrom),t.push(this.vertexCount),t.push(this.indexFrom),t.push(this.indexCount),t.push(this.minZoom),t.push(this.maxZoom),t}static deserialize(t,e){const i=t.readInt32(),s=t.readInt32(),r=new n(e.id,i,s);return r.vertexFrom=t.readInt32(),r.vertexCount=t.readInt32(),r.indexFrom=t.readInt32(),r.indexCount=t.readInt32(),r.minZoom=t.readInt32(),r.maxZoom=t.readInt32(),r}}e.a=n},577:function(t,e,i){"use strict";e.a=class{constructor(t,e){this._pos=0;const i=e?this._roundToNearest(e,t.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(i),this._buffer=new t(this._array),this._ctor=t}get length(){return this._pos}_roundToNearest(t,e){const i=Math.round(t);return i+(e-i%e)}_ensureSize(t){if(this._pos+t>=this._buffer.length){const e=this._roundToNearest(1.5*(this._array.byteLength+t*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),i=new ArrayBuffer(e),s=new this._ctor(i);s.set(this._buffer,0),this._array=i,this._buffer=s}}writeF32(t){this._ensureSize(1);const e=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=t,this._pos++,e}push(t){this._ensureSize(1);const e=this._pos;return this._buffer[this._pos++]=t,e}writeFixed(t){this._buffer[this._pos++]=t}setValue(t,e){this._buffer[t]=e}getValue(t){return this._buffer[t]}incr(t){this._buffer[t]++}decr(t){this._buffer[t]--}writeRegion(t){this._ensureSize(t.length);const e=this._pos;return this._buffer.set(t,this._pos),this._pos+=t.length,e}buffer(){const t=this._array.slice(0,4*this._pos);return this.destroy(),t}toArray(){const t=this._array,e=[];for(let i=0;i<t.byteLength/4;i++)e.push(t[i]);return e}seek(t){this._pos=t}destroy(){this._array=null,this._buffer=null}}},583:function(t,e,i){"use strict";i.d(e,"a",(function(){return h})),i.d(e,"b",(function(){return c})),i.d(e,"c",(function(){return l})),i.d(e,"d",(function(){return a}));Number.POSITIVE_INFINITY;const s=Math.PI,r=128/s,n=1/Math.LN2;function o(t,e){return(t%=e)>=0?t:t+e}function a(t){return o(t*r,256)}function c(t){return o(.7111111111111111*t,256)}function l(t){return Math.log(t)*n}function h(t,e,i){return t>=e&&t<=i||t>=i&&t<=e}},587:function(t,e,i){"use strict";i.d(e,"a",(function(){return A})),i.d(e,"b",(function(){return g}));var s=i(87),r=i(6),n=i(9),o=i(137),a=i(28),c=i(25),l=i(115),h=i(588),u=i(611),f=i(617);const d=r.a.getLogger("esri.symbols.cim.cimAnalyzer");function m(t){switch(t){case"Butt":return 0;case"Square":return 2;case"Round":default:return 1}}function p(t){switch(t){case"Bevel":return 0;case"Miter":return 2;case"Round":default:return 1}}function y(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":return"center";case"Justify":return"justify"}}function b(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function x(t,e,i,s){let r;t[e]?r=t[e]:(r={},t[e]=r),r[i]=s}function _(t){const e=t.markerPlacement;return e&&e.angleToLine?1:0}async function g(t,e,i,s){const r=i||[];if(!t)return r;let a,c;const l={};if("CIMSymbolReference"!==t.type)return d.error("Expect cim type to be 'CIMSymbolReference'"),r;if(a=t.symbol,c=t.primitiveOverrides,c){const t=[];for(const i of c){const s=i.valueExpressionInfo;if(s&&e){const r=s.expression,n=Object(o.d)(r,e.spatialReference,e.fields).then((t=>{t&&x(l,i.primitiveName,i.propertyName,t)}));t.push(n)}else null!=i.value&&x(l,i.primitiveName,i.propertyName,i.value)}await Object(n.b)(t)}switch(a.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":!function(t,e,i,s,r,n){if(!t)return;const o=t.symbolLayers;if(!o)return;let a;const c=u.a.getSize(t);"CIMPointSymbol"===t.type&&"Map"===t.angleAlignment&&(a=1);let l=o.length;for(;l--;){const h=o[l];if(!h||!1===h.enable)continue;const f=[];switch(u.b.findApplicableOverrides(h,e,f),h.type){case"CIMSolidFill":O(h,i,f,s,r);break;case"CIMPictureFill":v(h,i,f,s,r);break;case"CIMHatchFill":M(h,i,f,s,r);break;case"CIMGradientFill":j(h,i,f,s,r);break;case"CIMSolidStroke":w(h,i,f,s,r,"CIMPolygonSymbol"===t.type,c);break;case"CIMPictureStroke":S(h,i,f,s,r,"CIMPolygonSymbol"===t.type,c);break;case"CIMGradientStroke":C(h,i,f,s,r,"CIMPolygonSymbol"===t.type,c);break;case"CIMCharacterMarker":if(L(h,i,f,s,r))break;break;case"CIMPictureMarker":if(L(h,i,f,s,r))break;"CIMLineSymbol"===t.type&&(a=_(h)),z(h,i,f,s,r,a,c);break;case"CIMVectorMarker":if(L(h,i,f,s,r))break;"CIMLineSymbol"===t.type&&(a=_(h)),T(h,i,f,s,r,a,c,n);break;default:d.error("Cannot analyze CIM layer",h.type)}}}(a,c,l,e,r,s)}return r}function O(t,e,i,r,n){const o=t.primitiveName,a=Object(l.e)(t.color),c=Object(s.b)(JSON.stringify(t)).toString();n.push({type:"fill",templateHash:c,materialHash:0===i.length?c:()=>c,cim:t,materialOverrides:null,colorLocked:t.colorLocked,color:V(o,e,"Color",r,a,D),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:t.effects})}function v(t,e,i,r,n){const o=t.primitiveName,a=t.tintColor?Object(l.e)(t.tintColor):{r:255,g:255,b:255,a:1},c=Object(s.b)(JSON.stringify(t)).toString(),h=Object(s.b)(`${t.url}${JSON.stringify(t.colorSubstitutions)}`).toString();n.push({type:"fill",templateHash:c,materialHash:0===i.length?h:()=>h,cim:t,materialOverrides:null,colorLocked:t.colorLocked,effects:t.effects,color:V(o,e,"TintColor",r,a,D),height:V(o,e,"Height",r,t.height),scaleX:V(o,e,"ScaleX",r,t.scaleX),angle:V(o,e,"Rotation",r,t.rotation),offsetX:V(o,e,"OffsetX",r,t.offsetX),offsetY:V(o,e,"OffsetY",r,t.offsetY)})}function M(t,e,i,r,n){const o=["Rotation","OffsetX","OffsetY"],a=i.filter((e=>e.primitiveName!==t.primitiveName&&-1===o.indexOf(e.propertyName))),c=t.primitiveName,l=Object(s.b)(JSON.stringify(t)).toString(),h=Object(s.b)(`${t.separation}${JSON.stringify(t.lineSymbol)}`).toString();n.push({type:"fill",templateHash:l,materialHash:0===i.length?h:F(h,e,a,r),cim:t,materialOverrides:a,colorLocked:t.colorLocked,effects:t.effects,color:{r:255,g:255,b:255,a:1},height:V(c,e,"Separation",r,t.separation),scaleX:1,angle:V(c,e,"Rotation",r,t.rotation),offsetX:V(c,e,"OffsetX",r,t.offsetX),offsetY:V(c,e,"OffsetY",r,t.offsetY)})}function j(t,e,i,r,n){const o=Object(s.b)(JSON.stringify(t)).toString();n.push({type:"fill",templateHash:o,materialHash:0===i.length?o:F(o,e,i,r),cim:t,materialOverrides:null,colorLocked:t.colorLocked,effects:t.effects,color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1})}function w(t,e,i,r,n,o,a){const c=Object(s.b)(JSON.stringify(t)).toString(),h=t.primitiveName,u=Object(l.e)(t.color),f=void 0!==t.width?t.width:4,d=m(t.capStyle),y=p(t.joinStyle),b=t.miterLimit;n.push({type:"line",templateHash:c,materialHash:0===i.length?c:()=>c,cim:t,materialOverrides:null,isOutline:o,colorLocked:t.colorLocked,effects:t.effects,color:V(h,e,"Color",r,u,D),width:V(h,e,"Width",r,f),cap:V(h,e,"CapStyle",r,d),join:V(h,e,"JoinStyle",r,y),miterLimit:V(h,e,"MiterLimit",r,b),referenceWidth:a,zOrder:R(t.name),isDashed:!1})}function S(t,e,i,r,n,o,a){const c=Object(s.b)(`${t.url}${JSON.stringify(t.colorSubstitutions)}`).toString(),h=t.primitiveName,u=Object(l.e)(t.tintColor),f=void 0!==t.width?t.width:4,d=m(t.capStyle),y=p(t.joinStyle),b=t.miterLimit,x=Object(s.b)(JSON.stringify(t)).toString();n.push({type:"line",templateHash:x,materialHash:0===i.length?c:()=>c,cim:t,materialOverrides:null,isOutline:o,colorLocked:t.colorLocked,effects:t.effects,color:V(h,e,"TintColor",r,u,D),width:V(h,e,"Width",r,f),cap:V(h,e,"CapStyle",r,d),join:V(h,e,"JoinStyle",r,y),miterLimit:V(h,e,"MiterLimit",r,b),referenceWidth:a,zOrder:R(t.name),isDashed:!1})}function C(t,e,i,r,n,o,a){const c=t.primitiveName,l=void 0!==t.width?t.width:4,h=m(t.capStyle),u=p(t.joinStyle),f=t.miterLimit,d=Object(s.b)(JSON.stringify(t)).toString();n.push({type:"line",templateHash:d,materialHash:0===i.length?d:F(d,e,i,r),cim:t,materialOverrides:null,isOutline:o,colorLocked:t.colorLocked,effects:t.effects,color:{r:128,g:128,b:128,a:1},width:V(c,e,"Width",r,l),cap:V(c,e,"CapStyle",r,h),join:V(c,e,"JoinStyle",r,u),miterLimit:V(c,e,"MiterLimit",r,f),referenceWidth:a,zOrder:R(t.name),isDashed:!1})}function L(t,e,i,r,n){const o=t.markerPlacement;if(!o||"CIMMarkerPlacementInsidePolygon"!==o.type)return!1;const a=o,c=["Rotation","OffsetX","OffsetY"],l=i.filter((e=>e.primitiveName!==t.primitiveName&&-1===c.indexOf(e.propertyName))),h=Object(s.b)(JSON.stringify(t)).toString();return n.push({type:"fill",templateHash:h,materialHash:0===i.length?h:F(h,e,l,r),cim:t,materialOverrides:l,colorLocked:t.colorLocked,effects:t.effects,color:{r:255,g:255,b:255,a:1},height:V(a.primitiveName,e,"StepY",r,a.stepY),scaleX:1,angle:V(a.primitiveName,e,"GridAngle",r,a.gridAngle),offsetX:V(a.primitiveName,e,"OffsetX",r,a.offsetX),offsetY:V(a.primitiveName,e,"OffsetY",r,a.offsetY)}),!0}function z(t,e,i,r,n,o,a){const c=t.primitiveName,h=t.size,u=t.scaleX,f=t.rotation,d=t.offsetX,m=t.offsetY,p=Object(l.e)(t.tintColor),y=Object(s.b)(`${t.url}${JSON.stringify(t.colorSubstitutions)}`).toString();let b=!1,x="";for(const s of i)s.primitiveName===c&&(void 0!==s.value?x+=`-${s.primitiveName}-${s.propertyName}-${JSON.stringify(s.value)}`:s.valueExpressionInfo&&(b=!0));n.push({type:"marker",templateHash:Object(s.b)(JSON.stringify(t)+x).toString(),materialHash:b?()=>y:y,cim:t,materialOverrides:null,colorLocked:t.colorLocked,effects:t.effects,scaleSymbolsProportionally:!1,alignment:o,size:V(c,e,"Size",r,h),scaleX:V(c,e,"ScaleX",r,u),rotation:V(c,e,"Rotation",r,f),offsetX:V(c,e,"OffsetX",r,d),offsetY:V(c,e,"OffsetY",r,m),color:V(c,e,"TintColor",r,p,D),anchorPoint:t.anchorPoint,isAbsoluteAnchorPoint:"Relative"!==t.anchorPointUnits,outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:t.rotateClockwise,referenceSize:a,sizeRatio:1,markerPlacement:t.markerPlacement})}function T(t,e,i,s,r,n,o,a){const c=t.markerGraphics;if(!c)return;let l=0;if(t.scaleSymbolsProportionally){const e=t.frame;e&&(l=e.ymax-e.ymin)}for(const h of c)if(h){const c=h.symbol;if(!c)continue;switch(c.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":P(t,h,i,e,s,r,n,o,l,a);break;case"CIMTextSymbol":I(t,h,e,i,s,r,n,o,l)}}}function I(t,e,i,r,n,o,a,c,h){u.b.findApplicableOverrides(e,r,[]);const f=e.geometry;if(!("x"in f)||!("y"in f))return;const d=e.symbol,m=(p=d).underline?"underline":p.strikethrough?"line-through":"none";var p;const x=function(t){let e="normal",i="normal";if(t){const s=t.toLowerCase();-1!==s.indexOf("italic")?e="italic":-1!==s.indexOf("oblique")&&(e="oblique"),-1!==s.indexOf("bold")?i="bold":-1!==s.indexOf("light")&&(i="lighter")}return{style:e,weight:i}}(d.fontStyleName);d.font={family:d.fontFamilyName,decoration:m,...x};const _=t.frame,g=f.x-.5*(_.xmin+_.xmax),O=f.y-.5*(_.ymin+_.ymax),v=t.size/h,M=t.primitiveName,j=(d.height||0)*v,w=d.angle||0,S=((d.offsetX||0)+g)*v,C=((d.offsetY||0)+O)*v,L=Object(l.e)(u.a.getFillColor(d));let z=Object(l.e)(u.a.getStrokeColor(d)),T=u.a.getStrokeWidth(d);T||(z=Object(l.e)(u.a.getFillColor(d.haloSymbol)),T=d.haloSize*v);let I="";for(const s of r)s.primitiveName===M&&void 0!==s.value&&(I+=`-${s.primitiveName}-${s.propertyName}-${JSON.stringify(s.value)}`);const P=JSON.stringify(t.effects)+Number(t.colorLocked)+JSON.stringify(t.anchorPoint)+t.anchorPointUnits+JSON.stringify(t.markerPlacement),k=Object(s.b)(JSON.stringify(e)+P+I).toString();o.push({type:"text",templateHash:k,materialHash:()=>Object(s.b)(JSON.stringify(d.font)).toString(),cim:d,materialOverrides:null,colorLocked:t.colorLocked,effects:t.effects,alignment:a,anchorPoint:{x:t.anchorPoint?t.anchorPoint.x:0,y:t.anchorPoint?t.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==t.anchorPointUnits,fontName:d.fontFamilyName,decoration:"none",weight:"normal",style:"normal",size:V(M,i,"Size",n,j),angle:V(M,i,"Rotation",n,w),offsetX:V(M,i,"OffsetX",n,S),offsetY:V(M,i,"OffsetY",n,C),horizontalAlignment:y(d.horizontalAlignment),verticalAlignment:b(d.verticalAlignment),text:V(e.primitiveName,i,"TextString",n,e.textString,l.a,d.textCase),color:L,outlineColor:z,outlineSize:T,referenceSize:c,sizeRatio:1,markerPlacement:t.markerPlacement})}function P(t,e,i,r,n,o,a,c,h,d){const m=e.symbol,p=e.geometry;if(!p)return;const y=m.symbolLayers;if(!y)return;if(d)return void k(t,e,r,i,n,o,a,c,h);let b=y.length;for(;b--;){const d=y[b];if(d&&!1!==d.enable)switch(d.type){case"CIMSolidFill":case"CIMSolidStroke":{const m=Object(f.b)(p);if(!m)continue;const[y,b,x]=Object(f.d)(m,t.frame,t.size,t.anchorPoint,"Relative"!==t.anchorPointUnits),_="CIMSolidFill"===d.type,g={type:"sdf",geom:p,asFill:_},O=t.primitiveName,v=t.size,M=t.rotation||0,j=t.offsetX,w=t.offsetY,S=d.primitiveName,C=Object(l.e)(_?u.a.getFillColor(d):u.a.getStrokeColor(d)),L=_?{r:0,g:0,b:0,a:0}:Object(l.e)(u.a.getStrokeColor(d)),z=u.a.getStrokeWidth(d);if(!_&&!z)break;let T=!1,I="";for(const t of i)t.primitiveName!==S&&t.primitiveName!==O||(void 0!==t.value?I+=`-${t.primitiveName}-${t.propertyName}-${JSON.stringify(t.value)}`:t.valueExpressionInfo&&(T=!0));const P=JSON.stringify({...t,markerGraphics:null}),k=Object(s.b)(JSON.stringify(g)).toString(),R={type:"marker",templateHash:Object(s.b)(JSON.stringify(e)+JSON.stringify(d)+P+I).toString(),materialHash:T?()=>k:k,cim:g,materialOverrides:null,colorLocked:t.colorLocked,effects:t.effects,scaleSymbolsProportionally:t.scaleSymbolsProportionally,alignment:a,anchorPoint:{x:b,y:x},isAbsoluteAnchorPoint:!1,size:V(t.primitiveName,r,"Size",n,v),rotation:V(t.primitiveName,r,"Rotation",n,M),offsetX:V(t.primitiveName,r,"OffsetX",n,j),offsetY:V(t.primitiveName,r,"OffsetY",n,w),scaleX:1,frameHeight:h,rotateClockwise:t.rotateClockwise,referenceSize:c,sizeRatio:y,color:V(S,r,"Color",n,C,D),outlineColor:V(S,r,"Color",n,L,D),outlineWidth:V(S,r,"Width",n,z),markerPlacement:t.markerPlacement};o.push(R);break}default:k(t,e,r,i,n,o,a,c,h)}}}function k(t,e,i,r,n,o,a,l,h){const f=function(t,e){return{type:t.type,enable:!0,name:t.name,colorLocked:t.colorLocked,primitiveName:t.primitiveName,anchorPoint:t.anchorPoint,anchorPointUnits:t.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:t.rotateClockwise,rotation:0,size:t.size,billboardMode3D:t.billboardMode3D,depth3D:t.depth3D,frame:t.frame,markerGraphics:[e],scaleSymbolsProportionally:t.scaleSymbolsProportionally,respectFrame:t.respectFrame,clippingPath:t.clippingPath,effects:t.effects}}(t,e);let d=[];const m=["Rotation","OffsetX","OffsetY"];d=r.filter((e=>e.primitiveName!==t.primitiveName||-1===m.indexOf(e.propertyName)));let p="";for(const s of r)void 0!==s.value&&(p+=`-${s.primitiveName}-${s.propertyName}-${JSON.stringify(s.value)}`);const[y,b,x]=u.a.getTextureAnchor(f),_=t.primitiveName,g=t.rotation||0,O=t.offsetX||0,v=t.offsetY||0,M=Object(s.b)(JSON.stringify(f)+p).toString(),j={type:"marker",templateHash:M,materialHash:0===d.length?M:F(M,i,d,n),cim:f,materialOverrides:d,colorLocked:t.colorLocked,effects:t.effects,scaleSymbolsProportionally:t.scaleSymbolsProportionally,alignment:a,anchorPoint:{x:y,y:b},isAbsoluteAnchorPoint:!1,size:t.size,rotation:V(_,i,"Rotation",n,g),offsetX:V(_,i,"OffsetX",n,O),offsetY:V(_,i,"OffsetY",n,v),color:{r:0,g:0,b:0,a:0},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:h,rotateClockwise:t.rotateClockwise,referenceSize:l,sizeRatio:x/Object(c.e)(t.size),markerPlacement:t.markerPlacement};o.push(j)}function R(t){if(t&&0===t.indexOf("Level_")){const e=parseInt(t.substr(6),10);if(NaN!==e)return e}return 0}function D(t){if(!t||0===t.length)return null;const e=new a.a(t).toRgba();return{r:e[0],g:e[1],b:e[2],a:e[3]}}function V(t,e,i,s,r,n,a){const c=e[t];if(c){const t=c[i];if("string"==typeof t||"number"==typeof t||t instanceof Array)return n?n.call(null,t,a):t;if(null!=t&&t instanceof o.a)return(e,i,o)=>{let c=Object(h.a)(t,e,{$view:o},s.geometryType,i);return null!==c&&n&&(c=n.call(null,c,a)),null!==c?c:r}}return r}function F(t,e,i,r){for(const s of i)if(s.valueExpressionInfo){const t=e[s.primitiveName]&&e[s.primitiveName][s.propertyName];t instanceof o.a&&(s.fn=(e,i,s)=>Object(h.a)(t,e,{$view:s},r.geometryType,i))}return(e,r,n)=>{for(const t of i)t.fn&&(t.value=t.fn(e,r,n));return Object(s.b)(t+u.b.buildOverrideKey(i)).toString()}}function A(t,e){if(!e||0===e.length)return t;const i=JSON.parse(JSON.stringify(t));return u.b.applyOverrides(i,e),i}},588:function(t,e,i){"use strict";var s=i(6),r=i(13),n=i(326);const o=new Map;e.a=function(t,e,i,a,c){const l=t.referencesGeometry()&&c?function(t,e,i){const{transform:a,hasZ:c,hasM:l}=i;o.has(e)||o.set(e,function(t){const e={};switch(t){case"esriGeometryPoint":return(t,i,s,r)=>Object(n.e)(i,e,t,s,r);case"esriGeometryPolygon":return(t,i,s,r)=>Object(n.f)(i,e,t,s,r);case"esriGeometryPolyline":return(t,i,s,r)=>Object(n.g)(i,e,t,s,r);case"esriGeometryMultipoint":return(t,i,s,r)=>Object(n.d)(i,e,t,s,r);default:return s.a.getLogger("esri.views.2d.support.arcadeOnDemand").error(new r.a("mapview-arcade",`Unable to handle geometryType: ${t}`)),t=>t}}(e));const h=o.get(e)(t.geometry,a,c,l);return{...t,geometry:h}}(e,a,c):e,h=t.repurposeFeature(l);try{return t.evaluate({...i,$feature:h})}catch(u){return s.a.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",u),null}}},589:function(t,e,i){"use strict";var s=i(576),r=i(572),n=i(575);class o{constructor(t){this.insertAfter=null,this.id=t,this.displayRecords=[],this.metrics=[]}copy(){const t=new o(this.id);return t.set(this),t}clone(){const t=new o(this.id);return t.displayRecords=this.displayRecords.map((t=>t.clone())),t.metrics=this.metrics.map((t=>t.clone())),t.insertAfter=this.insertAfter,t}set(t){this.id=t.id,this.displayRecords=t.displayRecords,this.metrics=t.metrics,this.insertAfter=t.insertAfter}serialize(t){return t.push(this.id),Object(r.b)(t,this.metrics),Object(r.b)(t,this.displayRecords),t}static deserialize(t){const e=t.readInt32(),i=new o(e),a={id:e},c=Object(r.a)(t,n.a);return c.length&&(i.metrics=c),i.displayRecords=Object(r.a)(t,s.a,a),i}}e.a=o},594:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var s=i(565);class r{constructor(t,e,i){this.data=t,this.stride=e,this.vertexCount=i}static decode(t){const e=Object(s.c)(t.data,t.stride),i=t.stride,n=t.vertexCount;return new r(e,i,n)}static fromVertexVector(t){const e=Object(s.c)(t.data.buffer(),t.stride),i=t.stride,n=t.vertexCount;return new r(e,i,n)}}class n{constructor(t,e,i){this.geometryType=t,this.indexBuffer=new Uint32Array(e),this.namedBuffers=i}static decode(t){const e=t.geometryType,i=t.indexBuffer,s={};for(const n in t.namedBuffers)s[n]=r.decode(t.namedBuffers[n]);return new n(e,i,s)}static fromVertexVectors(t){const e=t.geometryType,i=t.indexVector.buffer(),s={};for(const n in t.namedVectors)s[n]=r.fromVertexVector(t.namedVectors[n]);return new n(e,i,s)}}},595:function(t,e,i){"use strict";function s(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}i.d(e,"a",(function(){return s}))},596:function(t,e,i){"use strict";i.d(e,"a",(function(){return l}));var s=i(576),r=i(572),n=i(575),o=i(589),a=class{constructor(t){this._pos=0,this._buffer=t,this._i32View=new Int32Array(this._buffer),this._f32View=new Float32Array(this._buffer)}readInt32(){return this._i32View[this._pos++]}readF32(){return this._f32View[this._pos++]}},c=i(577);class l{constructor(t,e){this.vertexVectorsMap=t,this._currentIndex=-1,this._currentRecordOffset=0,this._currentMetricOffset=0,this._currentMetrics=[];const i=4*(4*e.features+1),s=4*(8*e.records+1),r=4*(20*e.metrics+1);this._bufDisplayObjects=new c.a(Uint32Array,i+4),this._bufDisplayRecords=new c.a(Uint32Array,s+4),this._bufMetrics=new c.a(Uint32Array,r+4),this._bufDisplayObjects.push(0),this._bufDisplayRecords.push(0),this._bufMetrics.push(0)}get vertexBuffersMap(){if(!this._vertexBuffersMap){this._vertexBuffersMap={};for(let t=0;t<this.vertexVectorsMap.length;t++)this._vertexBuffersMap[t]=this.vertexVectorsMap[t].intoBuffers();this.vertexVectorsMap=null}return this._vertexBuffersMap}get(t){return this.vertexVectorsMap[t]}currentDisplayRecordCount(){return this._bufDisplayRecords[this._currentRecordOffset]}writeDisplayObject(t,e){this._bufDisplayObjects.incr(0),this._currentIndex=this._bufDisplayObjects.push(t),this._bufDisplayObjects.push(e),this._bufDisplayObjects.push(0),this._bufDisplayObjects.push(0),this._currentRecordOffset=0,this._currentMetricOffset=0,this._currentMetrics=[]}hasDisplayRecords(){return!(0===this._currentRecordOffset)}endDisplayObject(){this.hasDisplayRecords()?this._currentMetrics&&(0===this._currentMetricOffset&&(this._bufDisplayObjects.setValue(this._currentIndex+3,this._bufMetrics.length),this._currentMetricOffset=this._bufMetrics.length),Object(r.b)(this._bufMetrics,this._currentMetrics)):this._rollbackDisplayObject()}writeDisplayRecord(t,e,i,s,r,n,o=0,a=0){0===this._currentRecordOffset&&(this._currentRecordOffset=this._bufDisplayRecords.push(0),this._bufDisplayObjects.setValue(this._currentIndex+2,this._currentRecordOffset)),this._bufDisplayRecords.incr(this._currentRecordOffset),this._bufDisplayRecords.push(t),this._bufDisplayRecords.push(e),this._bufDisplayRecords.push(i),this._bufDisplayRecords.push(s),this._bufDisplayRecords.push(r),this._bufDisplayRecords.push(n),this._bufDisplayRecords.push(o),this._bufDisplayRecords.push(a)}writeMetrics(t){t&&this._currentMetrics.push(...t)}static deserializeDisplayObjects(t){const{bufDisplayObjects:e,bufMetrics:i,bufRecords:c}=t,l=new a(e),h=new a(c),u=new a(i),f=[];let d=l.readInt32();for(h.readInt32(),u.readInt32();d--;){const t=l.readInt32(),e=l.readInt32(),i=l.readInt32(),a=l.readInt32(),c=new o.a(t);0!==e&&(c.insertAfter=e),0!==i&&(c.displayRecords=Object(r.a)(h,s.a,{id:t})),0!==a&&(c.metrics=Object(r.a)(u,n.a)),f.push(c)}return f}encode(t,e){const i={};for(let s=0;s<this.vertexVectorsMap.length;s++){const t=this.vertexVectorsMap[s];i[s]={},t.transfer(i[s],e)}t.bufDisplayObjects=this._bufDisplayObjects.buffer(),t.bufRecords=this._bufDisplayRecords.buffer(),t.bufMetrics=this._bufMetrics.buffer(),e.push(t.bufDisplayObjects),e.push(t.bufMetrics),e.push(t.bufRecords),t.vertexBuffersMap=i,this.destroy()}destroy(){this.vertexVectorsMap=null,this._bufDisplayObjects=null,this._bufDisplayRecords=null,this._bufMetrics=null}_rollbackDisplayObject(){this._bufDisplayObjects.decr(0),this._bufDisplayObjects.seek(this._bufDisplayObjects.length-4),this._currentIndex=this._bufDisplayObjects.length}}},599:function(t,e,i){"use strict";var s=i(25),r=i(578),n=i(586),o=i(566),a=i(568),c=i(600),l=i(571);class h extends(Object(c.a)(l.a)){constructor(t,e,i,n,a,c,l,h,u,f,d,m,p,y,b,x,_,g=!1){super(),this._xOffset=Object(s.e)(m),this._yOffset=Object(s.e)(p),this._decoration=u||"none",this._color=n,this._haloColor=a,this._haloSize=Math.min(Math.floor(5*Object(s.e)(Object(s.g)(i))),127),this._size=Math.min(Math.round(Object(s.e)(e)),127);const O=Math.min(Math.round(Object(s.e)(e)),127);this._referenceSize=Math.round(Math.sqrt(256*O)),this._scale=this._size/24,this._angle=d,this._justify=Object(r.c)(c||"center"),this._xAlignD=Object(r.d)(c||"center"),this._yAlignD=Object(r.f)(l||"baseline"),this._baseline="baseline"===(l||"baseline"),this._bitset=(1===h?1:0)|(f?1:0)<<1;const v=o.e.load(t);v.sdf=!0,this._materialKey=v.data,this._lineWidth=Object(s.e)(y)||512,this._lineHeight=b||1,this._textPlacement=x,this.effects=_,this._isCIM=g}static fromText(t,e){const i=new h(t.materialKey,t.font.size,t.haloSize||0,t.color&&Object(a.d)(t.color)||0,t.haloColor&&Object(a.d)(t.haloColor)||0,t.horizontalAlignment,t.verticalAlignment,0,t.font.decoration,!1,t.angle||0,t.xoffset,t.yoffset,t.lineWidth,t.lineHeight,null,null,!1),[,s]=Object(n.a)(t.text);return i.bindTextInfo(e,s),i}static fromCIMText(t,e){const i=t.scaleFactor||1,s=new h(t.materialKey,t.size*t.sizeRatio*i,t.outlineSize*t.sizeRatio,Object(a.c)(t.color),Object(a.c)(t.outlineColor),t.horizontalAlignment,t.verticalAlignment,t.alignment,t.decoration,t.colorLocked,t.angle,t.offsetX*t.sizeRatio*i,t.offsetY*t.sizeRatio*i,512,1,t.markerPlacement,t.effects,!0),[,r]=Object(n.a)(t.text);return s.bindTextInfo(e,r),s}}e.a=h},600:function(t,e,i){"use strict";var s=i(2),r=i(25),n=i(426),o=i(448),a=i(567),c=i(628),l=i(564),h=i(566),u=i(601);e.a=t=>class extends t{constructor(...t){super(...t),this._isCIM=!1,this.geometryType=l.d.TEXT,this._aux=Object(a.b)(0,0,this._referenceSize,this._bitset)}bindTextInfo(t,e){t&&t.length?this._shapingInfo=Object(s.a)(t,(t=>Object(c.a)(t,e,{scale:this._scale,angle:this._angle,xOffset:this._xOffset,yOffset:this._yOffset,hAlign:this._xAlignD,vAlign:this._yAlignD,maxLineWidth:Math.max(32,Math.min(this._lineWidth,512)),lineHeight:o.n*Math.max(.25,Math.min(this._lineHeight,4)),decoration:this._decoration,isCIM:this._isCIM}))):this._shapingInfo=null}writeMeshWithGeometry(t,e,i,r,o,a){if(Object(s.i)(this._textPlacement)){const s=null!=a?a:i.readLegacyGeometry();return this._writePlacedText(t,e,o,s)}const c=a?Object(n.p)(Object(n.d)(a),2):"esriGeometryPolygon"===r?i.readCentroid():i.readUnquantizedGeometry();if(c){if(c.isPoint){const[i,s]=c.coords;return this._writeGlyphs(t,e,o,{x:i,y:s})}c.forEachVertex(((i,s)=>this._writeGlyphs(t,e,o,{x:i,y:s})))}}_writePlacedText(t,e,i,n){const o=this._shapingInfo;if(Object(s.h)(o))return;const c=h.e.load(this._materialKey),l=Object(s.o)(this._textPlacement),f=u.a.getPlacement(n,l,Object(r.e)(1));if(!f)return;let d,m,p=f.next();for(;null!=p;){m=Object(a.a)(Math.round(8*p.tx),Math.round(8*p.ty)),d=p.getAngle(),o.setRotation(d);for(const s of o.glyphs){c.textureBinding=s.textureBinding;const r=e.getVector("geometry").vertexCount,n=e.indexVector.length,o=this._writeIndices(e),a=this._writeVertex(e,i,m,s);t.writeDisplayRecord(this.geometryType,c.data,r,a,n,o)}o.setRotation(-d),p=f.next()}}_writeGlyphs(t,e,i,r){const n=this._shapingInfo;if(Object(s.h)(n))return;const o=h.e.load(this._materialKey),c=Object(a.a)(Math.round(8*r.x),Math.round(8*r.y));for(const s of n.glyphs){o.textureBinding=s.textureBinding;const r=e.getVector("geometry").vertexCount,n=e.indexVector.length,a=this._writeIndices(e),l=this._writeVertex(e,i,c,s);t.writeDisplayRecord(this.geometryType,o.data,r,l,n,a)}}_writeVertexCommon(t,e,i,s){const r=this._color,n=this._haloColor,o=Object(a.b)(0,0,this._referenceSize,this._bitset),c=Object(a.b)(0,0,this._size,this._haloSize);t.push(i),t.push(e),t.push(r),t.push(n),t.push(c),t.push(o)}_writeVertex(t,e,i,s){const r=t.get("geometry");return this._writeVertexCommon(r,e,i,s),r.push(s.offsets.upperLeft),r.push(s.texcoords.upperLeft),this._writeVertexCommon(r,e,i,s),r.push(s.offsets.upperRight),r.push(s.texcoords.upperRight),this._writeVertexCommon(r,e,i,s),r.push(s.offsets.lowerLeft),r.push(s.texcoords.lowerLeft),this._writeVertexCommon(r,e,i,s),r.push(s.offsets.lowerRight),r.push(s.texcoords.lowerRight),4}_writeIndices(t){const e=t.getVector("geometry").vertexCount,i=t.indexVector;return i.push(e+0),i.push(e+1),i.push(e+2),i.push(e+1),i.push(e+3),i.push(e+2),6}}},601:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var s=i(584),r=i(622);class n{static getPlacement(t,e,i){const n=Object(r.b)(e);if(!n)return null;const o=Object(s.c)(t);return n.execute(o,e,i)}}},602:function(t,e,i){"use strict";var s=i(2),r=i(25),n=i(448),o=i(325),a=i(427),c=i(567),l=i(566),h=i(568),u=i(571),f=i(603);class d extends(Object(f.a)(u.a)){constructor(t,e,i,s,r,h,u,f,d,m,p,y,b,x,_,g,O,v,M,j,w){super(),this.angle=s,this.height=u,this.width=h,this.xOffset=e*M,this.yOffset=i*M,this._markerPlacement=j,this.effects=w,this._anchorX=.5-(.5+g)*_.width/_.width,this._anchorY=.5-(.5+O)*_.height/_.height;const S=(1===x?1:0)|(p?1:0)<<1|(b?1:0)<<2|(y?1:0)<<3,C=_&&_.sdf,L=l.d.load(t);L.sdf=C,L.pattern=!0,L.textureBinding=_.textureBinding,this._materialKey=L.data,this._fillColor=r,this._outlineColor=d,this._sizeOutlineWidth=Object(c.b)(Math.round(Math.min(Math.sqrt(128*h),255)),Math.round(Math.min(Math.sqrt(128*u),255)),Math.round(Math.min(Math.sqrt(128*m),255)),Math.round(Math.min(Math.sqrt(128*f),255)));const z=_.rect.x+n.r,T=_.rect.y+n.r,I=z+_.width,P=T+_.height;this._texUpperLeft=Object(c.a)(z,T),this._texUpperRight=Object(c.a)(I,T),this._texBottomLeft=Object(c.a)(z,P),this._texBottomRight=Object(c.a)(I,P),h*=v,u*=v,h*=M,u*=M;const k=Math.round(Math.min(64*v,255));this._bitestAndDistRatio=Object(c.b)(0,0,S,k),this._computedWidth=h,this._computedHeight=u;const R=Object(a.a)(),D=Object(o.a)();this._applyTransformation(D,R)}static fromCIMMarker(t,e){const i=e&&e.width||1,n=e&&e.height||1,o=t.size,a=i/n*t.scaleX,c=t.scaleSymbolsProportionally&&t.frameHeight?o/t.frameHeight:1,l=Object(h.c)(t.color),u=Object(h.c)(t.outlineColor),f=Object(r.e)(o),m=f*a,p=Object(r.e)(t.offsetX||0),y=Object(r.e)(t.offsetY||0),b=Object(r.e)(t.outlineWidth||0)*c,x=t.alignment||0,_=Object(r.e)(t.referenceSize);let g=t.rotation||0;t.rotateClockwise||(g=-g);let O=0,v=0;const M=t.anchorPoint;return M&&(t.isAbsoluteAnchorPoint?o&&(O=-M.x/(o*a),v=M.y/o):(O=M.x,v=M.y)),new d(t.materialKey,p,y,g,l,m,f,_,u,b,t.colorLocked,t.scaleSymbolsProportionally,!1,x,e,O,v,t.sizeRatio,Object(s.p)(t.scaleFactor,1),t.markerPlacement,t.effects)}static fromPictureMarker(t,e){const i=Math.round(Object(r.e)(t.width)),s=Math.round(Object(r.e)(t.height)),o=n.q,a=Math.round(Object(r.e)(t.xoffset||0)),c=Math.round(Object(r.e)(t.yoffset||0));return new d(t.materialKey,a,c,t.angle,o,i,s,s,0,0,!1,!1,!1,0,e,0,0,1,1,null,null)}static fromSimpleMarker(t,e){const i=Object(h.d)(t.color),s=Math.round(Object(r.e)(t.size)),n=s,o=Math.round(Object(r.e)(t.xoffset||0)),a=Math.round(Object(r.e)(t.yoffset||0)),c=t.style,l=t.outline,u=0|(l&&l.color&&Object(h.d)(l.color)),f=0|(l&&l.width&&Math.round(Object(r.e)(l.width))),m=new d(t.materialKey,o,a,t.angle,i,s,n,n,u,f,!1,!1,"esriSMSCross"===c||"esriSMSX"===c,0,e,0,0,126/64,1,null,null);return m.boundsType="esriSMSCircle"===c?"circle":"square",m}static fromLineSymbolMarker(t,e){const i=Object(h.d)(t.color),s=Math.round(Object(r.e)(6*t.lineWidth)),n=s,o="cross"===t.style||"x"===t.style;let a;switch(t.placement){case"begin-end":a="Both";break;case"begin":a="JustBegin";break;case"end":a="JustEnd";break;default:a="None"}const c={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:a,offsetAlongLine:0},l=new d(t.materialKey,0,0,0,i,s,n,n/6,i,o?Math.round(Object(r.e)(t.lineWidth)):0,!1,!1,o,1,e,0,0,126/64,1,c,null);return l.boundsType="circle"===t.style?"circle":"square",l}}e.a=d},603:function(t,e,i){"use strict";var s=i(2),r=i(25),n=i(426),o=i(22),a=i(73),c=i(325),l=i(427),h=i(567),u=i(564),f=i(601);e.a=t=>class extends t{constructor(...t){super(...t),this.angle=0,this.xOffset=0,this.yOffset=0,this.width=0,this.height=0,this.boundsType="square",this._anchorX=0,this._anchorY=0,this._computedWidth=0,this._computedHeight=0,this.geometryType=u.d.MARKER}writeMeshWithGeometry(t,e,i,r,o,a){const c=e.indexVector,l=e.get("geometry"),h=e.getVector("geometry"),u=h.vertexCount,f=u,d=c.length;if(Object(s.i)(this._markerPlacement)){const t=null!=a?a:i.readLegacyGeometry();this._writePlacedMarkers(l,c,u,o,t)}else{const t=a?Object(n.p)(Object(n.d)(a),2):"esriGeometryPolygon"===r?i.readCentroid():i.readUnquantizedGeometry();if(!t)return;if(t.isPoint){const[e,i]=t.coords;this._writeVertices(l,o,this._getPos(e,i)),this._writeIndices(c,u)}else t.forEachVertex(((t,e)=>{const i=h.vertexCount;this._writeVertices(l,o,this._getPos(t,e)),this._writeIndices(c,i)}))}const m=e.getVector("geometry").vertexCount-f,p=c.length-d;t.writeDisplayRecord(this.geometryType,this._materialKey,f,m,d,p)}_applyTransformation(t,e,i=0){Object(a.d)(t),Object(a.h)(t,t,Object(l.b)(this.xOffset,-this.yOffset)),this.angle+i!==0&&Object(a.f)(t,t,.017453292519944444*(this.angle+i));const s=this._computedWidth,r=this._computedHeight,n=(this._anchorX-.5)*s,c=(this._anchorY-.5)*r;Object(o.p)(e,n,c),Object(o.q)(e,e,t),this._offsetUpperLeft=Object(h.a)(16*e[0],16*e[1]),Object(o.p)(e,n+s,c),Object(o.q)(e,e,t),this._offsetUpperRight=Object(h.a)(16*e[0],16*e[1]),Object(o.p)(e,n,c+r),Object(o.q)(e,e,t),this._offsetBottomLeft=Object(h.a)(16*e[0],16*e[1]),Object(o.p)(e,n+s,c+r),Object(o.q)(e,e,t),this._offsetBottomRight=Object(h.a)(16*e[0],16*e[1])}_writePlacedMarkers(t,e,i,n,o){const a=f.a.getPlacement(o,Object(s.o)(this._markerPlacement),Object(r.e)(1));if(!a)return;const h=Object(l.a)(),u=Object(c.a)();let d=0,m=a.next();for(;null!=m;)m.tx>=-128&&m.tx<=640&&m.ty>=-128&&m.ty<=640&&(this._applyTransformation(u,h,m.getAngle()/.017453292519944444),this._writeVertices(t,n,this._getPos(m.tx,m.ty)),this._writeIndices(e,i+d),d+=4),m=a.next()}_getPos(t,e){return Object(h.a)(Math.round(8*t),Math.round(8*e))}_writeVertices(t,e,i){t.push(i),t.push(this._offsetUpperLeft),t.push(this._texUpperLeft),t.push(this._bitestAndDistRatio),t.push(e),t.push(this._fillColor),t.push(this._outlineColor),t.push(this._sizeOutlineWidth),t.push(i),t.push(this._offsetUpperRight),t.push(this._texUpperRight),t.push(this._bitestAndDistRatio),t.push(e),t.push(this._fillColor),t.push(this._outlineColor),t.push(this._sizeOutlineWidth),t.push(i),t.push(this._offsetBottomLeft),t.push(this._texBottomLeft),t.push(this._bitestAndDistRatio),t.push(e),t.push(this._fillColor),t.push(this._outlineColor),t.push(this._sizeOutlineWidth),t.push(i),t.push(this._offsetBottomRight),t.push(this._texBottomRight),t.push(this._bitestAndDistRatio),t.push(e),t.push(this._fillColor),t.push(this._outlineColor),t.push(this._sizeOutlineWidth)}_writeIndices(t,e){const i=e;t.push(i+0),t.push(i+1),t.push(i+2),t.push(i+1),t.push(i+3),t.push(i+2)}}},604:function(t,e,i){"use strict";i.d(e,"a",(function(){return Bt})),i.d(e,"b",(function(){return Nt}));var s=i(6),r=i(13),n=i(9),o=i(451),a=i(573),c=i(597),l=i(599),h=i(602),u=i(29),f=i(25),d=i(448),m=i(567),p=i(566),y=i(568),b=i(583),x=i(569),_=i(426),g=i(564),O=i(147),v=(i(642),i(593));function M(t,e,i,s,r,n,o){Y=0;const a=(s-i)*n,c=r&&r.length,l=c?(r[0]-i)*n:a;let h,u,f,d,m,p=j(e,i,s,0,l,n,!0);if(p&&p.next!==p.prev){if(c&&(p=function(t,e,i,s,r,n){const o=new Array;for(let a=0,c=s.length;a<c;a++){const r=j(t,e,i,s[a]*n,a<c-1?s[a+1]*n:i*n,n,!1);r===r.next&&(r.steiner=!0),o.push(I(r))}o.sort(B);for(const a of o)P(a,r),r=w(r,r.next);return r}(e,i,s,r,p,n)),a>80*n){h=f=e[0+i*n],u=d=e[1+i*n];for(let t=n;t<l;t+=n){const s=e[t+i*n],r=e[t+1+i*n];h=Math.min(h,s),u=Math.min(u,r),f=Math.max(f,s),d=Math.max(d,r)}m=Math.max(f-h,d-u),m=0!==m?1/m:0}S(p,t,n,h,u,m,o,0)}}function j(t,e,i,s,r,n,o){let a;if(o===function(t,e,i,s,r,n){let o=0;for(let a=s,c=r-n;a<r;a+=n)o+=(t[c+e*n]-t[a+e*n])*(t[a+1+e*n]+t[c+1+e*n]),c=a;return o}(t,e,0,s,r,n)>0)for(let c=s;c<r;c+=n)a=z(c+e*n,t[c+e*n],t[c+1+e*n],a);else for(let c=r-n;c>=s;c-=n)a=z(c+e*n,t[c+e*n],t[c+1+e*n],a);return a&&N(a,a.next)&&(T(a),a=a.next),a}function w(t,e=t){if(!t)return t;let i,s=t;do{if(i=!1,s.steiner||!N(s,s.next)&&0!==R(s.prev,s,s.next))s=s.next;else{if(T(s),s=e=s.prev,s===s.next)break;i=!0}}while(i||s!==e);return e}function S(t,e,i,s,r,n,o,a){if(!t)return;!a&&n&&(t=k(t,s,r,n));let c=t;for(;t.prev!==t.next;){const l=t.prev,h=t.next;if(n?L(t,s,r,n):C(t))e.push(l.index/i+o),e.push(t.index/i+o),e.push(h.index/i+o),T(t),t=h.next,c=h.next;else if((t=h)===c){a?1===a?S(t=E(t,e,i,o),e,i,s,r,n,o,2):2===a&&Z(t,e,i,s,r,n,o):S(w(t),e,i,s,r,n,o,1);break}}}function C(t){const e=t.prev,i=t,s=t.next;if(R(e,i,s)>=0)return!1;let r=t.next.next;const n=r;let o=0;for(;r!==t.prev&&(0===o||r!==n);){if(o++,V(e.x,e.y,i.x,i.y,s.x,s.y,r.x,r.y)&&R(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function L(t,e,i,s){const r=t.prev,n=t,o=t.next;if(R(r,n,o)>=0)return!1;const a=r.x<n.x?r.x<o.x?r.x:o.x:n.x<o.x?n.x:o.x,c=r.y<n.y?r.y<o.y?r.y:o.y:n.y<o.y?n.y:o.y,l=r.x>n.x?r.x>o.x?r.x:o.x:n.x>o.x?n.x:o.x,h=r.y>n.y?r.y>o.y?r.y:o.y:n.y>o.y?n.y:o.y,u=A(a,c,e,i,s),f=A(l,h,e,i,s);let d=t.prevZ,m=t.nextZ;for(;d&&d.z>=u&&m&&m.z<=f;){if(d!==t.prev&&d!==t.next&&V(r.x,r.y,n.x,n.y,o.x,o.y,d.x,d.y)&&R(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,m!==t.prev&&m!==t.next&&V(r.x,r.y,n.x,n.y,o.x,o.y,m.x,m.y)&&R(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;d&&d.z>=u;){if(d!==t.prev&&d!==t.next&&V(r.x,r.y,n.x,n.y,o.x,o.y,d.x,d.y)&&R(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;m&&m.z<=f;){if(m!==t.prev&&m!==t.next&&V(r.x,r.y,n.x,n.y,o.x,o.y,m.x,m.y)&&R(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function z(t,e,i,s){const r=U.create(t,e,i);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function T(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function I(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function P(t,e){if(e=function(t,e){let i=e;const s=t.x,r=t.y;let n,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const t=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=s&&t>o){if(o=t,t===s){if(r===i.y)return i;if(r===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(s===o)return n.prev;const a=n,c=n.x,l=n.y;let h,u=1/0;for(i=n.next;i!==a;)s>=i.x&&i.x>=c&&s!==i.x&&V(r<l?s:o,r,c,l,r<l?o:s,r,i.x,i.y)&&(h=Math.abs(r-i.y)/(s-i.x),(h<u||h===u&&i.x>n.x)&&F(i,t)&&(n=i,u=h)),i=i.next;return n}(t,e)){const i=G(e,t);w(i,i.next)}}function k(t,e,i,s){for(let r;r!==t;r=r.next){if(r=r||t,null===r.z&&(r.z=A(r.x,r.y,e,i,s)),r.prev.next!==r||r.next.prev!==r)return r.prev.next=r,r.next.prev=r,k(t,e,i,s);r.prevZ=r.prev,r.nextZ=r.next}return t.prevZ.nextZ=null,t.prevZ=null,function(t){let e,i=1;for(;;){let s,r=t;t=null,e=null;let n=0;for(;r;){n++,s=r;let o=0;for(;o<i&&s;o++)s=s.nextZ;let a=i;for(;o>0||a>0&&s;){let i;0===o?(i=s,s=s.nextZ,a--):0!==a&&s?r.z<=s.z?(i=r,r=r.nextZ,o--):(i=s,s=s.nextZ,a--):(i=r,r=r.nextZ,o--),e?e.nextZ=i:t=i,i.prevZ=e,e=i}r=s}if(e.nextZ=null,i*=2,n<2)return t}}(t)}function R(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function D(t,e,i,s){return!!(N(t,e)&&N(i,s)||N(t,s)&&N(i,e))||R(t,e,i)>0!=R(t,e,s)>0&&R(i,s,t)>0!=R(i,s,e)>0}function V(t,e,i,s,r,n,o,a){return(r-o)*(e-a)-(t-o)*(n-a)>=0&&(t-o)*(s-a)-(i-o)*(e-a)>=0&&(i-o)*(n-a)-(r-o)*(s-a)>=0}function F(t,e){return R(t.prev,t,t.next)<0?R(t,e,t.next)>=0&&R(t,t.prev,e)>=0:R(t,e,t.prev)<0||R(t,t.next,e)<0}function A(t,e,i,s,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-s)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function N(t,e){return t.x===e.x&&t.y===e.y}function B(t,e){return t.x-e.x}function E(t,e,i,s){let r=t;do{const n=r.prev,o=r.next.next;!N(n,o)&&D(n,r,r.next,o)&&F(n,o)&&F(o,n)&&(e.push(n.index/i+s),e.push(r.index/i+s),e.push(o.index/i+s),T(r),T(r.next),r=t=o),r=r.next}while(r!==t);return r}function Z(t,e,i,s,r,n,o){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.index!==t.index&&X(a,t)){let c=G(a,t);return a=w(a,a.next),c=w(c,c.next),S(a,e,i,s,r,n,o,0),void S(c,e,i,s,r,n,o,0)}t=t.next}a=a.next}while(a!==t)}function X(t,e){return t.next.index!==e.index&&t.prev.index!==e.index&&!function(t,e){let i=t;do{if(i.index!==t.index&&i.next.index!==t.index&&i.index!==e.index&&i.next.index!==e.index&&D(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&F(t,e)&&F(e,t)&&function(t,e){let i=t,s=!1;const r=(t.x+e.x)/2,n=(t.y+e.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&r<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next}while(i!==t);return s}(t,e)}function G(t,e){const i=U.create(t.index,t.x,t.y),s=U.create(e.index,e.x,e.y),r=t.next,n=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,s.next=i,i.prev=s,n.next=s,s.prev=n,s}class U{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(t,e,i){const s=K[Y++];return s.index=t,s.x=e,s.y=i,s.prev=null,s.next=null,s.z=null,s.prevZ=null,s.nextZ=null,s.steiner=!1,s}}const K=new Array;let Y=0;for(let Et=0;Et<8096;Et++)K.push(new U);const H=new(i(625).a),W=new v.b(0,0,0,1,128);function q(t,e,i){let s=0;for(let r=1;r<i;r++){const i=t[2*(e+r-1)],n=t[2*(e+r-1)+1];s+=(t[2*(e+r)]-i)*(t[2*(e+r)+1]+n)}return s}function J(t,e,i,s,r){let n=0;for(let o=i;o<s;o+=3){const i=2*(t.getValue(o)-r),s=2*(t.getValue(o+1)-r),a=2*(t.getValue(o+2)-r);n+=Math.abs((e[i]-e[a])*(e[s+1]-e[i+1])-(e[i]-e[s])*(e[a+1]-e[i+1]))}return n}W.setExtent(d.F);var $=t=>class extends t{constructor(...t){super(...t),this.forceLibtess=!1,this.geometryType=g.d.FILL}writeMeshWithGeometry(t,e,i,s,r,n){const o=p.a.load(this._materialKey),a=e.indexVector,c=e.getVector("geometry"),l=c.vertexCount,h=a.length;let u=n?Object(_.p)(Object(_.d)(n),2):i.readUnquantizedGeometry();if(!u)return;if(u=function(t){if(!function(t,e,i){let s=0;for(let r=0;r<t.lengths.length;r++){const e=t.lengths[r];for(let r=0;r<e;r++){const e=t.coords[2*(r+s)],n=t.coords[2*(r+s)+1];if(e<-128||e>i||n<-128||n>i)return!0}s+=e}return!1}(t,0,d.F+128))return t;W.reset(3);let e=0;for(let n=0;n<t.lengths.length;n++){const i=t.lengths[n];let s=t.coords[2*(0+e)],r=t.coords[2*(0+e)+1];W.moveTo(s,r);for(let n=1;n<i;n++)s=t.coords[2*(n+e)],r=t.coords[2*(n+e)+1],W.lineTo(s,r);W.close(),e+=i}const i=W.result(!1);if(!i)return null;const s=[],r=[];for(const n of i){let t=0;for(const e of n)r.push(e.x),r.push(e.y),t++;s.push(t)}return new O.a(s,r)}(u),!u)return;let f=u.coords;!this.forceLibtess&&function(t,e,i){const{coords:s,lengths:r,hasIndeterminateRingOrder:n}=e;if(n)return!1;const o=t.length;let a=0;for(let c=0;c<r.length;){let e=c,n=r[c],l=q(s,a,n);const h=[];for(;++e<r.length;){const t=r[e],i=q(s,a+n,t);if(!(i>0))break;l+=i,h.push(a+n),n+=t}const u=t.length;M(t,s,a,a+n,h,2,i);const f=J(t,s,u,t.length,i),d=Math.abs(l);if(Math.abs((f-d)/Math.max(1e-7,d))>1e-5)return t.seek(o),!1;c=e,a+=n}return!0}(a,u,l)||(f=[],function(t,e,i,s){const r=[],{coords:n,lengths:o}=i;H.beginPolygon(t,r);let a=0;for(let c=0;c<o.length;c++){const t=i.lengths[c];H.beginContour();for(let e=0;e<t;e++){const t=[n[2*(a+e)],n[2*(a+e)+1],0];H.addVertex(t,t)}H.endContour(),a+=t}H.endPolygon();for(let c=0;c<r.length;c++)e.push(r[c]+s)}(f,a,u,l)),this._write(c,i,r,f,o);const m=c.vertexCount-l,y=a.length-h;t.writeDisplayRecord(this.geometryType,this._materialKey,l,m,h,y)}_write(t,e,i,s,r){for(let n=0;n<s.length;n+=2){const o=Object(m.a)(1*s[n],1*s[n+1]);t.data.push(o),t.data.push(i),r.dotDensity?t.data.writeF32(1/Math.abs(e.readGeometryArea())):(t.data.push(this.fillColor),t.data.push(this.tl),t.data.push(this.br),t.data.push(this.aux1),t.data.push(this.aux2),t.data.push(this.aux3))}}},Q=i(587),tt=i(571);const et=s.a.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");var it=class extends tt.a{constructor(t){super(),this._ongoingMaterialRequestMap=new Map,this._materialCache=new Map,this._dynamicPropertyMap=new Map,this._cimLayer=t}analyze(t,e,i,s){const r=e.readLegacyFeature(),o=this._materialCache,a=this._cimLayer.materialHash;if(!a)return et.error("A Dynamic mesh template must have a material hash value or function!"),Object(n.t)(null);const c="function"==typeof a?a(r,i,s):a;if(o.has(c)){const t=o.get(c);return Object(n.u)(t)}if(this._ongoingMaterialRequestMap.has(c))return this._ongoingMaterialRequestMap.get(c);const l=Object(Q.a)(this._cimLayer.cim,this._cimLayer.materialOverrides);l.mosaicHash=c;const h=t.getMosaicItem(l).then((t=>(this._ongoingMaterialRequestMap.delete(c),o.set(c,t),t))).catch((t=>(this._ongoingMaterialRequestMap.delete(c),et.error(".analyze()",t.message),null)));return this._ongoingMaterialRequestMap.set(c,h),h}};class st extends($(it)){constructor(t){if(super(t),Object(x.c)(t.color)){const e=(e,i,s)=>{const r=t.color(e,i,s);return r&&Object(y.c)(r)||0};this._dynamicPropertyMap.set("_fillColor",e)}else{const e=t.color;this.fillColor=e&&Object(y.c)(e)||0}let e=0;Object(x.c)(t.height)||(e=t.height||0),this._dynamicPropertyMap.set("_height",((i,s,r)=>Object(x.c)(t.height)?t.height(i,s,r):e));let i=0;Object(x.c)(t.offsetX)||(i=Object(f.e)(t.offsetX||0)+128,i>255&&(i=255)),this._dynamicPropertyMap.set("_offsetX",((e,s,r)=>{if(Object(x.c)(t.offsetX)){let i=Object(f.e)(t.offsetX(e,s,r))+128;return i>255&&(i=255),i}return i}));let s=1;Object(x.c)(t.scaleX)||(s=t.scaleX||1),this._dynamicPropertyMap.set("_scaleX",((e,i,r)=>Object(x.c)(t.scaleX)?t.scaleX(e,i,r):s));let r=0;Object(x.c)(t.offsetY)||(r=Object(f.e)(-t.offsetY||0)+128,r>255&&(r=255)),this._dynamicPropertyMap.set("_offsetY",((e,i,s)=>{if(Object(x.c)(t.offsetY)){let r=Object(f.e)(-t.offsetY(e,i,s))+128;return r>255&&(r=255),r}return r}));let n=0;Object(x.c)(t.angle)||(n=Object(b.d)(t.angle)||0),this._dynamicPropertyMap.set("_angle",((e,i,s)=>Object(x.c)(t.angle)?Object(b.d)(t.angle(e,i,s)):n)),this.effects=t.effects,this._cimFillLayer=t,this._fillMaterialKey=p.a.load(t.materialKey)}static fromCIMFill(t){return new st(t)}bindFeature(t,e,i){const s=t.readLegacyFeature();this._dynamicPropertyMap.forEach(((t,r)=>{this[r]=t(s,e,i)}));const r=this._fillMaterialKey,n=this._materialCache,o=this._cimFillLayer;this.aux3=Object(m.b)(0,0,this._angle,o.colorLocked?1:0);const c=(0,o.materialHash)(s,e,i),l=n.get(c);let h=null;if(l&&Object(a.a)(l.spriteMosaicItem)&&(h=l.spriteMosaicItem),h){const{rect:t,width:e,height:i}=h,s=t.x+d.r,n=t.y+d.r,o=s+e,a=n+i;let c=Object(u.n)(Object(f.e)(this._height));c>255?c=255:c<=0&&(c=Object(u.n)(a-n));let l=Object(u.n)(Object(f.e)(this._height/i*e||0));l>255?l=255:l<=0&&(l=Object(u.n)(o-s));const p=this._scaleX,y=1;this.tl=Object(m.a)(s,n),this.br=Object(m.a)(o,a),this.aux1=Object(m.b)(l,c,this._offsetX,this._offsetY),this.aux2=Object(m.a)(128*p,128*y),r.sdf=h.sdf,r.pattern=!0,r.textureBinding=h.textureBinding}else this.tl=0,this.br=0,this.aux1=0,this.aux2=0,r.sdf=!1,r.pattern=!1,r.textureBinding=0;this._materialKey=r.data}}var rt=st,nt=(i(7),i(626));const ot=d.F+16,at=new v.b(0,0,0,1,16);at.setExtent(d.F);const ct=new Uint32Array(9),lt=new Uint32Array(36),ht=new Uint32Array(3),ut=new Uint32Array(6),ft=t=>e=>{ut[0]=e.leftExit0,ut[1]=e.rightEntry0,ut[2]=e.leftExit2,ut[3]=e.rightEntry0,ut[4]=e.rightEntry2,ut[5]=e.leftExit2,t.indexCount+=6,t.indexBuf.writeRegion(ut)};var dt=t=>class extends t{constructor(...t){super(...t),this.tessellationProperties={_fillColor:null,_tl:null,_br:null,_halfWidth:null,_bitset:null,_halfReferenceWidth:null,id:null,indexBuf:null,indexCount:null,geometryBuf:null,vertexCount:null,offset:null},this._tessellationOptions={},this.geometryType=g.d.LINE}writeMeshWithGeometry(t,e,i,s,r,n){const o=e.indexVector,a=e.get("geometry"),c=e.getVector("geometry").vertexCount,l=o.length,h=null!=n?n:i.readLegacyGeometry();if(!h)return;switch(s){case"esriGeometryPolyline":{const t=this._clipLines(h.paths);if(0===t.length)return;this._write(o,a,c,r,t);break}case"esriGeometryPolygon":{const t=this._clipLines(h.rings);if(0===t.length)return;this._write(o,a,c,r,t);break}}const u=this.tessellationProperties.vertexCount,f=this.tessellationProperties.indexCount;t.writeDisplayRecord(this.geometryType,this._materialKey,c,u,l,f)}_clipLines(t){const e=[];let i=!1,s=0;for(;s<t.length;){const r=[],n=t[s];at.reset(2);let[o,a]=n[0];if(i)at.moveTo(o,a);else{if(o<-16||o>ot||a<-16||a>ot){i=!0;continue}r.push({x:o,y:a})}let c=!1;const l=n.length;for(let t=1;t<l;++t)if(o+=n[t][0],a+=n[t][1],i)at.lineTo(o,a);else{if(o<-16||o>ot||a<-16||a>ot){c=!0;break}r.push({x:o,y:a})}if(c)i=!0;else{if(i){const t=at.resultWithStarts();if(t)for(const i of t)e.push(i)}else e.push({line:r,start:0});s++,i=!1}}return e}_write(t,e,i,s,r){this.tessellationProperties.id=s,this.tessellationProperties.indexBuf=t,this.tessellationProperties.indexCount=0,this.tessellationProperties.geometryBuf=e,this.tessellationProperties.vertexCount=0,this.tessellationProperties.offset=i;for(const n of r){const t=n.line;t.length<2||(this._tessellationOptions.initialDistance=n.start%65535,this._tessellationCallbacks instanceof nt.a&&(this._tessellationCallbacks.capType=this._capType,this._tessellationCallbacks.joinType=this._joinType),Object(nt.d)(t,this._tessellationOptions,this._tessellationCallbacks),Object(nt.b)())}}_initializeTessellator(t){const e=p.c.load(this._materialKey);if(this._tessellationOptions.trackDistance=this._isDashed||this._hasPattern,this._tessellationOptions.thin=!t&&this.tessellationProperties._halfWidth<d.E/2&&!(e.vvSizeFieldStops||e.vvSizeMinMaxValue||e.vvSizeScaleStops||e.vvSizeUnitValue),this._tessellationOptions.wrapDistance=65535,this._tessellationOptions.outerBisectorAutoSplitThreshold=.2631578947368421,this._tessellationOptions.enableOuterBisectorSplit=this._isDashed||this._hasPattern,this._tessellationOptions.innerBisectorAutoSplitThreshold=.2631578947368421,this._tessellationOptions.enableInnerBisectorSplit=this._isDashed||this._hasPattern,this._tessellationOptions.thin)this._tessellationCallbacks={vertex:(i=this.tessellationProperties,t=>{const e=Math.ceil(1024*i._halfWidth),s=Math.ceil(1024*i._halfReferenceWidth);t.entry0=i.offset+i.vertexCount++;{const r=Object(m.a)(t.distance,e),n=Object(m.b)(Math.round(31*t.prevNormal.x),Math.round(31*t.prevNormal.y),Math.round(0),Math.round(-31)),o=Object(m.b)(0,0,0,i._bitset);lt[0]=Object(m.a)(8*t.currentVertex.x,8*t.currentVertex.y),lt[1]=i.id,lt[2]=i._fillColor,lt[3]=n,lt[4]=r,lt[5]=i._tl,lt[6]=i._br,lt[7]=o,lt[8]=Object(m.a)(s,0)}t.entry2=i.offset+i.vertexCount++;{const r=Object(m.a)(t.distance,e),n=Object(m.b)(Math.round(31*-t.prevNormal.x),Math.round(31*-t.prevNormal.y),Math.round(0),Math.round(31)),o=Object(m.b)(0,0,0,i._bitset);lt[9]=Object(m.a)(8*t.currentVertex.x,8*t.currentVertex.y),lt[10]=i.id,lt[11]=i._fillColor,lt[12]=n,lt[13]=r,lt[14]=i._tl,lt[15]=i._br,lt[16]=o,lt[17]=Object(m.a)(s,0)}t.exit0=i.offset+i.vertexCount++;{const r=Object(m.a)(t.distance,e),n=Object(m.b)(Math.round(31*t.nextNormal.x),Math.round(31*t.nextNormal.y),Math.round(0),Math.round(-31)),o=Object(m.b)(0,0,0,i._bitset);lt[18]=Object(m.a)(8*t.currentVertex.x,8*t.currentVertex.y),lt[19]=i.id,lt[20]=i._fillColor,lt[21]=n,lt[22]=r,lt[23]=i._tl,lt[24]=i._br,lt[25]=o,lt[26]=Object(m.a)(s,0)}t.exit2=i.offset+i.vertexCount++;{const r=Object(m.a)(t.distance,e),n=Object(m.b)(Math.round(31*-t.nextNormal.x),Math.round(31*-t.nextNormal.y),Math.round(0),Math.round(31)),o=Object(m.b)(0,0,0,i._bitset);lt[27]=Object(m.a)(8*t.currentVertex.x,8*t.currentVertex.y),lt[28]=i.id,lt[29]=i._fillColor,lt[30]=n,lt[31]=r,lt[32]=i._tl,lt[33]=i._br,lt[34]=o,lt[35]=Object(m.a)(s,0)}i.geometryBuf.writeRegion(lt)}),bridge:ft(this.tessellationProperties)};else{const t=new nt.a((t=>(e,i,s,r,n,o,a,c,l)=>{const h=Object(m.a)(l,Math.ceil(1024*t._halfWidth)),u=Object(m.b)(Math.round(31*n),Math.round(31*o),Math.round(31*a),Math.round(31*c)),f=Object(m.b)(31*s,31*r,0,t._bitset);return ct[0]=Object(m.a)(8*e,8*i),ct[1]=t.id,ct[2]=t._fillColor,ct[3]=u,ct[4]=h,ct[5]=t._tl,ct[6]=t._br,ct[7]=f,ct[8]=Object(m.a)(Math.ceil(1024*t._halfReferenceWidth),0),t.geometryBuf.writeRegion(ct),t.offset+t.vertexCount++})(this.tessellationProperties),(t=>(e,i,s)=>{ht[0]=e,ht[1]=i,ht[2]=s,t.indexCount+=3,t.indexBuf.writeRegion(ht)})(this.tessellationProperties));t.miterLimitCosine=this._miterLimitCosine,t.textured=this._isDashed||this._hasPattern,t.joinOnUTurn=this._joinOnUTurn,this._tessellationCallbacks=t}var i}};class mt extends(dt(it)){constructor(t){super(t),this._cimLineLayer=t;let e=0;if(Object(x.c)(t.width)||(e=.5*Object(f.e)(t.width)),this._dynamicPropertyMap.set("_halfWidth",((i,s,r)=>Object(x.c)(t.width)?.5*Object(f.e)(t.width(i,s,r)):e)),Object(x.c)(t.cap)?this._dynamicPropertyMap.set("_capType",t.cap):this._capType=t.cap,Object(x.c)(t.join)?this._dynamicPropertyMap.set("_joinType",t.join):this._joinType=t.join,Object(x.c)(t.color)){const e=(e,i,s)=>{const r=t.color(e,i,s);return r&&Object(y.c)(r)||0};this._dynamicPropertyMap.set("_fillColor",e)}else{const e=t.color;this._fillColor=e&&Object(y.c)(e)||0}if(Object(x.c)(t.miterLimit)){const e=(e,i,s)=>Object(x.b)(t.miterLimit(e,i,s));this._dynamicPropertyMap.set("_miterLimitCosine",e)}else this._miterLimitCosine=Object(x.b)(t.miterLimit);this._scaleFactor=t.scaleFactor||1,this._isDashed=t.isDashed,this.effects=t.effects,this.tessellationProperties._bitset=t.colorLocked?1:0,this._materialKey=t.materialKey,this._initializeTessellator(!0)}static fromCIMLine(t){return new mt(t)}bindFeature(t,e,i){const s=t.readLegacyFeature();this._dynamicPropertyMap.forEach(((t,r)=>{this[r]=t(s,e,i)})),this._halfWidth*=this._scaleFactor;const r=this._materialCache,n=(0,this._cimLineLayer.materialHash)(s,e,i),o=r.get(n);let c=null;if(o&&Object(a.a)(o.spriteMosaicItem)&&(c=o.spriteMosaicItem),c){this._hasPattern=!0;const{rect:t,width:e,height:i}=c,s=t.x+d.r,r=t.y+d.r,n=s+e,o=r+i;this.tessellationProperties._tl=Object(m.a)(s,r),this.tessellationProperties._br=Object(m.a)(n,o)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor,this.tessellationProperties._halfWidth=this._halfWidth,this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;const l=p.c.load(this._materialKey);c&&(l.sdf=c.sdf,l.pattern=!0,l.textureBinding=c.textureBinding),this._materialKey=l.data}}var pt=mt,yt=i(2),bt=i(325),xt=i(427),_t=i(603);const gt=Object(xt.a)(),Ot=Object(bt.a)(),vt=s.a.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate");class Mt extends(Object(_t.a)(it)){constructor(t){if(super(t),this._cimMarkerLayer=t,Object(x.c)(t.color)){const e=(e,i,s)=>Object(y.c)(t.color(e,i,s));this._dynamicPropertyMap.set("_fillColor",e)}else this._fillColor=Object(y.c)(t.color);if(Object(x.c)(t.outlineColor)){const e=(e,i,s)=>Object(y.c)(t.outlineColor(e,i,s));this._dynamicPropertyMap.set("_outlineColor",e)}else this._outlineColor=Object(y.c)(t.outlineColor);if(Object(x.c)(t.size)){const e=(e,i,s)=>Object(f.e)(t.size(e,i,s));this._dynamicPropertyMap.set("_size",e)}else this._size=Object(f.e)(t.size);if(Object(x.c)(t.scaleX)?this._dynamicPropertyMap.set("_scaleX",t.scaleX):this._scaleX=t.scaleX,Object(x.c)(t.offsetX)){const e=(e,i,s)=>Object(f.e)(t.offsetX(e,i,s));this._dynamicPropertyMap.set("xOffset",e)}else this.xOffset=Object(f.e)(t.offsetX);if(Object(x.c)(t.offsetY)){const e=(e,i,s)=>Object(f.e)(t.offsetY(e,i,s));this._dynamicPropertyMap.set("yOffset",e)}else this.yOffset=Object(f.e)(t.offsetY);if(Object(x.c)(t.outlineWidth)){const e=(e,i,s)=>Object(f.e)(t.outlineWidth(e,i,s));this._dynamicPropertyMap.set("_outlineWidth",e)}else this._outlineWidth=Object(f.e)(t.outlineWidth);Object(x.c)(t.rotation)?this._dynamicPropertyMap.set("_angle",t.rotation):this._angle=t.rotation,this._scaleFactor=Object(yt.p)(t.scaleFactor,1),this._markerPlacement=t.markerPlacement,this.effects=t.effects,this._bitSet=(1===t.alignment?1:0)|(t.colorLocked?1:0)<<1|(t.scaleSymbolsProportionally?1:0)<<3,this._materialKey=t.materialKey}static fromCIMMarker(t){return new Mt(t)}bindFeature(t,e,i){const s=t.readLegacyFeature();this._dynamicPropertyMap.forEach(((t,r)=>{this[r]=t(s,e,i)}));const n=this._cimMarkerLayer.materialHash,o="function"==typeof n?n(s,e,i):n,c=this._materialCache.get(o);if(!c||!Object(a.a)(c.spriteMosaicItem)||!c.spriteMosaicItem)return void vt.error(new r.a("mapview-cim","Encountered an error when binding feature"));const l=c.spriteMosaicItem,h=this._cimMarkerLayer.sizeRatio,u=l.width/l.height*this._scaleX,y=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle;let b=this._size,x=b*u;const _=this.xOffset,g=this.yOffset;this.xOffset*=this._scaleFactor,this.yOffset*=this._scaleFactor;const O=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/Object(f.e)(this._cimMarkerLayer.frameHeight):1,v=this._outlineWidth*O,M=Object(f.e)(this._cimMarkerLayer.referenceSize);let j=0,w=0;const S=this._cimMarkerLayer.anchorPoint;S&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(j=-S.x/(this._size*u),w=S.y/this._size):(j=S.x,w=S.y)),this._sizeOutlineWidth=Object(m.b)(Math.round(Math.min(Math.sqrt(128*x),255)),Math.round(Math.min(Math.sqrt(128*b),255)),Math.round(Math.min(Math.sqrt(128*v),255)),Math.round(Math.min(Math.sqrt(128*M),255))),this.angle=y;const C=Math.round(Math.min(64*h,255));this._bitestAndDistRatio=Object(m.b)(0,0,this._bitSet,C);const L=l.rect.x+d.r,z=l.rect.y+d.r,T=L+l.width,I=z+l.height;this._texUpperLeft=Object(m.a)(L,z),this._texUpperRight=Object(m.a)(T,z),this._texBottomLeft=Object(m.a)(L,I),this._texBottomRight=Object(m.a)(T,I);const P=p.d.load(this._materialKey);P.sdf=l.sdf,P.pattern=!0,P.textureBinding=l.textureBinding,this._materialKey=P.data,this._anchorX=.5-(.5+j)*l.width/l.width,this._anchorY=.5-(.5+w)*l.height/l.height,x*=h,b*=h,x*=this._scaleFactor,b*=this._scaleFactor,x*=l.rect.width/l.width,b*=l.rect.height/l.height,this._computedWidth=x,this._computedHeight=b,this._applyTransformation(Ot,gt),this.xOffset=_,this.yOffset=g}}var jt=Mt,wt=i(595),St=i(578),Ct=i(600);class Lt extends(Object(Ct.a)(it)){constructor(t){super(t),this._horizontalAlignment="center",this._verticalAlignment="middle",this._textToGlyphs=new Map;const e=t.scaleFactor||1;if(this._cimTextLayer=t,Object(x.c)(t.color)){const e=(e,i,s)=>Object(y.c)(t.color(e,i,s));this._dynamicPropertyMap.set("_color",e)}else this._color=Object(y.c)(t.color);if(Object(x.c)(t.color)){const e=(e,i,s)=>Object(y.c)(t.outlineColor(e,i,s));this._dynamicPropertyMap.set("_haloColor",e)}else this._haloColor=Object(y.c)(t.outlineColor);let i,s,r;if(Object(x.c)(t.size)||(i=Math.min(Math.round(Object(f.e)(t.size*t.sizeRatio)),127)),this._dynamicPropertyMap.set("_size",((e,s,r)=>Object(x.c)(t.size)?Math.min(Math.round(Object(f.e)(t.size(e,s,r)*t.sizeRatio)),127):i)),Object(x.c)(t.outlineSize)){const e=(e,i,s)=>Math.min(Math.floor(5*Object(f.e)(t.outlineSize(e,i,s)*t.sizeRatio)),127);this._dynamicPropertyMap.set("_haloSize",e)}else this._haloSize=Math.min(Math.floor(5*Object(f.e)(t.outlineSize*t.sizeRatio)),127);Object(x.c)(t.offsetX)||(s=Math.round(Object(f.e)(t.offsetX*t.sizeRatio))),this._dynamicPropertyMap.set("_xOffset",((e,i,r)=>Object(x.c)(t.offsetX)?Math.round(Object(f.e)(t.offsetX(e,i,r)*t.sizeRatio)):s)),Object(x.c)(t.offsetY)||(r=Math.round(Object(f.e)(t.offsetY*t.sizeRatio))),this._dynamicPropertyMap.set("_yOffset",((e,i,s)=>Object(x.c)(t.offsetY)?Math.round(Object(f.e)(t.offsetY(e,i,s)*t.sizeRatio)):r)),Object(x.c)(t.angle)?this._dynamicPropertyMap.set("_angle",t.angle):this._angle=t.angle,Object(x.c)(t.horizontalAlignment)?this._dynamicPropertyMap.set("_horizontalAlignment",t.horizontalAlignment):this._horizontalAlignment=t.horizontalAlignment,Object(x.c)(t.verticalAlignment)?this._dynamicPropertyMap.set("_verticalAlignment",t.verticalAlignment):this._verticalAlignment=t.verticalAlignment,this._scaleFactor=e,Object(x.c)(t.text)?this._dynamicPropertyMap.set("_text",t.text):this._text=t.text;const n=Math.min(Math.round(Object(f.e)(t.referenceSize*t.sizeRatio)),127);this._referenceSize=Math.round(Math.sqrt(256*n)),this._materialKey=t.materialKey;const o=p.f.load(this._materialKey);o.sdf=!0,this._bitset=(1===t.alignment?1:0)|(t.colorLocked?1:0)<<1,this._materialKey=o.data,this._decoration="none",this._lineHeight=1,this._lineWidth=512,this._textPlacement=t.markerPlacement,this.effects=t.effects,this._isCIM=!0}static fromCIMText(t){return new Lt(t)}async analyze(t,e,i,s){const r=e.readLegacyFeature(),n=function(t,e,i,s){return"string"==typeof t.text?t.text:"function"==typeof t.text?t.text(e,i,s):""}(this._cimTextLayer,r,i,s),o=await t.getMosaicItem(this._cimTextLayer.cim,Object(wt.a)(n));return this._textToGlyphs.set(n,o.glyphMosaicItems),o}bindFeature(t,e,i){const s=t.readLegacyFeature();if(this._dynamicPropertyMap.forEach(((t,r)=>{this[r]=t(s,e,i)})),!this._text||0===this._text.length)return void(this._shapingInfo=null);this._size*=this._scaleFactor,this._scale=this._size/24,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=Object(St.d)(this._horizontalAlignment||"center"),this._yAlignD=Object(St.f)(this._verticalAlignment||"baseline");const r=this._textToGlyphs.get(this._text);this.bindTextInfo(r,!1)}}var zt=Lt;class Tt extends($(tt.a)){constructor(t,e,i,s,r,n,o,a,c){super(),this.effects=c;const l=p.a.load(t);e&&(l.sdf=e.sdf,l.pattern=!0,l.textureBinding=e.textureBinding),this.fillColor=i,this.tl=s,this.br=r,this.aux1=n,this.aux2=o,this.aux3=a,this._materialKey=l.data}static fromCIMFill(t,e){const i=t.color,s=i&&Object(y.c)(i)||0,r=t.materialKey;if(!e){const e=Object(m.b)(0,0,0,t.colorLocked?1:0);return new Tt(r,null,s,0,0,0,0,e,t.effects)}const{rect:n,width:o,height:a}=e,c=n.x+d.r,l=n.y+d.r,h=c+o,p=l+a;let x=Object(u.n)(Object(f.e)(t.height||0));x>255?x=255:x<=0&&(x=Object(u.n)(p-l));let _=Object(u.n)(Object(f.e)(t.height/a*o||0));_>255?_=255:_<=0&&(_=Object(u.n)(h-c));let g=Object(f.e)(t.offsetX||0)+128;g>255&&(g=255);let O=Object(f.e)(-t.offsetY||0)+128;O>255&&(O=255);const v=t.scaleX||1,M=Object(m.a)(c,l),j=Object(m.a)(h,p),w=Object(m.b)(_,x,g,O),S=Object(m.a)(128*v,128),C=Object(m.b)(0,0,Object(b.b)(t.angle),t.colorLocked?1:0);return new Tt(r,e,s,M,j,w,S,C,t.effects)}static fromSimpleFill(t,e,i=!1){const{color:s}=t,r=s&&"esriSFSNull"!==t.style&&Object(y.d)(s)||0,n=Object(m.b)(0,0,0,i?255:0),o=t.materialKey;if(!e)return new Tt(o,null,r,0,0,0,0,n,null);const{rect:a,width:c,height:l}=e,h=a.x+d.r,f=a.y+d.r,p=h+c,b=f+l,x=Object(m.a)(h,f),_=Object(m.a)(p,b),g=Object(m.b)(Object(u.n)(p-h),Object(u.n)(b-f),0,0),O=Object(m.a)(128,128);return new Tt(o,e,r,x,_,g,O,n,null)}static fromPictureFill(t,e,i=!1){const s=d.q,{rect:r,width:n,height:o}=e,a=r.x+d.r,c=r.y+d.r,l=a+n,h=c+o,p=Object(m.a)(a,c),y=Object(m.a)(l,h);let b=Object(u.n)(Object(f.e)(t.width));b>255&&(b=255);let x=Object(u.n)(Object(f.e)(t.height));x>255&&(x=255);let _=Object(f.e)(t.xoffset)+128;_>255&&(_=255);let g=Object(f.e)(-t.yoffset)+128;g>255&&(g=255);const O=Object(m.b)(b,x,_,g),v=Object(m.a)(128*t.xscale,128*t.yscale),M=Object(m.b)(0,0,0,i?255:0),j=t.materialKey;return new Tt(j,e,s,p,y,O,v,M,null)}}var It=Tt,Pt=i(565);const kt=s.a.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate");class Rt extends(dt(tt.a)){constructor(t,e,i,s,r,n,o,a,c,l,h,u,f,d,m,y){super();const b=p.c.load(t);e&&(b.sdf=e.sdf,b.pattern=!0,b.textureBinding=e.textureBinding),this._capType=s,this._joinType=r,this._miterLimitCosine=Object(x.b)(n),this.tessellationProperties._fillColor=o,this.tessellationProperties._tl=a,this.tessellationProperties._br=c,this._hasPattern=l,this._isDashed=h,this._joinOnUTurn=m,this._isColorLocked=u,this._zOrder=d,this.effects=y,this._materialKey=b.data,this.tessellationProperties._bitset=u?1:0,this.tessellationProperties._halfWidth=.5*i,this.tessellationProperties._halfReferenceWidth=.5*f,this._initializeTessellator(!1)}static fromCIMLine(t,e,i){const s=t.color,r=t.scaleFactor||1,n=t.isDashed;let o=t.cap;n&&1===o&&(o=2);const a=t.join,c=Object(f.e)(t.width)*r,l=Object(f.e)(t.referenceWidth),h=Object(f.e)(t.miterLimit),u=s&&Object(y.c)(s)||0;if(!e)return new Rt(t.materialKey,e,c,o,a,h,u,0,0,!1,n,t.colorLocked,l,t.zOrder,i,t.effects);const{rect:p,width:b,height:x}=e,_=p.x+d.r,g=p.y+d.r,O=_+b,v=g+x,M=Object(m.a)(_,g),j=Object(m.a)(O,v);return new Rt(t.materialKey,e,c,o,a,h,u,M,j,!0,n,t.colorLocked,l,t.zOrder,i,t.effects)}static fromSimpleLine(t,e,i){const{color:s}=t,r="esriSLSSolid"!==t.style&&"esriSLSNull"!==t.style,n=Object(Pt.g)(t.cap||"round",r),o=Object(Pt.h)(t.join||"round");let a=s&&"esriSLSNull"!==t.style&&Object(y.d)(s)||0;"esriSLSNull"===t.style&&(a=0);const c=Object(f.e)(t.width),l=t.miterLimit;if(!e)return new Rt(t.materialKey,e,c,n,o,l,a,0,0,!1,r,!1,c,0,i,null);const{rect:h,width:u,height:p}=e,b=h.x+d.r,x=h.y+d.r,_=b+u,g=x+p,O=Object(m.a)(b,x),v=Object(m.a)(_,g);return new Rt(t.materialKey,e,c,n,o,l,a,O,v,!0,r,!1,c,0,i,null)}static fromPictureLineSymbol(t,e,i,s){return kt.error("PictureLineSymbol support does not exist!"),null}}var Dt=Rt;const Vt=s.a.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),Ft=new Array;function At(t,e){const i=t.length;return t.push(null),e.then((e=>t[i]=e)),t}function Nt(t){return!!(1&t)}class Bt{constructor(t,e){this._idCounter=1,this._templateIdCounter=1,this._idToTemplateGroup=new Map,this._symbolToTemplate=new Map,this._fetchQueue=[],this._idToResolver=new Map,this._cimTemplateCache=new Map,this._cimAnalyses=[],this._lock=new class{constructor(){this._resolver=null}isHeld(){return!!this._resolver}acquire(){return this._resolver?this._resolver.promise.then((()=>this.acquire())):(this._resolver=Object(n.g)(),Object(n.u)())}release(){const t=this._resolver;this._resolver=null,t.resolve()}},this._fetchResource=t,this._joinOnUTurn=e}get _markerError(){return this._errorTemplates.marker[0]}get _fillError(){return this._errorTemplates.fill[0]}get _lineError(){return this._errorTemplates.line[0]}get _textError(){return this._errorTemplates.line[0]}createTemplateGroup(t,e){this._initErrorTemplates();const i=t.hash;if(this._symbolToTemplate.has(i))return this._symbolToTemplate.get(i);const s=new Array;e&&this._createMeshTemplates(s,e,!0),this._createMeshTemplates(s,t,!1);const r=this._createGroupId("expanded-cim"===t.type);return this._idToTemplateGroup.set(r,s),this._symbolToTemplate.set(i,r),r}getTemplateGroup(t){return this._idToTemplateGroup.has(t)?this._idToTemplateGroup.get(t):Ft}getDynamicTemplateGroup(t){return this._idToTemplateGroup.has(t)?(Nt(t)||Vt.error("mapview-template-store",`Id ${t} does not refer to a dynamic template`),this._idToTemplateGroup.get(t)):Ft}getMosaicItem(t,e){const i=this._createTemplateId(),s=Object(n.c)((t=>this._idToResolver.set(i,t)));return this._fetchQueue.push({symbol:t,id:i,glyphIds:e}),s}finalize(t){return this._fetchQueue.length||this._lock.isHeld()?function(t,e,i){return t.acquire().then((()=>e(i))).then((()=>t.release())).catch((e=>{throw t.release(),e}))}(this._lock,this._fetchAllQueuedResources.bind(this),t):Object(n.u)()}_initErrorTemplates(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],Object(c.c)(o.c),!1),marker:this._createMeshTemplates([],Object(c.c)(o.b),!1),line:this._createMeshTemplates([],Object(c.c)(o.d),!1)})}_fetchAllQueuedResources(t){if(!this._fetchQueue.length)return Object(n.u)();const e=this._fetchQueue,i=this._cimAnalyses;return this._fetchQueue=[],this._cimAnalyses=[],Object(n.b)(i).then((()=>this._fetchResource(e,t).then((t=>{for(const{id:e,mosaicItem:i}of t)this._idToResolver.get(e)(i),this._idToResolver.delete(e)})))).catch((t=>{Object(n.n)(t)?this._fetchQueue=this._fetchQueue.concat(e):function(t){return"worker:port-closed"===t.name}(t)||Vt.error(new r.a("mapview-template-store","Unable to fetch requested texture resources",t))}))}_createGroupId(t){return this._idCounter++<<1|(t?1:0)}_createTemplateId(){return this._templateIdCounter++}async _createSMS(t){const{spriteMosaicItem:e}=await this.getMosaicItem(t);return Object(a.a)(e,Vt)?h.a.fromSimpleMarker(t,e):this._markerError}async _createPMS(t){const{spriteMosaicItem:e}=await this.getMosaicItem(t);return Object(a.a)(e,Vt)?h.a.fromPictureMarker(t,e):this._markerError}async _createSFS(t,e){const{spriteMosaicItem:i}=await this.getMosaicItem(t);return Object(a.a)(i,Vt)?It.fromSimpleFill(t,i,e):this._fillError}async _createPFS(t,e){const{spriteMosaicItem:i}=await this.getMosaicItem(t);return Object(a.a)(i,Vt)?It.fromPictureFill(t,i,e):this._fillError}async _createSLS(t,e){const{spriteMosaicItem:i}=await this.getMosaicItem(t);return Object(a.a)(i,Vt)?Dt.fromSimpleLine(t,i,this._joinOnUTurn):this._lineError}async _createLMS(t){const{spriteMosaicItem:e}=await this.getMosaicItem(t);return Object(a.a)(e,Vt)?h.a.fromLineSymbolMarker(t,e):this._markerError}async _createTS(t){const{glyphMosaicItems:e}=await this.getMosaicItem(t);return l.a.fromText(t,e)}async _createCIMText(t){const{glyphMosaicItems:e}=await this.getMosaicItem(t.cim,Object(wt.a)(t.text));return t.cim.mosaicHash=t.materialHash,Object(a.a)(e,Vt)?l.a.fromCIMText(t,e):this._textError}async _createCIMFill(t){t.cim.mosaicHash=t.materialHash;const{spriteMosaicItem:e}=await this.getMosaicItem(t.cim);return Object(a.a)(e,Vt)?It.fromCIMFill(t,e):this._fillError}async _createCIMLine(t){t.cim.mosaicHash=t.materialHash;const{spriteMosaicItem:e}=await this.getMosaicItem(t.cim);return Object(a.a)(e,Vt)?Dt.fromCIMLine(t,e,this._joinOnUTurn):this._lineError}async _createCIMMarker(t){t.cim.mosaicHash=t.materialHash;const{spriteMosaicItem:e}=await this.getMosaicItem(t.cim);return Object(a.a)(e,Vt)?h.a.fromCIMMarker(t,e):this._markerError}async _createCIM(t){const e=t.templateHash;if(this._cimTemplateCache.has(e))return this._cimTemplateCache.get(e);let i;switch(t.type){case"marker":i=this._createCIMMarker(t);break;case"line":i=this._createCIMLine(t);break;case"fill":i=this._createCIMFill(t);break;case"text":i=this._createCIMText(t)}return i.then((t=>this._cimTemplateCache.set(e,t))),i}_createDynamicCIM(t){const e=t.templateHash;if(this._cimTemplateCache.has(e))return this._cimTemplateCache.get(e);let i;switch(t.type){case"marker":i=jt.fromCIMMarker(t);break;case"line":i=pt.fromCIMLine(t);break;case"fill":i=rt.fromCIMFill(t);break;case"text":i=zt.fromCIMText(t)}return this._cimTemplateCache.set(e,i),i}_createPrimitiveMeshTemplates(t,e,i){switch(e.type){case"esriSMS":return At(t,this._createSMS(e));case"esriPMS":return At(t,this._createPMS(e));case"esriSFS":return At(t,this._createSFS(e,i));case"line-marker":return At(t,this._createLMS(e));case"esriPFS":return At(t,this._createPFS(e,i));case"esriSLS":return At(t,this._createSLS(e,!1));case"esriTS":return At(t,this._createTS(e));default:return Vt.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),t}}_createMeshTemplates(t,e,i){if(-1!==e.type.indexOf("3d"))return Vt.error("3D symbols are not supported with MapView"),t;if("expanded-cim"===e.type){for(const i of e.layers)"function"==typeof i.materialHash?t.push(this._createDynamicCIM(i)):At(t,this._createCIM(i));return t}if("composite-symbol"===e.type){for(const s of e.layers)this._createPrimitiveMeshTemplates(t,s,i);return t}return"cim"===e.type||"label"===e.type||"web-style"===e.type?t:this._createPrimitiveMeshTemplates(t,e,i)}}},609:function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));i(9);var s=i(222),r=(i(52),i(587)),n=i(564),o=i(566);const a={marker:n.d.MARKER,fill:n.d.FILL,line:n.d.LINE,text:n.d.TEXT};class c{constructor(t,e,i){this.layers=t,this.data=e,this.hash=this._createHash(),this.rendererKey=i;for(const s of t){const t=a[s.type];s.materialKey=Object(o.g)(t,this.rendererKey,!1,!1)}}get type(){return"expanded-cim"}_createHash(){let t="";for(const e of this.layers)t+=e.templateHash;return t}}const l=async(t,e)=>new c(await Object(r.b)(t.data,e),t.data,t.rendererKey),h=async(t,e,i)=>{if(!t)return null;if("cim"===t.type)return l(t,e);if("web-style"===t.type){const r=s.a.fromJSON(t),n={type:"cim",data:(await r.fetchCIMSymbol(i)).data,rendererKey:t.rendererKey};return l(n,e)}return t}},617:function(t,e,i){"use strict";i.d(e,"a",(function(){return h})),i.d(e,"b",(function(){return c})),i.d(e,"c",(function(){return o})),i.d(e,"d",(function(){return l}));var s=i(63),r=i(640),n=i(650);function o(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":{const e=t.symbolLayers;return e&&1===e.length?o(e[0]):null}case"CIMVectorMarker":{const e=t.markerGraphics;if(!e||1!==e.length)return null;const i=e[0];if(!i)return null;const s=i.geometry;if(!s)return null;const r=i.symbol;return!r||"CIMPolygonSymbol"!==r.type&&"CIMLineSymbol"!==r.type?null:{geom:s,asFill:"CIMPolygonSymbol"===r.type}}case"sdf":return{geom:t.geom,asFill:t.asFill}}return null}function a(t){let e=1/0,i=-1/0,s=1/0,r=-1/0;for(const n of t)for(const t of n)t[0]<e&&(e=t[0]),t[0]>i&&(i=t[0]),t[1]<s&&(s=t[1]),t[1]>r&&(r=t[1]);return[e,s,i,r]}function c(t){return t?t.rings?a(t.rings):t.paths?a(t.paths):Object(s.d)(t)?[t.xmin,t.ymin,t.xmax,t.ymax]:null:null}function l(t,e,i,s,r){const[n,o,a,c]=t;if(a<n||c<o)return[0,0,0];const l=a-n,h=c-o,u=Math.floor(31.5),f=(128-2*(u+1))/Math.max(l,h),d=Math.round(l*f)+2*u,m=Math.round(h*f)+2*u;let p=1;e&&(p=m/f/(e.ymax-e.ymin));let y=0,b=0;if(s)if(r){if(e&&i&&e.ymax-e.ymin>0){const t=(e.xmax-e.xmin)/(e.ymax-e.ymin);y=s.x/(i*t),b=s.y/i}}else y=s.x,b=s.y;return y=.5*(e.xmax+e.xmin)+y*(e.xmax-e.xmin),b=.5*(e.ymax+e.ymin)+b*(e.ymax-e.ymin),y-=n,b-=o,y*=f,b*=f,y+=u,b+=u,[p,y/d-.5,-(b/m-.5)]}function h(t){const e=(i=t.geom)?i.rings?i.rings:i.paths?i.paths:void 0!==i.xmin&&void 0!==i.ymin&&void 0!==i.xmax&&void 0!==i.ymax?[[[i.xmin,i.ymin],[i.xmin,i.ymax],[i.xmax,i.ymax],[i.xmax,i.ymin],[i.xmin,i.ymin]]]:null:null;var i;const s=function(t){let e=1/0,i=-1/0,s=1/0,n=-1/0;for(const r of t)for(const t of r)t[0]<e&&(e=t[0]),t[0]>i&&(i=t[0]),t[1]<s&&(s=t[1]),t[1]>n&&(n=t[1]);return new r.a(e,s,i-e,n-s)}(e),n=Math.floor(31.5),o=(128-2*(n+1))/Math.max(s.width,s.height),a=Math.round(s.width*o)+2*n,c=Math.round(s.height*o)+2*n,l=[];for(const r of e)if(r&&r.length>1){const e=[];for(const t of r){let[i,r]=t;i-=s.x,r-=s.y,i*=o,r*=o,i+=n-.5,r+=n-.5,e.push([i,r])}if(t.asFill){const t=e.length-1;e[0][0]===e[t][0]&&e[0][1]===e[t][1]||e.push(e[0])}l.push(e)}const h=function(t,e,i,s){const r=e*i,n=new Array(r),o=s*s+1;for(let a=0;a<r;++a)n[a]=o;for(const a of t){const t=a.length;for(let r=1;r<t;++r){const t=a[r-1],o=a[r];let c,l,h,u;t[0]<o[0]?(c=t[0],l=o[0]):(c=o[0],l=t[0]),t[1]<o[1]?(h=t[1],u=o[1]):(h=o[1],u=t[1]);let f=Math.floor(c)-s,d=Math.floor(l)+s,m=Math.floor(h)-s,p=Math.floor(u)+s;f<0&&(f=0),d>e&&(d=e),m<0&&(m=0),p>i&&(p=i);const y=o[0]-t[0],b=o[1]-t[1],x=y*y+b*b;for(let s=f;s<d;s++)for(let r=m;r<p;r++){let a,c,l=(s-t[0])*y+(r-t[1])*b;l<0?(a=t[0],c=t[1]):l>x?(a=o[0],c=o[1]):(l/=x,a=t[0]+l*y,c=t[1]+l*b);const h=(s-a)*(s-a)+(r-c)*(r-c),u=(i-r-1)*e+s;h<n[u]&&(n[u]=h)}}}for(let a=0;a<r;++a)n[a]=Math.sqrt(n[a]);return n}(l,a,c,n);return t.asFill&&function(t,e,i,s,r){for(const n of t){const t=n.length;for(let o=1;o<t;++o){const t=n[o-1],a=n[o];let c,l,h,u;t[0]<a[0]?(c=t[0],l=a[0]):(c=a[0],l=t[0]),t[1]<a[1]?(h=t[1],u=a[1]):(h=a[1],u=t[1]);let f=Math.floor(c),d=Math.floor(l)+1,m=Math.floor(h),p=Math.floor(u)+1;f<s&&(f=s),d>e-s&&(d=e-s),m<s&&(m=s),p>i-s&&(p=i-s);for(let n=m;n<p;++n){if(t[1]>n==a[1]>n)continue;const o=(i-n-1)*e;for(let e=f;e<d;++e)e<(a[0]-t[0])*(n-t[1])/(a[1]-t[1])+t[0]&&(r[o+e]=-r[o+e]);for(let t=s;t<f;++t)r[o+t]=-r[o+t]}}}}(l,a,c,n,h),[u(h,n),a,c]}function u(t,e){const i=2*e,s=t.length,r=new Uint8Array(4*s);for(let o=0;o<s;++o){const e=.5-t[o]/i;Object(n.a)(e,r,4*o)}return r}},632:function(t,e,i){"use strict";i.d(e,"a",(function(){return E}));i(7);var s=i(2),r=i(9),n=i(448),o=i(564),a=i(596),c=i(565),l=i(577),h=i(594);class u{constructor(t,e){this.data=t,this.stride=e}get vertexCount(){const t=this.stride/4,e=this.data.length/t;return e!==(0|e)&&console.debug("Corrupted stride"),e}transfer(t,e){const i=this.data.buffer();t.vertexCount=this.vertexCount,t.data=i,t.stride=this.stride,e.push(i)}}class f{constructor(t,e,i=!1){this.geometryType=t,this.indexVector=new l.a(Uint32Array,6*e),this.namedVectors={};const s=Object(c.k)(t,i);for(const r in s){const t=s[r];let i;switch(t%4){case 0:case 2:i=new l.a(Uint32Array,t*e);break;case 1:case 3:i=new l.a(Uint8Array,t*e)}this.namedVectors[r]=new u(i,t)}}get(t){return this.namedVectors[t].data}getVector(t){return this.namedVectors[t]}transfer(t,e){const i=this.indexVector.buffer(),s={};e.push(i);for(const r in this.namedVectors){const t=this.namedVectors[r];s[r]={},t.transfer(s[r],e)}t.geometryType=this.geometryType,t.indexBuffer=i,t.namedBuffers=s,this.destroy()}intoBuffers(){const t=h.a.fromVertexVectors(this);return this.destroy(),t}destroy(){this.indexVector=null,this.namedVectors=null}}var d=i(6),m=i(13),p=i(29),y=i(25),b=i(578),x=i(567),_=i(646),g=i(566),O=i(568),v=i(575),M=i(569);function j(t){return t.length-1}function w(t){let e=0;for(let i=0;i<j(t);i++)e+=S(t,i);return e}function S(t,e,i=1){const[s,r]=function(t,e){return t[e+1]}(t,e);return Math.sqrt(s*s+r*r)*i}class C{constructor(t,e,i,s,r){this._segments=t,this._index=e,this._distance=i,this._xStart=s,this._yStart=r,this._done=!1}static create(t){return new C(t,0,0,t[0][0],t[0][1])}clone(){return new C(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(t){return this._index===t._index||t._index===this._index-1&&(0===this._distance||1===t._distance)||t._index===this._index+1&&(1===this._distance||0===t._distance)}leq(t){return this._index<t._index||this._index===t._index&&this._distance<=t._distance}geq(t){return this._index>t._index||this._index===t._index&&this._distance>=t._distance}get _segment(){return this._segments[this._index+1]}get angle(){const t=this.dy,e=(0*t+-1*-this.dx)/(1*this.length);let i=Math.acos(e);return t>0&&(i=2*Math.PI-i),i}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:t,dy:e}=this;return Math.sqrt(t*t+e*e)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<j(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(t,e){const i=this.backwardLength;if(t<=i)return this._distance=(i-t)/this.length,this;let s=this.backwardLength;for(;this.prev();){if(s+this.length>t)return this._seekBackwards(t-s);s+=this.length}return this._distance=0,e?this:null}seek(t,e=!1){if(t<0)return this._seekBackwards(Math.abs(t),e);if(t<=this.remainingLength)return this._distance=(this.backwardLength+t)/this.length,this;let i=this.remainingLength;for(;this.next();){if(i+this.length>t)return this.seek(t-i,e);i+=this.length}return this._distance=1,e?this:null}}function L(t,e,i){const s=w(t),r=C.create(t),n=s/2,o=(s-e)/2,a=Math.floor(o/e),c=n-a*e;r.seek(c);for(let l=-a;l<=a;l++)r.x<512&&r.x>=0&&r.y<512&&r.y>=0&&i(r.clone(),l,n+l*e,s),r.seek(e)}function z(t,e){const i=1e-6;if(e<=0)return;const s=t.length;if(s<3)return;const r=[];let n=0;r.push(0);for(let u=1;u<s;u++)n+=Object(M.a)(t[u],t[u-1]),r.push(n);e=Math.min(e,.2*n);const o=[];o.push(t[0][0]),o.push(t[0][1]);const a=t[s-1][0],c=t[s-1][1],l=Object(M.e)([0,0],t[0],t[1]);Object(M.d)(l),t[0][0]+=e*l[0],t[0][1]+=e*l[1],Object(M.e)(l,t[s-1],t[s-2]),Object(M.d)(l),t[s-1][0]+=e*l[0],t[s-1][1]+=e*l[1];for(let u=1;u<s;u++)r[u]+=e;r[s-1]+=e;const h=.5*e;for(let u=1;u<s-1;u++){let n=0,a=0,c=0;for(let s=u-1;s>=0&&!(r[s+1]<r[u]-h);s--){const o=h+r[s+1]-r[u],l=r[s+1]-r[s],f=r[u]-r[s]<h?1:o/l;if(Math.abs(f)<i)break;const d=f*f,m=f*o-.5*d*l,p=f*l/e,y=t[s+1],b=t[s][0]-y[0],x=t[s][1]-y[1];n+=p/m*(y[0]*f*o+.5*d*(o*b-l*y[0])-d*f*l*b/3),a+=p/m*(y[1]*f*o+.5*d*(o*x-l*y[1])-d*f*l*x/3),c+=p}for(let o=u+1;o<s&&!(r[o-1]>r[u]+h);o++){const s=h-r[o-1]+r[u],l=r[o]-r[o-1],f=r[o]-r[u]<h?1:s/l;if(Math.abs(f)<i)break;const d=f*f,m=f*s-.5*d*l,p=f*l/e,y=t[o-1],b=t[o][0]-y[0],x=t[o][1]-y[1];n+=p/m*(y[0]*f*s+.5*d*(s*b-l*y[0])-d*f*l*b/3),a+=p/m*(y[1]*f*s+.5*d*(s*x-l*y[1])-d*f*l*x/3),c+=p}o.push(n/c),o.push(a/c)}o.push(a),o.push(c);for(let u=0,f=0;u<s;u++)t[u][0]=o[f++],t[u][1]=o[f++]}var T=i(599);const I=d.a.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate"),P=function(t){const e=new Map;return t=>(e.has(t)||e.set(t,(t=>{let e=0;if(0===t)return 1/0;for(;!(t%2);)e++,t/=2;return e})(t)),e.get(t))}(),k=t=>Math.floor(127*t+127),R=t=>Math.floor(10*t),D=t=>Math.round(t*(254/360)),V=(t,e)=>Object(x.a)(Math.round(8*t),Math.round(8*e));class F extends T.a{constructor(t,e,i,s){super(t,i.font.size,i.haloSize||0,i.color&&Object(O.d)(i.color)||0,i.haloColor&&Object(O.d)(i.haloColor)||0,i.horizontalAlignment,i.verticalAlignment,Object(_.a)(e.labelPlacement)?1:0,i.font.decoration,!1,i.angle||0,i.xoffset,i.yoffset,i.lineWidth,i.lineHeight,null,null),this._outLineLabelAngle=0,this._refPlacementPadding=0,this._refPlacementDirX=0,this._refPlacementDirY=0,this._refOffsetX=0,this._refOffsetY=0,this.geometryType=o.d.LABEL;const r=function(t,e){const i=!!t.minScale&&e.scaleToZoom(t.minScale)||0;return Object(p.d)(i,0,25.5)}(e,s),a=function(t,e){const i=!!t.maxScale&&e.scaleToZoom(t.maxScale)||255;return Object(p.d)(i,0,25.5)}(e,s),c=e.labelPlacement,[l,h]=Object(b.b)(c);this._xAlignD=l,this._yAlignD=h,this._minZoom=r,this._maxZoom=a,this._refPlacementPadding=Object(y.e)(i.haloSize)+n.D;const u=g.b.load(t);u.sdf=!0,this._materialKey=u.data}static fromLabelClass(t,e){if("center-along"===t.labelPlacement){const e=t.symbol;e.xoffset=0,e.yoffset=0,e.angle=0,e.font.decoration="none"}return new F(t.materialKey,t,t.symbol,e)}get _shapedBox(){return Object(s.o)(this._shapingInfo).bounds}bindReferenceTemplate(t){let e=Object(b.e)(this._xAlignD),i=Object(b.g)(this._yAlignD);if(this._refOffsetX=0,this._refOffsetY=0,Object(s.h)(t))return void(this._refSymbolAndPlacementOffset=Object(x.b)(0,0,k(e),k(i)));if("circle"===t.boundsType&&(e||i)){const t=Math.sqrt(e*e+i*i);e/=t,i/=t}const r=Math.max(t.height,t.width),n=4*this._refPlacementPadding;this._refSymbolAndPlacementOffset=Object(x.b)(n,r,k(e),k(i)),this._referenceSize=r,this._refPlacementDirX=e,this._refPlacementDirY=i,this._refOffsetX=t.xOffset,this._refOffsetY=t.yOffset}writeMesh(t,e,i,r,n,o){if(Object(s.h)(this._shapingInfo))return;const a=new Array,c=this._shapingInfo,l="esriGeometryPolygon"===i.geometryType?i.readLegacyCentroid():i.readLegacyGeometry();if(l){switch(this.current={out:t,outVecs:e,outMetrics:a,inId:n,inShaping:c,zoomLevel:o},r){case"esriGeometryPolyline":this._placeLineLabels(l);break;case"esriGeometryPoint":case"esriGeometryPolygon":this._placePointLabels(l);break;default:((t,e="mapview-labeling")=>{I.error(new m.a(e,t))})("mapview-labeling",`Geometry of type ${r} is not supported`)}t.writeMetrics(this.current.outMetrics)}}_isVisible(t,e){const i=R(this.current.zoomLevel);return R(t)<=i&&i<=R(e)}_placePointLabels(t){const{out:e,outVecs:i,outMetrics:s,inId:r}=this.current;this._writeGlyphs(e,i,r,t,s)}_placeLineLabels(t){const e=function(t,e){const i=e;for(let s=0;s<t.length;s++){let e=t[s];const r=[];r.push(e[0]);for(let t=1;t<e.length;t++){let[i,s]=r[t-1];i+=e[t][0],s+=e[t][1],r.push([i,s])}z(r,i);const n=[];n.push(r[0]);for(let t=1;t<r.length;t++){const[e,i]=r[t-1],[s,o]=r[t],a=Math.round(s-e),c=Math.round(o-i);n.push([a,c])}t[s]=n,e=n}return t}(t.paths,this.current.inShaping.bounds.width),i=this._placeSubdivGlyphs.bind(this),s=(this._shapedBox.width+128)/4;for(const r of e)L(r,s,i)}_placeSubdivGlyphs(t,e,i,s){const r=P(e),n=this._shapedBox.width/4,o=Math.min(i,s-i),a=Object(p.m)(o/(4+n/2)),c=0===e?a:Math.min(r,a),l=Math.max(this._minZoom,this.current.zoomLevel+2-c),h=this.current.zoomLevel-l,u=this._shapedBox.width/2*Math.pow(2,h);this.current.inShaping.isMultiline?0===e&&this._placeStraight(t,l):this._placeCurved(t,l,u)}_placeStraight(t,e){const{out:i,outVecs:s,outMetrics:r,inId:n}=this.current;this._writeGlyphs(i,s,n,t,r,e)}_placeCurved(t,e,i){const s={from:this.current.out.currentDisplayRecordCount(),count:-1},r=new v.a(this.current.inId,s,t.x,t.y,e),n=t.clone(),o=t.angle*(180/Math.PI)%360,a=(t.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=D(o),this._placeFirst(n,r,e,1),this._placeBack(t,n,r,e,i,1),this._placeForward(t,n,r,e,i,1),this._outLineLabelAngle=D(a),this._placeFirst(n,r,e,0),this._placeBack(t,n,r,e,i,0),this._placeForward(t,n,r,e,i,0),r.range.count=this.current.out.currentDisplayRecordCount()-r.range.from,r.bounds&&this.current.outMetrics.push(r)}_placeBack(t,e,i,s,r,n){const o=t.clone();let a=t.backwardLength+0;for(;o.prev()&&!(a>=r);)this._placeOnSegment(o,e,i,a,s,-1,n),a+=o.length+0}_placeForward(t,e,i,s,r,n){const o=t.clone();let a=t.remainingLength+0;for(;o.next()&&!(a>=r);)this._placeOnSegment(o,e,i,a,s,1,n),a+=o.length+0}_placeFirst(t,e,i,s){const r=t,n=this.current.inShaping,o=n.glyphs,a=this.current.zoomLevel,{out:c,outVecs:l,inId:h}=this.current,u=V(r.x,r.y);for(const f of o){const r=f.x>n.bounds.x?s:1-s,o=r*t.remainingLength+(1-r)*t.backwardLength,d=Math.abs(f.x+f.width/2-n.bounds.x),m=Math.max(0,a+Object(p.m)(d/(o+0))),y=Math.max(i,m);f.maxZoom=25,f.angle=t.angle+(1-s)*Math.PI,f.minZoom=y,this._writeGlyph(c,l,f,h,u),s&&this._isVisible(f.minZoom,f.maxZoom)&&e.add(f.bounds,0,0)}}_placeOnSegment(t,e,i,s,r,n,o){const a=this.current.inShaping.glyphs,{out:c,outVecs:l,inId:h}=this.current,u=this.current.inShaping,f=this.current.zoomLevel,d=t.dx/t.length,m=t.dy/t.length,y={x:t.x+s*-n*d,y:t.y+s*-n*m},b=V(y.x,y.y);for(const x of a){const a=x.x>u.bounds.x?o:1-o;if(!(a&&1===n||!a&&-1===n))continue;const d=Math.abs(x.x+x.width/2-u.bounds.x),m=Math.max(0,f+Object(p.m)(d/s)-.1),y=Math.max(r,f+Object(p.m)(d/(s+t.length+0)));0!==m&&(x.angle=t.angle+(1-o)*Math.PI,x.minZoom=y,x.maxZoom=m,this._writeGlyph(c,l,x,h,b),o&&this._isVisible(x.minZoom,x.maxZoom)&&i.add(x.bounds,t.x-e.x,t.y-e.y))}}_writeGlyphs(t,e,i,r,n,o=this._minZoom){const a=this._shapingInfo;if(Object(s.h)(a))return;if(r.x<0||r.x>=512||r.y<0||r.y>=512)return;const c=t.currentDisplayRecordCount(),l=V(r.x+this._refOffsetX,r.y-this._refOffsetY),h=new v.a(i,{from:c,count:-1},r.x+this._refOffsetX,r.y-this._refOffsetY,o);for(const s of a.glyphs)s.minZoom=o,s.maxZoom=this._maxZoom,this._writeGlyph(t,e,s,i,l);h.range.count=t.currentDisplayRecordCount()-h.range.from,h.bounds=a.boundsT;const u=g.b.load(this._materialKey),f=this._refPlacementDirX,d=this._refPlacementDirY,m=u.vvSizeFieldStops||u.vvSizeMinMaxValue||u.vvSizeScaleStops||u.vvSizeUnitValue;h.setPlacementOffset(m,this._referenceSize,this._refPlacementPadding,f,d),n.push(h)}_writeGlyph(t,e,i,s,r){const n=g.e.load(this._materialKey);n.textureBinding=i.textureBinding;const o=e.indexVector.length,a=e.getVector("geometry").vertexCount,c=this._writeIndices(e),l=this._writeVertex(e,s,r,i);t.writeDisplayRecord(this.geometryType,n.data,a,l,o,c)}_writeVertexCommon(t,e,i,s){const r=this._color,n=this._haloColor,o=Object(x.b)(0,0,this._size,this._haloSize),a=Math.max(s.minZoom,this._minZoom),c=Math.min(s.maxZoom,this._maxZoom),l=Object(x.b)(R(a),R(c),this._outLineLabelAngle,0);t.push(i),t.push(e),t.push(r),t.push(n),t.push(o),t.push(this._refSymbolAndPlacementOffset),t.push(l)}}var A=F,N=i(602),B=i(604);class E{constructor(t,e,i){this._isDD=!1,this._geometryType=t,this._idField=e,this._templateStore=i}update(t,e){this._isDD="simple"===t.mesh.matcher.type&&t.mesh.matcher.isDotDensity,Object(s.i)(t.mesh.labels)&&this._setLabelTemplates(t.mesh.labels,e)}_setLabelTemplates(t,e){this._labelTemplates=t.map((t=>A.fromLabelClass(t,e)))}get templates(){return this._templateStore}createMeshData(t){const e=new Array(5),i=this._labelTemplates&&this._labelTemplates.length>0,s="esriGeometryPolyline"===this._geometryType?n.k:n.j;return e[o.d.MARKER]=new f(o.d.MARKER,4*t),e[o.d.FILL]=new f(o.d.FILL,t,this._isDD),e[o.d.LINE]=new f(o.d.LINE,t),e[o.d.TEXT]=new f(o.d.TEXT,4*t),e[o.d.LABEL]=new f(o.d.LABEL,i?4*s:0),new a.a(e,{features:t,records:t,metrics:0})}async analyze(t,e,i,s,n){if(Object(r.o)(n))return;let o;"dictionary"===e.type&&(o=await e.analyze(this._idField,t.copy(),i,s,n));let a=0;for(;t.next();){let r;if(r=o?o[a++]:e.match(this._idField,t,this._geometryType,i,s),t.setGroupId(r),Object(B.b)(r)){const e=this._templateStore.getDynamicTemplateGroup(r);for(const r of e)r&&r.analyze&&r.analyze(this._templateStore,t,i,s)}}return this._templateStore.finalize(n)}async analyzeGraphics(t,e,i,s,n){if(Object(r.o)(n))return;const o=t.getCursor();for(e&&await e.analyze(this._idField,o.copy(),i,s,n);o.next();){let t=o.getGroupId();if(null!=t&&-1!==t||(t=e.match(this._idField,o,o.geometryType,i,s),o.setGroupId(t)),Object(B.b)(t)){const e=this._templateStore.getDynamicTemplateGroup(t);for(const t of e)t&&t.analyze&&t.analyze(this._templateStore,o,i,s)}o.setGroupId(t)}return this._templateStore.finalize(n)}writeGraphic(t,e){const i=e.getGroupId(),s=e.getDisplayId(),r=this._templateStore.getTemplateGroup(i),n=e.geometryType;if(null!=s){if(Object(B.b)(i))for(const t of r)t.bindFeature(e,null,null);if(r){t.writeDisplayObject(s,e.readGraphic().insertAfter);for(const i of r){if(!i)continue;const r=t.get(i.geometryType);i.writeMesh(t,r,e,n,s)}}}}writeCursor(t,e,i,r,n,o){const a=e.getGroupId(),c=e.getDisplayId(),l=this._templateStore.getTemplateGroup(a);if(null==c)return;if(!l)return;if(t.writeDisplayObject(c,0),Object(B.b)(a))for(const s of l)s.bindFeature(e,i,r);for(const s of l){const i=t.get(s.geometryType);!s.needsPixelBuffer&&e.hasFilter()||s.writeMesh(t,i,e,this._geometryType,c)}const h=t.hasDisplayRecords();if(Object(s.i)(o)&&h){const i=o&&this._findLabelRef(l);this._writeLabels(t,e,c,o,i,n)}t.endDisplayObject()}_findLabelRef(t){for(const e of t)if(e instanceof N.a)return e;return null}_writeLabels(t,e,i,r,n,o){for(const a of r)if(Object(s.i)(a)&&a){const{glyphs:s,rtl:r,index:c}=a,l=this._labelTemplates[c],h=t.get(l.geometryType);l.bindReferenceTemplate(n),l.bindTextInfo(s,r),l.writeMesh(t,h,e,this._geometryType,i,o)}}}},635:function(t,e,i){"use strict";i.d(e,"a",(function(){return x}));var s=i(6),r=i(13),n=i(9),o=i(137),a=i(115),c=i(361),l=i(588),h=i(609),u=i(597);const f=s.a.getLogger("esri/views/2d/engine/webgl/util/Matcher");class d{constructor(){this.type="feature",this._defaultResult=null}static async fromBasicRenderer(t,e,i){const s=new d;if(t.symbol){const r=await Object(h.a)(t.symbol,i),n=e.createTemplateGroup(r,null);s.setDefault(n)}return s}size(){return 1}getDefault(){return this._defaultResult}setDefault(t){this._defaultResult=t}match(t,e,i,s,r){return this.getDefault()}async analyze(t,e,i,s,r){return null}}class m extends d{constructor(t,e,i,s){super(),this.type="interval",this._intervals=[],this._isMaxInclusive=e,this._fieldIndex=s,this._field=t,this._normalizationInfo=i}static async fromCBRenderer(t,e,i){const{isMaxInclusive:s,normalizationField:r,normalizationTotal:o,normalizationType:a}=t,c=t.field,l=new m(c,s,{normalizationField:r,normalizationTotal:o,normalizationType:a},t.fieldIndex),u=await Object(h.a)(t.backgroundFillSymbol,i);await Object(n.b)(t.intervals.map((async t=>{const s=await Object(h.a)(t.symbol,i),r=await e.createTemplateGroup(s,u),n={min:t.min,max:t.max};l.add(n,r)})));const f=await Object(h.a)(t.defaultSymbol,i);if(f){const t=await e.createTemplateGroup(f,u);l.setDefault(t)}return l}add(t,e){this._intervals.push({interval:t,result:e}),this._intervals.sort(((t,e)=>t.interval.min-e.interval.min))}size(){return super.size()+this._intervals.length}match(t,e,i,s,r){if(null==this._fieldIndex&&!this._field)return this.getDefault();const n=null!=this._fieldIndex?e.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(e);if(!n&&(null==n||isNaN(n)))return this.getDefault();for(let o=0;o<this._intervals.length;o++){const{interval:t,result:e}=this._intervals[o],i=n>=t.min,s=this._isMaxInclusive?n<=t.max:n<t.max;if(i&&s)return e}return this.getDefault()}_needsNormalization(){const t=this._normalizationInfo;return t&&(t.normalizationField||t.normalizationTotal||t.normalizationType)}_getValueFromField(t){const e=t.readAttribute(this._field);if(!this._needsNormalization())return e;const{normalizationField:i,normalizationTotal:s,normalizationType:r}=this._normalizationInfo,n=!!i&&t.readAttribute(i);if(r)switch(r){case"esriNormalizeByField":return n?e/n:void 0;case"esriNormalizeByLog":return Math.log(e)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return e/s*100;default:return void f.error(`Found unknown normalization type: ${r}`)}else f.error("Normalization is required, but no type was set!")}}class p extends d{constructor(t,e,i){super(),this.type="map",this._nullResult=null,this._resultsMap=new Map,this._fieldsIndex=i,this._fields=t,this._seperator=e||""}static async fromUVRenderer(t,e,i){const s=t.fieldDelimiter,r=[t.field];t.field2&&r.push(t.field2),t.field3&&r.push(t.field3);const o=await Object(h.a)(t.backgroundFillSymbol,i),a=new p(r,s,t.fieldIndex);await Object(n.b)(t.map.map((async t=>{const s=await Object(h.a)(t.symbol,i),r=await e.createTemplateGroup(s,o);"<Null>"===t.value?a.setNullResult(r):a.add(t.value,r)})));const c=await Object(h.a)(t.defaultSymbol,i);if(c){const t=await e.createTemplateGroup(c,o);a.setDefault(t)}return a}setNullResult(t){this._nullResult=t}add(t,e){this._resultsMap.set(t.toString(),e)}size(){return super.size()+this._resultsMap.size}match(t,e,i,s,r){if(null==this._fieldsIndex&&!this._fields)return this.getDefault();const n=null!=this._fieldsIndex?e.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(e);if(null!==this._nullResult&&(null==n||""===n||"<Null>"===n))return this._nullResult;if(!n&&null==n)return this.getDefault();const o=n.toString();return this._resultsMap.has(o)?this._resultsMap.get(o):this.getDefault()}_getValueFromFields(t){const e=[];for(const i of this._fields){const s=t.readAttribute(i);e.push(s)}return e.join(this._seperator)}}class y extends d{constructor(t,e,i,s){super(),this.type="dictionary",this._groupIdCache=new c.a(100),this._renderer=t,this._fieldMap=t.fieldMap,this._symbolFields=t.getSymbolFields(),this._templates=e,this._info=i,this._scaleFn=s}static async fromDictionaryRenderer(t,e,s){const r=(await Promise.resolve().then(i.bind(null,365))).default.fromJSON(t.renderer);await r.fetchResources({spatialReference:s.spatialReference,fields:s.fields});const n=await async function(t,e){const i=t||1;if("number"==typeof i)return(t,e,s)=>i;const s=await Object(o.d)(i,e.spatialReference,e.fields);return(t,i,r)=>Object(l.a)(s,t,{$view:r},e.geometryType,i)||1}(r.scaleExpression,s);return new y(r,e,s,n)}async _analyzeFeature(t,e,i,s){const n=t.readLegacyFeature(),o=this._scaleFn(n,e,i),c=this._attributeHash(n)+"-"+o,l=this._groupIdCache.get(c);if(l)return l;const d={...i,spatialReference:this._info.spatialReference,abortOptions:s,fields:this._info.fields},m=await this._renderer.getSymbolAsync(n,d),p=Object(u.c)(m,this._renderer),y=Object(h.a)(p,this._info,s).then((t=>{if("expanded-cim"!==t.type)return f.error(new r.a("mapview-bad-type",`Found unexpected type ${t.type} in dictionary response`)),null;t.hash+="-"+o;for(const e of t.layers)e.scaleFactor=o,e.templateHash+="-"+o,"text"===e.type&&"string"==typeof e.text&&e.text.indexOf("[")>-1&&(e.text=Object(a.c)(this._fieldMap,e.text,e.cim.textCase));return this._templates.createTemplateGroup(t,null)}));return this._groupIdCache.put(c,y,1),y}async analyze(t,e,i,s,r){const o=e.getCursor(),a=[];for(;o.next();)a.push(this._analyzeFeature(o,i,s,r));return Object(n.b)(a)}match(t,e,i,s,r){return null}_attributeHash(t){let e="";for(const i of this._symbolFields){const s=this._fieldMap[i];s&&(e+=t.attributes[s]+"-")}return e}}const b=s.a.getLogger("esri/views/2d/engine/webgl/mesh/factories/matcherUtils");async function x(t,e,i){switch(t.type){case"simple":return d.fromBasicRenderer(t,e,i);case"map":return p.fromUVRenderer(t,e,i);case"interval":return m.fromCBRenderer(t,e,i);case"dictionary":return y.fromDictionaryRenderer(t,e,i);default:return b.error(new r.a("mapview-mesh:invalid-renderer","Unable to handle unknown renderer type")),null}}},642:function(t,e,i){"use strict";function s(t,e,i){const s=e&&e.length,a=s?e[0]*i:t.length;let c=r(t,0,a,i,!0);const l=new Array;if(!c||c.next===c.prev)return l;let h,d,m,p,y;if(s&&(c=function(t,e,i,s){const o=new Array;for(let n=0,a=e.length;n<a;n++){const i=r(t,e[n]*s,n<a-1?e[n+1]*s:t.length,s,!1);i===i.next&&(i.steiner=!0),o.push(u(i))}o.sort(v);for(const r of o)f(r,i),i=n(i,i.next);return i}(t,e,c,i)),t.length>80*i){h=m=t[0],d=p=t[1];for(let e=i;e<a;e+=i){const i=t[e],s=t[e+1];h=Math.min(h,i),d=Math.min(d,s),m=Math.max(m,i),p=Math.max(p,s)}y=Math.max(m-h,p-d),y=0!==y?1/y:0}return o(c,l,i,h,d,y),l}function r(t,e,i,s,r){let n;if(r===b(t,e,i,s)>0)for(let o=e;o<i;o+=s)n=l(o,t[o],t[o+1],n);else for(let o=i-s;o>=e;o-=s)n=l(o,t[o],t[o+1],n);return n&&O(n,n.next)&&(h(n),n=n.next),n}function n(t,e=t){if(!t)return t;let i,s=t;do{if(i=!1,s.steiner||!O(s,s.next)&&0!==p(s.prev,s,s.next))s=s.next;else{if(h(s),s=e=s.prev,s===s.next)break;i=!0}}while(i||s!==e);return e}function o(t,e,i,s,r,l,u=0){if(!t)return;!u&&l&&(t=d(t,s,r,l));let f=t;for(;t.prev!==t.next;){const d=t.prev,m=t.next;if(l?c(t,s,r,l):a(t))e.push(d.index/i),e.push(t.index/i),e.push(m.index/i),h(t),t=m.next,f=m.next;else if((t=m)===f){u?1===u?o(t=M(t,e,i),e,i,s,r,l,2):2===u&&j(t,e,i,s,r,l):o(n(t),e,i,s,r,l,1);break}}}function a(t){const e=t.prev,i=t,s=t.next;if(p(e,i,s)>=0)return!1;let r=t.next.next;const n=r;let o=0;for(;r!==t.prev&&(0===o||r!==n);){if(o++,x(e.x,e.y,i.x,i.y,s.x,s.y,r.x,r.y)&&p(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function c(t,e,i,s){const r=t.prev,n=t,o=t.next;if(p(r,n,o)>=0)return!1;const a=r.x<n.x?r.x<o.x?r.x:o.x:n.x<o.x?n.x:o.x,c=r.y<n.y?r.y<o.y?r.y:o.y:n.y<o.y?n.y:o.y,l=r.x>n.x?r.x>o.x?r.x:o.x:n.x>o.x?n.x:o.x,h=r.y>n.y?r.y>o.y?r.y:o.y:n.y>o.y?n.y:o.y,u=g(a,c,e,i,s),f=g(l,h,e,i,s);let d=t.prevZ,m=t.nextZ;for(;d&&d.z>=u&&m&&m.z<=f;){if(d!==t.prev&&d!==t.next&&x(r.x,r.y,n.x,n.y,o.x,o.y,d.x,d.y)&&p(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,m!==t.prev&&m!==t.next&&x(r.x,r.y,n.x,n.y,o.x,o.y,m.x,m.y)&&p(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;d&&d.z>=u;){if(d!==t.prev&&d!==t.next&&x(r.x,r.y,n.x,n.y,o.x,o.y,d.x,d.y)&&p(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;m&&m.z<=f;){if(m!==t.prev&&m!==t.next&&x(r.x,r.y,n.x,n.y,o.x,o.y,m.x,m.y)&&p(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function l(t,e,i,s){const r=new C(t,e,i);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function h(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function u(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function f(t,e){if(e=function(t,e){let i=e;const s=t.x,r=t.y;let n,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const t=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=s&&t>o){if(o=t,t===s){if(r===i.y)return i;if(r===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(s===o)return n.prev;const a=n,c=n.x,l=n.y;let h,u=1/0;for(i=n.next;i!==a;)s>=i.x&&i.x>=c&&s!==i.x&&x(r<l?s:o,r,c,l,r<l?o:s,r,i.x,i.y)&&(h=Math.abs(r-i.y)/(s-i.x),(h<u||h===u&&i.x>n.x)&&_(i,t)&&(n=i,u=h)),i=i.next;return n}(t,e)){const i=S(e,t);n(i,i.next)}}function d(t,e,i,s){for(let r;r!==t;r=r.next){if(r=r||t,null===r.z&&(r.z=g(r.x,r.y,e,i,s)),r.prev.next!==r||r.next.prev!==r)return r.prev.next=r,r.next.prev=r,d(t,e,i,s);r.prevZ=r.prev,r.nextZ=r.next}return t.prevZ.nextZ=null,t.prevZ=null,function(t){let e,i=1;for(;;){let s,r=t;t=null,e=null;let n=0;for(;r;){n++,s=r;let o=0;for(;o<i&&s;o++)s=s.nextZ;let a=i;for(;o>0||a>0&&s;){let i;0===o?(i=s,s=s.nextZ,a--):0!==a&&s?r.z<=s.z?(i=r,r=r.nextZ,o--):(i=s,s=s.nextZ,a--):(i=r,r=r.nextZ,o--),e?e.nextZ=i:t=i,i.prevZ=e,e=i}r=s}if(e.nextZ=null,i*=2,n<2)return t}}(t)}function m(t,e,i,s){const r=e&&e.length,n=r?e[0]*i:t.length;let o=Math.abs(b(t,0,n,i));if(r)for(let c=0,l=e.length;c<l;c++){const s=e[c]*i,r=c<l-1?e[c+1]*i:t.length;o-=Math.abs(b(t,s,r,i))}let a=0;for(let c=0;c<s.length;c+=3){const e=s[c]*i,r=s[c+1]*i,n=s[c+2]*i;a+=Math.abs((t[e]-t[n])*(t[r+1]-t[e+1])-(t[e]-t[r])*(t[n+1]-t[e+1]))}return 0===o&&0===a?0:Math.abs((a-o)/o)}function p(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function y(t,e,i,s){return!!(O(t,e)&&O(i,s)||O(t,s)&&O(i,e))||p(t,e,i)>0!=p(t,e,s)>0&&p(i,s,t)>0!=p(i,s,e)>0}function b(t,e,i,s){let r=0;for(let n=e,o=i-s;n<i;n+=s)r+=(t[o]-t[n])*(t[n+1]+t[o+1]),o=n;return r}function x(t,e,i,s,r,n,o,a){return(r-o)*(e-a)-(t-o)*(n-a)>=0&&(t-o)*(s-a)-(i-o)*(e-a)>=0&&(i-o)*(n-a)-(r-o)*(s-a)>=0}function _(t,e){return p(t.prev,t,t.next)<0?p(t,e,t.next)>=0&&p(t,t.prev,e)>=0:p(t,e,t.prev)<0||p(t,t.next,e)<0}function g(t,e,i,s,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-s)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function O(t,e){return t.x===e.x&&t.y===e.y}function v(t,e){return t.x-e.x}function M(t,e,i){let s=t;do{const r=s.prev,n=s.next.next;!O(r,n)&&y(r,s,s.next,n)&&_(r,n)&&_(n,r)&&(e.push(r.index/i),e.push(s.index/i),e.push(n.index/i),h(s),h(s.next),s=t=n),s=s.next}while(s!==t);return s}function j(t,e,i,s,r,a){let c=t;do{let t=c.next.next;for(;t!==c.prev;){if(c.index!==t.index&&w(c,t)){let l=S(c,t);return c=n(c,c.next),l=n(l,l.next),o(c,e,i,s,r,a),void o(l,e,i,s,r,a)}t=t.next}c=c.next}while(c!==t)}function w(t,e){return t.next.index!==e.index&&t.prev.index!==e.index&&!function(t,e){let i=t;do{if(i.index!==t.index&&i.next.index!==t.index&&i.index!==e.index&&i.next.index!==e.index&&y(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&_(t,e)&&_(e,t)&&function(t,e){let i=t,s=!1;const r=(t.x+e.x)/2,n=(t.y+e.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&r<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next}while(i!==t);return s}(t,e)}function S(t,e){const i=new C(t.index,t.x,t.y),s=new C(e.index,e.x,e.y),r=t.next,n=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,s.next=i,i.prev=s,n.next=s,s.prev=n,s}i.d(e,"a",(function(){return m})),i.d(e,"b",(function(){return s}));class C{constructor(t,e,i){this.index=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}}},646:function(t,e,i){"use strict";function s(t){switch(t){case"above-along":case"below-along":case"center-along":return 1;default:return 0}}i.d(e,"a",(function(){return s}))},768:function(t,e,i){"use strict";var s=i(0),r=(i(7),i(6),i(10),i(1)),n=i(3),o=(i(5),i(11),i(12),i(120));let a=class extends o.a{initialize(){}destroy(){}get supportsTileUpdates(){return!1}get spatialReference(){const t=this.get("tileStore.tileScheme.spatialReference");return t&&t.toJSON()||null}};Object(s.a)([Object(r.b)({readOnly:!0})],a.prototype,"supportsTileUpdates",null),Object(s.a)([Object(r.b)({constructOnly:!0})],a.prototype,"remoteClient",void 0),Object(s.a)([Object(r.b)({constructOnly:!0})],a.prototype,"service",void 0),Object(s.a)([Object(r.b)({dependsOn:["tileStore.tileScheme.spatialReference"]})],a.prototype,"spatialReference",null),Object(s.a)([Object(r.b)({constructOnly:!0})],a.prototype,"tileInfo",void 0),Object(s.a)([Object(r.b)({constructOnly:!0})],a.prototype,"tileStore",void 0),a=Object(s.a)([Object(n.a)("esri.views.2d.layers.features.processors.BaseProcessor")],a);var c=a;e.a=c},981:function(t,e,i){"use strict";i.r(e);var s=i(0),r=i(7),n=i(2),o=i(6),a=(i(10),i(1),i(3)),c=(i(13),i(5),i(11),i(12),i(9)),l=i(30),h=i(450),u=i(448),f=i(586),d=i(635),m=i(595),p=i(604),y=i(632),b=i(624);class x{constructor(t,e=2){this._bucketSize=t,this._rowsLength=u.F/t,this._colsLength=u.F/t,this._elementsPerBucket=e,this._grid=this._initGrid()}checkOverlap(t,e){const i=Math.floor(t/this._bucketSize),s=Math.floor(e/this._bucketSize);return i<0||i>=this._rowsLength||s<0||s>=this._colsLength||this._grid[s*this._colsLength+i]>=this._elementsPerBucket}markUsed(t,e){const i=Math.floor(t/this._bucketSize),s=Math.floor(e/this._bucketSize);this._grid[s*this._colsLength+i]+=1}reset(){this._grid=this._initGrid()}_initGrid(){return new Uint8Array(this._rowsLength*this._colsLength)}}var _=i(768);o.a.getLogger("esri.views.2d.layers.features.processors.SymbolProcessor");let g=class extends _.a{constructor(){super(...arguments),this.type="symbol"}destroy(){}get supportsTileUpdates(){return!0}async update(t,e){const i=e.schema.processors[0];if("symbol"!==i.type)return;const s=Object(h.a)(this._schema,i);Object(h.b)(s,"mesh")&&(Object(r.a)("esri-2d-update-debug")&&console.debug("Applying Update - Processor:",s),t.mesh=!0,t.why.mesh.push("Symbology changed"),this._schema=i,this._factory=this._createFactory(i),this._factory.update(i,this.tileStore.tileScheme.tileInfo))}onTileData(t,e,i){return Object(c.w)(i),this._onTileData(t,e,i)}onTileError(t,e,i){const s=i.signal,r={tileKey:t.id,error:e};return this.remoteClient.invoke("tileRenderer.onTileError",r,{signal:s})}_createFactory(t){const{geometryType:e,objectIdField:i,fields:s}=this.service,r={geometryType:e,fields:s,spatialReference:l.a.fromJSON(this.spatialReference)},n=new p.a(((t,e)=>this.remoteClient.invoke("tileRenderer.getMaterialItems",t,e)),!1);return this._store=n,this._matcher=Object(d.a)(t.mesh.matcher,n,r),new y.a(e,i,n)}async _onTileData(t,e,i){const{type:s,addOrUpdate:r,remove:o,end:a}=e;if(!r){const e={type:s,addOrUpdate:null,remove:o,clear:!1,end:a};return this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:t.id,data:e},i)}const l=this._processFeatures(t,r,i),h=i.signal;try{const e=await l,i=Object(n.a)(e,(t=>t.message)),r=Object(n.a)(e,(t=>t.transferList))||[],u={type:s,addOrUpdate:i,remove:o,clear:!1,end:a},f={transferList:Object(n.o)(r)||[],signal:h};return Object(c.w)(f),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:t.id,data:u},f)}catch(e){this._handleError(t,e,i)}}async _processFeatures(t,e,i){if(Object(n.h)(e)||!e.hasFeatures)return null;const s={transform:t.transform,hasZ:!1,hasM:!1},r=this._factory,o={viewingMode:"",scale:t.scale},a=await this._matcher;Object(c.w)(i);const l=this._getLabelInfos(t,e);return await r.analyze(e.getCursor(),a,s,o),Object(c.w)(i),this._writeFeatureSet(t,e,s,l,r)}_writeFeatureSet(t,e,i,s,r){const o=r.createMeshData(e.getApproximateSize()),a={viewingMode:"",scale:t.scale},c=e.getCursor();for(;c.next();)try{const e=c.getDisplayId(),l=Object(n.i)(s)?s.get(e):null;r.writeCursor(o,c,i,a,t.level,l)}catch(t){}return this._encodeDisplayData(o)}_encodeDisplayData(t){const e={},i=new Array;return t.encode(e,i),{message:e,transferList:i}}_handleError(t,e,i){if(!Object(c.n)(e)){const s={tileKey:t.id,error:e.message};return this.remoteClient.invoke("tileRenderer.onTileError",s,{signal:i.signal})}}_shouldDiscard(t,e){switch(this.service.geometryType){case"esriGeometryPoint":{const i=e.readLegacyPointGeometry();return!i||t.checkOverlap(i.x,i.y)}case"esriGeometryPolygon":{const i=e.readLegacyCentroid();return!i||t.checkOverlap(i.x,i.y)}default:return!1}}_markUsed(t,e){switch(this.service.geometryType){case"esriGeometryPoint":{const{x:i,y:s}=e.readLegacyPointGeometry();return t.markUsed(i,s)}case"esriGeometryPolygon":{const{x:i,y:s}=e.readLegacyCentroid();return t.markUsed(i,s)}}}_getLabelInfos(t,e){const i=this._schema.mesh.labels,s=Object(n.a)(i,(e=>e.filter((e=>function(t,e){return(!t.minScale||t.minScale>=e)&&(!t.maxScale||t.maxScale<=e)}(e,t.scale)))));if(Object(n.h)(s)||0===s.length)return null;const r=new Map,o=new x(u.e),a=e.getCursor();for(;a.next();){const t=a.getDisplayId();if(this._shouldDiscard(o,a)){r.has(t)||r.set(t,null);continue}let e=!1;const i=[],n=Object(b.b)(t),c=n&&1!==a.readAttribute("cluster_count")?"aggregate":"feature";for(const r of s){if(r.target!==c)continue;const s=a.getStorage(),o=n&&"feature"===c?s.getComputedStringAtIndex(a.readAttribute("referenceId"),r.fieldIndex):s.getComputedStringAtIndex(t,r.fieldIndex);if(!o)continue;const l=Object(f.a)(o.toString()),h=l[0],u=l[1];this._store.getMosaicItem(r.symbol,Object(m.a)(h)).then((t=>{i[r.index]={glyphs:t.glyphMosaicItems,rtl:u,index:r.index}})),e=!0}r.set(t,i),e&&this._markUsed(o,a)}return r}};g=Object(s.a)([Object(a.a)("esri.views.2d.layers.features.processors.SymbolProcessor")],g);var O=g;e.default=O}}]);