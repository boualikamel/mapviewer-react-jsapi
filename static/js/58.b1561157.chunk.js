(this["webpackJsonptesting-ant-cra"]=this["webpackJsonptesting-ant-cra"]||[]).push([[58,41],{1207:function(e,t,i){"use strict";i.r(t);var n=i(4),r=i(5),a=i(6),o=i(7),s=i(0),c=i(25),l=i(56),u=i(41),d=(i(13),i(16),i(12)),h=i(1),p=i(9),v=i(74),f=i(63),b=i(30),m=i(474),g=i(27),y=i(8),O=i.n(y),j=i(14),_=(i(90),i(114)),x=(i(168),i(61),i(480)),w=i(780),k=i(267),T=i(812),S=i(479),P=i(763),C=i(942),V=i(732),M=i(921),D=i(786),E=i(169),z=i(92),H=i(55),A=i(139),I=i(115),R=i(185),G=i(248),L=i(156),F=i(120),U=i(44),q=i(129),N=1e5,Z=function(e){Object(a.a)(i,e);var t=Object(o.a)(i);function i(){var e;return Object(n.a)(this,i),(e=t.apply(this,arguments))._drawActive=!1,e._handles=new f.a,e._graphicsLayer=new S.a,e._manipulatorLayer=new S.a,e._groupLayer=new P.default({layers:[e._graphicsLayer,e._manipulatorLayer],listMode:"hide",visible:!1}),e._vertices=[],e.geodesicDistanceThreshold=1e5,e.measurement=null,e.measurementLabel=null,e}return Object(r.a)(i,[{key:"initialize",value:function(){var e=this;Object(E.a)("esri/core/t9n/Units").then((function(t){e.messages=t})),this._handles.add(Object(z.c)(Object(j.a)(O.a.mark((function t(){return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(E.a)("esri/core/t9n/Units");case 2:e.messages=t.sent;case 3:case"end":return t.stop()}}),t)}))))),this.startToolCreation()}},{key:"destroy",value:function(){this.detach(),this._draw&&(this._draw.destroy(),this._draw=null),this._handles&&(this._handles.destroy(),this._handles=null),this._graphicsLayer&&(this._graphicsLayer.destroy(),this._graphicsLayer=null),this._manipulatorLayer&&(this._manipulatorLayer.destroy(),this._manipulatorLayer=null)}},{key:"editable",set:function(e){this._set("editable",e),e||this._draw.reset()}},{key:"activate",value:function(){this._drawActive||0!==this._vertices.length||this._startSketch()}},{key:"onAttach",value:function(){var e=this,t=this.view;this._draw=new C.a({view:t}),t.map.add(this._groupLayer),t.focus(),this._handles.add([Object(b.a)(this,["unit","geodesicDistanceThreshold","palette","messages"],(function(){e._vertices.length>0&&e._updateGraphics()})),Object(b.a)(this,"view.spatialReference",(function(e){W(e)&&!Object(k.g)()&&Object(k.i)()}))]),this.finishToolCreation()}},{key:"onDetach",value:function(){var e=this.view.map;this._draw.view=null,this._draw.destroy(),this._draw=null,e.remove(this._groupLayer),this._handles.removeAll(),this._graphicsLayer.removeAll(),this._manipulatorLayer.removeAll(),this._set("measurement",null),this._set("measurementLabel",null)}},{key:"onShow",value:function(){this._groupLayer.visible=!0}},{key:"onHide",value:function(){this._groupLayer.visible=!1}},{key:"reset",value:function(){this._vertices=[],this._graphicsLayer.removeAll(),this._set("measurement",null),this._set("measurementLabel",null),this._draw.reset(),this._drawActive=!1,this._updateSketch([])}},{key:"onInputEvent",value:function(e){"pointer-move"===e.type&&this._updateCursor()}},{key:"_startSketch",value:function(){var e=this;this._drawActive=!0;var t=this._draw.create("polyline",{mode:"click"});t.on(["vertex-add","vertex-update","vertex-remove","cursor-update","undo","redo"],(function(t){return e._updateSketch(t.vertices)})),t.on("draw-complete",(function(){return e._stopSketch()}))}},{key:"_stopSketch",value:function(){if(this._vertices.length<3)return this.reset(),void this._startSketch();this.manipulators.forEach((function(e){e.manipulator.interactive=!0})),this._drawActive=!1,this.complete()}},{key:"_updateSketch",value:function(e){var t=this;if(!W(this.view.spatialReference)||Object(k.g)()){if(e.length<2)return this._vertices=[],this.manipulators.removeAll(),void this._graphicsLayer.removeAll();this.finishToolCreation();for(var i=this.view.spatialReference;this._vertices.length>e.length;){var n=this._vertices.pop().manipulatorId;this.manipulators.remove(n)}for(var r=function(n){var r=Object(g.a)(e[n],2),a=r[0],o=r[1],s=function(e,t,i,n){var r=new L.a({style:"circle",color:n.handleColor,size:n.handleWidth,outline:{type:"simple-line",width:0}}),a=new L.a({style:"circle",color:n.handleColor,size:1.5*n.handleWidth,outline:{type:"simple-line",width:0}}),o=new _.a({geometry:e,symbol:r});return new M.a({view:t,layer:i,graphic:o,focusedSymbol:a})}(new H.a({x:a,y:o,spatialReference:i}),t.view,t._manipulatorLayer,t.palette),c=t.manipulators.add(s);Object(V.b)(s,(function(e,i){i.next(Object(V.e)(t.view)).next(Object(V.c)(e.graphic,2)).next((function(){var i=e.graphic.geometry;t._vertices[n].coord=[i.x,i.y],t._updateGraphics()}))})),t._vertices.push({manipulatorId:c,coord:[a,o]})},a=this._vertices.length;a<e.length;a++)r(a);var o=this._vertices.length-1,s=this._vertices[o],c=Object(g.a)(e[o],2),l=c[0],u=c[1];if(s.coord[0]!==l||s.coord[1]!==u){s.coord=[l,u];var d=new H.a({x:l,y:u,spatialReference:i});this.manipulators.findById(s.manipulatorId).graphic.geometry=d}var h=this._drawActive?this._vertices[o].manipulatorId:null;this.manipulators.forEach((function(e){e.manipulator.interactive=null==h||e.id!==h})),this._updateGraphics()}}},{key:"_updateCursor",value:function(){this.cursor=this._drawActive?"crosshair":null}},{key:"_updateGraphics",value:function(){this._graphicsLayer.removeAll();var e=function(e,t,i){if(2===e.length){var n,r=new F.a({paths:e,spatialReference:t});if(t.isGeographic)if(Object(T.e)(t))n=Object(T.b)(r,N);else{var a=Object(k.j)(r,U.a.WGS84),o=Object(T.b)(a,N);n=Object(k.j)(o,t)}else if(t.isWebMercator)n=Object(w.geodesicDensify)(r,N,"meters");else if(Object(w.planarLength)(r,"meters")>=i){var s=Object(k.j)(r,U.a.WGS84),c=Object(T.b)(s,N);n=Object(k.j)(c,t)}else n=r;return{measurement:null,fillGeometry:null,outlineGeometry:n}}e.push(e[0]);var l,u,d=new F.a({paths:[e],spatialReference:t}),h=new q.a({rings:[e],spatialReference:t}),p=null,v=null;if(t.isGeographic)if(Object(T.e)(t)){if(p=Object(T.b)(d,N),v=Object(T.b)(h,N),!(v=Object(w.simplify)(v)))return null;l=Object(T.c)([d],"meters")[0],u=Object(T.a)([v],"square-meters")[0]}else{var f=U.a.WGS84,b=Object(k.j)(d,f),m=Object(k.j)(h,f);if(p=Object(T.b)(b,N),v=Object(T.b)(m,N),!(v=Object(w.simplify)(v)))return null;l=Object(T.c)([b],"meters")[0],u=Object(T.a)([v],"square-meters")[0],p=Object(k.j)(p,t),v=Object(k.j)(v,t)}else if(t.isWebMercator){if(p=Object(w.geodesicDensify)(d,N,"meters"),v=Object(w.geodesicDensify)(h,N,"meters"),!(v=Object(w.simplify)(v)))return null;l=Object(w.geodesicLength)(d,"meters"),u=Object(w.geodesicArea)(v,"square-meters")}else{var g=Object(w.planarLength)(d,"meters");if(g>=i){var y=U.a.WGS84,O=Object(k.j)(d,y),j=Object(k.j)(h,y);if(p=Object(T.b)(O,N),v=Object(T.b)(j,N),!(v=Object(w.simplify)(v)))return null;l=Object(T.c)([O],"meters")[0],u=Object(T.a)([v],"square-meters")[0],p=Object(k.j)(p,t),v=Object(k.j)(v,t)}else{if(p=d,!(v=Object(w.simplify)(h)))return null;l=g,u=Object(w.planarArea)(v,"square-meters")}}return{measurement:{geometry:v,area:u,perimeter:l},fillGeometry:v,outlineGeometry:p}}(this._vertices.map((function(e){return e.coord})),this.view.spatialReference,this.geodesicDistanceThreshold);if(e){var t=e.measurement,i=e.fillGeometry,n=e.outlineGeometry;this._set("measurement",t);var r=t?function(e,t,i){if(!t||!e)return null;var n={area:null,perimeter:null},r=t.area,a=t.perimeter;switch(i){case"metric":n.area=Object(x.g)(e,r,"square-meters");break;case"imperial":n.area=Object(x.d)(e,r,"square-meters");break;default:var o=Object(l.c)(r,"square-meters",i);n.area=Object(x.b)(e,o,i)}var s=function(e){switch(e){case"metric":return"metric";case"imperial":return"imperial";case"square-inches":return"inches";case"square-feet":return"feet";case"square-yards":return"yards";case"square-miles":return"miles";case"square-us-feet":return"us-feet";case"square-meters":return"meters";case"square-kilometers":return"kilometers";case"acres":return"imperial";case"ares":case"hectares":return"metric";case"square-millimeters":return"millimeters";case"square-centimeters":return"centimeters";case"square-decimeters":return"decimeters";default:return null}}(i);if(s)switch(s){case"metric":n.perimeter=Object(x.h)(e,a,"meters");break;case"imperial":n.perimeter=Object(x.e)(e,a,"meters");break;default:var c=Object(l.c)(a,"meters",s);n.perimeter=Object(x.b)(e,c,s)}else n.perimeter="";return n}(this.messages,t,this.unit):null;if(this._set("measurementLabel",r),i||n){var a=this.palette,o=a.fillColor,s=a.pathColor,c=a.pathWidth,u=[];i&&u.push(new _.a({geometry:i,symbol:new A.a({color:o,outline:new I.a({width:0})})})),n&&u.push(new _.a({geometry:n,symbol:new I.a({color:s,width:c})})),i&&r&&u.push(new _.a({geometry:i.centroid,symbol:new R.a({color:[255,255,255,1],font:new G.a({size:14,family:"sans-serif"}),haloColor:[0,0,0,.5],haloSize:2,text:r.area})})),this._graphicsLayer.addMany(u)}}}}]),i}(D.a);function W(e){if(!e)return!1;var t=e.isGeographic,i=e.isWebMercator,n=e.isWGS84;return t&&!n&&!Object(T.e)(e)||!t&&!i}Object(s.a)([Object(h.b)()],Z.prototype,"cursor",void 0),Object(s.a)([Object(h.b)({value:!0})],Z.prototype,"editable",null),Object(s.a)([Object(h.b)({type:Number})],Z.prototype,"geodesicDistanceThreshold",void 0),Object(s.a)([Object(h.b)({readOnly:!0})],Z.prototype,"measurement",void 0),Object(s.a)([Object(h.b)({readOnly:!0})],Z.prototype,"measurementLabel",void 0),Object(s.a)([Object(h.b)()],Z.prototype,"messages",void 0),Object(s.a)([Object(h.b)()],Z.prototype,"palette",void 0),Object(s.a)([Object(h.b)()],Z.prototype,"unit",void 0),Object(s.a)([Object(h.b)({constructOnly:!0})],Z.prototype,"view",void 0);var B=Z=Object(s.a)([Object(p.a)("esri.widgets.AreaMeasurement2D.AreaMeasurement2DTool")],Z),X=i(857),Y={handleWidth:8,handleColor:[255,128,0,.5],pathWidth:2,pathColor:[255,128,0,1],fillColor:[255,128,0,.3]},Q=d.a.getLogger("esri.widgets.AreaMeasurement2D.AreaMeasurement2DViewModel"),K=function(e){Object(a.a)(i,e);var t=Object(o.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e)).supportedViewType="2d",r._handles=new f.a,r.geodesicDistanceThreshold=1e5,r.measurement=null,r.measurementLabel=null,r.palette=Y,r.tool=null,r}return Object(r.a)(i,[{key:"initialize",value:function(){var e=this;this._handles.add([Object(b.a)(this,["unit","palette","geodesicDistanceThreshold"],(function(t,i,n){e.tool&&(e.tool[n]=t)}))])}},{key:"destroy",value:function(){this._handles&&(this._handles.destroy(),this._handles=null)}},{key:"state",get:function(){var e;return this.isDisabled?"disabled":function(e){return null!=e&&(!W(e)||Object(k.h)())}(null==(e=this.view)?void 0:e.spatialReference)?this.tool&&this.tool.measurement?this.tool.active?"measuring":"measured":"ready":"disabled"}},{key:"unit",get:function(){return this._validateUnit(this.defaultUnit)},set:function(e){void 0!==e?this._override("unit",this._validateUnit(e)):this._clearOverride("unit")}},{key:"unitOptions",get:function(){return l.p},set:function(e){void 0!==e?this._override("unitOptions",this._validateUnits(e)):this._clearOverride("unitOptions")}},{key:"start",value:function(){return this.createTool()}},{key:"clear",value:function(){this.removeTool()}},{key:"createToolParams",value:function(){var e=this;return{toolConstructor:B,constructorArguments:function(){return{geodesicDistanceThreshold:e.geodesicDistanceThreshold,palette:e.palette,unit:e.unit}}}}},{key:"logUnsupportedError",value:function(){Q.error("AreaMeasurement2D widget is not implemented for SceneView")}},{key:"logError",value:function(){Q.error.apply(Q,arguments)}},{key:"_validateUnit",value:function(e){return-1!==this.unitOptions.indexOf(e)?e:-1!==this.unitOptions.indexOf(this.defaultUnit)?this.defaultUnit:this.unitOptions[0]}},{key:"_validateUnits",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.filter((function(e){return-1!==l.p.indexOf(e)}));return 0===t.length?l.p.slice():t}}]),i}(X.a);Object(s.a)([Object(h.b)(m.a)],K.prototype,"defaultUnit",void 0),Object(s.a)([Object(h.b)({type:Number})],K.prototype,"geodesicDistanceThreshold",void 0),Object(s.a)([Object(h.b)({readOnly:!0,aliasOf:"tool.measurement"})],K.prototype,"measurement",void 0),Object(s.a)([Object(h.b)({readOnly:!0,aliasOf:"tool.measurementLabel"})],K.prototype,"measurementLabel",void 0),Object(s.a)([Object(h.b)()],K.prototype,"palette",void 0),Object(s.a)([Object(h.b)({readOnly:!0})],K.prototype,"state",null),Object(s.a)([Object(h.b)({constructOnly:!0,readOnly:!0})],K.prototype,"tool",void 0),Object(s.a)([Object(h.b)({type:String})],K.prototype,"unit",null),Object(s.a)([Object(h.b)({type:[String]})],K.prototype,"unitOptions",null);var J=K=Object(s.a)([Object(p.a)("esri.widgets.AreaMeasurement2D.AreaMeasurement2DViewModel")],K),$=i(108),ee=i(80),te=i(17),ie=(i(51),"esri-area-measurement-2d"),ne={buttonDisabled:"esri-button--disabled",widgetIcon:"esri-icon-measure-area",base:"".concat(ie," esri-widget esri-widget--panel"),container:"".concat(ie,"__container"),hint:"".concat(ie,"__hint"),hintText:"".concat(ie,"__hint-text"),panelError:"".concat(ie,"__panel--error"),measurement:"".concat(ie,"__measurement"),measurementItem:"".concat(ie,"__measurement-item"),measurementItemDisabled:"".concat(ie,"__measurement-item--disabled"),measurementItemTitle:"".concat(ie,"__measurement-item-title"),measurementItemValue:"".concat(ie,"__measurement-item-value"),settings:"".concat(ie,"__settings"),units:"".concat(ie,"__units"),unitsLabel:"".concat(ie,"__units-label"),unitsSelect:"".concat(ie,"__units-select esri-select"),unitsSelectWrapper:"".concat(ie,"__units-select-wrapper"),actionSection:"".concat(ie,"__actions"),newMeasurementButton:"".concat(ie,"__clear-button esri-button esri-button--primary")},re=function(e){Object(a.a)(i,e);var t=Object(o.a)(i);function i(e,r){var a;return Object(n.a)(this,i),(a=t.call(this,e,r)).active=null,a.iconClass=ne.widgetIcon,a.label=void 0,a.messages=null,a.messagesUnits=null,a.unit=null,a.unitOptions=null,a.view=null,a.viewModel=new J,a}return Object(r.a)(i,[{key:"render",value:function(){var e=this,t=this.id,i=this.viewModel,n=this.visible,r=i.active,a=i.isSupported,o=i.measurementLabel,s=i.state,c=i.unit,u=i.unitOptions,d="disabled"===s,h="ready"===s,p="measuring"===s||"measured"===s,v=this.messages,f=this.messagesUnits,b=r&&h?Object(te.a)("section",{key:"hint",class:ne.hint},Object(te.a)("p",{class:ne.hintText},v.hint)):null,m=a?null:Object(te.a)("section",{key:"unsupported",class:ne.panelError},Object(te.a)("p",null,v.unsupported)),g=function(t,i,n){return i?Object(te.a)("div",{key:"".concat(n,"-enabled"),class:ne.measurementItem},Object(te.a)("span",{class:ne.measurementItemTitle},t),Object(te.a)("span",{class:ne.measurementItemValue},i)):Object(te.a)("div",{key:"".concat(n,"-disabled"),class:e.classes(ne.measurementItem,ne.measurementItemDisabled),"aria-disabled":"true"},Object(te.a)("span",{class:ne.measurementItemTitle},t))},y=p?Object(te.a)("section",{key:"measurement",class:ne.measurement},g(v.area,o.area,"area"),g(v.perimeter,o.perimeter,"perimeter")):null,O="".concat(t,"__units"),j=Object(te.a)("section",{key:"units",class:ne.units},Object(te.a)("label",{class:ne.unitsLabel,for:O},v.unit),Object(te.a)("div",{class:ne.unitsSelectWrapper},Object(te.a)("select",{class:ne.unitsSelect,id:O,onchange:this._changeUnit,bind:this,value:c},u.map((function(e){var t;return Object(te.a)("option",{key:e,value:e},Object(l.l)(e)?f.systems[e]:null==(t=f.units[e])?void 0:t.pluralCapitalized)}))))),_=p?Object(te.a)("div",{key:"settings",class:ne.settings},j):null,x=!a||r&&!p?null:Object(te.a)("div",{class:ne.actionSection},Object(te.a)("button",{disabled:d,class:this.classes(ne.newMeasurementButton,d&&ne.buttonDisabled),bind:this,onclick:this._newMeasurement,title:v.newMeasurement,type:"button","aria-label":v.newMeasurement},v.newMeasurement)),w=n?Object(te.a)("div",{class:ne.container},m,b,_,y,x):null;return Object(te.a)("div",{class:ne.base},w)}},{key:"_newMeasurement",value:function(){Object(c.l)(this.viewModel.start())}},{key:"_changeUnit",value:function(e){var t=e.target,i=t.options[t.selectedIndex];i&&(this.viewModel.unit=i.value)}}]),i}(v.a);Object(s.a)([Object(u.a)("viewModel.active")],re.prototype,"active",void 0),Object(s.a)([Object(h.b)()],re.prototype,"iconClass",void 0),Object(s.a)([Object(h.b)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],re.prototype,"label",void 0),Object(s.a)([Object(h.b)()],re.prototype,"localeStrings",void 0),Object(s.a)([Object(h.b)(),Object(ee.a)("esri/widgets/AreaMeasurement2D/t9n/AreaMeasurement2D")],re.prototype,"messages",void 0),Object(s.a)([Object(h.b)(),Object(ee.a)("esri/core/t9n/Units")],re.prototype,"messagesUnits",void 0),Object(s.a)([Object(u.a)("viewModel.unit")],re.prototype,"unit",void 0),Object(s.a)([Object(u.a)("viewModel.unitOptions")],re.prototype,"unitOptions",void 0),Object(s.a)([Object(u.a)("viewModel.view")],re.prototype,"view",void 0),Object(s.a)([Object(h.b)({type:J})],re.prototype,"viewModel",void 0),Object(s.a)([Object(u.a)("viewModel.visible")],re.prototype,"visible",void 0),Object(s.a)([Object($.a)()],re.prototype,"_newMeasurement",null),Object(s.a)([Object($.a)()],re.prototype,"_changeUnit",null);var ae=re=Object(s.a)([Object(p.a)("esri.widgets.AreaMeasurement2D")],re);t.default=ae},607:function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return f})),i.d(t,"c",(function(){return m})),i.d(t,"d",(function(){return v}));var n=i(15),r=i(6),a=i(7),o=i(4),s=i(5),c=i(130),l=i(112),u=i(10),d=i(129),h=i(120),p=i(727),v=function(){function e(t){Object(o.a)(this,e),this.left=null,this.right=null,this.type="vertex",this.index=null,this.component=t}return Object(s.a)(e,[{key:"pos",get:function(){return this._pos},set:function(e){this._pos=e,this.component.unnormalizeVertexPositions()}}]),e}(),f=function e(t,i,n){Object(o.a)(this,e),this.type="edge",this.component=t,this.left=i,this.right=n,i.right=this,n.left=this},b=function(){function e(t){Object(o.a)(this,e),this.vertices=[],this.edges=[],this.data=t}return Object(s.a)(e,[{key:"unnormalizeVertexPositions",value:function(){this.vertices.length<=1||this.data.coordinateHelper.unnormalize(this.vertices)}},{key:"updateVertexIndex",value:function(e,t){if(0!==this.vertices.length){var i=this.vertices[0],n=null,r=e,a=t;do{(n=r).index=a++,r=n.right?n.right.right:null}while(null!=r&&r!==i);n.left&&n!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(n),this.vertices.length-1)}}},{key:"getFirstVertex",value:function(){return 0===this.vertices.length?null:this.vertices[0]}},{key:"getLastVertex",value:function(){return 0===this.vertices.length?null:this.vertices[this.vertices.length-1]}},{key:"isClosed",value:function(){return this.vertices.length>2&&null!==this.vertices[0].left}},{key:"swapVertices",value:function(e,t){var i=this.vertices[e];this.vertices[e]=this.vertices[t],this.vertices[t]=i}},{key:"iterateVertices",value:function(e){if(0!==this.vertices.length){var t=this.vertices[0],i=t;do{e(i,i.index),i=Object(u.k)(i.right)?i.right.right:null}while(i!==t&&null!=i)}}}]),e}(),m=function(e){Object(r.a)(i,e);var t=Object(a.a)(i);function i(e){var n;return Object(o.a)(this,i),(n=t.call(this)).coordinateHelper=e,n.undoStack=[],n.redoStack=[],n.components=[],n}return Object(s.a)(i,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return 0!==t&&!Object(u.j)(this.lastOperation)&&this.lastOperation.accumulate(e)||(e.apply(),this.undoStack.push(e),this.redoStack=[]),e}},{key:"undo",value:function(){if(this.undoStack.length>0){var e=this.undoStack.pop();return e.undo(),this.redoStack.push(e),e}return null}},{key:"canUndo",get:function(){return this.undoStack.length>0}},{key:"lastOperation",get:function(){return this.undoStack.length>0?this.undoStack[this.undoStack.length-1]:null}},{key:"redo",value:function(){if(this.redoStack.length>0){var e=this.redoStack.pop();return e.apply(),this.undoStack.push(e),e}return null}},{key:"canRedo",get:function(){return this.redoStack.length>0}},{key:"toPoint",value:function(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.createPoint(this.components[0].vertices[0].pos)}},{key:"toPolyline",value:function(){var e=[],t=this.coordinateHelper.toArray;return this.components.forEach((function(i,n){var r=[],a=i.vertices.find((function(e){return null==e.left})),o=a;do{r.push(t(a.pos)),a=a.right?a.right.right:null}while(a&&a!==o);e.push(r)})),new h.a({paths:e,spatialReference:this.coordinateHelper.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}},{key:"toPolygon",value:function(){var e=[],t=this.coordinateHelper.toArray;return this.components.forEach((function(i,n){var r=[],a=i.vertices[0],o=a,s=o;do{r.push(t(o.pos)),o=Object(u.k)(o.right)?o.right.right:null}while(o&&o!==s);i.isClosed()&&r.push(t(a.pos)),e.push(r)})),new d.a({rings:e,spatialReference:this.coordinateHelper.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}}],[{key:"fromGeometry",value:function(e,t){var r=Object(p.a)(e.hasZ,e.hasM,e.spatialReference,t),a=new i(r);switch(e.type){case"polygon":for(var o=e.rings,s=0;s<o.length;++s){for(var l=o[s],u=new b(a),d=l.length>2&&Object(c.c)(l[0],l[l.length-1]),h=d?l.length-1:l.length,m=0;m<h;++m){var g=r.fromArray(l[m]),y=new v(u);u.vertices.push(y),y.pos=g,y.index=m}for(var O=u.vertices.length-1,j=0;j<O;++j){var _=u.vertices[j],x=u.vertices[j+1],w=new f(u,_,x);u.edges.push(w)}if(d){var k=new f(u,u.vertices[u.vertices.length-1],u.vertices[0]);u.edges.push(k)}a.components.push(u)}break;case"polyline":var T,S=Object(n.a)(e.paths);try{for(S.s();!(T=S.n()).done;){for(var P=T.value,C=new b(a),V=P.length,M=0;M<V;++M){var D=r.fromArray(P[M]),E=new v(C);C.vertices.push(E),E.pos=D,E.index=M}for(var z=C.vertices.length-1,H=0;H<z;++H){var A=C.vertices[H],I=C.vertices[H+1],R=new f(C,A,I);C.edges.push(R)}a.components.push(C)}}catch(F){S.e(F)}finally{S.f()}break;case"point":var G=new b(a),L=new v(G);L.index=0,L.pos=a.coordinateHelper.fromPoint(e),G.vertices.push(L),a.components.push(G)}return a}}]),i}(l.a)},687:function(e,t,i){"use strict";function n(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function r(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){for(var t=0,i=0,n=0;n<e.length;n++){var r=e[n].size;"number"==typeof r&&(t+=r,i++)}return t/i}(e.stops):t}function a(e,t){if(!t)return e;var i=t.filter((function(e){return"size"===e.type})).map((function(t){var i=t.maxSize,n=t.minSize;return(r(i,e)+r(n,e))/2})),n=0,a=i.length;if(0===a)return e;for(var o=0;o<a;o++)n+=i[o];var s=Math.floor(n/a);return Math.max(s,e)}function o(e){var t=e&&e.renderer,i="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return i;var r="visualVariables"in t?a(i,t.visualVariables):i;if("simple"===t.type)return n(r,t.symbol);if("unique-value"===t.type){var o=r;return t.uniqueValueInfos.forEach((function(e){o=n(o,e.symbol)})),o}if("class-breaks"===t.type){var s=r;return t.classBreakInfos.forEach((function(e){s=n(s,e.symbol)})),s}return t.type,r}i.d(t,"a",(function(){return o}))},707:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return v}));var n,r,a,o,s,c,l,u=i(598),d=i(597),h=i(694);function p(e){e.vertex.code.add(Object(d.a)(n||(n=Object(u.a)(["float screenSizePerspectiveMinSize(float size, vec4 factor) {\nfloat nonZeroSize = 1.0 - step(size, 0.0);\nreturn (\nfactor.z * (\n1.0 +\nnonZeroSize *\n2.0 * factor.w / (\nsize + (1.0 - nonZeroSize)\n)\n)\n);\n}"])))),e.vertex.code.add(Object(d.a)(r||(r=Object(u.a)(["float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\nreturn absCosAngle * absCosAngle * absCosAngle;\n}"])))),e.vertex.code.add(Object(d.a)(a||(a=Object(u.a)(["vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\nreturn vec4(\nmin(params.x / (distanceToCamera - params.y), 1.0),\nscreenSizePerspectiveViewAngleDependentFactor(absCosAngle),\nparams.z,\nparams.w\n);\n}"])))),e.vertex.code.add(Object(d.a)(o||(o=Object(u.a)(["float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\nreturn max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n}"])))),e.vertex.code.add(Object(d.a)(s||(s=Object(u.a)(["float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\nreturn applyScreenSizePerspectiveScaleFactorFloat(\nsize,\nscreenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)\n);\n}"])))),e.vertex.code.add(Object(d.a)(c||(c=Object(u.a)(["vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\nreturn mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n}"])))),e.vertex.code.add(Object(d.a)(l||(l=Object(u.a)(["vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\nreturn applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n}"]))))}function v(e,t){if(t.screenSizePerspective){Object(h.a)(t.screenSizePerspective,e,"screenSizePerspective");var i=t.screenSizePerspectiveAlignment||t.screenSizePerspective;Object(h.a)(i,e,"screenSizePerspectiveAlignment")}}},713:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return c}));i(90);var n=i(10),r=i(56),a=i(687),o=i(53);function s(e,t,i){var a,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.a;if("2d"===i.type)a=t*i.resolution;else if("3d"===i.type){var c=i.overlayPixelSizeInMapUnits(e),l=i.basemapSpatialReference;a=Object(n.k)(l)&&!l.equals(i.spatialReference)?Object(r.f)(l)/Object(r.f)(i.spatialReference):t*c}var u=e.x-a,d=e.y-a,h=e.x+a,p=e.y+a,v=i.spatialReference;return s.xmin=Math.min(u,h),s.ymin=Math.min(d,p),s.xmax=Math.max(u,h),s.ymax=Math.max(d,p),s.spatialReference=v,s}function c(e,t,i){var r=i.toMap(e);return!Object(n.j)(r)&&s(r,Object(a.a)(),i,l).intersects(t)}var l=new o.a},727:function(e,t,i){"use strict";i.d(t,"a",(function(){return m}));var n=i(4),r=i(5),a=i(50),o=i(91),s=i(54),c=i(85),l=i(443),u=i(463),d=i(55),h=i(45),p=Object(o.a)(),v=function(){function e(t,i){Object(n.a)(this,e),this.spatialReference=t,this.viewingMode=i,this._unnormalizationInfo=y(t,i)}return Object(r.a)(e,[{key:"tag",value:function(e){return e}},{key:"createNew",value:function(){return this.tag(Object(o.a)())}},{key:"fromPoint",value:function(e){return this.tag(Object(o.e)(e.x,e.y))}},{key:"fromArray",value:function(e){return this.tag(Object(o.e)(e[0],e[1]))}},{key:"toArray",value:function(e){return[e[0],e[1]]}},{key:"clone",value:function(e){return this.tag(Object(o.d)(e))}},{key:"copy",value:function(e,t){return Object(a.c)(t,e)}},{key:"toPoint",value:function(e,t){return t.x=e[0],t.y=e[1],t.hasZ=!1,t.hasM=!1,t.spatialReference=this.spatialReference,t}},{key:"createPoint",value:function(e){return new d.a({x:e[0],y:e[1],z:void 0,m:void 0,spatialReference:this.spatialReference})}},{key:"createPointFromArray",value:function(e){return new d.a({x:e[0],y:e[1],z:void 0,m:void 0,spatialReference:this.spatialReference})}},{key:"createDehydratedPoint",value:function(e){return{x:e[0],y:e[1],z:void 0,m:void 0,hasZ:!1,hasM:!1,spatialReference:this.spatialReference,type:"point"}}},{key:"lerp",value:function(e,t,i,n){return Object(a.m)(n,e,t,i)}},{key:"addDelta",value:function(e,t,i){e[0]+=t,e[1]+=i}},{key:"scale",value:function(e,t,i,n){var r=Object(a.a)(p,e,t),o=Object(a.b)(p,i,Object(a.h)(i,r));Object(a.o)(e,e,o,n-1)}},{key:"rotate",value:function(e,t,i){Object(a.q)(e,e,t,i)}},{key:"pointToArray",value:function(e){return[e.x,e.y]}},{key:"getZ",value:function(e,t){return t}},{key:"hasZ",value:function(){return!1}},{key:"getM",value:function(e,t){return t}},{key:"hasM",value:function(){return!1}},{key:"unnormalize",value:function(e){g(e,this._unnormalizationInfo)}},{key:"fromXYZ",value:function(e){return this.tag(Object(o.e)(e[0],e[1]))}},{key:"toXYZ",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(c.g)(e[0],e[1],t)}},{key:"distance",value:function(e,t){return Object(a.d)(e,t)}}]),e}(),f=function(){function e(t,i,r){Object(n.a)(this,e),this.valueType=t,this.spatialReference=i,this._unnormalizationInfo=y(i,r)}return Object(r.a)(e,[{key:"distance",value:function(e,t){return 0===this.valueType?Object(s.j)(e,t):Object(a.d)(e,t)}},{key:"tag",value:function(e){return e}},{key:"createNew",value:function(){return this.tag(Object(c.e)())}},{key:"fromPoint",value:function(e){return this.tag(Object(c.g)(e.x,e.y,0===this.valueType?e.z:e.m))}},{key:"fromArray",value:function(e){return this.tag(Object(c.g)(e[0],e[1],e[2]||0))}},{key:"toArray",value:function(e){return[e[0],e[1],e[2]]}},{key:"clone",value:function(e){return this.tag(Object(c.f)(e))}},{key:"copy",value:function(e,t){return Object(s.h)(t,e)}},{key:"toPoint",value:function(e,t){return t.x=e[0],t.y=e[1],0===this.valueType?(t.z=e[2],t.hasZ=!0,t.hasM=!1):(t.m=e[2],t.hasZ=!1,t.hasM=!0),t.spatialReference=this.spatialReference,t}},{key:"createPoint",value:function(e){return new d.a({x:e[0],y:e[1],z:0===this.valueType?e[2]:void 0,m:1===this.valueType?e[2]:void 0,spatialReference:this.spatialReference})}},{key:"createPointFromArray",value:function(e){return new d.a({x:e[0],y:e[1],z:0===this.valueType?e[2]:void 0,m:1===this.valueType?e[2]:void 0,spatialReference:this.spatialReference})}},{key:"createDehydratedPoint",value:function(e){var t=0===this.valueType,i=1===this.valueType;return{x:e[0],y:e[1],z:t?e[2]:void 0,m:i?e[2]:void 0,hasZ:t,hasM:i,spatialReference:this.spatialReference,type:"point"}}},{key:"lerp",value:function(e,t,i,n){return Object(s.f)(n,e,t,i)}},{key:"addDelta",value:function(e,t,i,n){e[0]+=t,e[1]+=i,0===this.valueType&&(e[2]+=n)}},{key:"scale",value:function(e,t,i,n){var r=Object(a.a)(p,e,t),o=Object(a.b)(p,i,Object(a.h)(i,r));Object(a.o)(e,e,o,n-1)}},{key:"rotate",value:function(e,t,i){Object(a.q)(e,e,t,i)}},{key:"pointToArray",value:function(e){return 0===this.valueType?[e.x,e.y,e.z]:[e.x,e.y,e.m]}},{key:"getZ",value:function(e,t){return 0===this.valueType?e[2]:t}},{key:"hasZ",value:function(){return 0===this.valueType}},{key:"getM",value:function(e,t){return 1===this.valueType?e[2]:t}},{key:"hasM",value:function(){return 1===this.valueType}},{key:"unnormalize",value:function(e){g(e,this._unnormalizationInfo)}},{key:"fromXYZ",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.tag(Object(c.g)(e[0],e[1],0===this.valueType?e.length>2?e[2]:t:i))}},{key:"toXYZ",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.tag(Object(c.g)(e[0],e[1],0===this.valueType?e[2]:t))}}]),e}(),b=function(){function e(t,i){Object(n.a)(this,e),this.spatialReference=t,this._unnormalizationInfo=y(t,i)}return Object(r.a)(e,[{key:"distance",value:function(e,t){return Object(s.j)(e,t)}},{key:"tag",value:function(e){return e}},{key:"createNew",value:function(){return this.tag(Object(u.e)())}},{key:"fromPoint",value:function(e){return this.tag(Object(u.g)(e.x,e.y,e.z,e.m))}},{key:"fromArray",value:function(e){return this.tag(Object(u.g)(e[0],e[1],e[2]||0,e[3]||0))}},{key:"toArray",value:function(e){return[e[0],e[1],e[2],e[3]]}},{key:"clone",value:function(e){return this.tag(Object(u.d)(e))}},{key:"copy",value:function(e,t){return Object(l.c)(t,e)}},{key:"toPoint",value:function(e,t){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.hasZ=!0,t.hasM=!0,t.spatialReference=this.spatialReference,t}},{key:"createPoint",value:function(e){return new d.a({x:e[0],y:e[1],z:e[2],m:e[3],spatialReference:this.spatialReference})}},{key:"createPointFromArray",value:function(e){return new d.a({x:e[0],y:e[1],z:e[2],m:e[3],spatialReference:this.spatialReference})}},{key:"createDehydratedPoint",value:function(e){return{x:e[0],y:e[1],z:e[2],m:e[3],hasZ:!0,hasM:!0,spatialReference:this.spatialReference,type:"point"}}},{key:"lerp",value:function(e,t,i,n){return Object(l.j)(n,e,t,i)}},{key:"addDelta",value:function(e,t,i,n){e[0]+=t,e[1]+=i,e[2]+=n}},{key:"scale",value:function(e,t,i,n){var r=Object(a.a)(p,e,t),o=Object(a.b)(p,i,Object(a.h)(i,r));Object(a.o)(e,e,o,n-1)}},{key:"rotate",value:function(e,t,i){Object(a.q)(e,e,t,i)}},{key:"pointToArray",value:function(e){return[e.x,e.y,e.z,e.m]}},{key:"getZ",value:function(e){return e[2]}},{key:"hasZ",value:function(){return!0}},{key:"getM",value:function(e){return e[3]}},{key:"hasM",value:function(){return!0}},{key:"unnormalize",value:function(e){g(e,this._unnormalizationInfo)}},{key:"fromXYZ",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.tag(Object(u.g)(e[0],e[1],e.length>2?e[2]:t,i))}},{key:"toXYZ",value:function(e){return Object(c.g)(e[0],e[1],e[2])}}]),e}();function m(e,t,i,n){return e&&t?new b(i,n):t?new f(1,i,n):e?new f(0,i,n):new v(i,n)}function g(e,t){if(t.supported){var i=1/0,n=-1/0,r=t.upperBoundX-t.lowerBoundX;e.forEach((function(e){for(var a=e.pos[0];a<t.lowerBoundX;)a+=r;for(;a>t.upperBoundX;)a-=r;i=Math.min(i,a),n=Math.max(n,a),e.pos[0]=a}));var a=n-i;r-a<a&&e.forEach((function(e){e.pos[0]<0&&(e.pos[0]+=r)}))}}function y(e,t){var i=Object(h.d)(e);return"global"===t&&i?{supported:!0,lowerBoundX:i.valid[0],upperBoundX:i.valid[1]}:{supported:!1,lowerBoundX:null,upperBoundX:null}}},739:function(e,t,i){"use strict";i.d(t,"a",(function(){return q})),i.d(t,"b",(function(){return R})),i.d(t,"c",(function(){return G})),i.d(t,"d",(function(){return L}));var n,r,a,o,s,c,l,u,d,h,p,v,f,b,m,g,y,O,j,_=i(598),x=i(50),w=i(91),k=i(463),T=i(626),S=i(855),P=i(784),C=i(856),V=i(674),M=i(705),D=i(657),E=i(675),z=i(729),H=i(707),A=i(597),I=i(617);function R(e){var t=new I.a,i=e.signedDistanceFieldEnabled;if(t.include(S.a),t.include(P.a,e),t.include(T.a,e),6===e.output)return t.include(C.a,e),t;t.include(H.a),t.fragment.include(z.a),t.fragment.include(E.a),t.include(M.a,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),t.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4"),i&&t.vertex.uniforms.add("outlineColor","vec4"),e.screenSizePerspectiveEnabled&&t.vertex.uniforms.add("screenSizePerspective","vec4"),(e.debugDrawBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add("uv0","vec2"),t.attributes.add("color","vec4"),t.attributes.add("size","vec2"),t.attributes.add("auxpos2","vec4"),t.vertex.code.add(Object(A.a)(n||(n=Object(_.a)(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize = inputSize * pixelRatio;\n      vec4 quadOffset = vec4(0.0);\n\n      ","\n\n      ","\n    "])),e.screenSizePerspectiveEnabled?Object(A.a)(r||(r=Object(_.a)(["\n      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "]))):Object(A.a)(a||(a=Object(_.a)(["\n      inputSize = size;\n      vec2 screenOffsetScaled = screenOffset;"]))),e.vvSize?"inputSize *= vvScale(auxpos2).xx;":"",e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":"",e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""));var x=Object(A.a)(o||(o=Object(_.a)(["vec2 uv01 = floor(uv0);\nvec2 uv = uv0 - uv01;\nquadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;"]))),w=e.pixelSnappingEnabled?i?Object(A.a)(s||(s=Object(_.a)(["posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"]))):Object(A.a)(c||(c=Object(_.a)(["posProj += quadOffset;\nif (inputSize.x == size.x) {\nposProj = alignToPixelOrigin(posProj, viewport.zw);\n}"]))):Object(A.a)(l||(l=Object(_.a)(["posProj += quadOffset;"])));t.vertex.code.add(Object(A.a)(u||(u=Object(_.a)(["\n      ","\n      ","\n      ","\n\n      bool alphaDiscard = vcolor.a < ",";\n      ",'\n      if (alphaDiscard) {\n        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      } else {\n        ',"\n        gl_Position = posProj;\n      }\n\n      vtc = uv * textureCoordinateScaleFactor;\n\n      ","\n      vsize = inputSize;\n      ","\n    }\n    "])),e.occlusionTestEnabled?"if (visible) {":"",x,e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;",A.a.float(D.c),i?"alphaDiscard = alphaDiscard && outlineColor.a < ".concat(A.a.float(D.c),";"):"",w,e.debugDrawBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":"",e.occlusionTestEnabled?Object(A.a)(d||(d=Object(_.a)(["} else { vtc = vec2(0.0);\n        ",""])),e.debugDrawBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"):"")),t.fragment.uniforms.add("tex","sampler2D"),i&&(t.fragment.uniforms.add("outlineColor","vec4"),t.fragment.uniforms.add("outlineSize","float"));var k=e.debugDrawBorder?Object(A.a)(h||(h=Object(_.a)(["(isBorder > 0.0 ? 0.0 : ",")"])),A.a.float(D.b)):A.a.float(D.b),R=Object(A.a)(p||(p=Object(_.a)(["\n    ","\n\n    ","\n\n    ","\n  "])),e.debugDrawBorder?Object(A.a)(v||(v=Object(_.a)(["\n      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"]))):"",i?Object(A.a)(f||(f=Object(_.a)(["\n      vec4 fillPixelColor = vcolor;\n\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize = 128.0;\n      const float texelSize = 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor = (vsize - txSize) * texelSize;\n      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist = d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *= fillAlphaFactor;\n\n      if (outlineSize > 0.25) {\n        vec4 outlinePixelColor = outlineColor;\n        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *= outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor < "," ||\n          fillPixelColor.a + outlinePixelColor.a < ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor = vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor < ",") {\n          discard;\n        }\n\n        gl_FragColor = premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "])),k,A.a.float(D.c),k):Object(A.a)(b||(b=Object(_.a)(["\n          vec4 texColor = texture2D(tex, vtc, -0.5);\n          if (texColor.a < ",") {\n            discard;\n          }\n          gl_FragColor = texColor * premultiplyAlpha(vcolor);\n          "])),k),e.debugDrawBorder?Object(A.a)(m||(m=Object(_.a)(["gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);"]))):"");return 7===e.output&&t.fragment.code.add(Object(A.a)(g||(g=Object(_.a)(["\n      void main() {\n        ","\n        gl_FragColor = vec4(gl_FragColor.a);\n      }\n      "])),R)),0===e.output&&t.fragment.code.add(Object(A.a)(y||(y=Object(_.a)(["\n    void main() {\n      ","\n      ","\n    }\n    "])),R,e.FrontFacePass?"gl_FragColor.rgb /= gl_FragColor.a;":"")),4===e.output&&(t.include(V.a),t.fragment.code.add(Object(A.a)(O||(O=Object(_.a)(["\n    void main() {\n      ","\n      ","\n    }\n    "])),R,e.binaryHighlightOcclusionEnabled?Object(A.a)(j||(j=Object(_.a)(["\n          if (voccluded == 1.0) {\n            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n          }"]))):"outputHighlight();"))),t}function G(e,t,i){e.setUniform4fv("materialColor",t.color),t.textureIsSignedDistanceField&&(t.outlineColor[3]<=0||t.outlineSize<=0?(e.setUniform4fv("outlineColor",k.b),e.setUniform1f("outlineSize",0)):(e.setUniform4fv("outlineColor",t.outlineColor),e.setUniform1f("outlineSize",t.outlineSize))),e.setUniform2f("screenOffset",2*t.screenOffset[0]*i,2*t.screenOffset[1]*i),e.setUniform2fv("anchorPos",L(t))}function L(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U;return e.textureIsSignedDistanceField?F(e.anchorPos,e.distanceFieldBoundingBox,t):Object(x.c)(t,e.anchorPos),t}function F(e,t,i){i[0]=e[0]*(t[2]-t[0])+t[0],i[1]=e[1]*(t[3]-t[1])+t[1]}var U=Object(w.a)(),q=Object.freeze({__proto__:null,build:R,bindHUDMaterialUniforms:G,calculateAnchorPosForRendering:L})},740:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return p}));var n,r,a,o,s,c,l=i(598),u=i(707),d=i(597);function h(e,t){var i=e.vertex.code;t.verticalOffsetEnabled?(e.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&(e.include(u.a),e.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),i.add(Object(d.a)(n||(n=Object(l.a)(["\n    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);\n      ","\n      ","\n      // Screen sized offset in world space, used for example for line callouts\n      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n      return worldNormal * worldOffset;\n    }\n\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n    }\n    "])),1===t.viewingMode?Object(d.a)(r||(r=Object(l.a)(["vec3 worldNormal = normalize(worldPos + localOrigin);"]))):Object(d.a)(a||(a=Object(l.a)(["vec3 worldNormal = vec3(0.0, 0.0, 1.0);"]))),t.screenSizePerspectiveEnabled?Object(d.a)(o||(o=Object(l.a)(["\n          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));\n          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"]))):Object(d.a)(s||(s=Object(l.a)(["\n          float verticalOffsetScreenHeight = verticalOffset.x;"])))))):i.add(Object(d.a)(c||(c=Object(l.a)(["vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }"]))))}function p(e,t,i){if(t.verticalOffset){var n=v(t.verticalOffset,i.camera.fovY,i.camera.fullViewport[3]),r=i.camera.pixelRatio||1;e.setUniform4f("verticalOffset",n.screenLength*r,n.perDistance,n.minWorldLength,n.maxWorldLength)}}function v(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:f;return n.screenLength=e.screenLength,n.perDistance=Math.tan(.5*t)/(.5*i),n.minWorldLength=e.minWorldLength,n.maxWorldLength=e.maxWorldLength,n}var f={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}},749:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var n=i(8),r=i.n(n),a=i(11),o=i(14),s=i(60);function c(e,t){return l.apply(this,arguments)}function l(){return(l=Object(o.a)(r.a.mark((function e(t,i){var n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(s.default)(t,Object(a.a)({responseType:"image"},i));case 2:return n=e.sent,o=n.data,e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},763:function(e,t,i){"use strict";i.r(t);var n=i(4),r=i(5),a=i(18),o=i(6),s=i(7),c=i(0),l=i(305),u=i(10),d=i(237),h=i(1),p=(i(13),i(72)),v=(i(16),i(12),i(9)),f=i(33),b=i(166),m=i(239),g=i(297),y=i(296),O=i(238),j=i(485),_=i(486),x=i(448),w=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e))._visibilityHandles={},r.fullExtent=void 0,r.operationalLayerType="GroupLayer",r.spatialReference=void 0,r.type="group",r._visibilityWatcher=r._visibilityWatcher.bind(Object(a.a)(r)),r}return Object(r.a)(i,[{key:"initialize",value:function(){this._enforceVisibility(this.visibilityMode,this.visible),this.watch("visible",this._visibleWatcher.bind(this),!0)}},{key:"_writeLayers",value:function(e,t,i,n){var r=[];if(!e)return r;e.forEach((function(e){var t=Object(x.a)(e,n.webmap?n.webmap.getLayerJSONFromResourceInfo(e):null,n);Object(u.k)(t)&&t.layerType&&r.push(t)})),t.layers=r}},{key:"portalItem",set:function(e){this._set("portalItem",e)}},{key:"visibilityMode",set:function(e){var t=this._get("visibilityMode")!==e;this._set("visibilityMode",e),t&&this._enforceVisibility(e,this.visible)}},{key:"load",value:function(e){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Scene Service"]},e)),Promise.resolve(this)}},{key:"loadAll",value:function(){var e=this;return Object(l.a)(this,(function(t){t(e.layers)}))}},{key:"layerAdded",value:function(e){e.visible&&"exclusive"===this.visibilityMode?this._turnOffOtherLayers(e):"inherited"===this.visibilityMode&&(e.visible=this.visible),this._visibilityHandles[e.uid]=e.watch("visible",this._visibilityWatcher,!0)}},{key:"layerRemoved",value:function(e){var t=this._visibilityHandles[e.uid];t&&(t.remove(),delete this._visibilityHandles[e.uid]),this._enforceVisibility(this.visibilityMode,this.visible)}},{key:"_turnOffOtherLayers",value:function(e){this.layers.forEach((function(t){t!==e&&(t.visible=!1)}))}},{key:"_enforceVisibility",value:function(e,t){if(Object(p.a)(this).initialized){var i=this.layers,n=i.find((function(e){return e.visible}));switch(e){case"exclusive":i.length&&!n&&((n=i.getItemAt(0)).visible=!0),this._turnOffOtherLayers(n);break;case"inherited":i.forEach((function(e){e.visible=t}))}}}},{key:"_visibleWatcher",value:function(e){"inherited"===this.visibilityMode&&this.layers.forEach((function(t){t.visible=e}))}},{key:"_visibilityWatcher",value:function(e,t,i,n){var r=n;switch(this.visibilityMode){case"exclusive":e?this._turnOffOtherLayers(r):this._isAnyLayerVisible()||(r.visible=!0);break;case"inherited":r.visible=this.visible}}},{key:"_isAnyLayerVisible",value:function(){return this.layers.some((function(e){return e.visible}))}}]),i}(Object(m.a)(Object(O.a)(Object(g.a)(Object(y.a)(Object(_.a)(Object(j.a)(Object(d.a)(b.a))))))));Object(c.a)([Object(h.b)()],w.prototype,"fullExtent",void 0),Object(c.a)([Object(h.b)({json:{read:!1,write:{ignoreOrigin:!0}}})],w.prototype,"layers",void 0),Object(c.a)([Object(f.a)("layers")],w.prototype,"_writeLayers",null),Object(c.a)([Object(h.b)({type:["GroupLayer"]})],w.prototype,"operationalLayerType",void 0),Object(c.a)([Object(h.b)({json:{origins:{"web-document":{read:!1,write:!1}}}})],w.prototype,"portalItem",null),Object(c.a)([Object(h.b)()],w.prototype,"spatialReference",void 0),Object(c.a)([Object(h.b)({json:{read:!1},readOnly:!0,value:"group"})],w.prototype,"type",void 0),Object(c.a)([Object(h.b)({type:["independent","inherited","exclusive"],value:"independent",json:{write:!0,origins:{"web-map":{read:!1,write:!1}}}})],w.prototype,"visibilityMode",null);var k=w=Object(c.a)([Object(v.a)("esri.layers.GroupLayer")],w);t.default=k},784:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return v}));var n,r,a,o,s,c,l,u=i(598),d=i(707),h=i(597);function p(e,t){var i=e;i.include(d.a),i.attributes.add("position","vec3"),i.attributes.add("normal","vec3"),i.attributes.add("auxpos1","vec4"),i.vertex.uniforms.add("proj","mat4"),i.vertex.uniforms.add("view","mat4"),i.vertex.uniforms.add("viewNormal","mat4"),i.vertex.uniforms.add("viewport","vec4"),i.vertex.uniforms.add("camPos","vec3"),i.vertex.uniforms.add("polygonOffset","float"),i.vertex.uniforms.add("cameraGroundRelative","float"),i.vertex.uniforms.add("pixelRatio","float"),i.vertex.uniforms.add("perDistancePixelRatio","float"),i.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float"),t.verticalOffsetEnabled&&i.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&i.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4"),i.vertex.uniforms.add("hudVisibilityTexture","sampler2D"),i.vertex.constants.add("smallOffsetAngle","float",.984807753012208),i.vertex.code.add(Object(h.a)(n||(n=Object(u.a)(["struct ProjectHUDAux {\nvec3 posModel;\nvec3 posView;\nvec3 vnormal;\nfloat distanceToCamera;\nfloat absCosAngle;\n};"])))),i.vertex.code.add(Object(h.a)(r||(r=Object(u.a)(["float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\nfloat pointGroundSign = sign(pointGroundDistance);\nif (pointGroundSign == 0.0) {\npointGroundSign = cameraGroundRelative;\n}\nfloat groundRelative = cameraGroundRelative * pointGroundSign;\nif (polygonOffset > .0) {\nfloat cosAlpha = clamp(absCosAngle, 0.01, 1.0);\nfloat tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\nfloat factor = (1.0 - tanAlpha / viewport[2]);\nif (groundRelative > 0.0) {\nposView *= factor;\n}\nelse {\nposView /= factor;\n}\n}\nreturn groundRelative;\n}"])))),t.isDraped||i.vertex.code.add(Object(h.a)(a||(a=Object(u.a)(["void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\nfloat distanceToCamera = length(posView);\nfloat pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;\nvec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\nvec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\nposModel += modelOffset;\nposView += viewOffset;\n}"])))),i.vertex.code.add(Object(h.a)(o||(o=Object(u.a)(["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset = auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance = auxpos1.w;\n\n      aux.posModel = position;\n      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal = normal;\n      ","\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera = length(aux.posView);\n\n      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);\n      float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle = abs(cosAngle);\n\n      ","\n\n      ","\n\n      ","\n\n      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -= groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "])),t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);",t.screenSizePerspectiveEnabled&&(t.verticalOffsetEnabled||1===t.screenCenterOffsetUnitsEnabled)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"",t.verticalOffsetEnabled?t.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":"",t.verticalOffsetEnabled?Object(h.a)(s||(s=Object(u.a)(["\n            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset = aux.vnormal * worldOffset;\n            aux.posModel += modelOffset;\n            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView += viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance += worldOffset;"]))):"",1!==t.screenCenterOffsetUnitsEnabled?Object(h.a)(c||(c=Object(u.a)(["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z != 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z != 0.0) {\n              aux.posView -= normalize(aux.posView) * centerOffset.z;\n            }\n          "]))):"",1===t.screenCenterOffsetUnitsEnabled?t.screenSizePerspectiveEnabled?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":"",1===t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":"")),i.vertex.code.add(Object(h.a)(l||(l=Object(u.a)(["bool testVisibilityHUD(vec4 posProj) {\nvec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\nvec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\nif (uRenderTransparentlyOccludedHUD > 0.5) {\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;\n}\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n}"]))))}function v(e,t){e.setUniform1f("uRenderTransparentlyOccludedHUD",0===t.renderTransparentlyOccludedHUD?1:1===t.renderTransparentlyOccludedHUD?0:.75)}},792:function(e,t,i){"use strict";i.d(t,"a",(function(){return Q}));var n,r=i(8),a=i.n(r),o=i(14),s=i(4),c=i(5),l=i(6),u=i(7),d=i(300),h=i(22),p=i(112),v=i(66),f=i(10),b=i(25),m=i(137),g=i(32),y=i(749),O=i(484),j=i(11),_=i(27),x=i(65);function w(){if(Object(f.j)(n)){var e=function(e){return Object(x.a)("esri/libs/basisu/".concat(e))};n=Promise.all([i.e(82),i.e(149)]).then(i.bind(null,1175)).then((function(e){return e.b})).then((function(t){return(0,t.default)({locateFile:e}).then((function(e){return e.initializeBasis(),delete e.then,e}))}))}return n}var k=i(143),T=i(302),S=null,P=null;function C(){return V.apply(this,arguments)}function V(){return(V=Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=Object(f.j)(P),!e.t0){e.next=6;break}return P=w(),e.next=5,P;case 5:S=e.sent;case 6:return e.abrupt("return",P);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e,t,i,n,r){var a=Object(T.b)(t?37496:37492),o=r&&e>1?(Math.pow(4,e)-1)/(3*Math.pow(4,e-1)):1;return Math.ceil(i*n*a*o)}function D(e){return e.getNumImages()>=1&&!e.isUASTC()}function E(e){return e.getFaces()>=1&&e.isETC1S()}function z(){return(z=Object(o.a)(a.a.mark((function e(t,i,n){var r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=Object(f.j)(S),!e.t0){e.next=5;break}return e.next=4,C();case 4:S=e.sent;case 5:if(D(r=new S.BasisFile(new Uint8Array(n)))){e.next=8;break}return e.abrupt("return",null);case 8:return r.startTranscoding(),o=A(t,i,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(function(e,t){return r.getImageTranscodedSizeInBytes(0,e,t)}),(function(e,t,i){return r.transcodeImage(i,0,e,t,0,0)})),e.abrupt("return",(r.close(),r.delete(),o));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(){return(H=Object(o.a)(a.a.mark((function e(t,i,n){var r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=Object(f.j)(S),!e.t0){e.next=5;break}return e.next=4,C();case 4:S=e.sent;case 5:if(E(r=new S.KTX2File(new Uint8Array(n)))){e.next=8;break}return e.abrupt("return",null);case 8:return r.startTranscoding(),o=A(t,i,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(function(e,t){return r.getImageTranscodedSizeInBytes(e,0,0,t)}),(function(e,t,i){return r.transcodeImage(i,e,0,0,t,0,-1,-1)})),e.abrupt("return",(r.close(),r.delete(),o));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e,t,i,n,r,a,o,s){for(var c=e.capabilities,l=c.compressedTextureETC,u=c.compressedTextureS3TC,d=l?n?[1,37496]:[0,37492]:u?n?[3,33779]:[2,33776]:[13,6408],h=Object(_.a)(d,2),p=h[0],v=h[1],f=t.hasMipmap?i:Math.min(1,i),b=[],m=0;m<f;m++)b.push(new Uint8Array(o(m,p))),s(m,p,b[m]);var g=b.length>1,y=g?9987:9729,O=Object(j.a)(Object(j.a)({},t),{},{samplingMode:y,hasMipmap:g,internalFormat:v,width:r,height:a});return new k.a(e,O,{type:"compressed",levels:b})}var I=i(765),R=i(12).a.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),G=542327876,L=131072;function F(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var U=F("DXT1"),q=F("DXT3"),N=F("DXT5");function Z(e,t,i){var n=function(e,t){var i=new Int32Array(e,0,31);if(i[0]!==G)return R.error("Invalid magic number in DDS header"),null;if(!(4&i[20]))return R.error("Unsupported format, must contain a FourCC code"),null;var n,r,a=i[21];switch(a){case U:n=8,r=33776;break;case q:n=16,r=33778;break;case N:n=16,r=33779;break;default:return R.error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(a)),null}var o=1,s=i[4],c=i[3];0==(3&s)&&0==(3&c)||(R.warn("Rounding up compressed texture size to nearest multiple of 4."),s=s+3&-4,c=c+3&-4);var l,u,d=s,h=c;i[2]&L&&!1!==t&&(o=Math.max(1,i[7])),1===o||Object(v.l)(s)&&Object(v.l)(c)||(R.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);for(var p=i[1]+4,f=[],b=0;b<o;++b)u=(s+3>>2)*(c+3>>2)*n,l=new Uint8Array(e,p,u),f.push(l),p+=u,s=Math.max(1,s>>1),c=Math.max(1,c>>1);return{textureData:{type:"compressed",levels:f},internalFormat:r,width:d,height:h}}(i,t.hasMipmap),r=n.textureData,a=n.internalFormat,o=n.width,s=n.height;return t.samplingMode=r.levels.length>1?9987:9729,t.hasMipmap=r.levels.length>1,t.internalFormat=a,t.width=o,t.height=s,new k.a(e,t,r)}var W=i(794),B=i(365),X=i(440),Y=i(122),Q=function(e){Object(l.a)(i,e);var t=Object(u.a)(i);function i(e,n){var r;return Object(s.a)(this,i),(r=t.call(this)).data=e,r.type=4,r.glTexture=null,r.powerOfTwoStretchInfo=null,r.loadingPromise=null,r.loadingController=null,r.events=new p.a,r.params=n||{},r.params.mipmap=!1!==r.params.mipmap,r.params.noUnpackFlip=r.params.noUnpackFlip||!1,r.params.preMultiplyAlpha=r.params.preMultiplyAlpha||!1,r.params.wrap=r.params.wrap||{s:10497,t:10497},r.params.powerOfTwoResizeMode=r.params.powerOfTwoResizeMode||1,r.estimatedTexMemRequired=i.estimateTexMemRequired(r.data,r.params),r.startPreload(),r}return Object(c.a)(i,[{key:"startPreload",value:function(){var e=this.data;Object(f.j)(e)||(e instanceof HTMLVideoElement?this.startPreloadVideoElement(e):e instanceof HTMLImageElement&&this.startPreloadImageElement(e))}},{key:"startPreloadVideoElement",value:function(e){Object(g.t)(e.src)||"auto"===e.preload&&e.crossOrigin||(e.preload="auto",e.crossOrigin="anonymous",e.src=e.src)}},{key:"startPreloadImageElement",value:function(e){Object(g.u)(e.src)||Object(g.t)(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}},{key:"dispose",value:function(){this.data=void 0}},{key:"width",get:function(){return this.params.width}},{key:"height",get:function(){return this.params.height}},{key:"createDescriptor",value:function(e){var t;return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?9987:9729,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:null!=(t=this.params.maxAnisotropy)?t:this.params.mipmap?e.parameters.maxMaxAnisotropy:1}}},{key:"load",value:function(e,t){if(Object(f.k)(this.glTexture))return this.glTexture;if(Object(f.k)(this.loadingPromise))return this.loadingPromise;var n=this.data;return Object(f.j)(n)?(this.glTexture=new k.a(e,this.createDescriptor(e),null),this.glTexture):"string"==typeof n?this.loadFromURL(e,t,n):n instanceof Image?this.loadFromImageElement(e,t,n):n instanceof HTMLVideoElement?this.loadFromVideoElement(e,t,n):n instanceof ImageData||n instanceof HTMLCanvasElement?this.loadFromImage(e,n,t):(Object(m.c)(n)||Object(m.k)(n))&&this.params.encoding===i.DDS_ENCODING?this.loadFromDDSData(e,n):(Object(m.c)(n)||Object(m.k)(n))&&this.params.encoding===i.KTX2_ENCODING?this.loadFromKTX2(e,n):(Object(m.c)(n)||Object(m.k)(n))&&this.params.encoding===i.BASIS_ENCODING?this.loadFromBasis(e,n):Object(m.k)(n)?this.loadFromPixelData(e,n):Object(m.c)(n)?this.loadFromPixelData(e,new Uint8Array(n)):null}},{key:"requiresFrameUpdates",get:function(){return this.data instanceof HTMLVideoElement}},{key:"frameUpdate",value:function(e,t,i){if(!(this.data instanceof HTMLVideoElement)||Object(f.j)(this.glTexture))return i;if(this.data.readyState<2||i===this.data.currentTime)return i;if(Object(f.k)(this.powerOfTwoStretchInfo)){var n=this.powerOfTwoStretchInfo,r=n.framebuffer,a=n.vao,o=n.sourceTexture;o.setData(this.data),this.drawStretchedTexture(e,t,r,a,o,this.glTexture)}else{var s=this.data,c=s.width,l=s.height,u=this.glTexture.descriptor,d=u.width,h=u.height;c!==d||l!==h?this.glTexture.updateData(0,0,0,Math.min(c,d),Math.min(l,h),this.data):this.glTexture.setData(this.data)}return this.glTexture.descriptor.hasMipmap&&this.glTexture.generateMipmap(),this.data.currentTime}},{key:"loadFromDDSData",value:function(e,t){return this.glTexture=Z(e,this.createDescriptor(e),t),this.glTexture}},{key:"loadFromKTX2",value:function(e,t){var i=this;return this.loadAsync((function(){return function(e,t,i){return H.apply(this,arguments)}(e,i.createDescriptor(e),t).then((function(e){return i.glTexture=e,e}))}))}},{key:"loadFromBasis",value:function(e,t){var i=this;return this.loadAsync((function(){return function(e,t,i){return z.apply(this,arguments)}(e,i.createDescriptor(e),t).then((function(e){return i.glTexture=e,e}))}))}},{key:"loadFromPixelData",value:function(e,t){Object(B.a)(this.params.width>0&&this.params.height>0);var i=this.createDescriptor(e);return i.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408,i.width=this.params.width,i.height=this.params.height,this.glTexture=new k.a(e,i,t),this.glTexture}},{key:"loadAsync",value:function(e){var t=this,i=Object(b.d)();this.loadingController=i;var n=e(i.signal);this.loadingPromise=n;var r=function(){t.loadingController===i&&(t.loadingController=null),t.loadingPromise===n&&(t.loadingPromise=null)};return n.then(r,r),n}},{key:"loadFromURL",value:function(e,t,i){var n=this;return this.loadAsync(function(){var r=Object(o.a)(a.a.mark((function r(o){var s;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(y.a)(i,{signal:o});case 2:return s=r.sent,r.abrupt("return",n.loadFromImage(e,s,t));case 4:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}},{key:"loadFromImageElement",value:function(e,t,i){var n=this;return i.complete?this.loadFromImage(e,i,t):this.loadAsync(function(){var r=Object(o.a)(a.a.mark((function r(o){var s;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(O.a)(i,i.src,!1,o);case 2:return s=r.sent,r.abrupt("return",n.loadFromImage(e,s,t));case 4:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}},{key:"loadFromVideoElement",value:function(e,t,i){return i.readyState>=2?this.loadFromImage(e,i,t):this.loadFromVideoElementAsync(e,t,i)}},{key:"loadFromVideoElementAsync",value:function(e,t,i){var n=this;return this.loadAsync((function(r){return new Promise((function(a,o){var s=function(){i.removeEventListener("loadeddata",c),i.removeEventListener("error",l),Object(f.k)(u)&&u.remove()},c=function(){i.readyState>=2&&(s(),a(n.loadFromImage(e,i,t)))},l=function(e){s(),o(e||new h.a("Failed to load video"))};i.addEventListener("loadeddata",c),i.addEventListener("error",l);var u=Object(b.q)(r,(function(){return l(Object(b.e)())}))}))}))}},{key:"loadFromImage",value:function(e,t,n){var r=i.getDataDimensions(t);this.params.width=r.width,this.params.height=r.height;var a=this.createDescriptor(e);return a.pixelFormat=3===this.params.components?6407:6408,!this.requiresPowerOfTwo(e,a)||Object(v.l)(r.width)&&Object(v.l)(r.height)?(a.width=r.width,a.height=r.height,this.glTexture=new k.a(e,a,t),this.glTexture):(this.glTexture=this.makePowerOfTwoTexture(e,t,r,a,n),this.glTexture)}},{key:"requiresPowerOfTwo",value:function(e,t){var i=33071,n="number"==typeof t.wrapMode?t.wrapMode===i:t.wrapMode.s===i&&t.wrapMode.t===i;return!Object(Y.a)(e.gl)&&(t.hasMipmap||!n)}},{key:"makePowerOfTwoTexture",value:function(e,t,i,n,r){var a,o=i.width,s=i.height,c=Object(v.p)(o),l=Object(v.p)(s);switch(n.width=c,n.height=l,this.params.powerOfTwoResizeMode){case 2:n.textureCoordinateScaleFactor=[o/c,s/l],(a=new k.a(e,n)).updateData(0,0,0,o,s,t);break;case 1:case null:case void 0:a=this.stretchToPowerOfTwo(e,t,n,r);break;default:Object(d.a)(this.params.powerOfTwoResizeMode)}return n.hasMipmap&&a.generateMipmap(),a}},{key:"stretchToPowerOfTwo",value:function(e,t,i,n){var r=new k.a(e,i),a=new X.a(e,{colorTarget:0,depthStencilTarget:0},r),o=new k.a(e,{target:3553,pixelFormat:i.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!i.flipped,maxAnisotropy:8,preMultiplyAlpha:i.preMultiplyAlpha},t),s=Object(W.b)(e);return this.drawStretchedTexture(e,n,a,s,o,r),this.requiresFrameUpdates?this.powerOfTwoStretchInfo={vao:s,sourceTexture:o,framebuffer:a}:(s.dispose(!0),o.dispose(),a.detachColorTexture(),e.bindFramebuffer(null),a.dispose()),r}},{key:"drawStretchedTexture",value:function(e,t,i,n,r,a){e.bindFramebuffer(i);var o=e.getViewport();e.setViewport(0,0,a.descriptor.width,a.descriptor.height);var s=t.program;e.useProgram(s),s.setUniform4f("color",1,1,1,1),s.bindTexture(r,"tex"),e.bindVAO(n),e.setPipelineState(t.pipeline),e.drawArrays(5,0,Object(T.f)(n,"geometry")),e.bindFramebuffer(null),e.setViewport(o.x,o.y,o.width,o.height)}},{key:"unload",value:function(){if(Object(f.k)(this.powerOfTwoStretchInfo)){var e=this.powerOfTwoStretchInfo,t=e.framebuffer,i=e.vao,n=e.sourceTexture;i.dispose(!0),n.dispose(),t.dispose(),this.glTexture=null,this.powerOfTwoStretchInfo=null}if(Object(f.k)(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null),Object(f.k)(this.loadingController)){var r=this.loadingController;this.loadingController=null,this.loadingPromise=null,r.abort()}this.events.emit("unloaded")}}],[{key:"getDataDimensions",value:function(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}},{key:"estimateTexMemRequired",value:function(e,t){if(Object(f.j)(e))return 0;if(Object(m.c)(e)||Object(m.k)(e))return t.encoding===i.KTX2_ENCODING?function(e,t){if(Object(f.j)(S))return e.byteLength;var i=new S.KTX2File(new Uint8Array(e)),n=E(i)?M(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),t):0;return i.close(),i.delete(),n}(e,t.mipmap):t.encoding===i.BASIS_ENCODING?function(e,t){if(Object(f.j)(S))return e.byteLength;var i=new S.BasisFile(new Uint8Array(e)),n=D(i)?M(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),t):0;return i.close(),i.delete(),n}(e,t.mipmap):e.byteLength;var n=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?i.getDataDimensions(e):t,r=n.width,a=n.height;return(t.mipmap?4/3:1)*r*a*(t.components||4)||0}}]),i}(I.a);Q.DDS_ENCODING="image/vnd-ms.dds",Q.KTX2_ENCODING="image/ktx2",Q.BASIS_ENCODING="image/x.basis"},813:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i(4),r=i(5),a=i(10),o=i(607),s=function(){function e(t,i,r){Object(n.a)(this,e),this.editGeometry=t,this.component=i,this.pos=r,this.addedVertex=null,this.originalEdge=null,this.left=null,this.right=null}return Object(r.a)(e,[{key:"apply",value:function(){var e="redo";Object(a.j)(this.addedVertex)&&(e="apply",this.addedVertex=new o.d(this.component));var t=this.component.getLastVertex();if(Object(a.j)(t))this.component.vertices.push(this.addedVertex),this.addedVertex.pos=this.pos,this.addedVertex.index=0;else{var i=null;t.right&&(this.originalEdge=t.right,i=this.originalEdge.right,this.component.edges.splice(this.component.edges.indexOf(this.originalEdge),1)),this.component.vertices.push(this.addedVertex),this.addedVertex.pos=this.pos,Object(a.j)(this.left)&&(this.left=new o.b(this.component,t,this.addedVertex)),this.component.edges.push(this.left),t.right=this.left,Object(a.k)(this.originalEdge)&&Object(a.k)(i)&&(Object(a.j)(this.right)&&(this.right=new o.b(this.component,this.addedVertex,i)),this.component.edges.push(this.right),i.left=this.right),this.component.updateVertexIndex(this.addedVertex,t.index+1)}var n={addedVertices:[this.addedVertex],operation:e};this.editGeometry.emit("change",n)}},{key:"undo",value:function(){if(Object(a.j)(this.addedVertex))return null;this.component.vertices.splice(this.component.vertices.indexOf(this.addedVertex),1),Object(a.k)(this.left)&&(this.component.edges.splice(this.component.edges.indexOf(this.left),1),this.left.left.right=null),Object(a.k)(this.right)&&(this.component.edges.splice(this.component.edges.indexOf(this.right),1),this.right.right.left=null),Object(a.k)(this.originalEdge)&&(this.component.edges.push(this.originalEdge),this.originalEdge.left.right=this.originalEdge,this.originalEdge.right.left=this.originalEdge),Object(a.k)(this.left)?this.component.updateVertexIndex(this.left.left,this.left.left.index):this.component.updateVertexIndex(this.addedVertex,0);var e={removedVertices:[this.addedVertex],operation:"undo"};this.editGeometry.emit("change",e)}},{key:"accumulate",value:function(){return!1}}]),e}()},817:function(e,t,i){"use strict";var n=i(4),r=i(5),a=i(6),o=i(7),s=i(10),c=function(e){Object(a.a)(i,e);var t=Object(o.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e))._textureIDs=new Set,r._textureRepository=e.textureRep,r._textureId=e.textureId,r._initTransparent=!!e.initTextureTransparent,r._texture=r._acquire(r._textureId),r._textureNormal=r._acquire(e.normalTextureId),r._textureEmissive=r._acquire(e.emissiveTextureId),r._textureOcclusion=r._acquire(e.occlusionTextureId),r._textureMetallicRoughness=r._acquire(e.metallicRoughnessTextureId),r}return Object(r.a)(i,[{key:"dispose",value:function(){var e=this;this._textureIDs.forEach((function(t){return e._textureRepository.release(t)})),this._textureIDs.clear()}},{key:"updateTexture",value:function(e){e!==this._textureId&&(this._release(this._textureId),this._textureId=e,this._texture=this._acquire(this._textureId))}},{key:"bindTextures",value:function(e){Object(s.k)(this._texture)&&e.bindTexture(this._texture.glTexture,"tex"),Object(s.k)(this._textureNormal)&&e.bindTexture(this._textureNormal.glTexture,"normalTexture"),Object(s.k)(this._textureEmissive)&&e.bindTexture(this._textureEmissive.glTexture,"texEmission"),Object(s.k)(this._textureOcclusion)&&e.bindTexture(this._textureOcclusion.glTexture,"texOcclusion"),Object(s.k)(this._textureMetallicRoughness)&&e.bindTexture(this._textureMetallicRoughness.glTexture,"texMetallicRoughness")}},{key:"bindTextureScale",value:function(e){var t=Object(s.k)(this._texture)&&this._texture.glTexture;t&&t.descriptor.textureCoordinateScaleFactor?e.setUniform2fv("textureCoordinateScaleFactor",t.descriptor.textureCoordinateScaleFactor):e.setUniform2f("textureCoordinateScaleFactor",1,1)}},{key:"_acquire",value:function(e){if(!Object(s.j)(e))return this._textureIDs.add(e),this._textureRepository.acquire(e,this._initTransparent)}},{key:"_release",value:function(e){Object(s.j)(e)||(this._textureIDs.delete(e),this._textureRepository.release(e))}}]),i}(i(715).a);t.a=c},818:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return s}));var n,r=i(598),a=i(643),o=i(597);function s(e){e.include(a.a),e.uniforms.add("geometryDepthTexture","sampler2D"),e.uniforms.add("cameraNearFar","vec2"),e.code.add(Object(o.a)(n||(n=Object(r.a)(["bool geometryDepthTest(vec2 pos, float elementDepth) {\nfloat geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, cameraNearFar);\nreturn (elementDepth < (geometryDepth - 1.0));\n}"]))))}function c(e,t){t.multipassGeometryEnabled&&t.geometryLinearDepthTexture&&e.bindTexture(t.geometryLinearDepthTexture,"geometryDepthTexture")}},819:function(e,t,i){"use strict";i.d(t,"a",(function(){return _}));var n=i(35),r=i(4),a=i(5),o=i(6),s=i(7),c=i(63),l=i(10),u=i(236),d=i(603),h=i(54),p=i(85),v=i(443),f=i(678),b=i(618),m=i(714),g=i(720),y=i(697),O=i(832),j=i(719),_=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e))._handles=new c.a,n._quadMaterial=null,n._outlineMaterial=null,n._maxSize=0,n._position=Object(p.e)(),n._up=Object(p.e)(),n._right=Object(p.e)(),n._renderOccluded=4,n._color=Object(f.c)(1,0,0,1),n._outlineColor=Object(f.c)(0,0,0,1),n._outlineSize=0,n._size=32,n._outlineRenderOccluded=16,n.applyProps(e),n}return Object(a.a)(i,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}},{key:"color",get:function(){return this._color},set:function(e){Object(v.c)(this._color,e),this._updateQuadMaterial()}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){Object(v.c)(this._outlineColor,e),this._updateOutlineMaterial()}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){var t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this._updateTransform())}},{key:"outlineRenderOccluded",get:function(){return this._outlineRenderOccluded},set:function(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}},{key:"geometry",set:function(e){var t=e.previous,i=e.center,n=e.next;this._maxSize=Math.min(Object(h.j)(i,t),Object(h.j)(i,n))/3,Object(h.o)(this._up,Object(h.g)(this._up,t,i)),Object(h.o)(this._right,Object(h.g)(this._right,n,i)),Object(h.h)(this._position,i),this.recreateGeometry()}},{key:"createExternalResources",value:function(){var e=this;this._quadMaterial=new O.a(this.quadMaterialParameters),this._outlineMaterial=new j.a(this.outlineMaterialParameters),this._handles.add(this.view.state.watch("camera",(function(){return e._updateTransform()})))}},{key:"destroyExternalResources",value:function(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}},{key:"forEachExternalMaterial",value:function(e){e(this._quadMaterial),e(this._outlineMaterial)}},{key:"createGeometries",value:function(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}},{key:"_createQuadGeometry",value:function(e){var t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}},{key:"_createOutlineGeometry",value:function(e){if(0!==this._outlineSize){var t=Object(h.c)(b.c.get(),this._up,this._right),i=y.a.createPolylineGeometry([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}}},{key:"_updateTransform",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.object,t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),n=Math.min(this._maxSize,i);Object(u.i)(x),Object(u.s)(x,x,this._position),Object(u.r)(x,x,[n,n,n]),Object(l.k)(e)&&(e.transformation=x)}},{key:"_quadGeometryData",value:function(e,t){var i=Object(h.c)(b.c.get(),e,t);return new g.a([["position",{size:3,data:[0,0,0].concat(Object(n.a)(t),Object(n.a)(e),Object(n.a)(i)),exclusive:!0}]],[["position",new Uint16Array([0,1,2,1,2,3])]])}},{key:"quadMaterialParameters",get:function(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}},{key:"_updateQuadMaterial",value:function(){this._quadMaterial&&this._quadMaterial.setParameterValues(this.quadMaterialParameters)}},{key:"outlineMaterialParameters",get:function(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}},{key:"_updateOutlineMaterial",value:function(){this._outlineMaterial&&this._outlineMaterial.setParameterValues(this.outlineMaterialParameters)}}]),i}(m.a),x=Object(d.d)()},855:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n,r,a=i(598),o=i(597);function s(e){var t=Object(o.a)(n||(n=Object(a.a)(["vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\nvec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}"]))),i=Object(o.a)(r||(r=Object(a.a)(["vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\nvec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}"])));e.vertex.code.add(t),e.vertex.code.add(i),e.fragment.code.add(t),e.fragment.code.add(i)}},856:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var n,r,a,o,s=i(598),c=i(643),l=i(818),u=i(729),d=i(597);function h(e,t){t.multipassGeometryEnabled&&e.vertex.include(l.b),t.multipassTerrainEnabled&&e.varyings.add("depth","float"),e.vertex.code.add(Object(d.a)(n||(n=Object(s.a)(["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) > 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      ","\n\n      ","\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n      }\n\n    } else {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position = posProjCenter;\n    gl_PointSize = 1.0;\n  }\n  "])),t.multipassGeometryEnabled?Object(d.a)(r||(r=Object(s.a)(["\n        // Don't draw vertices behind geometry\n        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){\n          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n        }"]))):"",t.multipassTerrainEnabled?"depth = projectAux.posView.z;":"")),t.multipassTerrainEnabled&&e.fragment.include(c.a),e.fragment.uniforms.add("terrainDepthTexture","sampler2D"),e.fragment.uniforms.add("cameraNearFar","vec2"),e.fragment.uniforms.add("inverseViewport","vec2"),e.fragment.include(u.a),e.fragment.code.add(Object(d.a)(a||(a=Object(s.a)(["\n  void main() {\n    gl_FragColor = vec4(1, 1, 1, 1);\n    ","\n  }\n  "])),t.multipassTerrainEnabled?Object(d.a)(o||(o=Object(s.a)(["\n\n          vec2 uv = gl_FragCoord.xy * inverseViewport;\n\n          //Read the rgba data from the texture linear depth\n          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);\n\n          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), cameraNearFar);\n\n          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)\n          //Mark the HUD vertex as occluded by transparent terrain\n          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){\n            gl_FragColor.g = 0.5;\n          }"]))):""))}},921:function(e,t,i){"use strict";i.d(t,"a",(function(){return _}));var n=i(4),r=i(5),a=i(6),o=i(7),s=i(0),c=i(36),l=i(112),u=i(10),d=i(38),h=i(1),p=(i(13),i(16),i(12),i(9)),v=i(50),f=i(54),b=i(85),m=i(267),g=i(756),y=i(465),O=i(378),j=i(713),_=function(e){Object(a.a)(i,e);var t=Object(o.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e)).layer=null,r.interactive=!0,r.selectable=!1,r.grabbable=!0,r.dragging=!1,r.cursor=null,r.events=new l.a.EventEmitter,r._circleCollisionCache=null,r._graphicSymbolChangedHandle=null,r._originalSymbol=null,r}return Object(r.a)(i,[{key:"graphic",set:function(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()}},{key:"elevationInfo",get:function(){var e="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,t=Object(g.d)(this.graphic),i=e?e.offset:0;return new O.a({mode:t,offset:i})}},{key:"focusedSymbol",set:function(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}},{key:"grabbableForEvent",value:function(){return!0}},{key:"grabbing",set:function(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}},{key:"hovering",set:function(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}},{key:"selected",set:function(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}},{key:"_focused",get:function(){return this._get("hovering")||this._get("grabbing")}},{key:"destroy",value:function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}},{key:"intersectionDistance",value:function(e){var t=this.graphic;if(!1===t.visible)return null;var i=t.geometry;if(Object(u.j)(i))return null;var n=this._get("focusedSymbol"),r=Object(u.k)(n)?n:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,i,r):this._intersectDistance3D(this.view,e,t)}},{key:"attach",value:function(){this.attachSymbolChanged(),Object(u.k)(this.layer)&&this.layer.add(this.graphic)}},{key:"detach",value:function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),Object(u.k)(this.layer)&&this.layer.remove(this.graphic)}},{key:"attachSymbolChanged",value:function(){var e=this;this.detachSymbolChanged(),this._graphicSymbolChangedHandle=this.graphic.watch("symbol",(function(t){Object(u.k)(t)&&t!==e.focusedSymbol&&t!==e._originalSymbol&&(e._originalSymbol=t,e._focused&&Object(u.k)(e.focusedSymbol)&&(e.graphic.symbol=e.focusedSymbol))}),!0)}},{key:"detachSymbolChanged",value:function(){Object(u.k)(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}},{key:"_updateGraphicSymbol",value:function(){this.graphic.symbol=this._focused&&Object(u.k)(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol}},{key:"_resetGraphicSymbol",value:function(){this.graphic.symbol=this._originalSymbol}},{key:"_intersectDistance2D",value:function(e,t,i,n){if(n=n||Object(y.e)(i),Object(u.j)(n))return null;var r=this._circleCollisionCache;if("point"!==i.type||"simple-marker"!==n.type)return Object(j.b)(t,i,e)?1:null;if(Object(u.j)(r)||!r.originalPoint.equals(i)){var a=i,o=e.spatialReference;if(Object(m.b)(a.spatialReference,o)){var s=Object(m.j)(a,o);r={originalPoint:a.clone(),mapPoint:s,radiusPx:Object(d.h)(n.size)},this._circleCollisionCache=r}}if(Object(u.k)(r)){var c=Object(d.j)(t,w),l=e.toScreen(r.mapPoint),h=r.radiusPx,p=l.x+Object(d.h)(n.xoffset),f=l.y-Object(d.h)(n.yoffset);return Object(v.j)(c,[p,f])<h*h?1:null}return null}},{key:"_intersectDistance3D",value:function(e,t,i){var n=e.toMap(t,{include:[i]});return n&&Object(m.o)(n,x,e.renderSpatialReference)?Object(f.j)(x,e.state.camera.eye):null}}]),i}(c.a);Object(s.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],_.prototype,"graphic",null),Object(s.a)([Object(h.b)({readOnly:!0})],_.prototype,"elevationInfo",null),Object(s.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],_.prototype,"view",void 0),Object(s.a)([Object(h.b)({value:null})],_.prototype,"focusedSymbol",null),Object(s.a)([Object(h.b)({constructOnly:!0})],_.prototype,"layer",void 0),Object(s.a)([Object(h.b)()],_.prototype,"interactive",void 0),Object(s.a)([Object(h.b)()],_.prototype,"selectable",void 0),Object(s.a)([Object(h.b)()],_.prototype,"grabbable",void 0),Object(s.a)([Object(h.b)({value:!1})],_.prototype,"grabbing",null),Object(s.a)([Object(h.b)()],_.prototype,"dragging",void 0),Object(s.a)([Object(h.b)()],_.prototype,"hovering",null),Object(s.a)([Object(h.b)({value:!1})],_.prototype,"selected",null),Object(s.a)([Object(h.b)()],_.prototype,"cursor",void 0),_=Object(s.a)([Object(p.a)("esri.views.interactive.GraphicManipulator")],_);var x=Object(b.e)(),w=Object(d.g)()},942:function(e,t,i){"use strict";var n=i(11),r=i(4),a=i(5),o=i(6),s=i(7),c=i(0),l=i(36),u=(i(13),i(1)),d=(i(16),i(12)),h=i(9),p=i(35),v=i(47),f=i(46),b=(i(90),i(63)),m=i(10),g=i(8),y=i.n(g),O=i(14),j=i(112),_=i(25),x=i(38),w=i(479),k=i(751),T=i(114),S=(i(61),i(241)),P=i(50),C=i(91),V=i(85),M=i(40),D={main:new M.a([255,127,0]),selected:new M.a([255,255,255]),outline:new M.a([0,0,0,.5]),selectedOutline:new M.a([255,255,255]),hoverOutline:new M.a([255,255,255]),secondary:new M.a([255,255,255]),secondaryOutline:new M.a([100,100,100]),transparent:new M.a([0,0,0,0])};function E(e,t){if(t)for(var i in t)e[i]=t[i]}var z=function e(t){Object(r.a)(this,e),this.size=8,this.hoverSize=10,this.color=D.main,this.hoverColor=D.main,this.outlineColor=D.outline,this.hoverOutlineColor=D.hoverOutline,E(this,t)},H=function e(t){Object(r.a)(this,e),this.color=D.secondary,this.hoverColor=D.main,E(this,t)},A=function e(t){Object(r.a)(this,e),this.color=D.transparent,this.hoverColor=D.transparent,this.outlineColor=D.main,this.hoverOutlineColor=D.main,this.stagedColor=D.transparent,this.stagedOutlineColor=D.secondary,E(this,t)},I=function e(t){Object(r.a)(this,e),this.vertex=new z,this.midpoint=new z({color:D.secondary,outlineColor:D.secondaryOutline,size:6}),this.selected=new z({color:D.selected,hoverColor:D.selected,hoverOutlineColor:D.hoverOutline}),E(this,t)},R=function e(t){Object(r.a)(this,e),this.center=new z({color:D.secondaryOutline}),this.fill=new A,this.line=new H,this.vertex=new z({color:D.selected,outlineColor:D.main,hoverColor:D.selected,hoverOutlineColor:D.secondaryOutline}),E(this,t)},G=(new function e(t){Object(r.a)(this,e),this.reshapeGraphics=new I,this.transformGraphics=new R,E(this,t)},i(24)),L=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(){var e;return Object(r.a)(this,i),(e=t.apply(this,arguments)).enabled=!0,e}return i}(G.a);Object(c.a)([Object(u.b)({type:Boolean})],L.prototype,"enabled",void 0),L=Object(c.a)([Object(h.a)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],L);var F=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).lineSnapper=new L,n.parallelLineSnapper=new L,n.rightAngleSnapper=new L,n.rightAngleTriangleSnapper=new L,n.shortLineThreshold=15,n.distance=5,n.pointThreshold=1e-6,n.intersectionParallelLineThreshold=1e-6,n.parallelLineThreshold=1e-6,n.touchSensitivityMultiplier=1.5,n.pointOnLineThreshold=1e-6,n.orange=new M.a([255,127,0]),n.lineHintWidthReference=3,n.lineHintWidthTarget=3,n.lineHintFadedExtensions=.3,n.parallelLineHintWidth=2,n.parallelLineHintLength=24,n.parallelLineHintOffset=1.5,n.rightAngleHintSize=24,n.rightAngleHintOutlineSize=1.5,n}return i}(G.a);Object(c.a)([Object(u.b)({type:L,constructOnly:!0,nonNullable:!0,json:{write:!0}})],F.prototype,"lineSnapper",void 0),Object(c.a)([Object(u.b)({type:L,constructOnly:!0,nonNullable:!0,json:{write:!0}})],F.prototype,"parallelLineSnapper",void 0),Object(c.a)([Object(u.b)({type:L,constructOnly:!0,nonNullable:!0,json:{write:!0}})],F.prototype,"rightAngleSnapper",void 0),Object(c.a)([Object(u.b)({type:L,constructOnly:!0,nonNullable:!0,json:{write:!0}})],F.prototype,"rightAngleTriangleSnapper",void 0),Object(c.a)([Object(u.b)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],F.prototype,"shortLineThreshold",void 0),Object(c.a)([Object(u.b)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],F.prototype,"distance",void 0),Object(c.a)([Object(u.b)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],F.prototype,"pointThreshold",void 0),Object(c.a)([Object(u.b)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],F.prototype,"intersectionParallelLineThreshold",void 0),Object(c.a)([Object(u.b)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],F.prototype,"parallelLineThreshold",void 0),Object(c.a)([Object(u.b)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],F.prototype,"touchSensitivityMultiplier",void 0),Object(c.a)([Object(u.b)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],F.prototype,"pointOnLineThreshold",void 0),Object(c.a)([Object(u.b)({type:M.a,nonNullable:!0})],F.prototype,"orange",void 0),Object(c.a)([Object(u.b)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],F.prototype,"lineHintWidthReference",void 0),Object(c.a)([Object(u.b)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],F.prototype,"lineHintWidthTarget",void 0),Object(c.a)([Object(u.b)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],F.prototype,"lineHintFadedExtensions",void 0),Object(c.a)([Object(u.b)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],F.prototype,"parallelLineHintWidth",void 0),Object(c.a)([Object(u.b)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],F.prototype,"parallelLineHintLength",void 0),Object(c.a)([Object(u.b)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],F.prototype,"parallelLineHintOffset",void 0),Object(c.a)([Object(u.b)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],F.prototype,"rightAngleHintSize",void 0),Object(c.a)([Object(u.b)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],F.prototype,"rightAngleHintOutlineSize",void 0);var U=new(F=Object(c.a)([Object(h.a)("esri.views.interactive.snapping.Settings.Defaults")],F)),q=i(15),N=i(55),Z=i(756);function W(e,t){var i=e.length===t.length&&e[0]===t[0]&&e[1]===t[1];switch(e.length){case 2:return i;case 3:return i&&e[2]===t[2];case 4:return i&&e[3]===t[3]}return!1}function B(e,t,i,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Object(V.e)(),a=t.toXYZ(e);return a[2]=Object(Z.b)(n,a,t.spatialReference,i)||0,n.renderCoordsHelper.toRenderCoords(a,t.spatialReference,r),r}function X(e,t,i,n,r,a,o){var s=i.toXYZ(e),c=i.toXYZ(t),l=Object(Z.b)(r,s,i.spatialReference,n),u=Object(Z.b)(r,c,i.spatialReference,n),d=(null==l?u:null==u?l:Math.min(l,u))||0;s[2]=d,c[2]=d,r.renderCoordsHelper.toRenderCoords(s,i.spatialReference,a),r.renderCoordsHelper.toRenderCoords(c,i.spatialReference,o)}Object(V.e)(),Object(x.g)(),new N.a;var Y=function e(){Object(r.a)(this,e)},Q=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this)).intersectionPoint=e,n}return Object(a.a)(i,[{key:"equals",value:function(e){return e instanceof i&&W(this.intersectionPoint,e.intersectionPoint)}}]),i}(Y);d.a.getLogger("esri.views.interactive.snapping.hints.LineSnappingHint");var K=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e,n,a){var o,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],c=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return Object(r.a)(this,i),(o=t.call(this)).type=e,o.lineStart=n,o.lineEnd=a,o.fadeLeft=s,o.fadeRight=c,o}return Object(a.a)(i,[{key:"equals",value:function(e){return e instanceof i&&this.type===e.type&&W(this.lineStart,e.lineStart)&&W(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}}]),i}(Y);d.a.getLogger("esri.views.interactive.snapping.hints.ParallelSnappingHint");var J=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e,n){var a;return Object(r.a)(this,i),(a=t.call(this)).lineStart=e,a.lineEnd=n,a}return Object(a.a)(i,[{key:"equals",value:function(e){return e instanceof i&&W(this.lineStart,e.lineStart)&&W(this.lineEnd,e.lineEnd)}}]),i}(Y),$=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this)).point=e,n}return Object(a.a)(i,[{key:"equals",value:function(e){return e instanceof i&&W(this.point,e.point)}}]),i}(Y);d.a.getLogger("esri.views.interactive.snapping.hints.RightAngleSnappingHint");var ee=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e,n,a){var o;return Object(r.a)(this,i),(o=t.call(this)).previousVertex=e,o.centerVertex=n,o.nextVertex=a,o}return Object(a.a)(i,[{key:"equals",value:function(e){return e instanceof i&&W(this.previousVertex,e.previousVertex)&&W(this.centerVertex,e.centerVertex)&&W(this.nextVertex,e.nextVertex)}}]),i}(Y),te=function(){function e(){Object(r.a)(this,e)}return Object(a.a)(e,[{key:"draw",value:function(e,t){var i,n=this.getUniqueHints(e),r=[],a=Object(q.a)(n);try{for(a.s();!(i=a.n()).done;){var o=i.value;o instanceof Q&&r.push(this.visualizeIntersectionPoint(o,t)),o instanceof K&&r.push(this.visualizeLine(o,t)),o instanceof J&&r.push(this.visualizeParallelSign(o,t)),o instanceof ee&&r.push(this.visualizeRightAngleQuad(o,t)),o instanceof $&&r.push(this.visualizePoint(o,t))}}catch(s){a.e(s)}finally{a.f()}return Object(S.b)(r)}},{key:"getUniqueHints",value:function(e){var t,i=[],n=Object(q.a)(e);try{for(n.s();!(t=n.n()).done;){var r,a=t.value,o=!0,s=Object(q.a)(i);try{for(s.s();!(r=s.n()).done;){var c=r.value;if(a.equals(c)){o=!1;break}}}catch(l){s.e(l)}finally{s.f()}o&&i.push(a)}}catch(l){n.e(l)}finally{n.f()}return i}}]),e}(),ie=i(120),ne=i(156),re=i(115),ae=i(247),oe=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this)).graphicsLayer=e,n}return Object(a.a)(i,[{key:"visualizeIntersectionPoint",value:function(e,t){return this._visualizeSnappingIndicator(new N.a({x:e.intersectionPoint[0],y:e.intersectionPoint[1],spatialReference:t.coordinateHelper.spatialReference}),le)}},{key:"visualizePoint",value:function(e,t){return this._visualizeSnappingIndicator(new N.a({x:e.point[0],y:e.point[1],spatialReference:t.coordinateHelper.spatialReference}),ue)}},{key:"visualizeLine",value:function(e,t){return this._visualizeSnappingIndicator(new ie.a({paths:[[e.lineStart,e.lineEnd]],spatialReference:t.coordinateHelper.spatialReference}),de)}},{key:"visualizeParallelSign",value:function(e,t){return this._visualizeSnappingIndicator(new ie.a({paths:[[e.lineStart,e.lineEnd]],spatialReference:t.coordinateHelper.spatialReference}),he)}},{key:"visualizeRightAngleQuad",value:function(e,t){return this._visualizeSnappingIndicator(new ie.a({paths:[[e.previousVertex,e.centerVertex,e.nextVertex]],spatialReference:t.coordinateHelper.spatialReference}),be(e))}},{key:"_visualizeSnappingIndicator",value:function(e,t){var i=this,n=new T.a({geometry:e,symbol:t});return this.graphicsLayer.add(n),Object(S.c)((function(){i.graphicsLayer.remove(n)}))}}]),i}(te),se=D.main.toArray(),ce=[].concat(Object(p.a)(D.main.toRgb()),[100]),le=new ne.a({outline:new re.a({width:1.5,color:se}),size:15,color:[0,0,0,0]}),ue=new ne.a({outline:{width:.5,color:[0,0,0,1]},size:10,color:se}),de=new ae.a({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:Object(x.i)(U.lineHintWidthTarget),color:se}]}}}),he=new ae.a({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,1.5],[7,1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:se}]}}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,-1.5],[7,-1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:se}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}}),pe=function(e){return new ae.a({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:.5,y:.5,z:0},anchorPointUnits:"Relative",size:Object(x.i)(U.rightAngleHintSize),rotation:e,markerPlacement:{type:"CIMMarkerPlacementOnVertices",placePerPart:!0,angleToLine:!0,placeOnEndPoints:!1},frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[5,-5],[-5,-5],[-5,5],[5,5],[5,-5]]]},symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:Object(x.i)(U.rightAngleHintOutlineSize),color:se},{type:"CIMSolidFill",enable:!0,color:ce}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}})},ve=pe(45),fe=pe(225),be=function(){var e=Object(C.a)(),t=Object(C.a)(),i=Object(V.e)();return function(n){return Object(P.a)(e,n.centerVertex,n.previousVertex),Object(P.a)(t,n.nextVertex,n.previousVertex),Object(P.g)(i,e,t),i[2]<0?ve:fe}}(),me=i(727),ge=i(607),ye=i(813),Oe=function(){function e(t,i,n){Object(r.a)(this,e),this.editGeometry=t,this.vertices=i,this.operation=n,this.undone=!1}return Object(a.a)(e,[{key:"apply",value:function(){var e=this;this.vertices.forEach((function(t){return e.operation.apply(t)})),this.editGeometry.components.forEach((function(e){return e.unnormalizeVertexPositions()}));var t={updatedVertices:this.vertices,operation:this.undone?"redo":"apply"};this.editGeometry.emit("change",t)}},{key:"undo",value:function(){var e=this;this.vertices.forEach((function(t){return e.operation.undo(t)}));var t={updatedVertices:this.vertices,operation:"undo"};this.editGeometry.emit("change",t),this.undone=!0}},{key:"canAccumulate",value:function(e){if(this.undone||e.vertices.length!==this.vertices.length)return!1;for(var t=0;t<e.vertices.length;++t)if(e.vertices[t]!==this.vertices[t])return!1;return this.operation.canAccumulate(e.operation)}},{key:"accumulate",value:function(t){var i=this;if(t instanceof e&&this.canAccumulate(t)){this.vertices.forEach((function(e){return i.operation.accumulate(e,t.operation)})),this.operation.accumulateParams(t.operation),this.editGeometry.components.forEach((function(e){return e.unnormalizeVertexPositions()}));var n={updatedVertices:this.vertices,operation:"apply"};return this.editGeometry.emit("change",n),!0}return!1}}]),e}(),je=function e(t){Object(r.a)(this,e),this.helper=t},_e=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(r.a)(this,e),this.editGeometry=t,this.vertices=i,this.minNumberOfVertices=n,this.removedVertices=null}return Object(a.a)(e,[{key:"apply",value:function(){var e=this,t="redo";null==this.removedVertices?(this.removedVertices=[],this.vertices.forEach((function(t){var i=e._removeVertex(t);Object(m.k)(i)&&e.removedVertices.push(i)})),t="apply"):this.removedVertices.forEach((function(t){e._removeVertex(t.removedVertex)}));var i={removedVertices:this.vertices,operation:t};this.editGeometry.emit("change",i)}},{key:"undo",value:function(){var e=this;this.removedVertices.forEach((function(t){e._undoRemoveVertex(t)}));var t={addedVertices:this.vertices,operation:"undo"};this.editGeometry.emit("change",t)}},{key:"accumulate",value:function(){return!1}},{key:"_removeVertex",value:function(e){var t=e.component;if(t.vertices.length<=this.minNumberOfVertices)return null;var i={removedVertex:e,createdEdge:null},n=e.left,r=e.right;return t.vertices.splice(t.vertices.indexOf(e),1),n&&(t.edges.splice(t.edges.indexOf(n),1),n.left.right=null),r&&(t.edges.splice(t.edges.indexOf(r),1),r.right.left=null),0===e.index&&r&&this.vertices.length>0&&t.swapVertices(t.vertices.indexOf(r.right),0),n&&r&&(i.createdEdge=new ge.b(t,n.left,r.right),t.edges.push(i.createdEdge)),r&&t.updateVertexIndex(r.right,r.right.index-1),i}},{key:"_undoRemoveVertex",value:function(e){var t=e.removedVertex,i=e.removedVertex.component,n=t.left,r=t.right;e.createdEdge&&i.edges.splice(i.edges.indexOf(e.createdEdge),1),i.vertices.push(t),n&&(i.edges.push(n),n.left.right=n),r&&(i.edges.push(r),r.right.left=r),i.updateVertexIndex(t,t.index)}}]),e}(),xe=function(){function e(t,i,n){Object(r.a)(this,e),this.editGeometry=t,this.edge=i,this.t=n,this.createdVertex=null,this.left=null,this.right=null}return Object(a.a)(e,[{key:"apply",value:function(){var e="redo",t=this.edge,i=t.component,n=t.component.data,r=t.left,a=t.right;i.edges.splice(i.edges.indexOf(t),1),Object(m.j)(this.createdVertex)&&(e="apply",this.createdVertex=new ge.d(t.component)),i.vertices.push(this.createdVertex),this.createdVertex.pos=n.coordinateHelper.lerp(t.left.pos,t.right.pos,this.t,n.coordinateHelper.createNew()),Object(m.j)(this.left)&&(this.left=new ge.b(i,r,this.createdVertex)),this.left.left.left?i.edges.push(this.left):i.edges.unshift(this.left),r.right=this.left,Object(m.j)(this.right)&&(this.right=new ge.b(i,this.createdVertex,a)),i.edges.push(this.right),a.left=this.right,i.updateVertexIndex(this.createdVertex,r.index+1);var o={addedVertices:[this.createdVertex],operation:e};this.editGeometry.emit("change",o)}},{key:"undo",value:function(){if(Object(m.j)(this.createdVertex)||Object(m.j)(this.left)||Object(m.j)(this.right))return null;var e=this.edge,t=e.component,i=this.createdVertex.left,n=this.createdVertex.right,r=i.left,a=n.right;t.vertices.splice(t.vertices.indexOf(this.createdVertex),1),t.edges.splice(t.edges.indexOf(this.left),1),t.edges.splice(t.edges.indexOf(this.right),1),this.edge.left.left?t.edges.push(this.edge):t.edges.unshift(this.edge),r.right=e,a.left=e,t.updateVertexIndex(r,r.index);var o={removedVertices:[this.createdVertex],operation:"undo"};this.editGeometry.emit("change",o)}},{key:"accumulate",value:function(){return!1}}]),e}(),we=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e,n,a,o){var s;return Object(r.a)(this,i),(s=t.call(this,e)).dx=n,s.dy=a,s.dz=o,s}return Object(a.a)(i,[{key:"move",value:function(e,t,i,n){this.helper.addDelta(e.pos,t,i,n)}},{key:"apply",value:function(e){this.move(e,this.dx,this.dy,this.dz)}},{key:"undo",value:function(e){this.move(e,-this.dx,-this.dy,-this.dz)}},{key:"canAccumulate",value:function(e){return e instanceof i}},{key:"accumulate",value:function(e,t){this.move(e,t.dx,t.dy,t.dz)}},{key:"accumulateParams",value:function(e){this.dx+=e.dx,this.dy+=e.dy,this.dz+=e.dz}}]),i}(je),ke=i(27),Te=i(66),Se=i(54),Pe=i(704),Ce=i(736);function Ve(e,t){return e[0]*t[1]-e[1]*t[0]}var Me,De=1e-6,Ee=Object(C.a)(),ze=Object(C.a)(),He=Object(C.a)(),Ae=Object(C.a)(),Ie=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e,n,a){var o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return Object(r.a)(this,i),(o=t.call(this,e)).planeType=n,o.edge=a,o.distance=s,o._plane=Object(Pe.d)(),o._offsetPlane=Object(Pe.d)(),o._minDistance=-1/0,o._maxDistance=1/0,0===c&&o._initialize(),o}return Object(a.a)(i,[{key:"plane",get:function(){return this._plane}},{key:"requiresSplitEdgeLeft",get:function(){return!this._left.isOriginalDirection}},{key:"requiresSplitEdgeRight",get:function(){return!this._right.isOriginalDirection}},{key:"edgeDirection",get:function(){return this._edgeDirection}},{key:"_initialize",value:function(){this._initializeNeighbors(),this._initializePlane(),this._initializeDistanceConstraints()}},{key:"_initializeNeighbors",value:function(){var e,t,i,n,r=this._toXYZ(this.edge.left.pos),a=this._toXYZ(null==(e=this.edge.left.left)||null==(t=e.left)?void 0:t.pos),o=this._toXYZ(this.edge.right.pos),s=this._toXYZ(null==(i=this.edge.right.right)||null==(n=i.right)?void 0:n.pos);this._edgeDirection=Object(Se.s)(Object(V.e)(),r,o),this._left=this._computeNeighbor(r,a,this._edgeDirection),this._right=this._computeNeighbor(o,s,this._edgeDirection)}},{key:"_toXYZ",value:function(e){return Object(m.k)(e)?this.helper.toXYZ(e):null}},{key:"_computeNeighbor",value:function(e,t,i){if(Object(m.j)(t))return{start:e,end:t,direction:Object(V.g)(-i[1],i[0],0),isOriginalDirection:!0};var n=Object(Se.s)(Object(V.e)(),e,t),r=!this._passesBisectingAngleThreshold(n,i);return{start:e,end:t,direction:r?this._bisectVectorsPerpendicular(i,n):n,isOriginalDirection:!r}}},{key:"_passesBisectingAngleThreshold",value:function(e,t){var i=Math.abs(Object(Ce.a)(t,e));return i>=Re&&i<=Math.PI-Re}},{key:"_bisectVectorsPerpendicular",value:function(e,t){var i=Object(Se.e)(e,t)<0?e:Object(Se.p)(Object(V.e)(),e),n=Math.abs(Object(Se.e)(i,t));if(!(n<.001||n>.999))return this._bisectDirection(i,t);var r=Object(Se.d)(Object(V.e)(),i,[0,0,1]);return Object(Se.o)(r,r)}},{key:"_bisectDirection",value:function(e,t){var i=Object(Se.c)(Object(V.e)(),e,t);return Object(Se.o)(i,i)}},{key:"_initializePlane",value:function(){var e=this._computeNormalDirection(this._left),t=this._computeNormalDirection(this._right);Object(Se.e)(e,t)<0&&Object(Se.p)(t,t),Object(Pe.f)(this._left.start,this._bisectDirection(e,t),this._plane)}},{key:"_computeNormalDirection",value:function(e){var t=Object(Se.d)(Object(V.e)(),e.direction,this._edgeDirection);Object(Se.o)(t,t);var i=Object(Se.d)(Object(V.e)(),this._edgeDirection,t);return 1===this.planeType&&(i[2]=0),Object(Se.o)(i,i)}},{key:"_initializeDistanceConstraints",value:function(){Object(m.k)(this._left.end)&&!this.requiresSplitEdgeLeft&&this._updateDistanceConstraint(Object(Pe.s)(this._plane,this._left.end)),Object(m.k)(this._right.end)&&!this.requiresSplitEdgeRight&&this._updateDistanceConstraint(Object(Pe.s)(this._plane,this._right.end)),this._updateIntersectDistanceConstraint(this._plane)}},{key:"_updateDistanceConstraint",value:function(e){e<=0&&(this._minDistance=Math.max(this._minDistance,e)),e>=0&&(this._maxDistance=Math.min(this._maxDistance,e))}},{key:"_updateIntersectDistanceConstraint",value:function(e){var t=Object(Pe.p)(e),i=this._edgeDirection,n=Object(Se.c)(Object(V.e)(),this._left.start,this._left.direction),r=Object(Se.c)(Object(V.e)(),this._right.start,this._right.direction),a=this._pointInBasis2D(Object(C.a)(),t,i,this._left.start),o=this._pointInBasis2D(Object(C.a)(),t,i,n),s=this._pointInBasis2D(Object(C.a)(),t,i,this._right.start),c=function(e,t){var i=e.start,n=e.end,r=t.start,a=t.end,o=Object(P.a)(Ee,n,i),s=Object(P.a)(ze,a,r),c=Ve(o,s);if(Math.abs(c)<=De)return[];var l=Object(P.a)(He,i,r),u=Ve(s,l)/c,d=Ve(o,l)/c;if(u>=0){if(d>=0||1===t.type)return[Object(P.o)(Ae,i,o,u)]}else if(1===e.type&&(d>=0||1===t.type))return[Object(P.o)(Ae,i,o,u)];return[]}({start:o,end:a,type:1},{start:this._pointInBasis2D(Object(C.a)(),t,i,r),end:s,type:1}),l=Object(ke.a)(c,1)[0];if(l){var u=Object(P.a)(Object(C.a)(),a,o);Object(P.f)(u,u);var d=Object(P.a)(Object(C.a)(),l,o),h=Object(P.h)(u,d),p=Object(Se.c)(Object(V.e)(),n,Object(Se.b)(Object(V.e)(),this._left.direction,-h)),v=Object(Pe.s)(e,p);this._updateDistanceConstraint(v)}}},{key:"_pointInBasis2D",value:function(e,t,i,n){return e[0]=Object(Ce.c)(t,n),e[1]=Object(Ce.c)(i,n),e}},{key:"_offset",value:function(e,t){var i=this;Number.isFinite(this._minDistance)&&(t=Math.max(this._minDistance,t)),Number.isFinite(this._maxDistance)&&(t=Math.min(this._maxDistance,t)),Object(Pe.c)(this._plane,this._offsetPlane),this._offsetPlane[3]-=t;var n=function(e,t,n){return Object(m.k)(t)&&Object(Pe.i)(i._offsetPlane,e,Object(Se.c)(Object(V.e)(),e,t),n)},r=Object(V.e)();(e===this.edge.left?n(this._left.start,this._left.direction,r):n(this._right.start,this._right.direction,r))&&this.helper.copy(this.helper.fromXYZ(r,void 0,this.helper.getM(e.pos)),e.pos)}},{key:"signedDistanceToPoint",value:function(e){return Object(Pe.s)(this.plane,this.helper.toXYZ(this.helper.fromPoint(e)))}},{key:"apply",value:function(e){this._offset(e,this.distance)}},{key:"undo",value:function(e){this._offset(e,0)}},{key:"canAccumulate",value:function(e){return e instanceof i&&this.edge.left.index===e.edge.left.index&&this.edge.right.index===e.edge.right.index&&this.edge.component===e.edge.component&&this._maybeEqualsVec3(this._left.direction,e._left.direction)&&this._maybeEqualsVec3(this._right.direction,e._right.direction)&&Object(Se.A)(Object(Pe.p)(this._plane),Object(Pe.p)(e._plane))}},{key:"accumulate",value:function(e,t){var i=this._plane[3]-t._plane[3]+t.distance;this._offset(e,i)}},{key:"accumulateParams",value:function(e){var t=e.distance-e._plane[3];this.distance=t+this._plane[3]}},{key:"clone",value:function(){var e=new i(this.helper,this.planeType,this.edge,this.distance,1);return Object(Pe.c)(this._plane,e._plane),Object(Pe.c)(this._offsetPlane,e._offsetPlane),e._maxDistance=this._maxDistance,e._minDistance=this._minDistance,e._left=this._cloneNeighbor(this._left),e._right=this._cloneNeighbor(this._right),e._edgeDirection=Object(Se.h)(Object(V.e)(),this._edgeDirection),e}},{key:"_maybeEqualsVec3",value:function(e,t){return Object(m.j)(e)&&Object(m.j)(t)||Object(m.k)(e)&&Object(m.k)(t)&&Object(Se.A)(e,t)}},{key:"_cloneNeighbor",value:function(e){var t=e.start,i=e.end,n=e.direction,r=e.isOriginalDirection;return{start:Object(Se.h)(Object(V.e)(),t),end:Object(m.k)(i)?Object(Se.h)(Object(V.e)(),i):null,direction:Object(Se.h)(Object(V.e)(),n),isOriginalDirection:r}}}]),i}(je),Re=Object(Te.g)(15),Ge=i(130),Le=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e,n,a){var o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return Object(r.a)(this,i),(o=t.call(this,e)).origin=n,o.angle=a,o.accumulationType=s,o}return Object(a.a)(i,[{key:"rotate",value:function(e,t){this.helper.rotate(e.pos,this.origin,t)}},{key:"apply",value:function(e){this.rotate(e,this.angle)}},{key:"undo",value:function(e){this.rotate(e,-this.angle)}},{key:"canAccumulate",value:function(e){return e instanceof i&&Object(Ge.c)(this.origin,e.origin)}},{key:"accumulate",value:function(e,t){var i=1===t.accumulationType;this.rotate(e,i?t.angle-this.angle:t.angle)}},{key:"accumulateParams",value:function(e){var t=1===e.accumulationType;this.angle=t?e.angle:this.angle+e.angle}}]),i}(je),Fe=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e,n,a,o,s){var c,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return Object(r.a)(this,i),(c=t.call(this,e)).origin=n,c.axis1=a,c.factor1=o,c.factor2=s,c.accumulationType=l,c.axis2=Object(P.r)(Object(C.a)(),a[1],-a[0]),c}return Object(a.a)(i,[{key:"scale",value:function(e,t,i){this.helper.scale(e.pos,this.origin,this.axis1,t),this.helper.scale(e.pos,this.origin,this.axis2,i)}},{key:"apply",value:function(e){this.scale(e,this.factor1,this.factor2)}},{key:"undo",value:function(e){this.scale(e,1/this.factor1,1/this.factor2)}},{key:"canAccumulate",value:function(e){return e instanceof i&&Object(Ge.c)(this.origin,e.origin)&&Object(Ge.c)(this.axis1,e.axis1)}},{key:"accumulate",value:function(e,t){1===t.accumulationType?this.scale(e,t.factor1/this.factor1,t.factor2/this.factor2):this.scale(e,t.factor1,t.factor2)}},{key:"accumulateParams",value:function(e){var t=1===e.accumulationType;this.factor1=t?e.factor1:this.factor1*e.factor1,this.factor2=t?e.factor2:this.factor2*e.factor2}}]),i}(je),Ue=function(){function e(){Object(r.a)(this,e),this.operations=[],this.closed=!1}return Object(a.a)(e,[{key:"close",value:function(){this.closed=!0}},{key:"apply",value:function(){var e,t=Object(q.a)(this.operations);try{for(t.s();!(e=t.n()).done;){e.value.apply()}}catch(i){t.e(i)}finally{t.f()}}},{key:"undo",value:function(){for(var e=this.operations.length-1;e>=0;e--)this.operations[e].undo()}},{key:"accumulate",value:function(e){if(this.closed)return!1;var t=this.operations.length?this.operations[this.operations.length-1]:null;return t&&t.accumulate(e)||(this.operations.push(e),e.apply()),!0}}]),e}(),qe=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e,n){var a;return Object(r.a)(this,i),(a=t.call(this)).editGeometry=e,a.type=n,a._geometry=null,a._dirty=!0,a._listener=a.editGeometry.on("change",(function(e){a._dirty=!0,e.addedVertices&&a.emit("vertex-add",{type:"vertex-add",vertices:e.addedVertices,operation:e.operation}),e.removedVertices&&a.emit("vertex-remove",{type:"vertex-remove",vertices:e.removedVertices,operation:e.operation}),e.updatedVertices&&a.emit("vertex-update",{type:"vertex-update",vertices:e.updatedVertices,operation:e.operation})})),a}return Object(a.a)(i,[{key:"destroy",value:function(){this._listener.remove()}},{key:"splitEdge",value:function(e,t){return this.editGeometry.apply(new xe(this.editGeometry,e,t))}},{key:"updateVertices",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this.editGeometry.apply(new Oe(this.editGeometry,e,t),i)}},{key:"moveVertices",value:function(e,t,i,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return this.updateVertices(e,new we(this.editGeometry.coordinateHelper,t,i,n),r)}},{key:"scaleVertices",value:function(e,t,i,n,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return this.updateVertices(e,new Fe(this.editGeometry.coordinateHelper,t,i,n,r,o),a)}},{key:"rotateVertices",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return this.updateVertices(e,new Le(this.editGeometry.coordinateHelper,t,i,r),n)}},{key:"removeVertices",value:function(e){return this.editGeometry.apply(new _e(this.editGeometry,e,this._minNumVerticesPerType))}},{key:"appendVertex",value:function(e){return 0===this.editGeometry.components.length?null:this.editGeometry.apply(new ye.a(this.editGeometry,this.editGeometry.components[0],e))}},{key:"offsetEdge",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return this.updateVertices([t.left,t.right],new Ie(this.editGeometry.coordinateHelper,e,t,i),n)}},{key:"canRemoveVertex",value:function(){return this.editGeometry.components[0].vertices.length>this._minNumVerticesPerType}},{key:"createUndoGroup",value:function(){var e=new Ue;return this.editGeometry.apply(e),{remove:function(){return e.close()}}}},{key:"undo",value:function(){return this.editGeometry.undo()}},{key:"canUndo",get:function(){return this.editGeometry.canUndo}},{key:"redo",value:function(){return this.editGeometry.redo()}},{key:"canRedo",get:function(){return this.editGeometry.canRedo}},{key:"geometry",get:function(){if(this._dirty){switch(this.type){case"point":this._geometry=this.editGeometry.toPoint();break;case"polyline":this._geometry=this.editGeometry.toPolyline();break;case"polygon":this._geometry=this.editGeometry.toPolygon()}this._dirty=!1}return this._geometry}},{key:"_minNumVerticesPerType",get:function(){switch(this.type){case"point":return 1;case"polyline":return 2;case"polygon":return 3;default:return 0}}}],[{key:"fromGeometry",value:function(e,t){return new i(ge.c.fromGeometry(e,t),e.type)}}]),i}(j.a),Ne=function(){function e(t){Object(r.a)(this,e),this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.geometry=t.geometry,this.elevationInfo=t.elevationInfo,this.pointer=t.pointer,this.vertexHandle=t.vertexHandle,this.excludeFeature=t.excludeFeature,this.visualizer=t.visualizer}return Object(a.a)(e,[{key:"coordinateHelper",get:function(){return this.geometry.editGeometry.coordinateHelper}}]),e}(),Ze=Me=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e){var n,a;return Object(r.a)(this,i),(n=t.call(this,e))._hasZ=null,n._cursorScreenPoint=null,n._snappingTask=null,n._stagedVertex=null,n._stagedVertexUnsnapped=null,n._lastVertexUnsnapped=null,n._nativeEventHistory={undoStack:[],redoStack:[]},n.interactiveUndoDisabled=!1,n.history=[],n.redoHistory=[],n.snapToScene=!1,n.view=null,n.elevationInfo=null,n.defaultZ=0,n._coordinateHelper=Object(me.a)(e.hasZ,!1,e.view.spatialReference,"local"),n._snappingManager=e.snappingManager,n._editGeometry=new qe(new ge.c(n._coordinateHelper),null!=(a=e.editGeometryType)?a:"polygon"),n._snappingGraphicsLayer=new w.a({id:Me.SNAPPING_GRAPHICS_LAYER_ID,listMode:"hide",internal:!0}),n._snappingContext=new Ne({geometry:n._editGeometry,elevationInfo:{mode:"on-the-ground",offset:0},pointer:"mouse",visualizer:new oe(n._snappingGraphicsLayer)}),n._activeComponent=new ge.a(n._editGeometry.editGeometry),n._editGeometry.editGeometry.components.push(n._activeComponent),n}return Object(a.a)(i,[{key:"initialize",value:function(){"2d"===this.view.type&&this.view.map.layers.add(this._snappingGraphicsLayer)}},{key:"destroy",value:function(){this._snappingTask=Object(m.a)(this._snappingTask),this.view.map.layers.remove(this._snappingGraphicsLayer),this._snappingGraphicsLayer.destroy(),Object(m.k)(this._snappingManager)&&this._snappingManager.doneSnapping(),this._editGeometry.destroy()}},{key:"_committedVertices",get:function(){return this._editGeometry.editGeometry.components[0].vertices.map((function(e){return e.pos}))}},{key:"vertices",get:function(){return Object(m.k)(this._stagedVertex)?[].concat(Object(p.a)(this._committedVertices),[this._coordinateHelper.pointToArray(this._stagedVertex)]):this._committedVertices}},{key:"hasZ",get:function(){return Object(m.k)(this._hasZ)?this._hasZ:"3d"===this.view.type},set:function(e){this._hasZ=e,this.notifyChange("hasZ")}},{key:"canUndo",value:function(){return this._editGeometry.editGeometry.canUndo}},{key:"canRedo",value:function(){return this._editGeometry.editGeometry.canRedo}},{key:"undo",value:function(){this.canUndo()&&this._editGeometry.undo()}},{key:"redo",value:function(){this.canRedo()&&this._editGeometry.redo()}},{key:"getCoordsFromScreenPoint",value:function(e){var t=this.screenToMap(e);return Object(m.k)(t)?t.hasZ?[t.x,t.y,t.z]:[t.x,t.y]:null}},{key:"getCoordsAndPointFromScreenPoint",value:function(e){var t=this.screenToMap(e);return Object(m.k)(t)?t.hasZ?{vertex:[t.x,t.y,t.z],mapPoint:t}:{vertex:[t.x,t.y],mapPoint:t}:null}},{key:"_pushCursorVertex",value:function(e){var t=this,i=Object(k.c)(e[0],e[1],null,this.view.spatialReference);this._stagedVertexUnsnapped=i,Object(m.j)(this._snappingManager)?this._stagedVertex=i:(this._stagedVertex=this._snappingManager.update(i,this._snappingContext),this._snappingTask=Object(_.h)(function(){var e=Object(O.a)(y.a.mark((function e(n){var r;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(m.k)(t._snappingManager)){e.next=5;break}return e.next=3,t._snappingManager.snap(i,t._snappingContext,n);case 3:return r=e.sent,e.abrupt("return",(r.valid&&(t._stagedVertex=r.apply(),t.notifyChange("vertices")),r));case 5:return e.abrupt("return",null);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))}},{key:"_popCursorVertex",value:function(){this._stagedVertex=null,this._stagedVertexUnsnapped=null,this.notifyChange("vertices")}},{key:"getGeometryZValue",value:function(){return this.defaultZ}},{key:"screenToMap",value:function(e){var t=null;if("3d"===this.view.type)if(this.hasZ){var i=Object(m.s)(this.elevationInfo,We);t=this.view.sceneIntersectionHelper.intersectElevationFromScreen(Object(x.g)(e.x,e.y),i,this.getGeometryZValue())}else{var n=Object(m.s)(this.elevationInfo,Be);t=this.view.sceneIntersectionHelper.intersectElevationFromScreen(Object(x.g)(e.x,e.y),n,0),Object(m.k)(t)&&(t.z=void 0)}else t=this.view.toMap(e),Object(m.k)(t)&&(t.z=this.hasZ?this.getGeometryZValue():void 0);return t}},{key:"_isDuplicateOfLastVertex",value:function(e){var t=this._editGeometry.editGeometry.components[0].getLastVertex();if(Object(m.k)(t)&&e[0]===t[0]&&e[1]===t[1])return!0;var i=this._coordinateHelper.createDehydratedPoint(e),n=i.x,r=i.y;return!(!Object(m.k)(this._lastVertexUnsnapped)||n!==this._lastVertexUnsnapped.x||r!==this._lastVertexUnsnapped.y)}},{key:"_vertexAddHandler",value:function(e){var t=Object(m.k)(this._stagedVertex)?this._coordinateHelper.pointToArray(this._stagedVertex):this.getCoordsFromScreenPoint(this._cursorScreenPoint);Object(m.k)(t)&&this._addVertex(t,e.native)}},{key:"_drawCompleteHandler",value:function(e){this._completeDrawing(e.native)}}]),i}(j.a.EventedAccessor);Ze.SNAPPING_GRAPHICS_LAYER_ID="DrawAction-snapping-graphics-layer",Object(c.a)([Object(u.b)({readOnly:!0})],Ze.prototype,"vertices",null),Object(c.a)([Object(u.b)({type:Boolean,nonNullable:!0})],Ze.prototype,"interactiveUndoDisabled",void 0),Object(c.a)([Object(u.b)({readOnly:!0})],Ze.prototype,"history",void 0),Object(c.a)([Object(u.b)({readOnly:!0})],Ze.prototype,"redoHistory",void 0),Object(c.a)([Object(u.b)()],Ze.prototype,"snapToScene",void 0),Object(c.a)([Object(u.b)()],Ze.prototype,"view",void 0),Object(c.a)([Object(u.b)()],Ze.prototype,"elevationInfo",void 0),Object(c.a)([Object(u.b)({nonNullable:!0})],Ze.prototype,"defaultZ",void 0),Object(c.a)([Object(u.b)()],Ze.prototype,"hasZ",null),Ze=Me=Object(c.a)([Object(h.a)("esri.views.draw.DrawAction")],Ze);var We={mode:"absolute-height",offset:0},Be={mode:"on-the-ground",offset:0},Xe=Ze,Ye=function(){function e(t,i,n,a){Object(r.a)(this,e),this.view=t,this.native=i,this.vertexIndex=n,this.vertices=a,this.defaultPrevented=!1,this.type="vertex-add"}return Object(a.a)(e,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),e}(),Qe=function(){function e(t,i,n,a){Object(r.a)(this,e),this.view=t,this.native=i,this.vertexIndex=n,this.vertices=a,this.defaultPrevented=!1,this.type="vertex-remove"}return Object(a.a)(e,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),e}(),Ke=function(){function e(t,i,n,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;Object(r.a)(this,e),this.view=t,this.native=i,this.vertexIndex=n,this.vertices=a,this.mapPoint=o,this.coordinates=null,this.defaultPrevented=!1,this.type="cursor-update",this.coordinates=1===a.length?a[0]:null}return Object(a.a)(e,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),e}(),Je=function(){function e(t,i){Object(r.a)(this,e),this.native=t,this.vertices=i,this.coordinates=null,this.defaultPrevented=!1,this.type="draw-complete",this.coordinates=1===i.length?i[0]:null}return Object(a.a)(e,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),e}(),$e=i(198),et="r",tt="z",it="Enter",nt="f",rt=" ",at=i(132),ot=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e))._popVertexOnPointerMove=!1,n._addVertexOnPointerUp=!1,n._activePointerId=null,n._viewHandles=new b.a,n._undoRedoHandles=new b.a,n}return Object(a.a)(i,[{key:"initialize",value:function(){this._addViewHandles(),this._addUndoRedoHandles()}},{key:"destroy",value:function(){this._removeViewHandles(),this._viewHandles.destroy(),this._removeUndoRedoHandles(),this._undoRedoHandles.destroy(),this.emit("destroy")}},{key:"undo",value:function(){Object(v.a)(Object(f.a)(i.prototype),"undo",this).call(this),this.notifyChange("vertices")}},{key:"redo",value:function(){Object(v.a)(Object(f.a)(i.prototype),"redo",this).call(this),this.notifyChange("vertices")}},{key:"complete",value:function(){this._completeDrawing()}},{key:"_addViewHandles",value:function(){var e=this;this._removeViewHandles(),this._viewHandles.add([this.view.on("click",(function(e){e.stopPropagation()}),$e.b.TOOL),this.view.on("pointer-down",(function(t){e._shouldHandlePointerEvent(t)&&(e._snappingTask=Object(m.a)(e._snappingTask),e._activePointerId=t.pointerId,e._addVertexOnPointerUp=!0,e._cursorScreenPoint=Object(at.a)(t),"touch"===t.pointerType&&e._updateCursor(t.native))}),$e.b.TOOL),this.view.on("pointer-move",(function(t){e._popVertexOnPointerMove&&(e.undo(),e._popVertexOnPointerMove=!1),e._snappingTask=Object(m.a)(e._snappingTask),e._cursorScreenPoint=Object(at.a)(t),"touch"!==t.pointerType&&e._updateCursor(t.native)}),$e.b.TOOL),this.view.on("pointer-drag",(function(t){e._shouldHandlePointerEvent(t)&&(e._snappingTask=Object(m.a)(e._snappingTask),e._addVertexOnPointerUp=!1)}),$e.b.TOOL),this.view.on("pointer-up",(function(t){if(e._shouldHandlePointerEvent(t))if(e._snappingTask=Object(m.a)(e._snappingTask),e._activePointerId=null,e._addVertexOnPointerUp)e._vertexAddHandler(t);else{var i="touch"===t.pointerType;e._updateCursor(t.native,i)}}),$e.b.TOOL),this.view.on("drag",["Shift"],(function(e){e.stopPropagation()}),$e.b.TOOL),this.view.on("double-click",(function(t){t.stopPropagation(),e._drawCompleteHandler(t)}),$e.b.TOOL),this.view.on("double-click",["Control"],(function(t){t.stopPropagation(),e._drawCompleteHandler(t)}),$e.b.TOOL),this.view.on("key-down",(function(t){var i=t.key,n=t.repeat;i===nt&&!n&&e._cursorScreenPoint?(t.stopPropagation(),e._snappingTask=Object(m.a)(e._snappingTask),e._vertexAddHandler(t)):i===it&&!n&&e._cursorScreenPoint&&e.vertices.length>2?(t.stopPropagation(),e._snappingTask=Object(m.a)(e._snappingTask),e._vertexAddHandler(t),e._drawCompleteHandler(t)):i!==tt||e.interactiveUndoDisabled||n?i!==et||e.interactiveUndoDisabled||n?i!==rt||n||t.stopPropagation():(t.stopPropagation(),e.redo()):(t.stopPropagation(),e.undo())}),$e.b.TOOL),this.view.on("key-up",(function(e){e.key===rt&&e.stopPropagation()}),$e.b.TOOL)])}},{key:"_addUndoRedoHandles",value:function(){var e=this;this._removeUndoRedoHandles(),this._undoRedoHandles.add([this._editGeometry.on("vertex-remove",(function(t){if(e.notifyChange("vertices"),"undo"===t.operation){var i=e._nativeEventHistory.undoStack.pop();e._nativeEventHistory.redoStack.push(i);var n=Object(p.a)(e._committedVertices);Object(m.k)(e._stagedVertex)&&n.push(e._coordinateHelper.pointToArray(e._stagedVertex)),e.emit("undo",new Qe(e.view,i,t.vertices[0].index,n))}})),this._editGeometry.on("vertex-add",(function(t){if(e.notifyChange("vertices"),"apply"===t.operation){var i=e._nativeEventHistory.undoStack[e._nativeEventHistory.undoStack.length],n=e._committedVertices.length-1,r=new Ye(e.view,i,n,e.vertices);e.emit("vertex-add",r),r.defaultPrevented&&(e._popVertexOnPointerMove=!0)}else if("redo"===t.operation){var a=e._nativeEventHistory.redoStack.pop();e._nativeEventHistory.undoStack.push(a);var o=Object(p.a)(e._committedVertices);Object(m.k)(e._stagedVertex)&&o.push(e._coordinateHelper.pointToArray(e._stagedVertex)),e.emit("redo",new Ye(e.view,a,t.vertices[0].index,o))}}))])}},{key:"_removeViewHandles",value:function(){this._viewHandles.removeAll()}},{key:"_removeUndoRedoHandles",value:function(){this._undoRedoHandles.removeAll()}},{key:"_addVertex",value:function(e,t){var i=this._coordinateHelper.fromArray(e);if(!this._isDuplicateOfLastVertex(i)){this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometry.appendVertex(i);var n=t||new Event("placeholder");this._nativeEventHistory.undoStack.push(n)}}},{key:"_updateCursor",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._popCursorVertex(),this._cursorScreenPoint){var n=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);if(Object(m.k)(n)&&!i){this._pushCursorVertex(n.vertex);var r=function(){return new Ke(t.view,e,t._activeComponent.vertices.length,t.vertices,Object(m.k)(t._stagedVertex)?new N.a(t._stagedVertex):null)};this.emit("cursor-update",r()),Object(m.k)(this._snappingTask)&&this._snappingTask.promise.then((function(e){e.valid&&t.emit("cursor-update",r())}),(function(){}))}}}},{key:"_completeDrawing",value:function(e){if(this._activePointerId=null,this._popCursorVertex(),this._snappingTask=Object(m.a)(this._snappingTask),Object(m.k)(this._snappingManager)&&this._snappingManager.doneSnapping(),!(this.vertices.length<2)){var t=new Je(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}}},{key:"_shouldHandlePointerEvent",value:function(e){return function(e){return"mouse"!==e.pointerType||0===e.button}(e)&&(Object(m.j)(this._activePointerId)||this._activePointerId===e.pointerId)}}]),i}(Xe);ot=Object(c.a)([Object(h.a)("esri.views.draw.MultipointDrawAction")],ot);Object.freeze({__proto__:null,get MultipointDrawAction(){return ot}});var st=i(309),ct=i(113),lt=i(23),ut=i(735),dt=i(732),ht=i(478),pt=function(){function e(){Object(r.a)(this,e),this.next=new dt.a}return Object(a.a)(e,[{key:"createSnapDragEventPipelineStep",value:function(e){var t=this,i=e.predicate,r=void 0===i?function(){return!0}:i,a=e.cancel,o=e.snappingManager,s=e.snappingContext,c=e.updatingHandles;if(Object(m.j)(o))return function(e){return e};var l=null,u=null,d=function(){l=Object(m.a)(l),o.doneSnapping(),Object(m.k)(u)&&u.frameTask.remove(),u=null};return a.next((function(e){return d(),e})),this.next=new dt.a,function(e){if(!r(e))return e;if(l=Object(m.a)(l),"start"===e.action){var i="3d"===o.view.type?o.view.resourceController.scheduler.registerTask(ht.b.SNAPPING):ht.a;u={context:new Ne({geometry:s.geometry,elevationInfo:s.elevationInfo,pointer:s.pointer,vertexHandle:Object(m.k)(e.info)?e.info.handle:null,excludeFeature:s.excludeFeature,visualizer:s.visualizer}),originalPos:Object(m.k)(e.snapOrigin)?s.coordinateHelper.createDehydratedPoint(e.snapOrigin):e.mapStart,frameTask:i}}if(Object(m.k)(u)){var a=u.context.coordinateHelper.createDehydratedPoint(u.context.coordinateHelper.fromArray([u.originalPos.x,u.originalPos.y,u.originalPos.z]));a.x+=e.mapEnd.x-e.mapStart.x,a.y+=e.mapEnd.y-e.mapStart.y;var h=e.mapStart.x-u.originalPos.x,p=e.mapStart.y-u.originalPos.y,v=Object(n.a)(Object(n.a)({},e),{},{action:"udpate"}),f=u.context,b=o.update(a,u.context);if(e.mapEnd.x=b.x+h,e.mapEnd.y=b.y+p,"end"!==e.action){var g=u.frameTask;l=Object(_.h)(function(){var e=Object(O.a)(y.a.mark((function e(i){var n,r;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.schedule((function(){return o.snap(a,f,i)}),i);case 2:if(!(n=e.sent).valid){e.next=8;break}return e.next=6,g.schedule((function(){return n.apply()}),i);case 6:r=e.sent,Object(ut.a)(r,b)||(v.mapEnd.x=r.x+h,v.mapEnd.y=r.y+p,t.next.execute(v));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),c.addPromise(l.promise)}}return"end"===e.action&&d(),e}}}]),e}(),vt=i(443),ft=i(678),bt=i(851),mt=i(781),gt=i(693),yt=i(647),Ot=i(873),jt=i(714),_t=i(697),xt=i(719),wt=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e))._ray=Object(yt.c)(),n._externalResources=null,n._handles=new b.a,n._isWorldDown=!1,n._start=Object(V.e)(),n._end=Object(V.g)(1,0,0),n._width=1,n._color=Object(ft.c)(1,0,1,1),n._polygonOffset=!1,n._writeDepthEnabled=!0,n._innerWidth=0,n._innerColor=Object(ft.c)(1,1,1,1),n._stippleIntegerRepeats=!0,n._stipplePattern=null,n._stippleOffColor=null,n._falloff=0,n._extensionType=0,n._laserlineStyle=null,n._laserlineEnabled=!1,n._renderOccluded=4,n._fadedExtensions=Vt,n.applyProps(e),n}return Object(a.a)(i,[{key:"createExternalResources",value:function(){var e=this,t=new xt.a(this.materialParameters);this._handles.add(this.view.state.watch("camera",(function(){e.updateGeometry()})));var i=new Ot.a({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:t,laserline:i}}},{key:"destroyExternalResources",value:function(){Object(m.k)(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}},{key:"forEachExternalMaterial",value:function(e){Object(m.k)(this._externalResources)&&e(this._externalResources.material)}},{key:"createGeometries",value:function(e){var t=[Object(V.e)(),Object(V.e)()],i=3===this.extensionType;i&&t.push(Object(V.e)(),Object(V.e)());var n=i?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,r=_t.a.createPolylineGeometry(t,null,n);e.addGeometry(r,Object(m.r)(this._externalResources).material),this.updateVertices(r)}},{key:"updateVisibility",value:function(e){Object(v.a)(Object(f.a)(i.prototype),"updateVisibility",this).call(this,e),Object(m.k)(this._externalResources)&&(this._externalResources.laserline.visible=e)}},{key:"setStartEndFromWorldDownAtLocation",value:function(e){this._isWorldDown=!0,Object(Se.h)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),Object(Se.g)(this._end,e,this._end),Object(yt.e)(this._start,this._end,this._ray),this.updateGeometry()}},{key:"start",get:function(){return this._start},set:function(e){this._isWorldDown=!1,Object(Se.l)(this._start,e)||(Object(Se.h)(this._start,e),Object(yt.e)(this._start,this._end,this._ray),this.updateGeometry())}},{key:"end",get:function(){return this._end},set:function(e){this._isWorldDown=!1,Object(Se.l)(this._end,e)||(Object(Se.h)(this._end,e),Object(yt.e)(this._start,this._end,this._ray),this.updateGeometry())}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this.updateMaterial())}},{key:"color",get:function(){return this._color},set:function(e){Object(vt.g)(e,this._color)||(Object(vt.c)(this._color,e),this.updateMaterial())}},{key:"polygonOffset",get:function(){return this._polygonOffset},set:function(e){e!==this._polygonOffset&&(this._polygonOffset=e,this.updateMaterial())}},{key:"writeDepthEnabled",get:function(){return this._writeDepthEnabled},set:function(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this.updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(e){Object(vt.g)(e,this._innerColor)||(Object(vt.c)(this._innerColor,e),this.updateMaterial())}},{key:"stippleIntegerRepeats",get:function(){return this._stippleIntegerRepeats},set:function(e){e!==this._stippleIntegerRepeats&&(this._stippleIntegerRepeats=e,this.updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(e){var t=Object(m.k)(e)!==Object(m.k)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this.updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(e){(Object(m.j)(e)||Object(m.j)(this._stippleOffColor)||!Object(vt.g)(e,this._stippleOffColor))&&(this._stippleOffColor=Object(m.k)(e)?Object(ft.a)(e):null,this.updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}},{key:"extensionType",get:function(){return this._extensionType},set:function(e){e!==this._extensionType&&(this._extensionType=e,this.updateGeometry())}},{key:"_laserlineAttached",get:function(){return this._laserlineEnabled&&Object(m.k)(this._laserlineStyle)}},{key:"laserlineStyle",get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,Object(m.k)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,Object(m.k)(e)&&(this._externalResources.laserline.style=e))}},{key:"laserlineEnabled",get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,Object(m.k)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}},{key:"fadedExtensions",get:function(){return this._fadedExtensions},set:function(e){this._fadedExtensions=Object(m.s)(e,Vt),this.recreateGeometry()}},{key:"updateMaterial",value:function(){Object(m.j)(this._externalResources)||this._externalResources.material.setParameterValues(this.materialParameters)}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stippleIntegerRepeats:this._stippleIntegerRepeats,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}},{key:"updateGeometry",value:function(){Object(m.k)(this.object)&&this.updateVertices(this.object.geometries[0])}},{key:"updateVertices",value:function(e){var t=3===this._extensionType?this.updateLineSegmentFinite(Pt):this.updateLineSegmentInfinite(this._extensionType,Pt);this.updateVertexAttributes(e,t),Object(m.k)(this._externalResources)&&(this._externalResources.laserline.intersectsLine=t)}},{key:"updateLineSegmentFinite",value:function(e){return Object(gt.f)(this._start,this._end,e)}},{key:"updateLineSegmentInfinite",value:function(e,t){var i=this.view.state.camera;switch(Object(bt.c)(this._ray,kt),e){case 0:kt.c0=-Number.MAX_VALUE;break;case 1:case 2:var n=this._ray.origin,r=Object(m.s)(this.view.elevationProvider.getElevation(n[0],n[1],n[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),a=this.view.renderCoordsHelper.getAltitude(n);this._isWorldDown&&a<r&&Object(Se.p)(kt.ray.direction,kt.ray.direction),2===this._extensionType&&null!=r&&(kt.c1=Math.abs(a-r))}if(!Object(mt.d)(i.frustum,kt))return Object(gt.f)(this._start,this._end,t);var o=Object(bt.e)(kt,Tt),s=Object(bt.d)(kt,St);return Object(gt.f)(o,s,t)}},{key:"updateVertexAttributes",value:function(e,t){var i=e.getMutableAttribute("position").data;if(3===this.extensionType){var n=Object(gt.h)(t,-this.fadedExtensions.start,Tt);i[0]=n[0],i[1]=n[1],i[2]=n[2];var r=Object(gt.h)(t,0,Tt);i[3]=r[0],i[4]=r[1],i[5]=r[2];var a=Object(gt.h)(t,1,Tt);i[6]=a[0],i[7]=a[1],i[8]=a[2];var o=Object(gt.h)(t,1+this.fadedExtensions.end,Tt);i[9]=o[0],i[10]=o[1],i[11]=o[2]}else{var s=Object(gt.h)(t,0,Tt);i[0]=s[0],i[1]=s[1],i[2]=s[2];var c=Object(gt.h)(t,1,Tt);i[3]=c[0],i[4]=c[1],i[5]=c[2]}Object(m.k)(this.object)&&this.object.geometryVertexAttrsUpdated(0)}}]),i}(jt.a),kt=Object(bt.a)(),Tt=Object(V.e)(),St=Object(V.e)(),Pt=Object(gt.d)(),Ct=1/3,Vt={start:Ct,end:Ct},Mt=i(603),Dt=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e))._handles=new b.a,n._location=Object(V.e)(),n._direction=Object(V.g)(1,0,0),n._width=1,n._offset=1,n._length=18,n._color=Object(ft.c)(1,0,1,1),n._renderOccluded=4,n.applyProps(e),n}return Object(a.a)(i,[{key:"location",get:function(){return this._location},set:function(e){Object(Se.l)(this._location,e)||(Object(Se.h)(this._location,e),this.updateGeometry())}},{key:"direction",get:function(){return this._direction},set:function(e){Object(Se.l)(this._direction,e)||(Object(Se.h)(this._direction,e),this.updateGeometry())}},{key:"setDirectionFromPoints",value:function(e,t){Object(Se.o)(this._direction,Object(Se.g)(this._direction,t,e)),this.updateGeometry()}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this.updateMaterial())}},{key:"offset",get:function(){return this._offset},set:function(e){e!==this._offset&&(this._offset=e,this.updateGeometry())}},{key:"length",get:function(){return this._length},set:function(e){e!==this._length&&(this._length=e,this.updateGeometry())}},{key:"color",get:function(){return this._color},set:function(e){Object(vt.g)(e,this._color)||(Object(vt.c)(this._color,e),this.updateMaterial())}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}},{key:"createExternalResources",value:function(){var e=this,t=new xt.a(this.materialParameters);this._handles.add(this.view.state.watch("camera",(function(){e.updateGeometry()}))),this._externalResources={material:t}}},{key:"destroyExternalResources",value:function(){this._handles.removeAll(),this._externalResources=null}},{key:"createGeometries",value:function(e){var t=_t.a.createPolylineGeometry([Object(V.e)(),Object(V.e)()]),i=_t.a.createPolylineGeometry([Object(V.e)(),Object(V.e)()]),n=Object(m.r)(this._externalResources).material;e.addGeometry(t,n,Mt.a),e.addGeometry(i,n,Mt.a),this.updateVertices(e)}},{key:"forEachExternalMaterial",value:function(e){Object(m.k)(this._externalResources)&&e(this._externalResources.material)}},{key:"updateMaterial",value:function(){Object(m.j)(this._externalResources)||this._externalResources.material.setParameterValues(this.materialParameters)}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}},{key:"updateGeometry",value:function(){var e=this.object;Object(m.j)(e)||this.updateVertices(e)}},{key:"updateVertices",value:function(e){var t=this.view.state.camera;t.projectToScreen(this.location,zt),Object(Se.c)(Et,this.location,this.direction),t.projectToScreen(Et,Ht),Object(P.f)(Ht,Object(P.a)(Ht,Ht,zt)),this.updateVertexAttributes(t,e,0,zt,Ht,1),this.updateVertexAttributes(t,e,1,zt,Ht,-1)}},{key:"updateVertexAttributes",value:function(e,t,i,n,r,a){var o=t.geometryRecords[i].geometry.getMutableAttribute("position").data,s=Object(P.b)(At,Object(P.r)(At,r[1]*a,r[0]*-a),this.offset+this.width/2),c=Object(P.i)(It,Object(P.i)(It,Object(P.i)(It,n,Object(P.b)(It,r,this.length/2)),s),s),l=Object(P.i)(Rt,c,Object(P.b)(Rt,r,-this.length));e.unprojectFromScreen(c,Et),o[0]=Et[0],o[1]=Et[1],o[2]=Et[2],e.unprojectFromScreen(l,Et),o[3]=Et[0],o[4]=Et[1],o[5]=Et[2],t.geometryVertexAttrsUpdated(i)}}]),i}(jt.a),Et=Object(V.e)(),zt=Object(x.g)(),Ht=Object(x.g)(),At=Object(x.g)(),It=Object(x.g)(),Rt=Object(x.g)(),Gt=i(463),Lt=i(267),Ft=i(625),Ut=i(618),qt=i(30),Nt=i(743),Zt=i(768),Wt=function(){function e(t){Object(r.a)(this,e),this.resourceFactory=t,this._resources=null,this._visible=!0,this._attached=!1}return Object(a.a)(e,[{key:"destroy",value:function(){this._destroyResources()}},{key:"object",get:function(){return Object(m.k)(this._resources)?this._resources.object:null}},{key:"resources",get:function(){return Object(m.k)(this._resources)?this._resources.external:null}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this._syncVisible())}},{key:"attached",get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}},{key:"recreate",value:function(){this.attached&&this._createResources()}},{key:"recreateGeometry",value:function(){if(this.resourceFactory.recreateGeometry){var e=this.resourceFactory.view._stage;if(!Object(m.j)(this._resources)&&e){var t=this._resources.object;this._resources.external.forEach((function(t){2===t.type&&e.remove(t)})),t.removeAllGeometries();var i=this.resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer);e.addMany(i)}}else this.recreate()}},{key:"_createOrDestroyResources",value:function(){this._attached?this._resources||this._createResources():this._destroyResources()}},{key:"_createResources",value:function(){var e=this;this._destroyResources();var t=this.resourceFactory.view._stage;if(t){var i=new Zt.a({isPickable:!1,updatePolicy:1});t.add(i);var n=new Nt.a({castShadow:!1}),r=this.resourceFactory.createResources(n,i);r.forEach((function(e){return t.add(e)})),t.add(n),i.add(n),this._syncVisible();var a=this.resourceFactory.cameraChanged?Object(qt.a)(this.resourceFactory.view.state,"camera",(function(t){return e.resourceFactory.cameraChanged(t)})):null;this._resources={layer:i,object:n,external:r,cameraHandle:a}}}},{key:"_destroyResources",value:function(){if(!Object(m.j)(this._resources)){var e=this.resourceFactory.view._stage;null==e||e.remove(this._resources.object),null==e||e.remove(this._resources.layer),this._resources.external.forEach((function(t){null==e||e.remove(t),"dispose"in t&&t.dispose()})),this._resources.object.dispose(),this._resources.cameraHandle&&this._resources.cameraHandle.remove(),this._resources=null}}},{key:"_syncVisible",value:function(){Object(m.j)(this._resources)||this._resources.object.setVisible(this._visible)}}]),e}(),Bt=i(853),Xt=i(489),Yt=i(738),Qt=(i(136),d.a.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils"));function Kt(e){return null!=e.cachedResult}var Jt=function(){function e(){Object(r.a)(this,e),this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}return Object(a.a)(e,[{key:"featureExpressionInfoContext",get:function(){return this._featureExpressionInfoContext}},{key:"meterUnitOffset",get:function(){return this._meterUnitOffset}},{key:"unit",get:function(){return this._unit},set:function(e){this._unit=e,this._metersPerElevationInfoUnit=Object(Xt.a)(e)}},{key:"reset",value:function(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}},{key:"offsetMeters",set:function(e){this._meterUnitOffset=e,this._renderUnitOffset=0}},{key:"offsetElevationInfoUnits",set:function(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}},{key:"addOffsetRenderUnits",value:function(e){this._renderUnitOffset+=e}},{key:"geometryZWithOffset",value:function(e,t){var i=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?i:e+i}},{key:"calculateOffsetRenderUnits",value:function(e){var t=this._meterUnitOffset,i=this.featureExpressionInfoContext;return null!=i&&(t+=function(e){if(null!=e){if(Kt(e))return e.cachedResult;var t=e.arcade,i=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof i&&(e.cachedResult=0,i=0),i}return 0}(i)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}},{key:"setFromElevationInfo",value:function(e){this.mode=e.mode,this.unit=Object(Xt.c)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=Object(m.s)(e.offset,0)}},{key:"updateFeatureExpressionInfoContext",value:function(e,t,i){if(Object(m.j)(e))this._featureExpressionInfoContext=null;else{var n,r=e&&e.arcade;r&&Object(m.k)(t)&&Object(m.k)(i)?(this._featureExpressionInfoContext={cachedResult:(n=e).cachedResult,arcade:n.arcade?{func:n.arcade.func,context:n.arcade.modules.arcadeUtils.createExecContext(null,{sr:n.arcade.context.spatialReference}),modules:n.arcade.modules}:null},function(e,t){if(null!=e&&!Kt(e)){if(!t||!e.arcade)return void Qt.errorOncePerTick("Arcade support required but not provided");var i=t;i._geometry&&(i._geometry=Object(Yt.b)(i._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}(this._featureExpressionInfoContext,function(e,t,i){return e.arcadeUtils.createFeature(t.attributes,t.geometry,i)}(r.modules,t,i))):this._featureExpressionInfoContext=e}}}],[{key:"fromElevationInfo",value:function(t){var i=new e;return Object(m.k)(t)&&i.setFromElevationInfo(t),i}}]),e}(),$t=i(365);function ei(e,t,i){switch(e){case"circle":return ti(t,i);case"square":return function(e,t){return ii(e,t,!1)}(t,i);case"cross":return function(e,t){return ni(e,t,!1)}(t,i);case"x":return function(e,t){return ni(e,t,!0)}(t,i);case"kite":return function(e,t){return ii(e,t,!0)}(t,i);case"triangle":return function(e,t){for(var i=new Uint8Array(4*e*e),n=1,r=-.5,a=Math.sqrt(n*n+r*r),o=(e-t)/2,s=0;s<e;s++)for(var c=0;c<e;c++){var l=s*e+c,u=(c-o)/t,d=(s-o+.75)/t,h=-(n*u+r*d)/a,p=(n*(u-1)+r*-d)/a,v=-d,f=Math.max(h,p,v);Object($t.h)(f*t/e+.5,i,4*l)}return i}(t,i);default:return ti(t,i)}}function ti(e,t){for(var i=e,n=new Uint8Array(4*i*i),r=i/2-.5,a=t/2,o=0;o<i;o++)for(var s=0;s<i;s++){var c=s+i*o,l=s-r,u=o-r,d=Math.sqrt(l*l+u*u)-a;d=d/e+.5,Object($t.h)(d,n,4*c)}return n}function ii(e,t,i){i&&(t/=Math.SQRT2);for(var n=new Uint8Array(4*e*e),r=0;r<e;r++)for(var a=0;a<e;a++){var o=a-.5*e+.25,s=.5*e-r-.75,c=r*e+a;if(i){var l=(o+s)/Math.SQRT2;s=(s-o)/Math.SQRT2,o=l}var u=Math.max(Math.abs(o),Math.abs(s))-.5*t;u=u/e+.5,Object($t.h)(u,n,4*c)}return n}function ni(e,t,i){i&&(t*=Math.SQRT2);for(var n=.5*t,r=new Uint8Array(4*e*e),a=0;a<e;a++)for(var o=0;o<e;o++){var s=o-.5*e,c=.5*e-a-1,l=a*e+o;if(i){var u=(s+c)/Math.SQRT2;c=(c-s)/Math.SQRT2,s=u}var d=void 0;d=(d=(s=Math.abs(s))>(c=Math.abs(c))?s>n?Math.sqrt((s-n)*(s-n)+c*c):c:c>n?Math.sqrt(s*s+(c-n)*(c-n)):s)/e+.5,Object($t.h)(d,r,4*l)}return r}var ri=i(792),ai=i(146),oi=i(616),si=i(236);function ci(e){return(t=e)instanceof Float32Array&&t.length>=16||function(e){return Array.isArray(e)&&e.length>=16}(e);var t}var li=i(142),ui=i(700),di=i(759),hi=i(817),pi=i(716),vi=i(914),fi=i(783),bi=i(694),mi=i(737),gi=i(739),yi=i(626),Oi=i(740),ji=i(784),_i=i(674),xi=i(818),wi=i(636),ki=i(705),Ti=i(707),Si=i(717),Pi=i(672),Ci=i(680),Vi=i(681),Mi=i(688),Di=i(706),Ei=i(673),zi=i(467),Hi=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(){return Object(r.a)(this,i),t.apply(this,arguments)}return Object(a.a)(i,[{key:"initializeProgram",value:function(e){var t=i.shader.get(),n=this.configuration,r=t.build({output:n.output,FrontFacePass:2===n.transparencyPassType,viewingMode:e.viewingMode,occlusionTestEnabled:n.occlusionTestEnabled,signedDistanceFieldEnabled:n.sdf,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawBorder:n.debugDrawBorder,binaryHighlightOcclusionEnabled:n.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:n.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:n.screenSizePerspective,verticalOffsetEnabled:n.verticalOffset,pixelSnappingEnabled:n.pixelSnappingEnabled,vvSize:n.vvSize,vvColor:n.vvColor,vvInstancingEnabled:!1,isDraped:n.isDraped,multipassGeometryEnabled:n.multipassGeometryEnabled,multipassTerrainEnabled:n.multipassTerrainEnabled,cullAboveGround:n.cullAboveGround});return new Ei.a(e.rctx,r,Mi.a)}},{key:"bindPass",value:function(e,t){Object(Si.b)(this.program,t.camera.projectionMatrix),this.program.setUniform1f("cameraGroundRelative",t.camera.aboveGround?1:-1),this.program.setUniform1f("perDistancePixelRatio",Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix),this.program.setUniform1f("polygonOffset",e.shaderPolygonOffset),Object(Oi.b)(this.program,e,t),Object(Ti.b)(this.program,e),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio||1),Object(Si.e)(this.program,t),6===this.configuration.output?(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(xi.a)(this.program,t),Object(wi.a)(this.program,t)):(Object(ji.b)(this.program,t),Object(gi.c)(this.program,e,t.camera.pixelRatio||1),Object(ki.b)(this.program,e),this.configuration.occlusionTestEnabled&&this.program.bindTexture(t.hudVisibilityTexture,"hudVisibilityTexture")),4===this.configuration.output&&Object(_i.b)(this.program,t)}},{key:"bindDraw",value:function(e){Object(Si.c)(this.program,e),Object(Si.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(yi.c)(this.program,this.configuration,e),this.program.rebindTextures()}},{key:"setPipelineState",value:function(e){var t=this.configuration,i=3===e,n=2===e,r=this.configuration.polygonOffsetEnabled&&Ai,a=(i||n)&&4!==t.output?(t.depthEnabled||6===t.output)&&zi.d:null;return Object(zi.e)({blending:0===t.output||7===t.output||4===t.output?i?Ii:Object(Di.a)(e):null,depthTest:{func:515},depthWrite:a,colorWrite:zi.c,polygonOffset:r})}},{key:"initializePipeline",value:function(){return this.setPipelineState(this.configuration.transparencyPassType)}},{key:"primitiveType",get:function(){return 6===this.configuration.output?0:4}}]),i}(Ci.a);Hi.shader=new Pi.a(gi.a,(function(){return i.e(192).then(i.bind(null,1176))}));var Ai={factor:0,units:-4},Ii=Object(zi.g)(1,771),Ri=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(){var e;return Object(r.a)(this,i),(e=t.apply(this,arguments)).output=0,e.occlusionTestEnabled=!0,e.sdf=!1,e.vvSize=!1,e.vvColor=!1,e.verticalOffset=!1,e.screenSizePerspective=!1,e.screenCenterOffsetUnitsEnabled=0,e.debugDrawBorder=!0,e.binaryHighlightOcclusion=!0,e.slicePlaneEnabled=!1,e.polygonOffsetEnabled=!1,e.depthEnabled=!0,e.transparencyPassType=3,e.pixelSnappingEnabled=!0,e.isDraped=!1,e.multipassGeometryEnabled=!1,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return i}(Vi.a);Object(c.a)([Object(Vi.b)({count:8})],Ri.prototype,"output",void 0),Object(c.a)([Object(Vi.b)()],Ri.prototype,"occlusionTestEnabled",void 0),Object(c.a)([Object(Vi.b)()],Ri.prototype,"sdf",void 0),Object(c.a)([Object(Vi.b)()],Ri.prototype,"vvSize",void 0),Object(c.a)([Object(Vi.b)()],Ri.prototype,"vvColor",void 0),Object(c.a)([Object(Vi.b)()],Ri.prototype,"verticalOffset",void 0),Object(c.a)([Object(Vi.b)()],Ri.prototype,"screenSizePerspective",void 0),Object(c.a)([Object(Vi.b)({count:2})],Ri.prototype,"screenCenterOffsetUnitsEnabled",void 0),Object(c.a)([Object(Vi.b)()],Ri.prototype,"debugDrawBorder",void 0),Object(c.a)([Object(Vi.b)()],Ri.prototype,"binaryHighlightOcclusion",void 0),Object(c.a)([Object(Vi.b)()],Ri.prototype,"slicePlaneEnabled",void 0),Object(c.a)([Object(Vi.b)()],Ri.prototype,"polygonOffsetEnabled",void 0),Object(c.a)([Object(Vi.b)()],Ri.prototype,"depthEnabled",void 0),Object(c.a)([Object(Vi.b)({count:4})],Ri.prototype,"transparencyPassType",void 0),Object(c.a)([Object(Vi.b)()],Ri.prototype,"pixelSnappingEnabled",void 0),Object(c.a)([Object(Vi.b)()],Ri.prototype,"isDraped",void 0),Object(c.a)([Object(Vi.b)()],Ri.prototype,"multipassGeometryEnabled",void 0),Object(c.a)([Object(Vi.b)()],Ri.prototype,"multipassTerrainEnabled",void 0),Object(c.a)([Object(Vi.b)()],Ri.prototype,"cullAboveGround",void 0);var Gi=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e,ln)).techniqueConfig=new Ri,n}return Object(a.a)(i,[{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.verticalOffset=!!this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0,this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset,this.techniqueConfig.isDraped=this.params.isDraped,this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.params.pixelSnappingEnabled,this.techniqueConfig.sdf=this.params.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.params.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.params.vvColorEnabled,0===e&&(this.techniqueConfig.debugDrawBorder=!!this.params.debugDrawBorder),4===e&&(this.techniqueConfig.binaryHighlightOcclusion=this.params.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.params.depthEnabled,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassGeometryEnabled=!!t&&t.multipassGeometryEnabled,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}},{key:"intersect",value:function(e,t,i,n,r,a,o,s,c){c?this.intersectDrapedHudGeometry(e,a,o,s):this.intersectHudGeometry(e,t,i,n,o,s)}},{key:"intersectDrapedHudGeometry",value:function(e,t,i,n){var r=e.vertexAttributes.get("position"),a=e.vertexAttributes.get("size"),o=this.params,s=Object(gi.d)(o),c=1,l=1;if(Object(m.k)(n)){var u=n(rn);c=u[0],l=u[5]}c*=e.screenToWorldRatio,l*=e.screenToWorldRatio;for(var d=on*e.screenToWorldRatio,h=0;h<r.data.length/r.size;h++){var p=h*r.size,v=r.data[p],f=r.data[p+1],b=h*a.size,g=void 0;sn[0]=a.data[b]*c,sn[1]=a.data[b+1]*l,o.textureIsSignedDistanceField&&(g=o.outlineSize*e.screenToWorldRatio/2),Ni(t,v,f,sn,d,g,o,s)&&i()}}},{key:"intersectHudGeometry",value:function(e,t,i,n,r,a){if(n.options.selectionMode&&n.options.hud&&!Object(mi.d)(t)){var o=this.params,s=1,c=1;if(Object(ai.e)(Ji,i),Object(m.k)(a)){var l=a(rn);s=l[0],c=l[5],function(e){var t=e[0],i=e[1],n=e[2],r=e[3],a=e[4],o=e[5],s=e[6],c=e[7],l=e[8],u=1/Math.sqrt(t*t+i*i+n*n),d=1/Math.sqrt(r*r+a*a+o*o),h=1/Math.sqrt(s*s+c*c+l*l);e[0]=t*u,e[1]=i*u,e[2]=n*u,e[3]=r*d,e[4]=a*d,e[5]=o*d,e[6]=s*h,e[7]=c*h,e[8]=l*h}(Ji)}var u=e.vertexAttributes.get("position"),d=e.vertexAttributes.get("size"),h=e.vertexAttributes.get("normal"),p=e.vertexAttributes.get("auxpos1");Object($t.a)(u.size>=3);var v=n.point,f=n.camera,b=Object(gi.d)(o);s*=f.pixelRatio,c*=f.pixelRatio;for(var g="screen"===this.params.centerOffsetUnits,y=0;y<u.data.length/u.size;y++){var O=y*u.size;Object(Se.t)(Bi,u.data[O],u.data[O+1],u.data[O+2]),Object(Se.n)(Bi,Bi,i);var j=y*d.size;sn[0]=d.data[j]*s,sn[1]=d.data[j+1]*c,Object(Se.n)(Bi,Bi,f.viewMatrix);var _=y*p.size;if(Object(Se.t)(tn,p.data[_+0],p.data[_+1],p.data[_+2]),!g&&(Bi[0]+=tn[0],Bi[1]+=tn[1],0!==tn[2])){var x=tn[2];Object(Se.o)(tn,Bi),Object(Se.g)(Bi,Bi,Object(Se.b)(tn,tn,x))}var w=y*h.size;if(Object(Se.t)(Xi,h.data[w],h.data[w+1],h.data[w+2]),this.normalAndViewAngle(Xi,Ji,f,nn),this.applyVerticalOffsetTransformationView(Bi,nn,f,Zi),f.applyProjection(Bi,Yi),Yi[0]>-1){var k=Math.floor(Yi[0])+this.params.screenOffset[0],T=Math.floor(Yi[1])+this.params.screenOffset[1];g&&(k+=tn[0],0!==tn[1]&&(T+=Object(vi.b)(tn[1],Zi.factorAlignment))),Object(vi.a)(sn,Zi.factor,sn);var S=an*f.pixelRatio,P=void 0;if(o.textureIsSignedDistanceField&&(P=o.outlineSize*f.pixelRatio/2),Ni(v,k,T,sn,S,P,o,b)){var C=n.ray;if(Object(Se.n)(Ki,Bi,Object(si.a)(en,f.viewMatrix)),Yi[0]=v[0],Yi[1]=v[1],f.unprojectFromRenderScreen(Yi,Bi)){var M=Object(V.e)();Object(Se.h)(M,C.direction);var D=1/Object(Se.m)(M);Object(Se.b)(M,M,D),r(Object(Se.j)(C.origin,Bi)*D,M,-1,1,!0,Ki)}}}}}}},{key:"computeAttachmentOrigin",value:function(e,t){var i=e.vertexAttributes;if(!i)return!1;var n=i.get("position"),r=e.indices.get("position");return Object(di.b)(n,r,t)}},{key:"createBufferWriter",value:function(){return new dn(this)}},{key:"normalAndViewAngle",value:function(e,t,i,n){return ci(t)&&(t=Object(ai.e)($i,t)),Object(Se.u)(n.normal,e,t),Object(Se.n)(n.normal,n.normal,i.viewInverseTransposeMatrix),n.cosAngle=Object(Se.e)(Qi,cn),n}},{key:"updateScaleInfo",value:function(e,t,i){var n=this.params;n.screenSizePerspective?Object(vi.c)(i,t,n.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),n.screenSizePerspectiveAlignment?Object(vi.c)(i,t,n.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}},{key:"applyShaderOffsetsView",value:function(e,t,i,n,r,a,o){var s=this.normalAndViewAngle(t,i,r,nn);return this.applyVerticalGroundOffsetView(e,s,r,o),this.applyVerticalOffsetTransformationView(o,s,r,a),this.applyPolygonOffsetView(o,s,n[3],r,o),this.applyCenterOffsetView(o,n,o),o}},{key:"applyShaderOffsetsNDC",value:function(e,t,i,n,r){return this.applyCenterOffsetNDC(e,t,i,n),Object(m.k)(r)&&Object(Se.h)(r,n),this.applyPolygonOffsetNDC(n,t,i,n),n}},{key:"applyPolygonOffsetView",value:function(e,t,i,n,r){var a=n.aboveGround?1:-1,o=Object(Te.s)(i);0===o&&(o=a);var s=a*o;if(this.params.shaderPolygonOffset<=0)return Object(Se.h)(r,e);var c=Object(Te.e)(Math.abs(t.cosAngle),.01,1),l=1-Math.sqrt(1-c*c)/c/n.viewport[2];return Object(Se.b)(r,e,s>0?l:1/l),r}},{key:"applyVerticalGroundOffsetView",value:function(e,t,i,n){var r=Object(Se.m)(e),a=i.aboveGround?1:-1,o=.5*i.computeRenderPixelSizeAtDist(r),s=Object(Se.b)(Bi,t.normal,a*o);return Object(Se.c)(n,e,s),n}},{key:"applyVerticalOffsetTransformationView",value:function(e,t,i,n){var r=this.params;if(!r.verticalOffset||!r.verticalOffset.screenLength){if(r.screenSizePerspective||r.screenSizePerspectiveAlignment){var a=Object(Se.m)(e);this.updateScaleInfo(n,a,t.cosAngle)}else n.factor.scale=1,n.factorAlignment.scale=1;return e}var o=Object(Se.m)(e),s=r.screenSizePerspectiveAlignment||r.screenSizePerspective,c=Object(bi.f)(i,o,r.verticalOffset,t.cosAngle,s);return this.updateScaleInfo(n,o,t.cosAngle),Object(Se.b)(t.normal,t.normal,c),Object(Se.c)(e,e,t.normal)}},{key:"applyCenterOffsetView",value:function(e,t,i){var n="screen"!==this.params.centerOffsetUnits;return i!==e&&Object(Se.h)(i,e),n&&(i[0]+=t[0],i[1]+=t[1],t[2]&&(Object(Se.o)(Xi,i),Object(Se.c)(i,i,Object(Se.b)(Xi,Xi,t[2])))),i}},{key:"applyCenterOffsetNDC",value:function(e,t,i,n){var r="screen"!==this.params.centerOffsetUnits;return n!==e&&Object(Se.h)(n,e),r||(n[0]+=t[0]/i.fullWidth*2,n[1]+=t[1]/i.fullHeight*2),n}},{key:"applyPolygonOffsetNDC",value:function(e,t,i,n){var r=this.params.shaderPolygonOffset;if(e!==n&&Object(Se.h)(n,e),r){var a=i.aboveGround?1:-1,o=a*Object(Te.s)(t[3]);n[2]-=(o||a)*r}return n}},{key:"getGLMaterial",value:function(e){return 0===e.output||7===e.output?new Fi(e):4===e.output?new Ui(e):void 0}},{key:"calculateRelativeScreenBounds",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(li.h)();return qi(this.params,e,t,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}}]),i}(pi.a),Li=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e){var a;return Object(r.a)(this,i),(a=t.call(this,Object(n.a)(Object(n.a)({},e),e.material.params))).updateParameters(),a}return Object(a.a)(i,[{key:"beginSlot",value:function(e){return e===(this._material.params.drawInSecondSlot?19:18)}},{key:"updateParameters",value:function(e){this.updateTexture(this._material.params.textureId),this.selectProgram(e)}},{key:"selectProgram",value:function(e){this._technique=this._techniqueRep.releaseAndAcquire(Hi,this._material.getTechniqueConfig(this._output,e),this._technique)}},{key:"ensureParameters",value:function(e){this.updateParameters(e)}},{key:"bind",value:function(e){this.bindTextures(this._technique.program),this.bindTextureScale(this._technique.program),this._technique.bindPass(this._material.params,e)}}]),i}(hi.a),Fi=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e))._isOcclusionSlot=!1,n}return Object(a.a)(i,[{key:"beginSlot",value:function(e){var t=this._material.params.drawInSecondSlot?19:18;return this._material.params.occlusionTest?(this._isOcclusionSlot=12===e,12===e||e===t):(this._isOcclusionSlot=!1,e===t)}},{key:"technique",get:function(){return this._isOcclusionSlot?this._occlusionTechnique:this._technique}},{key:"selectProgram",value:function(e){this._technique=this._techniqueRep.releaseAndAcquire(Hi,this._material.getTechniqueConfig(this._output,e),this._technique),this._occlusionTechnique=this._techniqueRep.releaseAndAcquire(Hi,this._material.getTechniqueConfig(6,e),this._occlusionTechnique)}},{key:"bind",value:function(e){var t=this.technique;this._isOcclusionSlot||(this.bindTextures(t.program),this.bindTextureScale(t.program)),t.bindPass(this._material.params,e)}}]),i}(Li),Ui=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e){return Object(r.a)(this,i),t.call(this,Object(n.a)(Object(n.a)({},e),{},{output:4}))}return i}(Li);function qi(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Wi;return Object(P.c)(n,e.anchorPos),n[0]*=-t[0],n[1]*=-t[1],n[0]+=e.screenOffset[0]*i,n[1]+=e.screenOffset[1]*i,n}function Ni(e,t,i,n,r,a,o,s){var c=t-r-(s[0]>0?n[0]*s[0]:0),l=c+n[0]+2*r,u=i-r-(s[1]>0?n[1]*s[1]:0),d=u+n[1]+2*r;if(o.textureIsSignedDistanceField){var h=o.distanceFieldBoundingBox;c+=n[0]*h[0],u+=n[1]*h[1],l-=n[0]*(1-h[2]),d-=n[1]*(1-h[3]),c-=a,l+=a,u-=a,d+=a}return e[0]>c&&e[0]<l&&e[1]>u&&e[1]<d}var Zi={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},Wi=Object(C.a)(),Bi=Object(V.e)(),Xi=Object(V.e)(),Yi=Object(x.e)(),Qi=Object(V.e)(),Ki=Object(V.e)(),Ji=Object(oi.b)(),$i=Object(oi.b)(),en=Object(Mt.d)(),tn=Object(V.e)(),nn={normal:Qi,cosAngle:0},rn=Object(Mt.d)(),an=1,on=2,sn=[0,0],cn=Object(V.g)(0,0,1),ln=Object(n.a)({texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:Object(C.e)(.5,.5),shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,pixelSnappingEnabled:!0,debugDrawBorder:!1,isDraped:!1},pi.b),un=Object(ui.a)().vec3f("position").vec3f("normal").vec2f("uv0").vec4u8("color").vec2f("size").vec4f("auxpos1").vec4f("auxpos2"),dn=function(){function e(t){Object(r.a)(this,e),this.material=t,this.vertexBufferLayout=un}return Object(a.a)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return 6*e.indices.get("position").length}},{key:"write",value:function(e,t,i,n){Object(fi.e)(t.indices.get("position"),t.vertexAttributes.get("position").data,e.transformation,i.position,n,6),Object(fi.d)(t.indices.get("normal"),t.vertexAttributes.get("normal").data,e.invTranspTransformation,i.normal,n,6);var r,a,o,s,c=t.vertexAttributes.get("uv0").data;if(null==c||c.length<4){var l=this.material.params;r=0,a=0,o=l.texCoordScale[0],s=l.texCoordScale[1]}else r=c[0],a=c[1],o=c[2],s=c[3];o=Math.min(1.99999,o+1),s=Math.min(1.99999,s+1);for(var u=t.indices.get("position").length,d=i.uv0,h=n,p=0;p<u;++p)d.set(h,0,r),d.set(h,1,a),h+=1,d.set(h,0,o),d.set(h,1,a),h+=1,d.set(h,0,o),d.set(h,1,s),h+=1,d.set(h,0,o),d.set(h,1,s),h+=1,d.set(h,0,r),d.set(h,1,s),h+=1,d.set(h,0,r),d.set(h,1,a),h+=1;Object(fi.b)(t.indices.get("color"),t.vertexAttributes.get("color").data,4,i.color,n,6);for(var v=t.indices.get("size"),f=t.vertexAttributes.get("size").data,b=v.length,m=i.size,g=n,y=0;y<b;++y)for(var O=f[2*v[y]],j=f[2*v[y]+1],_=0;_<6;++_)m.set(g,0,O),m.set(g,1,j),g+=1;t.indices.get("auxpos1")&&t.vertexAttributes.get("auxpos1")&&Object(fi.a)(t.indices.get("auxpos1"),t.vertexAttributes.get("auxpos1").data,i.auxpos1,n,6),t.indices.get("auxpos2")&&t.vertexAttributes.get("auxpos2")&&Object(fi.a)(t.indices.get("auxpos2"),t.vertexAttributes.get("auxpos2").data,i.auxpos2,n,6)}}]),e}(),hn=function(){function e(t){var i=this;Object(r.a)(this,e),this.view=null,this._geometry=null,this._size=3,this._color=Object(Gt.g)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=Object(Gt.g)(1,1,1,1),this._elevationInfo=null,this.resources=new Wt({view:t.view,createResources:function(e){return i.createResources(e)},recreateGeometry:function(e,t){return e.geometry=i.recreateGeometry(t,e.material),Object(m.k)(e.geometry)?[e.geometry]:[]}});var n=!0;for(var a in t)a in this?"attached"===a?n=t[a]:this[a]=t[a]:console.error("Cannot set unknown property",a);this.attached=n}return Object(a.a)(e,[{key:"destroy",value:function(){this.resources.destroy()}},{key:"visible",get:function(){return this.resources.visible},set:function(e){this.resources.visible=e}},{key:"attached",get:function(){return this.resources.attached},set:function(e){this.resources.attached=e}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.resources.recreateGeometry()}},{key:"size",get:function(){return this._size},set:function(e){if(e!==this._size){var t=this.preferredTextureSize;this._size=e,t<this.preferredTextureSize?Object(m.k)(this.resources)&&this.resources.recreate():this.updateSizeAttribute()}}},{key:"color",get:function(){return this._color},set:function(e){Object(vt.g)(e,this._color)||(Object(vt.c)(this._color,e),this.updateMaterial())}},{key:"pixelSnappingEnabled",get:function(){return this._pixelSnappingEnabled},set:function(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this.updateMaterial())}},{key:"primitive",get:function(){return this._primitive},set:function(e){this._primitive!==e&&(this._primitive=e,Object(m.k)(this.resources)&&this.resources.recreate())}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateMaterial())}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){Object(vt.g)(e,this._outlineColor)||(Object(vt.c)(this._outlineColor,e),this.updateMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.resources&&this.resources.recreateGeometry()}},{key:"updateMaterial",value:function(){var e=this.resources.resources;Object(m.j)(e)||e.material.setParameterValues(this.materialParameters(e.texture.id))}},{key:"updateSizeAttribute",value:function(){var e=this.resources.resources,t=this.resources.object;if(!Object(m.j)(e)&&!Object(m.j)(t)){var i=e.geometry;if(!Object(m.j)(i)){var n=i.getMutableAttribute("size").data,r=this.geometrySize;n[0]=r,n[1]=r,t.geometryVertexAttrsUpdated(0)}}}},{key:"materialParameters",value:function(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:vn,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled}}},{key:"geometrySize",get:function(){return this._size/pn}},{key:"recreateGeometry",value:function(e,t){var i=this.createRenderGeometry();return Object(m.k)(i)&&e.addGeometry(i,t),i}},{key:"createResources",value:function(e){var t=this.createTexture(),i=new Gi(this.materialParameters(t.id)),n=this.recreateGeometry(e,i);return{material:i,texture:t,geometry:n,forEach:function(e){e(t),e(i),Object(m.k)(this.geometry)&&e(this.geometry)}}}},{key:"preferredTextureSize",get:function(){return Object(Te.e)(Object(Te.p)(2*this.geometrySize),16,128)}},{key:"createTexture",value:function(){var e=this.preferredTextureSize;return new ri.a(ei(this._primitive,e,e*pn),{mipmap:!1,wrap:{s:33071,t:33071},width:e,height:e,components:4,noUnpackFlip:!0})}},{key:"calculateMapBounds",value:function(e){if(Object(m.j)(this.resources.resources)||Object(m.j)(this.resources.resources.geometry))return!1;var t=this.resources.resources.geometry.vertexAttributes.get("position");return Object(Lt.r)(t.data,this.view.renderCoordsHelper.spatialReference,fn,this.view.spatialReference),Object(Ft.g)(e,fn),!0}},{key:"createRenderGeometry",value:function(){var e=this.geometry;if(Object(m.j)(e))return null;var t=this.view,i=t.renderCoordsHelper,n=t.elevationProvider,r=Object(Bt.b)(e,n,Jt.fromElevationInfo(this.elevationInfo),i),a=Object(Se.t)(Ut.c.get(),e.x,e.y,r),o=Ut.c.get();Object(Lt.r)(a,e.spatialReference,o,i.spatialReference);var s=this.geometrySize;return _t.a.createPointGeometry(null,o,null,[s,s],[0,0,0,1])}}]),e}(),pn=.5,vn=[pn/2,pn/2,1-pn/2,1-pn/2],fn=Object(V.e)(),bn=i(819),mn=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(){return Object(r.a)(this,i),t.apply(this,arguments)}return Object(a.a)(i,[{key:"visualizeIntersectionPoint",value:function(e,t){var i=t.coordinateHelper,n=t.elevationInfo,r=t.view;return Object(S.a)(new hn({view:r,primitive:"circle",geometry:i.createPoint(e.intersectionPoint),elevationInfo:n,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:M.a.toUnitRGBA(U.orange),pixelSnappingEnabled:!1}))}},{key:"visualizePoint",value:function(e,t){var i=t.coordinateHelper,n=t.elevationInfo,r=t.view;return Object(S.a)(new hn({view:r,primitive:"circle",geometry:i.createPoint(e.point),elevationInfo:n,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:M.a.toUnitRGBA(U.orange),pixelSnappingEnabled:!1}))}},{key:"visualizeLine",value:function(e,t){var i=t.coordinateHelper,n=t.elevationInfo,r=t.view;return Object(S.a)(this.createLineSegmentHintFromMap(e.type,e.lineStart,e.lineEnd,i,n,r,e.fadeLeft,e.fadeRight))}},{key:"visualizeParallelSign",value:function(e,t){var i=t.coordinateHelper,n=t.elevationInfo,r=t.view,a=B(e.lineStart,i,n,t.view),o=B(e.lineEnd,i,n,t.view),s=Object(Se.f)(o,a,o,.5),c=new Dt({view:r,attached:!1,offset:U.parallelLineHintOffset,length:U.parallelLineHintLength,width:U.parallelLineHintWidth,color:M.a.toUnitRGBA(U.orange),location:s,renderOccluded:16});return c.setDirectionFromPoints(a,s),c.attached=!0,Object(S.a)(c)}},{key:"visualizeRightAngleQuad",value:function(e,t){var i=t.coordinateHelper,n=t.elevationInfo,r=t.view;return Object(S.a)(new bn.a({view:r,attached:!0,color:M.a.toUnitRGBA(U.orange),renderOccluded:2,outlineRenderOccluded:16,outlineColor:M.a.toUnitRGBA(U.orange),outlineSize:U.rightAngleHintOutlineSize,size:U.rightAngleHintSize,geometry:{previous:B(e.previousVertex,i,n,r),center:B(e.centerVertex,i,n,r),next:B(e.nextVertex,i,n,r)}}))}},{key:"createLineSegmentHintFromMap",value:function(e,t,i,n,r,a){var o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],s=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],c=Object(V.e)(),l=Object(V.e)();return X(t,i,n,r,a,c,l),this.createLineSegmentHint(e,a,c,l,o,s)}},{key:"createLineSegmentHint",value:function(e,t,i,n){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=new wt({view:t,extensionType:3,start:i,end:n,color:M.a.toUnitRGBA(U.orange),renderOccluded:16});switch(e){case 0:o.width=U.lineHintWidthTarget,o.fadedExtensions={start:0,end:U.lineHintFadedExtensions};break;case 2:o.width=U.lineHintWidthReference,o.fadedExtensions={start:0,end:0};break;case 1:o.width=U.lineHintWidthReference,o.fadedExtensions={start:r?U.lineHintFadedExtensions:0,end:a?U.lineHintFadedExtensions:0}}return o.attached=!0,o}}]),i}(te),gn=function(){function e(t){var i=t.grabbableForEvent;Object(r.a)(this,e),this.events=new j.a,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.grabbableForEvent=i}return Object(a.a)(e,[{key:"intersectionDistance",value:function(e,t){return 0}},{key:"attach",value:function(){}},{key:"detach",value:function(){}}]),e}(),yn=["freehand","hybrid","click"],On="click",jn=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e))._manipulator=null,n._stagedVertex=null,n.elevationInfo=null,n.snapToSceneEnabled=null,n._handles=new b.a,n._snappingPipeline=new pt,n._createOperationCompleted=!1,n._pointerDownStates=new Set,n._snappingTask=null,n}return Object(a.a)(i,[{key:"drawingMode",set:function(e){this._set("drawingMode",null!=e?e:On)}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"isCompleted",get:function(){return this._createOperationCompleted}},{key:"_snappingEnabled",get:function(){return Object(m.k)(this.snappingManager)&&this.snappingManager.options.effectiveEnabled}},{key:"initialize",value:function(){var e,t,i=this;this.coordinateHelper=Object(me.a)(this.hasZ,this.hasM,this.view.spatialReference,this.view.viewingMode);var r=null==(e=this.view)||null==(t=e.resourceController)?void 0:t.scheduler;this._frameTask=r?r.registerTask(ht.b.SNAPPING):ht.a,this._editGeometry=new qe(new ge.c(this.coordinateHelper),"segment"===this.geometryType?"polyline":this.geometryType),this._activeComponent=new ge.a(this._editGeometry.editGeometry),this._editGeometry.editGeometry.components.push(this._activeComponent),this._editGeometry.on(["vertex-add","vertex-update","vertex-remove"],(function(e){var t=e.vertices.map((function(e){return{componentIndex:0,vertexIndex:e.index,coordinates:i.coordinateHelper.toArray(e.pos)}})),r=t.map((function(e){return e.coordinates}));switch(e.type){case"vertex-add":i.emit(e.type,Object(n.a)(Object(n.a)({},e),{},{added:r,vertices:t}));break;case"vertex-update":i.emit(e.type,Object(n.a)(Object(n.a)({},e),{},{updated:r,vertices:t}));break;case"vertex-remove":i.emit(e.type,Object(n.a)(Object(n.a)({},e),{},{removed:r,vertices:t}))}})),this._manipulator=new gn({grabbableForEvent:function(e){return"click"!==i.drawingMode||"touch"===e.pointerType&&i._snappingEnabled&&1===i._pointerDownStates.size}}),this.manipulators.add(this._manipulator),this._manipulator.grabbable="point"!==this.geometryType;var a=this.createManipulatorDragPipeline(this._manipulator),o=this._manipulator.events.on("immediate-double-click",(function(e){i._manipulator.dragging||"point"===i.geometryType||(i.complete(),e.stopPropagation())})),s=this._manipulator.events.on("immediate-click",(function(e){if(!i._manipulator.dragging){var t=i._activeComponent,n=i._closeOnClickVertexIndex(e.screenPoint);if(Object(m.k)(n))i.discardStagedVertex(),i.complete();else{var r=i._screenToMap(e.screenPoint);if(Object(m.k)(r))switch(i.drawingMode){case"freehand":"point"===i.geometryType&&(i.hasStagedVertex?i.commitStagedVertex():i._editGeometry.appendVertex(i.coordinateHelper.fromPoint(r)),i.complete());break;case"click":case"hybrid":i._snappingTask=Object(m.a)(i._snappingTask),i.hasStagedVertex?i.commitStagedVertex():i._editGeometry.appendVertex(i.coordinateHelper.fromPoint(r)),("point"===i.geometryType||"segment"===i.geometryType&&2===t.vertices.length||"segment"===i.geometryType&&"hybrid"===i.drawingMode&&1===t.vertices.length)&&i.complete()}}e.stopPropagation()}}));this._handles.add([a,s,o])}},{key:"createManipulatorDragPipeline",value:function(e){switch(this.drawingMode){case"click":return this.createManipulatorDragPipelineClick(e);case"freehand":return this.createManipulatorDragPipelineFreehand(e);case"hybrid":return this.createManipulatorDragPipelineHybrid(e)}}},{key:"createManipulatorDragPipelineClick",value:function(e){var t=this;return Object(dt.b)(e,(function(e,i,n,r){var a="touch"===r&&t._snappingEnabled;!t.isCompleted&&a&&(i.next(t._screenToMapDragEventStep()).next((function(e){return"start"===e.action&&(t.stagedVertex=e.mapStart,("segment"===t.geometryType||a&&0===t.numVertices)&&t.commitStagedVertex()),e})).next(t._snappingPipeline.createSnapDragEventPipelineStep({predicate:function(){return a},cancel:n,snappingManager:t.snappingManager,snappingContext:new Ne({geometry:t._editGeometry,elevationInfo:t.elevationInfo,pointer:r,visualizer:new mn}),updatingHandles:t.updatingHandles}),t._snappingPipeline.next).next((function(e){return a&&(t.stagedVertex=e.mapEnd,"end"===e.action&&t.commitStagedVertex()),e})).next((function(e){return"end"===e.action&&("segment"!==t.geometryType&&"point"!==t.geometryType||t.complete()),e})),n.next((function(){a&&Object(m.k)(t.snappingManager)&&t.snappingManager.doneSnapping()})))}))}},{key:"createManipulatorDragPipelineFreehand",value:function(e){var t=this;return Object(dt.b)(e,(function(e,i){t.isCompleted||i.next(t._screenToMapDragEventStep()).next((function(e){return"start"===e.action&&(t.stagedVertex=e.mapStart,"segment"===t.geometryType&&t.commitStagedVertex()),e})).next((function(e){switch(e.action){case"start":case"update":t.stagedVertex=e.mapEnd,"polygon"!==t.geometryType&&"polyline"!==t.geometryType||t.commitStagedVertex();break;case"end":t.complete()}return e}))}))}},{key:"createManipulatorDragPipelineHybrid",value:function(e){var t=this;return Object(dt.b)(e,(function(e,i){t.isCompleted||i.next(t._screenToMapDragEventStep()).next((function(e){return"start"===e.action&&(t.stagedVertex=e.mapStart,t.commitStagedVertex()),e})).next((function(e){switch(e.action){case"start":case"update":t.stagedVertex=e.mapEnd,"polygon"!==t.geometryType&&"polyline"!==t.geometryType||t.commitStagedVertex();break;case"end":"segment"!==t.geometryType&&"point"!==t.geometryType||t.complete()}return e}))}))}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null,this._editGeometry.destroy(),this._frameTask.remove()}},{key:"onInputEvent",value:function(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}},{key:"canRedo",get:function(){return this._editGeometry.canRedo}},{key:"redo",value:function(){this._editGeometry.redo()}},{key:"canUndo",get:function(){return this._editGeometry.canUndo}},{key:"undo",value:function(){Object(m.k)(this.snappingManager)&&this.snappingManager.doneSnapping(),this._editGeometry.undo()}},{key:"complete",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object(m.a)(this._snappingTask),Object(m.k)(this.snappingManager)&&this.snappingManager.doneSnapping(),"polyline"===this.geometryType||"polygon"===this.geometryType?this.discardStagedVertex():this.commitStagedVertex();var t="polyline"===this.geometryType&&this.numVertices<2||"polygon"===this.geometryType&&this.numVertices<3;this._createOperationCompleted=!t,(this.isCompleted||e)&&this.emit("complete",{vertices:this.vertices.map((function(e,t){return{componentIndex:0,vertexIndex:t,coordinates:e}})),aborted:e,type:"complete"})}},{key:"cancel",value:function(){this.complete(!0)}},{key:"interactive",get:function(){return this._manipulator.interactive},set:function(e){this._manipulator.interactive=e}},{key:"numVertices",get:function(){return Object(m.k)(this._stagedVertex)?this._activeComponent.vertices.length+1:this._activeComponent.vertices.length}},{key:"numCommittedVertices",get:function(){return this._activeComponent.vertices.length}},{key:"vertices",get:function(){var e=this.committedVertices;return Object(m.k)(this._stagedVertex)&&e.push(this.coordinateHelper.pointToArray(this._stagedVertex)),e}},{key:"committedVertices",get:function(){var e=this;return this._activeComponent.vertices.map((function(t){return e.coordinateHelper.toArray(t.pos)}))}},{key:"spatialReference",get:function(){return this.view.spatialReference}},{key:"hasStagedVertex",get:function(){return Object(m.k)(this._stagedVertex)}},{key:"stagedVertex",get:function(){return this._stagedVertex},set:function(e){if(Object(m.j)(e))this.discardStagedVertex();else{if(Object(m.j)(this._stagedVertex))this._stagedVertex=Object(lt.a)(e);else{if(Object(ut.a)(this._stagedVertex,e))return;this._stagedVertex.x=e.x,this._stagedVertex.y=e.y,this._stagedVertex.z=e.z,this._stagedVertex.m=e.m,this._stagedVertex.hasZ=e.hasZ,this._stagedVertex.hasM=e.hasM,this._stagedVertex.spatialReference=e.spatialReference}this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(e)}],operation:"apply",type:"vertex-update"})}}},{key:"commitStagedVertex",value:function(){if(this._snappingTask=Object(m.a)(this._snappingTask),Object(m.k)(this._stagedVertex)){var e=this._stagedVertex;this._stagedVertex=null,this._editGeometry.appendVertex(this.coordinateHelper.fromPoint(e))}}},{key:"discardStagedVertex",value:function(){this._stagedVertex=null}},{key:"_onPointerMove",value:function(e){var t=this;if(Object(m.a)(this._snappingTask),!(this._manipulator.dragging||this._pointerDownStates.has(e.pointerId)||this._manipulator.grabbing)&&this._manipulator.interactive){var i=Object(x.f)(e.x,e.y),n=this._closeOnClickVertexIndex(i);if(Object(m.k)(n)){this.discardStagedVertex();var r={componentIndex:0,vertexIndex:n,coordinates:this.coordinateHelper.toArray(this._activeComponent.vertices[n].pos)};this.emit("cursor-update",{updated:null,vertices:[r],operation:"apply",type:"vertex-update"})}else{var a=this._screenToMap(i);if(this._manipulator.cursor=Object(m.k)(a)?"crosshair":null,Object(m.k)(a))if(Object(m.k)(this.snappingManager)){var o=this.snappingManager,s=new Ne({geometry:this._editGeometry,elevationInfo:this.elevationInfo,pointer:e.pointerType,visualizer:new mn});this.stagedVertex=o.update(a,s),this._snappingTask=Object(_.h)(function(){var e=Object(O.a)(y.a.mark((function e(i){var n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._frameTask.schedule((function(){return o.snap(a,s,i)}),i);case 2:if(n=e.sent,e.t0=n.valid,!e.t0){e.next=7;break}return e.next=7,t._frameTask.schedule((function(){t.stagedVertex=n.apply()}),i);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.updatingHandles.addPromise(this._snappingTask.promise)}else this.stagedVertex=a}e.stopPropagation()}}},{key:"_onHold",value:function(e){Object(m.a)(this._snappingTask),"click"===this.drawingMode&&"touch"===e.pointerType&&this._snappingEnabled&&(this.stagedVertex=e.mapPoint),e.stopPropagation()}},{key:"_screenToMapDragEventStep",value:function(){var e=this,t=null;return function(i){if("start"===i.action&&(t=e._screenToMap(i.screenStart)),Object(m.j)(t))return null;var r=e._screenToMap(i.screenEnd);return Object(m.k)(r)?Object(n.a)(Object(n.a)({},i),{},{mapStart:t,mapEnd:r}):null}}},{key:"_screenToMap",value:function(e){return this._getDrawSurface().screenToMap(e)}},{key:"_mapToScreen",value:function(e){return this._getDrawSurface().mapToScreen(e)}},{key:"_getDrawSurface",value:function(){if(!this.coordinateHelper.hasZ)return this.elevationDrawSurface.defaultZ=null,this.elevationDrawSurface;var e=this.defaultZ,t=!1;Object(m.k)(this.elevationInfo)&&"absolute-height"===this.elevationInfo.mode&&(t=!0),Object(m.k)(this.snapToSceneEnabled)&&(t=this.snapToSceneEnabled),Object(m.k)(this.elevationInfo)&&"on-the-ground"===this.elevationInfo.mode&&(t=!1);var i=this._activeComponent.vertices.length;return("segment"===this.geometryType||"polygon"===this.geometryType)&&i>0&&(e=this.coordinateHelper.getZ(this._activeComponent.vertices[0].pos),t=!1),t?this.sceneDrawSurface:(this.elevationDrawSurface.defaultZ=e,this.elevationDrawSurface)}},{key:"_vertexWithinPointerDistance",value:function(e,t){var i=this._mapToScreen(e);return!!Object(m.k)(i)&&function(e,t,i){var n=e.x-t.x,r=e.y-t.y;return n*n+r*r<=i}(i,t,25)}},{key:"_closeOnClickVertexIndex",value:function(e){var t=this._activeComponent;if("polygon"===this.geometryType&&t.vertices.length>2){if(this._vertexWithinPointerDistance(this.coordinateHelper.toPoint(t.vertices[0].pos,_n),e))return 0;if(this._vertexWithinPointerDistance(this.coordinateHelper.toPoint(t.vertices[t.vertices.length-1].pos,_n),e))return t.vertices.length-1}return null}}]),i}(j.a.EventedMixin(ct.a));Object(c.a)([Object(u.b)({constructOnly:!0})],jn.prototype,"view",void 0),Object(c.a)([Object(u.b)({value:On})],jn.prototype,"drawingMode",null),Object(c.a)([Object(u.b)({constructOnly:!0})],jn.prototype,"geometryType",void 0),Object(c.a)([Object(u.b)({constructOnly:!0})],jn.prototype,"elevationInfo",void 0),Object(c.a)([Object(u.b)()],jn.prototype,"snapToSceneEnabled",void 0),Object(c.a)([Object(u.b)({constructOnly:!0})],jn.prototype,"manipulators",void 0),Object(c.a)([Object(u.b)({constructOnly:!0})],jn.prototype,"hasZ",void 0),Object(c.a)([Object(u.b)({constructOnly:!0})],jn.prototype,"hasM",void 0),Object(c.a)([Object(u.b)()],jn.prototype,"defaultZ",void 0),Object(c.a)([Object(u.b)({constructOnly:!0})],jn.prototype,"sceneDrawSurface",void 0),Object(c.a)([Object(u.b)({constructOnly:!0})],jn.prototype,"elevationDrawSurface",void 0),Object(c.a)([Object(u.b)({constructOnly:!0})],jn.prototype,"snappingManager",void 0),Object(c.a)([Object(u.b)({readOnly:!0})],jn.prototype,"updating",null),jn=Object(c.a)([Object(h.a)("esri.views.3d.interactive.editingTools.draw3D.DrawOperation")],jn);var _n=new N.a({x:0,y:0,z:0}),xn=function(){function e(t,i,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Object(r.a)(this,e),this.elevationInfo=t,this.defaultZ=i,this.view=n,this.excludeGraphics=a}return Object(a.a)(e,[{key:"screenToMap",value:function(e){if(Object(m.k)(this.defaultZ))return this.view.sceneIntersectionHelper.intersectElevationFromScreen(Object(x.g)(e.x,e.y),this.elevationInfo,this.defaultZ,this.excludeGraphics);var t=this.view.sceneIntersectionHelper.intersectElevationFromScreen(Object(x.g)(e.x,e.y),this.elevationInfo,0,this.excludeGraphics);return Object(m.k)(t)&&(t.z=void 0),t}},{key:"mapToScreen",value:function(e){var t=Object(k.c)(e.x,e.y,Object(Z.a)(this.view,e,this.elevationInfo),e.spatialReference);return this.view.toScreen(t)}}]),e}(),wn=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];Object(r.a)(this,e),this.view=t,this.elevationInfo=i,this.exclude=n}return Object(a.a)(e,[{key:"screenToMap",value:function(e){var t=this.view.toMap(e,{exclude:this.exclude});return Object(m.k)(t)&&(t.z=Object(Z.e)(t,this.view,this.elevationInfo)),t}},{key:"mapToScreen",value:function(e){var t=e;return Object(m.k)(this.elevationInfo)&&(t=Object(k.c)(e.x,e.y,Object(Z.a)(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}}]),e}(),kn=i(786),Tn=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).drawOperation=null,n.hasZ=!0,n.defaultZ=0,n.elevationInfo=null,n.snapToScene=null,n.mode=null,n.geometryType=null,n.type="draw-3d",n}return Object(a.a)(i,[{key:"updating",get:function(){var e,t;return null!=(e=null==(t=this.drawOperation)?void 0:t.updating)&&e}},{key:"initialize",value:function(){var e=this,t=Object(m.s)(this.elevationInfo,{mode:this.hasZ?"absolute-height":"on-the-ground",offset:0});this.drawOperation=new jn({view:this.view,manipulators:this.manipulators,geometryType:this.geometryType,drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,sceneDrawSurface:new wn(this.view,t),elevationDrawSurface:new xn(t,this.defaultZ,this.view),hasM:!1,elevationInfo:t}),this.drawOperation.on("vertex-add",(function(t){return e.onVertexAdd(t)})),this.drawOperation.on("vertex-remove",(function(t){return e.onVertexRemove(t)})),this.drawOperation.on("vertex-update",(function(t){return e.onVertexUpdate(t)})),this.drawOperation.on("cursor-update",(function(t){return e.onCursorUpdate(t)})),this.drawOperation.on("complete",(function(t){return e.onComplete(t)})),this.complete()}},{key:"destroy",value:function(){this.drawOperation.destroy(),this.drawOperation=null,this._set("view",null)}},{key:"onInputEvent",value:function(e){this.drawOperation.onInputEvent(e)}},{key:"enabled",set:function(e){this.drawOperation.interactive=e,this._set("enabled",e)}},{key:"reset",value:function(){}},{key:"canRedo",get:function(){return this.drawOperation.canRedo}},{key:"redo",value:function(){this.drawOperation.redo()}},{key:"canUndo",get:function(){return this.drawOperation.canUndo}},{key:"undo",value:function(){this.drawOperation.undo()}},{key:"completeCreateOperation",value:function(){this.drawOperation.complete()}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){this.drawOperation.isCompleted||this.drawOperation.cancel()}},{key:"getVertexCoords",value:function(){return this.drawOperation.vertices}},{key:"onVertexAdd",value:function(e){this.emit("vertex-add",e)}},{key:"onVertexRemove",value:function(e){this.emit("vertex-remove",e)}},{key:"onVertexUpdate",value:function(e){this.emit("vertex-update",e)}},{key:"onCursorUpdate",value:function(e){this.emit("cursor-update",e)}},{key:"onComplete",value:function(e){this.emit("complete",e)}}]),i}(j.a.EventedMixin(kn.a));Object(c.a)([Object(u.b)()],Tn.prototype,"drawOperation",void 0),Object(c.a)([Object(u.b)({readOnly:!0})],Tn.prototype,"updating",null),Object(c.a)([Object(u.b)({constructOnly:!0,nonNullable:!0})],Tn.prototype,"view",void 0),Object(c.a)([Object(u.b)({value:!0})],Tn.prototype,"enabled",null),Object(c.a)([Object(u.b)({constructOnly:!0})],Tn.prototype,"hasZ",void 0),Object(c.a)([Object(u.b)({constructOnly:!0,nonNullable:!0})],Tn.prototype,"defaultZ",void 0),Object(c.a)([Object(u.b)({constructOnly:!0})],Tn.prototype,"elevationInfo",void 0),Object(c.a)([Object(u.b)()],Tn.prototype,"snapToScene",void 0),Object(c.a)([Object(u.b)({constructOnly:!0})],Tn.prototype,"mode",void 0),Object(c.a)([Object(u.b)({constructOnly:!0})],Tn.prototype,"geometryType",void 0),Object(c.a)([Object(u.b)({readOnly:!0})],Tn.prototype,"type",void 0),Tn=Object(c.a)([Object(h.a)("esri.views.3d.interactive.editingTools.draw.DrawTool")],Tn);var Sn=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e))._addVertexOnPointerUp=!1,n._activePointerId=null,n._viewHandles=new b.a,n}return Object(a.a)(i,[{key:"initialize",value:function(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool(this.view)}},{key:"destroy",value:function(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy()):this._removeDrawTool(),this.emit("destroy")}},{key:"coordinates",get:function(){return Object(st.c)(d.a.getLogger("esri.views.draw.PointDrawAction"),"coordinates",{replacement:"vertices",version:"4.19"}),this.vertices[0]}},{key:"complete",value:function(){"2d"===this.view.type?this._cursorScreenPoint&&this._completeDrawing():this._drawTool.completeCreateOperation()}},{key:"_addViewHandles",value:function(){var e=this;this._removeViewHandles(),this._viewHandles.add([this.view.on("pointer-down",(function(t){e._shouldHandlePointerEvent(t)&&(e._snappingTask=Object(m.a)(e._snappingTask),e._activePointerId=t.pointerId,e._addVertexOnPointerUp=!0,e._cursorScreenPoint=Object(at.a)(t),"touch"===t.pointerType&&e._updateCursor(t.native))}),$e.b.TOOL),this.view.on("pointer-move",(function(t){e._snappingTask=Object(m.a)(e._snappingTask),e._cursorScreenPoint=Object(at.a)(t),"touch"!==t.pointerType&&e._updateCursor(t.native)}),$e.b.TOOL),this.view.on("pointer-drag",(function(t){e._shouldHandlePointerEvent(t)&&(e._snappingTask=Object(m.a)(e._snappingTask),e._addVertexOnPointerUp=!1)}),$e.b.TOOL),this.view.on("pointer-up",(function(t){if(e._shouldHandlePointerEvent(t))if(e._snappingTask=Object(m.a)(e._snappingTask),e._activePointerId=null,e._addVertexOnPointerUp)t.stopPropagation(),e._vertexAddHandler(t);else{var i="touch"===t.pointerType;e._updateCursor(t.native,i)}}),$e.b.TOOL),this.view.on("drag",["Shift"],(function(e){e.stopPropagation()}),$e.b.TOOL),this.view.on("key-down",(function(t){t.key===it&&e._cursorScreenPoint&&(e._snappingTask=Object(m.a)(e._snappingTask),e._vertexAddHandler(t))}),$e.b.TOOL)])}},{key:"_removeViewHandles",value:function(){this._viewHandles.removeAll()}},{key:"_addDrawTool",value:function(e){var t=this;this._drawTool=new Tn({view:e,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"point",mode:"click"}),this.view.toolViewManager.tools.push(this._drawTool),this.view.activeTool=this._drawTool,this._drawTool.on("cursor-update",(function(e){1===e.vertices.length&&t.emit("cursor-update",new Ke(t.view,null,e.vertices[0].vertexIndex,t._drawTool.getVertexCoords()))})),this._drawTool.on("complete",(function(e){t.emit("draw-complete",new Je(null,t._drawTool.getVertexCoords())),t._removeDrawTool()}))}},{key:"_removeDrawTool",value:function(){Object(m.k)(this._drawTool)&&(this.view.tools.remove(this._drawTool),this._drawTool.destroy(),this._drawTool=null)}},{key:"_addVertex",value:function(e){var t=this._coordinateHelper.fromArray(e);this._isDuplicateOfLastVertex(t)||(this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometry.appendVertex(t),this.notifyChange("vertices"),this._completeDrawing())}},{key:"_updateCursor",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._popCursorVertex(),this._cursorScreenPoint){var n=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);if(Object(m.k)(n)&&!i){this._pushCursorVertex(n.vertex);var r=function(){return new Ke(t.view,e,t._activeComponent.vertices.length,t.vertices,Object(m.k)(t._stagedVertex)?new N.a(t._stagedVertex):null)};this.emit("cursor-update",r()),Object(m.k)(this._snappingTask)&&this._snappingTask.promise.then((function(e){e.valid&&t.emit("cursor-update",r())}),(function(){}))}}}},{key:"_completeDrawing",value:function(e){this._activePointerId=null,this._popCursorVertex(),this._snappingTask=Object(m.a)(this._snappingTask),Object(m.k)(this._snappingManager)&&this._snappingManager.doneSnapping();var t=new Je(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}},{key:"_shouldHandlePointerEvent",value:function(e){return function(e){return"mouse"!==e.pointerType||0===e.button}(e)&&(Object(m.j)(this._activePointerId)||this._activePointerId===e.pointerId)}}]),i}(Xe);Object(c.a)([Object(u.b)({readOnly:!0})],Sn.prototype,"coordinates",null),Sn=Object(c.a)([Object(h.a)("esri.views.draw.PointDrawAction")],Sn);var Pn=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e))._panEnabled=!1,n._popVertexOnPointerMove=!1,n._addVertexOnPointerUp=!1,n._activePointerId=null,n._viewHandles=new b.a,n._undoRedoHandles=new b.a,n.mode=On,n}return Object(a.a)(i,[{key:"initialize",value:function(){"2d"===this.view.type?(this._addViewHandles(),this._addUndoRedoHandles()):this._addDrawTool(this.view)}},{key:"destroy",value:function(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy(),this._removeUndoRedoHandles(),this._undoRedoHandles.destroy()):this._removeDrawTool(),this.emit("destroy")}},{key:"_dragEnabled",get:function(){return"freehand"===this.mode||"hybrid"===this.mode}},{key:"_clickEnabled",get:function(){return"click"===this.mode||"hybrid"===this.mode}},{key:"undo",value:function(){Object(v.a)(Object(f.a)(i.prototype),"undo",this).call(this),this.notifyChange("vertices")}},{key:"redo",value:function(){Object(v.a)(Object(f.a)(i.prototype),"redo",this).call(this),this.notifyChange("vertices")}},{key:"complete",value:function(){"2d"===this.view.type?this._completeDrawing():this._drawTool.completeCreateOperation()}},{key:"getGeometryZValue",value:function(){return this.vertices.length>0&&this.vertices[0].length>2?this.vertices[0][2]:this._get("defaultZ")}},{key:"_addViewHandles",value:function(){var e=this;this._removeViewHandles(),this._viewHandles.add([this.view.on("click",(function(e){e.stopPropagation()}),$e.b.TOOL),this.view.on("pointer-down",(function(t){e._shouldHandlePointerEvent(t)&&(e._snappingTask=Object(m.a)(e._snappingTask),e._activePointerId=t.pointerId,e._addVertexOnPointerUp=!0,e._cursorScreenPoint=Object(at.a)(t),"touch"===t.pointerType&&e._updateCursor(t.native))}),$e.b.TOOL),this.view.on("pointer-move",(function(t){e._snappingTask=Object(m.a)(e._snappingTask),e._popVertexOnPointerMove&&(e.undo(),e._popVertexOnPointerMove=!1),e._cursorScreenPoint=Object(at.a)(t),"touch"!==t.pointerType&&e._updateCursor(t.native)}),$e.b.TOOL),this.view.on("pointer-drag",(function(t){e._shouldHandlePointerEvent(t)&&(e._snappingTask=Object(m.a)(e._snappingTask),e._cursorScreenPoint=Object(at.a)(t),e._dragEnabled&&!e._panEnabled?e._vertexAddHandler(t):e._addVertexOnPointerUp=!1)}),$e.b.TOOL),this.view.on("pointer-up",(function(t){if(e._shouldHandlePointerEvent(t))if(e._snappingTask=Object(m.a)(e._snappingTask),e._activePointerId=null,e._addVertexOnPointerUp){if(!e._clickEnabled)return 1===e.vertices.length&&e.vertices.pop(),void e._drawCompleteHandler(t);e._vertexAddHandler(t)}else{var i="touch"===t.pointerType;e._updateCursor(t.native,i)}}),$e.b.TOOL),this.view.on("drag",(function(t){e._dragEnabled&&Object(m.k)(e._activePointerId)&&!e._panEnabled&&t.stopPropagation()}),$e.b.TOOL),this.view.on("drag",["Shift"],(function(e){e.stopPropagation()}),$e.b.TOOL),this.view.on("double-click",(function(t){t.stopPropagation(),e._drawCompleteHandler(t)}),$e.b.TOOL),this.view.on("double-click",["Control"],(function(t){t.stopPropagation(),e._drawCompleteHandler(t)}),$e.b.TOOL),this.view.on("key-down",(function(t){var i=t.key,n=t.repeat;i===nt&&!n&&e._cursorScreenPoint?(t.stopPropagation(),e._snappingTask=Object(m.a)(e._snappingTask),e._vertexAddHandler(t)):i!==it||n?i!==tt||e.interactiveUndoDisabled||n?i!==et||e.interactiveUndoDisabled||n?i!==rt||n||(t.stopPropagation(),e._panEnabled=!0):(t.stopPropagation(),e.redo()):(t.stopPropagation(),e.undo()):(t.stopPropagation(),e._drawCompleteHandler(t))}),$e.b.TOOL),this.view.on("key-up",(function(t){t.key===rt&&(t.stopPropagation(),e._panEnabled=!1)}),$e.b.TOOL)])}},{key:"_addUndoRedoHandles",value:function(){var e=this;this._removeUndoRedoHandles(),this._undoRedoHandles.add([this._editGeometry.on("vertex-remove",(function(t){if(e.notifyChange("vertices"),"undo"===t.operation){var i=e._nativeEventHistory.undoStack.pop();e._nativeEventHistory.redoStack.push(i);var n=Object(p.a)(e._committedVertices);Object(m.k)(e._stagedVertex)&&n.push(e._coordinateHelper.pointToArray(e._stagedVertex)),e.emit("undo",new Qe(e.view,i,t.vertices[0].index,n))}})),this._editGeometry.on("vertex-add",(function(t){if(e.notifyChange("vertices"),"apply"===t.operation){var i=e._nativeEventHistory.undoStack[e._nativeEventHistory.undoStack.length],n=e._committedVertices.length-1,r=new Ye(e.view,i,n,e.vertices);e.emit("vertex-add",r),r.defaultPrevented&&(e._popVertexOnPointerMove=!0)}else if("redo"===t.operation){var a=e._nativeEventHistory.redoStack.pop();e._nativeEventHistory.undoStack.push(a);var o=Object(p.a)(e._committedVertices);Object(m.k)(e._stagedVertex)&&o.push(e._coordinateHelper.pointToArray(e._stagedVertex)),e.emit("redo",new Ye(e.view,a,t.vertices[0].index,o))}}))])}},{key:"_removeViewHandles",value:function(){this._viewHandles.removeAll()}},{key:"_removeUndoRedoHandles",value:function(){this._undoRedoHandles.removeAll()}},{key:"_addDrawTool",value:function(e){var t=this;this._drawTool=new Tn({view:e,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"polygon",mode:this.mode}),this.view.toolViewManager.tools.push(this._drawTool),this.view.activeTool=this._drawTool,this._drawTool.on("vertex-add",(function(e){1===e.vertices.length&&t.emit("vertex-add",new Ye(t.view,null,e.vertices[0].vertexIndex,t._drawTool.getVertexCoords()))})),this._drawTool.on("cursor-update",(function(e){1===e.vertices.length&&t.emit("cursor-update",new Ke(t.view,null,e.vertices[0].vertexIndex,t._drawTool.getVertexCoords()))})),this._drawTool.on("complete",(function(e){t.emit("draw-complete",new Je(null,t._drawTool.getVertexCoords())),t._removeDrawTool()}))}},{key:"_removeDrawTool",value:function(){Object(m.k)(this._drawTool)&&(this.view.tools.remove(this._drawTool),this._drawTool.destroy(),this._drawTool=null)}},{key:"_addVertex",value:function(e,t){var i=this._coordinateHelper.fromArray(e);if(!this._isDuplicateOfLastVertex(i)){this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometry.appendVertex(i);var n=t||new Event("placeholder");this._nativeEventHistory.undoStack.push(n)}}},{key:"_updateCursor",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._popCursorVertex(),this._cursorScreenPoint){var n=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);if(Object(m.k)(n)&&!i){this._pushCursorVertex(n.vertex);var r=function(){return new Ke(t.view,e,t._activeComponent.vertices.length,t.vertices,Object(m.k)(t._stagedVertex)?new N.a(t._stagedVertex):null)};this.emit("cursor-update",r()),Object(m.k)(this._snappingTask)&&this._snappingTask.promise.then((function(e){e.valid&&t.emit("cursor-update",r())}),(function(){}))}}}},{key:"_completeDrawing",value:function(e){if(this._activePointerId=null,this._popCursorVertex(),!(this._committedVertices.length<3)){this._snappingTask=Object(m.a)(this._snappingTask),Object(m.k)(this._snappingManager)&&this._snappingManager.doneSnapping();var t=new Je(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}}},{key:"_shouldHandlePointerEvent",value:function(e){return function(e){return"mouse"!==e.pointerType||0===e.button}(e)&&(Object(m.j)(this._activePointerId)||this._activePointerId===e.pointerId)}}]),i}(Xe);Object(c.a)([Object(u.b)()],Pn.prototype,"_dragEnabled",null),Object(c.a)([Object(u.b)()],Pn.prototype,"_clickEnabled",null),Object(c.a)([Object(u.b)({type:yn})],Pn.prototype,"mode",void 0),Pn=Object(c.a)([Object(h.a)("esri.views.draw.PolygonDrawAction")],Pn);var Cn=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e))._panEnabled=!1,n._popVertexOnPointerMove=!1,n._addVertexOnPointerUp=!1,n._activePointerId=null,n._viewHandles=new b.a,n._undoRedoHandles=new b.a,n.mode=On,n}return Object(a.a)(i,[{key:"initialize",value:function(){"2d"===this.view.type?(this._addViewHandles(),this._addUndoRedoHandles()):this._addDrawTool(this.view)}},{key:"destroy",value:function(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy(),this._removeUndoRedoHandles(),this._undoRedoHandles.destroy()):this._removeDrawTool(),this.emit("destroy")}},{key:"_clickEnabled",get:function(){return"click"===this.mode||"hybrid"===this.mode}},{key:"_dragEnabled",get:function(){return"freehand"===this.mode||"hybrid"===this.mode}},{key:"undo",value:function(){Object(v.a)(Object(f.a)(i.prototype),"undo",this).call(this),this.notifyChange("vertices")}},{key:"redo",value:function(){Object(v.a)(Object(f.a)(i.prototype),"redo",this).call(this),this.notifyChange("vertices")}},{key:"complete",value:function(){"2d"===this.view.type?this._completeDrawing():this._drawTool.completeCreateOperation()}},{key:"_addViewHandles",value:function(){var e=this;this._removeViewHandles(),this._viewHandles.add([this.view.on("click",(function(e){e.stopPropagation()}),$e.b.TOOL),this.view.on("pointer-down",(function(t){e._shouldHandlePointerEvent(t)&&!e._panEnabled&&(e._snappingTask=Object(m.a)(e._snappingTask),e._activePointerId=t.pointerId,e._addVertexOnPointerUp=!0,e._cursorScreenPoint=Object(at.a)(t),"touch"===t.pointerType&&e._updateCursor(t.native))}),$e.b.TOOL),this.view.on("pointer-move",(function(t){e._popVertexOnPointerMove&&(e.undo(),e._popVertexOnPointerMove=!1),e._snappingTask=Object(m.a)(e._snappingTask),e._cursorScreenPoint=Object(at.a)(t),"touch"!==t.pointerType&&e._updateCursor(t.native)}),$e.b.TOOL),this.view.on("pointer-drag",(function(t){e._shouldHandlePointerEvent(t)&&(e._snappingTask=Object(m.a)(e._snappingTask),e._cursorScreenPoint=Object(at.a)(t),e._dragEnabled&&!e._panEnabled?e._vertexAddHandler(t):e._addVertexOnPointerUp=!1)}),$e.b.TOOL),this.view.on("pointer-up",(function(t){if(e._shouldHandlePointerEvent(t))if(e._snappingTask=Object(m.a)(e._snappingTask),e._activePointerId=null,e._addVertexOnPointerUp){if(!e._clickEnabled)return 1===e.vertices.length&&e.vertices.pop(),void e._drawCompleteHandler(t);e._vertexAddHandler(t)}else{var i="touch"===t.pointerType;e._updateCursor(t.native,i)}}),$e.b.TOOL),this.view.on("drag",(function(t){e._dragEnabled&&Object(m.k)(e._activePointerId)&&!e._panEnabled&&t.stopPropagation()}),$e.b.TOOL),this.view.on("drag",["Shift"],(function(e){e.stopPropagation()}),$e.b.TOOL),this.view.on("double-click",(function(t){t.stopPropagation(),e._drawCompleteHandler(t)}),$e.b.TOOL),this.view.on("double-click",["Control"],(function(t){t.stopPropagation(),e._drawCompleteHandler(t)}),$e.b.TOOL),this.view.on("key-down",(function(t){var i=t.key,n=t.repeat;i===nt&&!n&&e._cursorScreenPoint?(t.stopPropagation(),e._snappingTask=Object(m.a)(e._snappingTask),e._vertexAddHandler(t)):i!==it||n?i!==tt||e.interactiveUndoDisabled||n?i!==et||e.interactiveUndoDisabled||n?i!==rt||n||(t.stopPropagation(),e._panEnabled=!0):(t.stopPropagation(),e.redo()):(t.stopPropagation(),e.undo()):(t.stopPropagation(),e._drawCompleteHandler(t))}),$e.b.TOOL),this.view.on("key-up",(function(t){t.key===rt&&(t.stopPropagation(),e._panEnabled=!1)}),$e.b.TOOL)])}},{key:"_addUndoRedoHandles",value:function(){var e=this;this._removeUndoRedoHandles(),this._undoRedoHandles.add([this._editGeometry.on("vertex-remove",(function(t){if(e.notifyChange("vertices"),"undo"===t.operation){var i=e._nativeEventHistory.undoStack.pop();e._nativeEventHistory.redoStack.push(i);var n=Object(p.a)(e._committedVertices);Object(m.k)(e._stagedVertex)&&n.push(e._coordinateHelper.pointToArray(e._stagedVertex)),e.emit("undo",new Qe(e.view,i,t.vertices[0].index,n))}})),this._editGeometry.on("vertex-add",(function(t){if(e.notifyChange("vertices"),"apply"===t.operation){var i=e._nativeEventHistory.undoStack[e._nativeEventHistory.undoStack.length],n=e._committedVertices.length-1,r=new Ye(e.view,i,n,e.vertices);e.emit("vertex-add",r),r.defaultPrevented&&(e._popVertexOnPointerMove=!0)}else if("redo"===t.operation){var a=e._nativeEventHistory.redoStack.pop();e._nativeEventHistory.undoStack.push(a);var o=Object(p.a)(e._committedVertices);Object(m.k)(e._stagedVertex)&&o.push(e._coordinateHelper.pointToArray(e._stagedVertex)),e.emit("redo",new Ye(e.view,a,t.vertices[0].index,o))}}))])}},{key:"_removeViewHandles",value:function(){this._viewHandles.removeAll()}},{key:"_removeUndoRedoHandles",value:function(){this._undoRedoHandles.removeAll()}},{key:"_addDrawTool",value:function(e){var t=this;this._drawTool=new Tn({view:e,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"polyline",mode:this.mode}),this.view.toolViewManager.tools.push(this._drawTool),this.view.activeTool=this._drawTool,this._drawTool.on("vertex-add",(function(e){1===e.vertices.length&&t.emit("vertex-add",new Ye(t.view,null,e.vertices[0].vertexIndex,t._drawTool.getVertexCoords()))})),this._drawTool.on("cursor-update",(function(e){1===e.vertices.length&&t.emit("cursor-update",new Ke(t.view,null,e.vertices[0].vertexIndex,t._drawTool.getVertexCoords()))})),this._drawTool.on("complete",(function(e){t.emit("draw-complete",new Je(null,t._drawTool.getVertexCoords())),t._removeDrawTool()}))}},{key:"_removeDrawTool",value:function(){Object(m.k)(this._drawTool)&&(this.view.tools.remove(this._drawTool),this._drawTool=Object(m.e)(this._drawTool))}},{key:"_addVertex",value:function(e,t){var i=this._coordinateHelper.fromArray(e);if(!this._isDuplicateOfLastVertex(i)){this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometry.appendVertex(i);var n=t||new Event("placeholder");this._nativeEventHistory.undoStack.push(n)}}},{key:"_updateCursor",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._popCursorVertex(),this._cursorScreenPoint){var n=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);if(Object(m.k)(n)&&!i){this._pushCursorVertex(n.vertex);var r=function(){return new Ke(t.view,e,t._activeComponent.vertices.length,t.vertices,Object(m.k)(t._stagedVertex)?new N.a(t._stagedVertex):null)};this.emit("cursor-update",r()),Object(m.k)(this._snappingTask)&&this._snappingTask.promise.then((function(e){e.valid&&t.emit("cursor-update",r())}),(function(){}))}}}},{key:"_completeDrawing",value:function(e){if(this._activePointerId=null,this._popCursorVertex(),!(this._committedVertices.length<2)){this._snappingTask=Object(m.a)(this._snappingTask),Object(m.k)(this._snappingManager)&&this._snappingManager.doneSnapping();var t=new Je(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}}},{key:"_shouldHandlePointerEvent",value:function(e){return function(e){return"mouse"!==e.pointerType||0===e.button}(e)&&(Object(m.j)(this._activePointerId)||this._activePointerId===e.pointerId)}}]),i}(Xe);Object(c.a)([Object(u.b)()],Cn.prototype,"_clickEnabled",null),Object(c.a)([Object(u.b)()],Cn.prototype,"_dragEnabled",null),Object(c.a)([Object(u.b)({type:yn})],Cn.prototype,"mode",void 0),Cn=Object(c.a)([Object(h.a)("esri.views.draw.PolylineDrawAction")],Cn);var Vn=i(84),Mn=i(225),Dn=i(686),En=i(656);function zn(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(m.k)(i)?[e,t,i]:[e,t]}function Hn(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(m.k)(i)?{x:e,y:t,z:i}:{x:e,y:t}}var An=function(){function e(t){Object(r.a)(this,e),this.spatialReference=t}return Object(a.a)(e,[{key:"mapToLocalMultiple",value:function(e){var t=this;return Object(m.g)(e.map((function(e){return t.mapToLocal(e)})))}},{key:"doUnnormalization",get:function(){return!1}}]),e}(),In=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e,n){var a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(r.a)(this,i),(a=t.call(this,n)).defaultZ=o,a.transform=Object(Mn.b)(),a.transformInv=Object(Mn.b)(),a.transform=Object(Mn.a)(e),Object(Vn.a)(a.transformInv,a.transform),a}return Object(a.a)(i,[{key:"makeMapPoint",value:function(e,t){return zn(e,t,this.defaultZ)}},{key:"mapToLocal",value:function(e){return Hn(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}},{key:"localToMap",value:function(e){return zn(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this.defaultZ)}}]),i}(An),Rn=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e,n){var a;Object(r.a)(this,i),(a=t.call(this,e.spatialReference)).view=e,a.defaultZ=null,a.pWS=Object(V.e)(),a.tangentFrameUpWS=Object(V.e)(),a.tangentFrameRightWS=Object(V.e)(),a.tangentFrameForwardWS=Object(V.e)(),a.localFrameRightWS=Object(V.e)(),a.localFrameUpWS=Object(V.e)(),a.worldToLocalTransform=Object(En.b)(),a.localToWorldTransform=Object(En.b)(),a.scale=1,a.scale=e.resolution,a.referenceMapPoint=n,a.defaultZ=n.hasZ?n.z:null;var o=e.state.camera.viewRight;a.view.renderCoordsHelper.toRenderCoords(a.referenceMapPoint,a.pWS),a.view.renderCoordsHelper.worldBasisAtPosition(a.pWS,0,a.tangentFrameRightWS),a.view.renderCoordsHelper.worldBasisAtPosition(a.pWS,1,a.tangentFrameUpWS),a.view.renderCoordsHelper.worldBasisAtPosition(a.pWS,2,a.tangentFrameForwardWS);var s=Object(V.e)();return Object(Se.b)(s,a.tangentFrameForwardWS,Object(Se.e)(o,a.tangentFrameForwardWS)),Object(Se.g)(a.localFrameRightWS,o,s),Object(Se.o)(a.localFrameRightWS,a.localFrameRightWS),Object(Se.d)(a.localFrameUpWS,a.tangentFrameForwardWS,a.localFrameRightWS),Object(Dn.g)(a.worldToLocalTransform,a.localFrameRightWS,a.tangentFrameRightWS),Object(Dn.c)(a.localToWorldTransform,a.worldToLocalTransform),a}return Object(a.a)(i,[{key:"doUnnormalization",get:function(){return"global"===this.view.viewingMode}},{key:"makeMapPoint",value:function(e,t){return zn(e,t,this.defaultZ)}},{key:"mapToLocal",value:function(e){var t=Object(V.e)();this.view.renderCoordsHelper.toRenderCoords(new N.a({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),Object(Se.r)(t,t,this.worldToLocalTransform);var i=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return Object(m.k)(i)?Hn(i.x/this.scale,i.y/this.scale):null}},{key:"localToMap",value:function(e){var t=Object(V.e)();this.view.renderCoordsHelper.toRenderCoords(new N.a({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),Object(Se.r)(t,t,this.localToWorldTransform);var i=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return Object(m.k)(i)?zn(i.x,i.y,this.defaultZ):null}}]),i}(An);var Gn=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e))._isDragging=!1,n._panEnabled=!1,n._viewHandles=new b.a,n._activePointerId=null,n._addVertexOnPointerUp=!1,n.viewAlignedCoordinateSystem=null,n.mode="freehand",n}return Object(a.a)(i,[{key:"initialize",value:function(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool(this.view)}},{key:"destroy",value:function(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy()):this._removeDrawTool(),this.emit("destroy")}},{key:"complete",value:function(){"2d"===this.view.type?this._completeDrawing():this._drawTool.completeCreateOperation()}},{key:"getGeometryZValue",value:function(){return this.vertices.length>0&&this.vertices[0].length>2?this.vertices[0][2]:this._get("defaultZ")}},{key:"_addViewHandles",value:function(){this._removeViewHandles(),"click"===this.mode?this._viewHandles.add(this._getClickModeViewHandles()):this._viewHandles.add(this._getDragModeViewHandles())}},{key:"_getDragModeViewHandles",value:function(){var e=this;return[this.view.on("immediate-click",(function(t){if(t.stopPropagation(),t.mapPoint&&!e._panEnabled){var i=e.getCoordsFromScreenPoint(Object(at.a)(t));Object(m.k)(i)&&(e._vertexAddHandler(t),e._drawCompleteHandler(t))}}),$e.b.TOOL),this.view.on("pointer-down",(function(t){e._shouldHandlePointerEvent(t)&&(e._snappingTask=Object(m.a)(e._snappingTask),e._panEnabled||(e._resetGeometry(),e._addVertexOnPointerUp=!0,e._cursorScreenPoint=Object(at.a)(t),e._activePointerId=t.pointerId,e._vertexAddHandler(t),e._isDragging=!1,"touch"===t.pointerType&&e._updateCursor(t.native)))}),$e.b.TOOL),this.view.on("pointer-move",(function(t){e._snappingTask=Object(m.a)(e._snappingTask),Object(m.j)(e._activePointerId)&&"touch"!==t.pointerType&&(e._cursorScreenPoint=Object(at.a)(t),e._updateCursor(t.native))}),$e.b.TOOL),this.view.on("pointer-drag",(function(t){e._shouldHandlePointerEvent(t)&&(e._snappingTask=Object(m.a)(e._snappingTask),e._isDragging=!0,e._cursorScreenPoint=Object(at.a)(t),e._updateCursor(t.native))}),$e.b.TOOL),this.view.on("pointer-up",(function(t){e._shouldHandlePointerEvent(t)&&e._addVertexOnPointerUp&&(e._snappingTask=Object(m.a)(e._snappingTask),e._activePointerId=null,e._isDragging&&e._vertexAddHandler(t),2===e._committedVertices.length&&e._drawCompleteHandler(t),e._isDragging=!1)}),$e.b.TOOL),this.view.on("key-down",(function(t){t.key===it&&e._cursorScreenPoint?(e._snappingTask=Object(m.a)(e._snappingTask),e._vertexAddHandler(t),e._drawCompleteHandler(t)):t.key===rt&&(e._panEnabled=!0)}),$e.b.TOOL),this.view.on("key-up",(function(t){t.key===rt&&(e._panEnabled=!1)}),$e.b.TOOL),this.view.on("drag",(function(t){Object(m.k)(e._activePointerId)&&t.stopPropagation()}),$e.b.TOOL),this.view.on("drag",["Shift"],(function(e){e.stopPropagation()}),$e.b.TOOL)]}},{key:"_getClickModeViewHandles",value:function(){var e=this;return[this.view.on("pointer-down",(function(t){e._snappingTask=Object(m.a)(e._snappingTask),e._cursorScreenPoint=Object(at.a)(t),e._activePointerId=t.pointerId,e._isDragging=!1,"touch"===t.pointerType&&e._updateCursor(t.native)}),$e.b.TOOL),this.view.on("pointer-move",(function(t){e._snappingTask=Object(m.a)(e._snappingTask),e._cursorScreenPoint=Object(at.a)(t),Object(m.j)(e._activePointerId)&&"touch"!==t.pointerType&&e._updateCursor(t.native)}),$e.b.TOOL),this.view.on("pointer-drag",(function(t){e._shouldHandlePointerEvent(t)&&(e._snappingTask=Object(m.a)(e._snappingTask),e._isDragging=!0)}),$e.b.TOOL),this.view.on("pointer-up",(function(t){e._shouldHandlePointerEvent(t)&&(e._snappingTask=Object(m.a)(e._snappingTask),e._activePointerId=null,t.stopPropagation(),e._isDragging||e._vertexAddHandler(t),2!==e.vertices.length||e._isDragging||e._drawCompleteHandler(t),e._isDragging=!1)}),$e.b.TOOL),this.view.on("key-down",(function(t){t.key===nt&&e._cursorScreenPoint&&(e._vertexAddHandler(t),2===e.vertices.length&&e._drawCompleteHandler(t)),t.key===it&&e._cursorScreenPoint&&2===e.vertices.length&&(e._vertexAddHandler(t),e._drawCompleteHandler(t))}),$e.b.TOOL)]}},{key:"_removeViewHandles",value:function(){this._viewHandles.removeAll()}},{key:"_addDrawTool",value:function(e){var t=this;this._drawTool=new Tn({view:e,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"segment",mode:this.mode}),this.view.toolViewManager.tools.push(this._drawTool),this.view.activeTool=this._drawTool,this._drawTool.on("vertex-add",(function(e){1===e.vertices.length&&t.emit("vertex-add",new Ye(t.view,null,e.vertices[0].vertexIndex,t._drawTool.getVertexCoords()))})),this._drawTool.on("cursor-update",(function(e){1===e.vertices.length&&t.emit("cursor-update",new Ke(t.view,null,e.vertices[0].vertexIndex,t._drawTool.getVertexCoords()))})),this._drawTool.on("complete",(function(e){t.emit("draw-complete",new Je(null,t._drawTool.getVertexCoords())),t._removeDrawTool()}))}},{key:"_removeDrawTool",value:function(){Object(m.k)(this._drawTool)&&(this.view.tools.remove(this._drawTool),this._drawTool.destroy(),this._drawTool=null)}},{key:"_addVertex",value:function(e,t){var i=this._coordinateHelper.fromArray(e);if(!this._isDuplicateOfLastVertex(i)){this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometry.appendVertex(i),1===this._committedVertices.length&&(this.viewAlignedCoordinateSystem=function(e,t){if("2d"===e.type)return new In(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if("3d"===e.type){var i=t.length>2?new N.a({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new N.a({x:t[0],y:t[1],spatialReference:e.spatialReference});return new Rn(e,i)}return null}(this.view,this._committedVertices[0]));var n=this._committedVertices.length-1,r=new Ye(this.view,t,n,this.vertices);this.emit("vertex-add",r)}}},{key:"_updateCursor",value:function(e){var t=this;if(this._popCursorVertex(),this._cursorScreenPoint){var i=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);if(Object(m.k)(i)){this._pushCursorVertex(i.vertex);var n=function(){return new Ke(t.view,e,t._activeComponent.vertices.length,t.vertices,Object(m.k)(t._stagedVertex)?new N.a(t._stagedVertex):null)};this.emit("cursor-update",n()),Object(m.k)(this._snappingTask)&&this._snappingTask.promise.then((function(e){e.valid&&t.emit("cursor-update",n())}),(function(){}))}}}},{key:"_completeDrawing",value:function(e){if(this._activePointerId=null,this._popCursorVertex(),this._cursorScreenPoint=null,this._isDragging=!1,this._snappingTask=Object(m.a)(this._snappingTask),Object(m.k)(this._snappingManager)&&this._snappingManager.doneSnapping(),!(this.vertices.length<1)){var t=new Je(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}}},{key:"_resetGeometry",value:function(){this._editGeometry.destroy(),this._editGeometry=new qe(new ge.c(this._coordinateHelper),"polygon"),this._activeComponent=new ge.a(this._editGeometry.editGeometry),this._editGeometry.editGeometry.components.push(this._activeComponent)}},{key:"_shouldHandlePointerEvent",value:function(e){return function(e){return"mouse"!==e.pointerType||0===e.button}(e)&&(Object(m.j)(this._activePointerId)||this._activePointerId===e.pointerId)}}]),i}(Xe);Object(c.a)([Object(u.b)({type:["freehand","click"]})],Gn.prototype,"mode",void 0),Gn=Object(c.a)([Object(h.a)("esri/views/2d/engine/markup/SegmentDrawAction")],Gn);var Ln=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(){var e;return Object(r.a)(this,i),(e=t.apply(this,arguments)).activeAction=null,e.type="draw",e.view=null,e}return Object(a.a)(i,[{key:"destroy",value:function(){this.activeAction&&(this.activeAction.destroy(),this.activeAction=null)}},{key:"create",value:function(e,t){this.reset();var i=Object(n.a)({view:this.view},t);switch(e){case"point":i.editGeometryType="point",this.activeAction=new Sn(i);break;case"polyline":i.editGeometryType="polyline",this.activeAction=new Cn(i);break;case"multipoint":i.editGeometryType="polygon",this.activeAction=new ot(i);break;case"polygon":i.editGeometryType="polygon",this.activeAction=new Pn(i);break;case"rectangle":case"circle":case"ellipse":case"triangle":i.editGeometryType="polygon",this.activeAction=new Gn(i)}return this.activeAction}},{key:"complete",value:function(){this.activeAction&&this.activeAction.complete(),this.activeAction=null}},{key:"reset",value:function(){this.activeAction&&this.activeAction.destroy(),this.activeAction=null}}]),i}(l.a);Object(c.a)([Object(u.b)()],Ln.prototype,"activeAction",void 0),Object(c.a)([Object(u.b)({readOnly:!0})],Ln.prototype,"type",void 0),Object(c.a)([Object(u.b)()],Ln.prototype,"view",void 0);var Fn=Ln=Object(c.a)([Object(h.a)("esri.views.draw.Draw")],Ln);t.a=Fn}}]);
//# sourceMappingURL=58.b1561157.chunk.js.map