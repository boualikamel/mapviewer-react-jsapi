(this["webpackJsonpjsapi-create-react-app"]=this["webpackJsonpjsapi-create-react-app"]||[]).push([[8],{582:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var s=i(620);function r(t,e){if(!(this instanceof r))return new r(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&("function"==typeof e?this.toBBox=e:this._initFormat(e)),this.clear()}function n(t,e,i){if(!i)return e.indexOf(t);for(var s=0;s<e.length;s++)if(i(t,e[s]))return s;return-1}function a(t,e){o(t,0,t.children.length,e,t)}function o(t,e,i,s,r){r||(r=m(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var n,a=e;a<i;a++)n=t.children[a],u(r,t.leaf?s(n):n);return r}function u(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function c(t,e){return t.minX-e.minX}function l(t,e){return t.minY-e.minY}function h(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function f(t){return t.maxX-t.minX+(t.maxY-t.minY)}function d(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function p(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function m(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(t,e,i,r,n){for(var a,o=[e,i];o.length;)(i=o.pop())-(e=o.pop())<=r||(a=e+Math.ceil((i-e)/r/2)*r,Object(s.a)(t,a,e,i,n),o.push(e,a,a,i))}r.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,i=[],s=this.toBBox;if(!p(t,e))return i;for(var r,n,a,o,u=[];e;){for(r=0,n=e.children.length;r<n;r++)a=e.children[r],p(t,o=e.leaf?s(a):a)&&(e.leaf?i.push(a):d(t,o)?this._all(a,i):u.push(a));e=u.pop()}return i},collides:function(t){var e=this.data,i=this.toBBox;if(!p(t,e))return!1;for(var s,r,n,a,o=[];e;){for(s=0,r=e.children.length;s<r;s++)if(n=e.children[s],p(t,a=e.leaf?i(n):n)){if(e.leaf||d(t,a))return!0;o.push(n)}e=o.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}var s=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===s.height)this._splitRoot(this.data,s);else{if(this.data.height<s.height){var r=this.data;this.data=s,s=r}this._insert(s,this.data.height-s.height-1,!0)}else this.data=s;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=m([]),this},remove:function(t,e){if(!t)return this;for(var i,s,r,a,o=this.data,u=this.toBBox(t),c=[],l=[];o||c.length;){if(o||(o=c.pop(),s=c[c.length-1],i=l.pop(),a=!0),o.leaf&&-1!==(r=n(t,o.children,e)))return o.children.splice(r,1),c.push(o),this._condense(c),this;a||o.leaf||!d(o,u)?s?(i++,o=s.children[i],a=!1):o=null:(c.push(o),l.push(i),i=0,s=o,o=o.children[0])}return this},toBBox:function(t){return t},compareMinX:c,compareMinY:l,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},_build:function(t,e,i,s){var r,n=i-e+1,o=this._maxEntries;if(n<=o)return a(r=m(t.slice(e,i+1)),this.toBBox),r;s||(s=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/Math.pow(o,s-1))),(r=m([])).leaf=!1,r.height=s;var u,c,l,h,f=Math.ceil(n/o),d=f*Math.ceil(Math.sqrt(o));for(y(t,e,i,d,this.compareMinX),u=e;u<=i;u+=d)for(y(t,u,l=Math.min(u+d-1,i),f,this.compareMinY),c=u;c<=l;c+=f)h=Math.min(c+f-1,l),r.children.push(this._build(t,c,h,s-1));return a(r,this.toBBox),r},_chooseSubtree:function(t,e,i,s){for(var r,n,a,o,u,c,l,f,d,p;s.push(e),!e.leaf&&s.length-1!==i;){for(l=f=1/0,r=0,n=e.children.length;r<n;r++)u=h(a=e.children[r]),d=t,p=a,(c=(Math.max(p.maxX,d.maxX)-Math.min(p.minX,d.minX))*(Math.max(p.maxY,d.maxY)-Math.min(p.minY,d.minY))-u)<f?(f=c,l=u<l?u:l,o=a):c===f&&u<l&&(l=u,o=a);e=o||e.children[0]}return e},_insert:function(t,e,i){var s=this.toBBox,r=i?t:s(t),n=[],a=this._chooseSubtree(r,this.data,e,n);for(a.children.push(t),u(a,r);e>=0&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(r,n,e)},_split:function(t,e){var i=t[e],s=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,s);var n=this._chooseSplitIndex(i,r,s),o=m(i.children.splice(n,i.children.length-n));o.height=i.height,o.leaf=i.leaf,a(i,this.toBBox),a(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(i,o)},_splitRoot:function(t,e){this.data=m([t,e]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,i){var s,r,n,a,u,c,l,f,d,p,m,y,g,x;for(c=l=1/0,s=e;s<=i-e;s++)d=r=o(t,0,s,this.toBBox),p=n=o(t,s,i,this.toBBox),void 0,void 0,void 0,void 0,m=Math.max(d.minX,p.minX),y=Math.max(d.minY,p.minY),g=Math.min(d.maxX,p.maxX),x=Math.min(d.maxY,p.maxY),a=Math.max(0,g-m)*Math.max(0,x-y),u=h(r)+h(n),a<c?(c=a,f=s,l=u<l?u:l):a===c&&u<l&&(l=u,f=s);return f},_chooseSplitAxis:function(t,e,i){var s=t.leaf?this.compareMinX:c,r=t.leaf?this.compareMinY:l;this._allDistMargin(t,e,i,s)<this._allDistMargin(t,e,i,r)&&t.children.sort(s)},_allDistMargin:function(t,e,i,s){t.children.sort(s);var r,n,a=this.toBBox,c=o(t,0,e,a),l=o(t,i-e,i,a),h=f(c)+f(l);for(r=e;r<i-e;r++)n=t.children[r],u(c,t.leaf?a(n):n),h+=f(c);for(r=i-e-1;r>=e;r--)n=t.children[r],u(l,t.leaf?a(n):n),h+=f(l);return h},_adjustParentBBoxes:function(t,e,i){for(var s=i;s>=0;s--)u(e[s],t)},_condense:function(t){for(var e,i=t.length-1;i>=0;i--)0===t[i].children.length?i>0?(e=t[i-1].children).splice(e.indexOf(t[i]),1):this.clear():a(t[i],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},598:function(t,e,i){"use strict";i.d(e,"a",(function(){return f})),i.d(e,"b",(function(){return m})),i.d(e,"c",(function(){return g}));var s=i(9),r=i(34),n=i(44),a=i(102),o=i(610);const u=[0,0];function c(t,e){if(!e)return null;if("x"in e){const i={x:0,y:0};return[i.x,i.y]=t(e.x,e.y,u),null!=e.z&&(i.z=e.z),null!=e.m&&(i.m=e.m),i}if("xmin"in e){const i={xmin:0,ymin:0,xmax:0,ymax:0};return[i.xmin,i.ymin]=t(e.xmin,e.ymin,u),[i.xmax,i.ymax]=t(e.xmax,e.ymax,u),e.hasZ&&(i.zmin=e.zmin,i.zmax=e.zmax,i.hasZ=!0),e.hasM&&(i.mmin=e.mmin,i.mmax=e.mmax,i.hasM=!0),i}return"rings"in e?{rings:l(e.rings,t),hasM:e.hasM,hasZ:e.hasZ}:"paths"in e?{paths:l(e.paths,t),hasM:e.hasM,hasZ:e.hasZ}:"points"in e?{points:h(e.points,t),hasM:e.hasM,hasZ:e.hasZ}:void 0}function l(t,e){const i=[];for(const s of t)i.push(h(s,e));return i}function h(t,e){const i=[];for(const s of t){const t=e(s[0],s[1],[0,0]);i.push(t),s.length>2&&t.push(s[2]),s.length>3&&t.push(s[3])}return i}async function f(t,e){if(!e)return;const i=Array.isArray(t)?t.map((t=>{var e;return null==(e=t.geometry)?void 0:e.spatialReference})):[t];await Object(a.d)(i.map((t=>({source:t,dest:e}))))}const d=c.bind(null,n.c),p=c.bind(null,n.f);function m(t,e,i){return t?(i||(i=e,e=t.spatialReference),Object(r.i)(e)&&Object(r.i)(i)&&!Object(r.c)(e,i)?Object(n.a)(e,i)?Object(r.m)(i)?d(t):p(t):Object(a.j)(o.a,[t],e,i,null)[0]:t):t}const y=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(t,e,i){!t||!t.length||!e||!i||Object(r.c)(e,i);const n={geometries:t,inSpatialReference:e,outSpatialReference:i,resolve:null};return this._jobs.push(n),Object(s.c)((t=>{n.resolve=t,null===this._timer&&(this._timer=setTimeout(this._process,10))}))}_process(){this._timer=null;const t=this._jobs.shift();if(!t)return;const{geometries:e,inSpatialReference:i,outSpatialReference:s,resolve:u}=t;Object(n.a)(i,s)?Object(r.m)(s)?u(e.map(d)):u(e.map(p)):u(Object(a.j)(o.a,e,i,s,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};async function g(t,e,i){return y.push(t,e,i)}},606:function(t,e,i){"use strict";function s(t,e){return t?e?4:3:e?3:2}function r(t,e,i,r,o){if(!e||!e.lengths.length)return null;const u="upperLeft"===(null==o?void 0:o.originPosition)?-1:1;t.lengths.length&&(t.lengths.length=0),t.coords.length&&(t.coords.length=0);const c=t.coords,l=[],h=i?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:f,coords:d}=e,p=s(i,r);let m=0;for(const s of f){const t=n(h,d,m,s,i,r,u);t&&l.push(t),m+=s*p}if(l.sort(((t,e)=>{let s=u*t[2]-u*e[2];return 0===s&&i&&(s=t[4]-e[4]),s})),l.length){let t=6*l[0][2];c[0]=l[0][0]/t,c[1]=l[0][1]/t,i&&(t=6*l[0][4],c[2]=0!==t?l[0][3]/t:0),(c[0]<h[0]||c[0]>h[1]||c[1]<h[2]||c[1]>h[3]||i&&(c[2]<h[4]||c[2]>h[5]))&&(c.length=0)}if(!c.length){const t=e.lengths[0]?a(d,0,f[0],i,r):null;if(!t)return null;c[0]=t[0],c[1]=t[1],i&&t.length>2&&(c[2]=t[2])}return t}function n(t,e,i,r,n,a,o=1){const u=s(n,a);let c=i,l=i+u,h=0,f=0,d=0,p=0,m=0;for(let s=0,g=r-1;s<g;s++,c+=u,l+=u){const i=e[c],s=e[c+1],r=e[c+2],a=e[l],o=e[l+1],u=e[l+2];let y=i*o-a*s;p+=y,h+=(i+a)*y,f+=(s+o)*y,n&&(y=i*u-a*r,d+=(r+u)*y,m+=y),i<t[0]&&(t[0]=i),i>t[1]&&(t[1]=i),s<t[2]&&(t[2]=s),s>t[3]&&(t[3]=s),n&&(r<t[4]&&(t[4]=r),r>t[5]&&(t[5]=r))}if(p*o>0&&(p*=-1),m*o>0&&(m*=-1),!p)return null;const y=[h,f,.5*p];return n&&(y[3]=d,y[4]=.5*m),y}function a(t,e,i,r,n){const a=s(r,n);let h=e,f=e+a,d=0,p=0,m=0,y=0;for(let s=0,g=i-1;s<g;s++,h+=a,f+=a){const e=t[h],i=t[h+1],s=t[h+2],n=t[f],a=t[f+1],g=t[f+2],x=r?u(e,i,s,n,a,g):o(e,i,n,a);if(x)if(d+=x,r){const t=l(e,i,s,n,a,g);p+=x*t[0],m+=x*t[1],y+=x*t[2]}else{const t=c(e,i,n,a);p+=x*t[0],m+=x*t[1]}}return d>0?r?[p/d,m/d,y/d]:[p/d,m/d]:i>0?r?[t[e],t[e+1],t[e+2]]:[t[e],t[e+1]]:null}function o(t,e,i,s){const r=i-t,n=s-e;return Math.sqrt(r*r+n*n)}function u(t,e,i,s,r,n){const a=s-t,o=r-e,u=n-i;return Math.sqrt(a*a+o*o+u*u)}function c(t,e,i,s){return[t+.5*(i-t),e+.5*(s-e)]}function l(t,e,i,s,r,n){return[t+.5*(s-t),e+.5*(r-e),i+.5*(n-i)]}i.d(e,"a",(function(){return r}))},610:function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));const s={convertToGEGeometry:function(t,e){return null==e?null:t.convertJSONToGeometry(e)},exportPoint:function(t,e,i){const s=new r(t.getPointX(e),t.getPointY(e),i),n=t.hasZ(e),a=t.hasM(e);return n&&(s.z=t.getPointZ(e)),a&&(s.m=t.getPointM(e)),s},exportPolygon:function(t,e,i){return new n(t.exportPaths(e),i,t.hasZ(e),t.hasM(e))},exportPolyline:function(t,e,i){return new a(t.exportPaths(e),i,t.hasZ(e),t.hasM(e))},exportMultipoint:function(t,e,i){return new o(t.exportPoints(e),i,t.hasZ(e),t.hasM(e))},exportExtent:function(t,e,i){const s=t.hasZ(e),r=t.hasM(e),n=new u(t.getXMin(e),t.getYMin(e),t.getXMax(e),t.getYMax(e),i);if(s){const i=t.getZExtent(e);n.zmin=i.vmin,n.zmax=i.vmax}if(r){const i=t.getMExtent(e);n.mmin=i.vmin,n.mmax=i.vmax}return n}};class r{constructor(t,e,i){this.x=t,this.y=e,this.spatialReference=i,this.z=void 0,this.m=void 0}}class n{constructor(t,e,i,s){this.rings=t,this.spatialReference=e,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),s&&(this.hasM=s)}}class a{constructor(t,e,i,s){this.paths=t,this.spatialReference=e,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),s&&(this.hasM=s)}}class o{constructor(t,e,i,s){this.points=t,this.spatialReference=e,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),s&&(this.hasM=s)}}class u{constructor(t,e,i,s,r){this.xmin=t,this.ymin=e,this.xmax=i,this.ymax=s,this.spatialReference=r,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},620:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var s=i(285),r=Object(s.b)((function(t){var e;void 0!==(e=function(){function t(i,s,r,n,a){for(;n>r;){if(n-r>600){var o=n-r+1,u=s-r+1,c=Math.log(o),l=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*l*(o-l)/o)*(u-o/2<0?-1:1);t(i,s,Math.max(r,Math.floor(s-u*l/o+h)),Math.min(n,Math.floor(s+(o-u)*l/o+h)),a)}var f=i[s],d=r,p=n;for(e(i,r,s),a(i[n],f)>0&&e(i,r,n);d<p;){for(e(i,d,p),d++,p--;a(i[d],f)<0;)d++;for(;a(i[p],f)>0;)p--}0===a(i[r],f)?e(i,r,p):e(i,++p,n),p<=s&&(r=p+1),s<=p&&(n=p-1)}}function e(t,e,i){var s=t[e];t[e]=t[i],t[i]=s}function i(t,e){return t<e?-1:t>e?1:0}return function(e,s,r,n,a){t(e,s,r||0,n||e.length-1,a||i)}}())&&(t.exports=e)}))},669:function(t,e,i){"use strict";i.d(e,"a",(function(){return o})),i.d(e,"b",(function(){return u})),i.d(e,"c",(function(){return a}));var s=i(7),r=i(14),n=i(260);function a(t){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===t||"esriGeometryMultipoint"===t?n.a:"esriGeometryPolyline"===t?n.c:n.b}}}function o(t,e){if(Object(s.a)("csp-restrictions"))return()=>({[e]:null,...t});try{let i=`this.${e} = null;`;for(const e in t)i+=`this${e.indexOf(".")?`["${e}"]`:`.${e}`} = ${JSON.stringify(t[e])};`;const s=new Function(i);return()=>new s}catch(i){return()=>({[e]:null,...t})}}function u(t={}){return[{name:"New Feature",description:"",prototype:{attributes:Object(r.a)(t)}}]}},699:function(t,e,i){"use strict";function s(t,e){if(!t)return null;const i=e.featureAdapter,{startTimeField:s,endTimeField:r}=t;let n=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(s&&r)e.forEach((t=>{const e=i.getAttribute(t,s),o=i.getAttribute(t,r);null==e||isNaN(e)||(n=Math.min(n,e)),null==o||isNaN(o)||(a=Math.max(a,o))}));else{const t=s||r;e.forEach((e=>{const s=i.getAttribute(e,t);null==s||isNaN(s)||(n=Math.min(n,s),a=Math.max(a,s))}))}return{start:n,end:a}}function r(t,e,i){if(!e||!t)return null;const{startTimeField:s,endTimeField:r}=t;if(!s&&!r)return null;const{start:n,end:a}=e;return null===n&&null===a?null:void 0===n&&void 0===a?()=>!1:s&&r?function(t,e,i,s,r){return null!=s&&null!=r?n=>{const a=t.getAttribute(n,e),o=t.getAttribute(n,i);return(null==a||a<=r)&&(null==o||o>=s)}:null!=s?e=>{const r=t.getAttribute(e,i);return null==r||r>=s}:null!=r?i=>{const s=t.getAttribute(i,e);return null==s||s<=r}:void 0}(i,s,r,n,a):function(t,e,i,s){return null!=i&&null!=s&&i===s?s=>t.getAttribute(s,e)===i:null!=i&&null!=s?r=>{const n=t.getAttribute(r,e);return n>=i&&n<=s}:null!=i?s=>t.getAttribute(s,e)>=i:null!=s?i=>t.getAttribute(i,e)<=s:void 0}(i,s||r,n,a)}i.d(e,"a",(function(){return s})),i.d(e,"b",(function(){return r}))},726:function(t,e,i){"use strict";var s=i(14),r=i(2),n=i(13),a=i(9),o=i(34),u=i(267),c=i(63),l=i(50),h=i(82),f=i(370),d=i(496),p=i(356),m=i(750),y=i(132),g=i(598),x=i(471),b=i(549);const _=new class{constructor(t,e){this._cache=new x.a(t),this._invalidCache=new x.a(e)}get(t,e){const i=`${e.uid}:${t}`,s=this._cache.get(i);if(s)return s;if(void 0!==this._invalidCache.get(i))return null;try{const s=b.WhereClause.create(t,e);return this._cache.put(i,s),s}catch{return this._invalidCache.put(i,null),null}}}(50,500),I="feature-store:unsupported-query",w=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeDate"]);function S(t,e){return t?_.get(t,e):null}function O(t,e,i,s=!0){const r=[];for(const o of e)if("*"!==o&&!t.has(o))if(s){const e=j(o);try{const i=S(e,t);if(!i)throw new n.a(I,"invalid SQL expression",{where:e});if(!i.isStandardized)throw new n.a(I,"expression is not standard",{clause:i});O(t,i.fieldNames,"expression contains missing fields")}catch(a){const t=a&&a.details;if(t&&(t.clause||t.where))throw a;t&&t.missingFields?r.push(...t.missingFields):r.push(o)}}else r.push(o);if(r.length)throw new n.a(I,i,{missingFields:r})}function j(t){return t.split(" as ")[0]}function R(t,e){const i=e.get(t);return!!i&&!w.has(i.type)}var F=i(736),M=i(699),v=i(426),T=i(326),A=class{constructor(t,e,i){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=t.returnDistinctValues,this.fieldsIndex=i,this.featureAdapter=e;const s=t.outFields;if(s&&-1===s.indexOf("*")){this.outFields=s;let t=0;for(const e of s){const s=j(e),r=this.fieldsIndex.get(s),n=r?null:S(s,i),a=r?r.name:e.split(" as ")[1]||"FIELD_EXP_"+t++;this._fieldDataCache.set(e,{alias:a,clause:n})}}}countDistinctValues(t){return this.returnDistinctValues?(t.forEach((t=>this.getAttributes(t))),this._returnDistinctMap.size):t.length}getAttributes(t){const e=this._processAttributesForOutFields(t);return this._processAttributesForDistinctValues(e)}getFieldValue(t,e,i){const s=i?i.name:e;let r=null;return this._fieldDataCache.has(s)?r=this._fieldDataCache.get(s).clause:i||(r=S(e,this.fieldsIndex),this._fieldDataCache.set(s,{alias:s,clause:r})),i?this.featureAdapter.getAttribute(t,s):r.calculateValue(t,this.featureAdapter)}validateItem(t,e){return this._fieldDataCache.has(e)||this._fieldDataCache.set(e,{alias:e,clause:S(e,this.fieldsIndex)}),this._fieldDataCache.get(e).clause.testFeature(t,this.featureAdapter)}validateItems(t,e){return this._fieldDataCache.has(e)||this._fieldDataCache.set(e,{alias:e,clause:S(e,this.fieldsIndex)}),this._fieldDataCache.get(e).clause.testSet(t,this.featureAdapter)}_processAttributesForOutFields(t){const e=this.outFields;if(!e||!e.length)return this.featureAdapter.getAttributes(t);const i={};for(const s of e){const{alias:e,clause:r}=this._fieldDataCache.get(s);i[e]=r?r.calculateValue(t,this.featureAdapter):this.featureAdapter.getAttribute(t,e)}return i}_processAttributesForDistinctValues(t){if(Object(r.h)(t)||!this.returnDistinctValues)return t;const e=this.outFields,i=[];if(e)for(const r of e){const{alias:e}=this._fieldDataCache.get(r);i.push(t[e])}else for(const r in t)i.push(t[r]);const s=`${(e||["*"]).join(",")}=${i.join(",")}`;let n=this._returnDistinctMap.get(s)||0;return this._returnDistinctMap.set(s,++n),n>1?null:t}};function N(t){return t.substr(24,12)+t.substr(19,4)+t.substr(16,2)+t.substr(14,2)+t.substr(11,2)+t.substr(9,2)+t.substr(6,2)+t.substr(4,2)+t.substr(2,2)+t.substr(0,2)}function Q(t,e,i){return(i?t>e:t<e)?-1:(i?t<e:t>e)?1:0}function E(t,e,i){return i?e-t:t-e}function C(t,e,i,s){if(i&&"esriFieldTypeDate"===i.type){const i=new Date(t).getTime(),r=new Date(e).getTime();if(!isNaN(i)&&!isNaN(r))return E(i,r,s)}if("number"==typeof t&&"number"==typeof e)return E(t,e,s);if("string"==typeof t&&"string"==typeof e){const r=t.toUpperCase(),n=e.toUpperCase();return!i||"esriFieldTypeGUID"!==i.type&&"esriFieldTypeGlobalID"!==i.type?Q(r,n,s):Q(N(r),N(n),s)}return s?1:-1}class P{constructor(t,e,i){this.items=t,this.queryGeometry=e,this.definitionExpression=i.definitionExpression,this.geometryType=i.geometryType,this.hasM=i.hasM,this.hasZ=i.hasZ,this.objectIdField=i.objectIdField,this.spatialReference=i.spatialReference,this.fieldsIndex=i.fieldsIndex,this.timeInfo=i.timeInfo,this.featureAdapter=i.featureAdapter,this.aggregateAdapter=i.aggregateAdapter}get size(){return this.items.length}createQueryResponseForCount(t){const e=new A(t,this.featureAdapter,this.fieldsIndex);if(!t.outStatistics)return e.countDistinctValues(this.items);const{groupByFieldsForStatistics:i,having:s}=t;if(!(null==i?void 0:i.length))return 1;const r=new Map,n=new Map,a=new Set,o=t.outStatistics;for(const u of o){const{statisticType:t}=u,o="exceedslimit"!==t?u.onStatisticField:void 0;if(!n.has(o)){const t=[];for(const s of i){const i=this._getAttributeValues(e,s,r);t.push(i)}n.set(o,this._calculateUniqueValues(t))}const c=n.get(o);for(const i in c){const{data:t,items:r}=c[i],n=t.join(",");s&&!e.validateItems(r,s)||a.add(n)}}return a.size}createQueryResponse(t){let e;return e=t.outStatistics?t.outStatistics.some((t=>"exceedslimit"===t.statisticType))?this._createExceedsLimitQueryResponse(t):this._createStatisticsQueryResponse(t):this._createFeatureQueryResponse(t),t.returnQueryGeometry&&(Object(o.i)(t.outSR)&&!Object(o.c)(this.queryGeometry.spatialReference,t.outSR)?e.queryGeometry=Object(F.d)({spatialReference:t.outSR,...Object(g.b)(this.queryGeometry,this.queryGeometry.spatialReference,t.outSR)}):e.queryGeometry=Object(F.d)({spatialReference:t.outSR,...this.queryGeometry})),e}executeAttributesQuery(t){const e=S(t.where,this.fieldsIndex);if(!e)return Object(a.u)(this);if(e.isStandardized){let i=0;const s=[];for(const t of this.items)e.testFeature(t,this.featureAdapter)&&(s[i++]=t);const r=new P(s,this.queryGeometry,this);return r.definitionExpression=t.where,Object(a.u)(r)}return Object(a.t)(new TypeError("Where clause is not standardized"))}executeAggregateIdsQuery(t){if(!t.aggregateIds||!t.aggregateIds.length||Object(r.h)(this.aggregateAdapter))return Object(a.u)(this);const e=new Set;for(const s of t.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(s).forEach((t=>e.add(t)));const i=this.featureAdapter.getObjectId;return Object(a.u)(new P(this.items.filter((t=>e.has(i(t)))),this.queryGeometry,this))}executeObjectIdsQuery(t){if(!t.objectIds||!t.objectIds.length)return Object(a.u)(this);const e=new Set(t.objectIds),i=this.featureAdapter.getObjectId;return Object(a.u)(new P(this.items.filter((t=>e.has(i(t)))),this.queryGeometry,this))}executeTimeQuery(t){const e=Object(M.b)(this.timeInfo,t.timeExtent,this.featureAdapter);if(!Object(r.i)(e))return Object(a.u)(this);const i=this.items.filter(e);return Object(a.u)(new P(i,this.queryGeometry,this))}filterLatest(){const{trackIdField:t,startTimeField:e,endTimeField:i}=this.timeInfo,s=i||e,r=new Map,n=this.featureAdapter.getAttribute;for(const a of this.items){const e=n(a,t),i=n(a,s),o=r.get(e);(!o||i>n(o,s))&&r.set(e,a)}const o=Array.from(r.values());return Object(a.u)(new P(o,this.queryGeometry,this))}async project(t){if(!t||Object(o.c)(this.spatialReference,t))return this;const e=this.featureAdapter,i=(await Object(g.c)(this.items.map((t=>Object(F.f)(this.geometryType,this.hasZ,this.hasM,e.getGeometry(t)))),this.spatialReference,t)).map(((t,i)=>e.cloneWithGeometry(this.items[i],Object(v.d)(t,this.hasZ,this.hasM))));return new P(i,this.queryGeometry,{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:t,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})}_sortFeatures(t,e,i){if(t.length>1&&e&&e.length)for(const s of e.reverse()){const e=s.split(" "),r=e[0],n=this.fieldsIndex.get(r),a=e[1]&&"desc"===e[1].toLowerCase();t.sort(((t,e)=>C(i(t,r,n),i(e,r,n),n,a)))}}_createFeatureQueryResponse(t){const e=this.items,{geometryType:i,hasM:s,hasZ:r,objectIdField:n,spatialReference:a}=this,{outFields:o,outSR:u,quantizationParameters:c,resultRecordCount:l,resultOffset:h,returnZ:f,returnM:d}=t,p=null!=l&&e.length>(h||0)+l,m=o&&(o.indexOf("*")>-1?[...this.fieldsIndex.fields]:o.map((t=>this.fieldsIndex.get(t))));return{exceededTransferLimit:p,features:this._createFeatures(t,e),fields:m,geometryType:i,hasM:s&&d,hasZ:r&&f,objectIdFieldName:n,spatialReference:Object(F.d)(u||a),transform:c&&Object(T.c)(c)||null}}_createFeatures(t,e){const i=new A(t,this.featureAdapter,this.fieldsIndex),{hasM:s,hasZ:r}=this,{orderByFields:n,quantizationParameters:a,returnGeometry:o,returnCentroid:u,maxAllowableOffset:c,resultOffset:l,resultRecordCount:h,returnZ:f=!1,returnM:d=!1}=t,p=r&&f,m=s&&d;let y=[],g=0;const x=[...e];if(this._sortFeatures(x,n,((t,e,s)=>i.getFieldValue(t,e,s))),o||u){const t=Object(T.c)(a);if(o&&!u)for(const e of x)y[g++]={attributes:i.getAttributes(e),geometry:Object(F.f)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(e),c,t,p,m)};else if(!o&&u)for(const e of x)y[g++]={attributes:i.getAttributes(e),centroid:Object(F.i)(this,this.featureAdapter.getCentroid(e,this),t)};else for(const e of x)y[g++]={attributes:i.getAttributes(e),centroid:Object(F.i)(this,this.featureAdapter.getCentroid(e,this),t),geometry:Object(F.f)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(e),c,t,p,m)}}else for(const _ of x){const t=i.getAttributes(_);t&&(y[g++]={attributes:t})}const b=l||0;if(null!=h){const t=b+h;y=y.slice(b,Math.min(y.length,t))}return y}_createExceedsLimitQueryResponse(t){let e=!1,i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY;for(const n of t.outStatistics)if("exceedslimit"===n.statisticType){i=null!=n.maxPointCount?n.maxPointCount:Number.POSITIVE_INFINITY,s=null!=n.maxRecordCount?n.maxRecordCount:Number.POSITIVE_INFINITY,r=null!=n.maxVertexCount?n.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)e=this.items.length>i;else if(this.items.length>s)e=!0;else{const t=this.hasZ?this.hasM?4:3:this.hasM?3:2,i=this.featureAdapter;e=this.items.reduce(((t,e)=>{const s=i.getGeometry(e);return t+(s&&s.coords.length||0)}),0)/t>r}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(e)}}]}}_createStatisticsQueryResponse(t){const e={attributes:{}},i=[],s=new Map,r=new Map,n=new Map,a=new Map,o=new A(t,this.featureAdapter,this.fieldsIndex),u=t.outStatistics,{groupByFieldsForStatistics:c,having:l,orderByFields:h}=t,f=c&&c.length,d=!!f,p=d&&c[0],m=d&&!this.fieldsIndex.get(p);for(const g of u){const{outStatisticFieldName:t,statisticType:u}=g,h=g,y="exceedslimit"!==u?g.onStatisticField:void 0,x="percentile_disc"===u||"percentile_cont"===u,b=d&&1===f&&(y===p||m)&&"count"===u;if(d){if(!n.has(y)){const t=[];for(const e of c){const i=this._getAttributeValues(o,e,s);t.push(i)}n.set(y,this._calculateUniqueValues(t))}const e=n.get(y);for(const i in e){const{count:r,data:n,items:u,itemPositions:f}=e[i],d=n.join(",");if(!l||o.validateItems(u,l)){const e=a.get(d)||{attributes:{}};let i=null;if(b)i=r;else{const t=this._getAttributeValues(o,y,s),e=f.map((e=>t[e]));i=x&&"statisticParameters"in h?this._getPercentileValue(h,e):this._getStatisticValue(h,e)}e.attributes[t]=i,c.forEach(((t,i)=>e.attributes[this.fieldsIndex.get(t)?t:`EXPR_${i+1}`]=n[i])),a.set(d,e)}}}else{const i=this._getAttributeValues(o,y,s);e.attributes[t]=x&&"statisticParameters"in h?this._getPercentileValue(h,i):this._getStatisticValue(h,i,r)}i.push({name:t,alias:t,type:"esriFieldTypeDouble"})}const y=d?Array.from(a.values()):[e];return this._sortFeatures(y,h,((t,e)=>t.attributes[e])),{fields:i,features:y}}_getStatisticValue(t,e,i){const{onStatisticField:s,statisticType:r}=t,n=i&&i.has(s)?i.get(s):this._calculateStatistics(e);return i&&i.set(s,n),n["var"===r?"variance":r]}_getPercentileValue(t,e){const{onStatisticField:i,statisticParameters:s,statisticType:r}=t,{value:n,orderBy:a}=s,o="desc"===a,u=this.fieldsIndex.get(i),c=[...e].filter((t=>null!=t)).sort(((t,e)=>C(t,e,u,o)));return this._calculatePercentile(c,n,"percentile_disc"===r)}_getAttributeValues(t,e,i){if(i.has(e))return i.get(e);const s=this.fieldsIndex.get(e),r=this.items.map((i=>t.getFieldValue(i,e,s)));return i.set(e,r),r}_calculateStatistics(t){let e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,s=null,r=null,n=null,a=null;const o=[];let u=0;for(const c of t)"string"==typeof c?u++:null==c||isNaN(c)||(s+=c,e=Math.min(e,c),i=Math.max(i,c),o.push(c),u++);if(u){r=s/u;let t=0;for(const e of o)t+=Math.pow(e-r,2);a=u>1?t/(u-1):0,n=Math.sqrt(a)}else e=null,i=null;return{avg:r,count:u,max:i,min:e,stddev:n,sum:s,variance:a}}_calculateUniqueValues(t){const e={},i=this.items,s=i.length;for(let r=0;r<s;r++){const s=i[r],n=[];for(const e of t)n.push(e[r]);const a=n.join(",");null==e[a]?e[a]={count:1,data:n,items:[s],itemPositions:[r]}:(e[a].count++,e[a].items.push(s),e[a].itemPositions.push(r))}return e}_calculatePercentile(t,e,i){if(0===t.length)return null;if(e<=0)return t[0];if(e>=1)return t[t.length-1];const s=(t.length-1)*e,r=Math.floor(s),n=r+1,a=s%1,o=t[r],u=t[n];return n>=t.length||i||"string"==typeof o||"string"==typeof u?o:o*(1-a)+u*a}}var G=P;const B=new Set,Y=new f.c(2e6);let V=0;const q=Object(y.b)(),D=Object(y.b)();e.a=class{constructor(t){this.capabilities={query:m.a},this.geometryType=t.geometryType,this.hasM=t.hasM,this.hasZ=t.hasZ,this.objectIdField=t.objectIdField,this.spatialReference=t.spatialReference,this.definitionExpression=t.definitionExpression,this.featureStore=t.featureStore,this.aggregateAdapter=t.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",(()=>this.clearCache())),this.timeInfo=t.timeInfo,t.cacheSpatialQueries&&(this._geometryQueryCache=new f.b(V+++"$$",Y)),this.fieldsIndex=new p.a(t.fields),t.scheduler&&t.task&&(this._frameQueue=new d.a,this._frameTask=t.scheduler.registerTask(t.task,(t=>this._update(t)),(()=>this._frameQueue.length>0)))}destroy(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null),this.clearCache(),this._geometryQueryCache&&this._geometryQueryCache.destroy(),this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null),this.fieldsIndex.destroy()}get featureAdapter(){return this.featureStore.featureAdapter}get fullExtent(){const t=this.featureStore.fullBounds;return t?{xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:Object(F.d)(this.spatialReference)}:null}get timeExtent(){return this.timeInfo?(this._timeExtent||(this._timeExtent=Object(M.a)(this.timeInfo,this.featureStore)),this._timeExtent):null}clearCache(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null,this._timeExtent=null}async executeQuery(t={},e){let i,r=Object(s.a)(t);try{r=await this._schedule((()=>Object(F.b)(r,this.definitionExpression,this.spatialReference)),e),r=await this._reschedule((()=>this._checkQuerySupport(r)),e),i=await this._reschedule((()=>this._executeGeometryQuery(r,e)),e),i=await this._reschedule((()=>i.executeAggregateIdsQuery(r)),e),i=await this._reschedule((()=>i.executeObjectIdsQuery(r)),e),i=await this._reschedule((()=>i.executeTimeQuery(r)),e),i=await this._reschedule((()=>i.executeAttributesQuery(r)),e)}catch(n){if(n!==F.a)throw n;i=new G([],null,this)}return i.createQueryResponse(r)}async executeQueryForCount(t={},e){let i,r=Object(s.a)(t);r.returnGeometry=!1,r.returnCentroid=!1,r.outSR=null;try{r=await this._schedule((()=>Object(F.b)(r,this.definitionExpression,this.spatialReference)),e),r=await this._reschedule((()=>this._checkQuerySupport(r)),e),i=await this._reschedule((()=>this._executeGeometryQuery(r,e)),e),i=await this._reschedule((()=>i.executeAggregateIdsQuery(r)),e),i=await this._reschedule((()=>i.executeObjectIdsQuery(r)),e),i=await this._reschedule((()=>i.executeTimeQuery(r)),e),i=await this._reschedule((()=>i.executeAttributesQuery(r)),e)}catch(n){if(n!==F.a)throw n;return 0}return i.createQueryResponseForCount(r)}async executeQueryForExtent(t={},e){let i,r=Object(s.a)(t);const n=r.outSR;try{r=await this._schedule((()=>Object(F.b)(r,this.definitionExpression,this.spatialReference)),e),r=await this._reschedule((()=>this._checkQuerySupport(r)),e),r.returnGeometry=!0,r.returnCentroid=!1,r.outSR=null,i=await this._reschedule((()=>this._executeGeometryQuery(r,e)),e),i=await this._reschedule((()=>i.executeAggregateIdsQuery(r)),e),i=await this._reschedule((()=>i.executeObjectIdsQuery(r)),e),i=await this._reschedule((()=>i.executeTimeQuery(r)),e),i=await this._reschedule((()=>i.executeAttributesQuery(r)),e);const t=i.size;if(!t)return{count:t,extent:null};Object(y.m)(D,y.a),this.featureStore.forEachBounds(i.items,(t=>Object(y.e)(D,t)),q);const s={xmin:D[0],ymin:D[1],xmax:D[3],ymax:D[4],spatialReference:Object(F.d)(this.spatialReference)};this.hasZ&&isFinite(D[2])&&isFinite(D[5])&&(s.zmin=D[2],s.zmax=D[5]);const a=Object(g.b)(s,i.spatialReference,n);if(a.spatialReference=Object(F.d)(n||this.spatialReference),a.xmax-a.xmin==0){const t=Object(l.c)(a.spatialReference);a.xmin-=t,a.xmax+=t}if(a.ymax-a.ymin==0){const t=Object(l.c)(a.spatialReference);a.ymin-=t,a.ymax+=t}if(this.hasZ&&null!=a.zmin&&null!=a.zmax&&a.zmax-a.zmin==0){const t=Object(l.c)(a.spatialReference);a.zmin-=t,a.zmax+=t}return{count:t,extent:a}}catch(a){if(a===F.a)return{count:0,extent:null};throw a}}async executeQueryForIds(t={},e){return this.executeQueryForIdSet(t,e).then((t=>Array.from(t)))}async executeQueryForIdSet(t={},e){let i,r=Object(s.a)(t);r.returnGeometry=!1,r.returnCentroid=!1,r.outSR=null;try{r=await this._schedule((()=>Object(F.b)(r,this.definitionExpression,this.spatialReference)),e),r=await this._reschedule((()=>this._checkQuerySupport(r)),e),i=await this._reschedule((()=>this._executeGeometryQuery(r,e)),e),i=await this._reschedule((()=>i.executeAggregateIdsQuery(r)),e),i=await this._reschedule((()=>i.executeObjectIdsQuery(r)),e),i=await this._reschedule((()=>i.executeTimeQuery(r)),e),i=await this._reschedule((()=>i.executeAttributesQuery(r)),e);const t=i.items,s=new Set;return await this._reschedule((()=>{for(const e of t)s.add(i.featureAdapter.getObjectId(e))}),e),s}catch(n){if(n===F.a)return new Set;throw n}}async executeQueryForLatestObservations(t={},e){if(!this.timeInfo||!this.timeInfo.trackIdField)throw new n.a("feature-store:unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:t,timeInfo:this.timeInfo});let i,r=Object(s.a)(t);try{r=await this._schedule((()=>Object(F.b)(r,this.definitionExpression,this.spatialReference)),e),r=await this._reschedule((()=>this._checkQuerySupport(r)),e),i=await this._reschedule((()=>this._executeGeometryQuery(r,e)),e),i=await this._reschedule((()=>i.executeAggregateIdsQuery(r)),e),i=await this._reschedule((()=>i.executeObjectIdsQuery(r)),e),i=await this._reschedule((()=>i.executeTimeQuery(r)),e),i=await this._reschedule((()=>i.executeAttributesQuery(r)),e),i=await this._reschedule((()=>i.filterLatest()),e)}catch(a){if(a!==F.a)throw a;i=new G([],null,this)}return i.createQueryResponse(r)}async _schedule(t,e){return this._frameQueue?this._frameQueue.push(t,e):t()}async _reschedule(t,e){return this._frameQueue?this._frameQueue.unshift(t,e):t()}_update(t){for(this._budget=t;!t.done&&this._frameQueue&&this._frameQueue.process();)t.madeProgress();this._budget=null}_getAll(){if(!this._allItems){const t=[];this.featureStore.forEach((e=>t.push(e))),this._allItems=new G(t,null,this)}return this._allItems}async _executeGeometryQuery(t,e){const{geometry:i,outSR:s,spatialRel:n}=t,a=Object(o.i)(s)&&!Object(o.c)(this.spatialReference,s),u=this._geometryQueryCache?a?JSON.stringify({geometry:i,spatialRelationship:n,outSpatialReference:s}):JSON.stringify({geometry:i,spatialRelationship:n}):null;if(u){const t=this._geometryQueryCache.get(u);if(!Object(r.j)(t))return t}const c=async e=>{if(a&&(t.returnGeometry||t.returnCentroid)){const t=await e.project(s);return u&&this._geometryQueryCache.put(u,t,t.size||1),t}return u&&this._geometryQueryCache.put(u,e,e.size||1),e};if(!i)return c(this._getAll());const l=this.featureAdapter;if("esriSpatialRelDisjoint"===n){const t=this._searchFeatures(this._getQueryBBoxes(i));if(!t.length)return c(this._getAll());let s,r;const a=new Set;for(const e of t)a.add(l.getObjectId(e));return await this._reschedule((()=>{let t=0;s=new Array(a.size),this.featureStore.forEach((e=>s[t++]=e)),r=a}),e),c(await this._reschedule((async()=>{const t=await Object(F.g)(n,i,this.geometryType,this.hasZ,this.hasM);return new G(await this._runSpatialFilter(s,(e=>!r.has(l.getObjectId(e))||t(l.getGeometry(e))),e),i,this)}),e))}const h=this._searchFeatures(this._getQueryBBoxes(i));if(!h.length){const t=new G([],i,this);return u&&this._geometryQueryCache.put(u,t,t.size||1),t}if(this._canExecuteSoloPass(i,t))return c(new G(h,i,this));const f=await Object(F.g)(n,i,this.geometryType,this.hasZ,this.hasM),d=await this._runSpatialFilter(h,(t=>f(l.getGeometry(t))),e);return c(new G(d,i,this))}async _runSpatialFilter(t,e,i){if(!e)return t;if(!this._budget)return t.filter((t=>e(t)));let s=0;const r=new Array,n=async()=>{for(;s<t.length;){const a=t[s];e(a)&&r.push(a),this._budget.done&&await this._reschedule((()=>n()),i),++s}};return this._reschedule((()=>n()),i).then((()=>r))}_canExecuteSoloPass(t,e){const{geometryType:i}=this,{spatialRel:s}=e;return Object(F.c)(t)&&("esriSpatialRelEnvelopeIntersects"===s||"esriGeometryPoint"===i&&("esriSpatialRelIntersects"===s||"esriSpatialRelContains"===s||"esriSpatialRelWithin"===s))}_getQueryBBoxes(t){if(Object(F.c)(t)){if(Object(c.d)(t))return[Object(h.k)(t.xmin,t.ymin,t.xmax,t.ymax)];if(Object(c.g)(t))return t.rings.map((t=>Object(h.k)(Math.min(t[0][0],t[2][0]),Math.min(t[0][1],t[2][1]),Math.max(t[0][0],t[2][0]),Math.max(t[0][1],t[2][1]))))}return[Object(u.a)(Object(h.f)(),t)]}_searchFeatures(t){for(const s of t)this.featureStore.forEachInBounds(s,(t=>{B.add(t)}));const e=new Array(B.size);let i=0;return B.forEach((t=>e[i++]=t)),B.clear(),e}async _checkQuerySupport(t){if(t.distance<0||null!=t.geometryPrecision||t.multipatchOption||t.pixelSize||t.relationParam||t.text)throw new n.a("feature-store:unsupported-query","Unsupported query options",{query:t});return Object(a.b)([this._checkAttributesQuerySupport(t),this._checkStatisticsQuerySupport(t),Object(F.e)(t,this.geometryType,this.spatialReference),Object(g.a)(this.spatialReference,t.outSR)]).then((()=>t))}_checkAttributesQuerySupport(t){const{outFields:e,orderByFields:i,returnDistinctValues:s,outStatistics:r}=t,a=r?r.map((t=>t.outStatisticFieldName&&t.outStatisticFieldName.toLowerCase())):[];if(i&&i.length>0){const t=" asc",e=" desc",s=i.map((i=>{const s=i.toLowerCase();return s.indexOf(t)>-1?s.split(t)[0]:s.indexOf(e)>-1?s.split(e)[0]:i})).filter((t=>-1===a.indexOf(t)));O(this.fieldsIndex,s,"orderByFields contains missing fields")}if(e&&e.length>0)O(this.fieldsIndex,e,"outFields contains missing fields");else if(s)throw new n.a("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:t});!function(t,e){if(!e)return!0;const i=_.get(e,t);if(!i)throw new n.a(I,"invalid SQL expression",{where:e});if(!i.isStandardized)throw new n.a(I,"where clause is not standard",{where:e});O(t,i.fieldNames,"where clause contains missing fields")}(this.fieldsIndex,t.where)}async _checkStatisticsQuerySupport(t){const{outStatistics:e,groupByFieldsForStatistics:i,having:s}=t,r=i&&i.length,a=e&&e.length;if(s){if(!r||!a)throw new n.a("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:t});!function(t,e,i){if(!e)return!0;const s=_.get(e,t);if(!s)throw new n.a(I,"invalid SQL expression",{having:e});if(!s.isAggregate)throw new n.a(I,"having does not contain a valid aggregate function",{having:e});const r=s.fieldNames;if(O(t,r,"having contains missing fields"),!s.getExpressions().every((e=>{const{aggregateType:s,field:r}=e,n=t.has(r)&&t.get(r).name;return i.some((e=>{const{onStatisticField:i,statisticType:r}=e;return(t.has(i)&&t.get(i).name)===n&&r.toLowerCase().trim()===s}))})))throw new n.a(I,"expressions in having should also exist in outStatistics",{having:e})}(this.fieldsIndex,s,e)}if(a){if(!function(t){return t.every((t=>"exceedslimit"!==t.statisticType))}(e))return;const s=e.map((t=>t.onStatisticField));O(this.fieldsIndex,s,"onStatisticFields contains missing fields"),r&&O(this.fieldsIndex,i,"groupByFieldsForStatistics contains missing fields");for(const i of e){const{onStatisticField:e,statisticType:s}=i;if("percentile_disc"!==s&&"percentile_cont"!==s||!("statisticParameters"in i)){if("count"!==s&&e&&R(e,this.fieldsIndex))throw new n.a("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:i,query:t})}else{const{statisticParameters:e}=i;if(!e)throw new n.a("feature-store:unsupported-query","statisticParamters should be set for percentile type",{definition:i,query:t})}}}}}},736:function(t,e,i){"use strict";i.d(e,"a",(function(){return I})),i.d(e,"b",(function(){return M})),i.d(e,"c",(function(){return V})),i.d(e,"d",(function(){return T})),i.d(e,"e",(function(){return Y})),i.d(e,"f",(function(){return F})),i.d(e,"g",(function(){return B})),i.d(e,"h",(function(){return v})),i.d(e,"i",(function(){return R}));var s=i(2),r=i(36),n=i(13),a=i(9),o=i(34),u=i(116),c=i(359),l=i(360),h=i(63),f=i(50),d=i(449),p=i(147),m=i(426),y=(i(606),i(598));function g(t,e){return t?e?4:3:e?3:2}function x(t,e,i,s,r){if(!t)return!1;const n=g(e,i),{coords:a,lengths:o}=t;let u=!1,c=0;for(const l of o)u=b(u,a,n,c,l,s,r),c+=l*n;return u}function b(t,e,i,s,r,n,a){let o=t,u=s;for(let c=s,l=s+r*i;c<l;c+=i){u=c+i,u===l&&(u=s);const t=e[c],r=e[c+1],h=e[u],f=e[u+1];(r<a&&f>=a||f<a&&r>=a)&&t+(a-r)/(f-r)*(h-t)<n&&(o=!o)}return o}const _=new r.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),I=Object.freeze({}),w=new p.a,S=new p.a,O=new p.a,j={esriGeometryPoint:m.m,esriGeometryPolyline:m.o,esriGeometryPolygon:m.n,esriGeometryMultipoint:m.l};function R(t,e,i,s=t.hasZ,r=t.hasM){const n=t.hasZ&&s,a=t.hasM&&r;if(i){const o=Object(m.u)(O,e,t.hasZ,t.hasM,"esriGeometryPoint",i,s,r);return Object(m.m)(o,n,a)}return Object(m.m)(e,n,a)}function F(t,e,i,s,r,n,a=e,o=i){const u=e&&a,c=i&&o,l=s?"coords"in s?s:s.geometry:null;if(!l)return null;if(r){let s=Object(m.q)(S,l,e,i,t,r,a,o);return n&&(s=Object(m.u)(O,s,u,c,t,n)),j[t](s,u,c)}if(n){const s=Object(m.u)(O,l,e,i,t,n,a,o);return j[t](s,u,c)}return Object(m.x)(w,l,e,i,a,o),j[t](w,u,c)}async function M(t,e,i){const{outFields:s,orderByFields:r,groupByFieldsForStatistics:n,outStatistics:a}=t;if(s)for(let o=0;o<s.length;o++)s[o]=s[o].trim();if(r)for(let o=0;o<r.length;o++)r[o]=r[o].trim();if(n)for(let o=0;o<n.length;o++)n[o]=n[o].trim();if(a)for(let o=0;o<a.length;o++)a[o].onStatisticField&&(a[o].onStatisticField=a[o].onStatisticField.trim());return t.geometry&&!t.outSR&&(t.outSR=t.geometry.spatialReference),v(t,e,i)}async function v(t,e,i){if(!t)return null;let{where:r}=t;if(t.where=r=r&&r.trim(),(!r||/^1 *= *1$/.test(r)||e&&e===r)&&(t.where=null),!t.geometry)return t;let n=await async function(t){const{geometry:e,distance:i,units:s}=t;if(null==i||"vertexAttributes"in e)return e;const r=e.spatialReference,n=s?_.fromJSON(s):Object(f.e)(r),a=r&&(Object(o.f)(r)||Object(o.m)(r))?e:await Object(y.a)(r,o.a).then((()=>Object(y.b)(e,o.a)));return(await G().then((t=>t.geodesicBuffer)))(a.spatialReference,a,i,n)}(t);if(t.distance=0,t.units=null,"esriSpatialRelEnvelopeIntersects"===t.spatialRel){const{spatialReference:e}=t.geometry;n=Object(l.a)(n),n.spatialReference=e}t.geometry=n,await Object(y.a)(n.spatialReference,i);const a=(await Object(d.a)(Object(h.a)(n)))[0];if(Object(s.h)(a))throw I;const u=a.toJSON(),c=await Object(y.b)(u,u.spatialReference,i);if(!c)throw I;return c.spatialReference=i,t.geometry=c,t}function T(t){return t&&A in t?JSON.parse(JSON.stringify(t,N)):t}const A="_geVersion",N=(t,e)=>t!==A?e:void 0,Q={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},E={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},C={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},P={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function G(){return i.e(23).then(i.bind(null,797))}function B(t,e,i,s,r){if(Object(h.g)(e)&&"esriGeometryPoint"===i&&("esriSpatialRelIntersects"===t||"esriSpatialRelContains"===t)){const t=Object(m.g)(new p.a,e,!1,!1);return Object(a.u)((e=>function(t,e,i,s){return x(t,e,i,s.coords[0],s.coords[1])}(t,!1,!1,e)))}if(Object(h.g)(e)&&"esriGeometryMultipoint"===i){const i=Object(m.g)(new p.a,e,!1,!1);if("esriSpatialRelContains"===t)return Object(a.u)((t=>function(t,e,i,s,r,n){const a=g(r,n),{coords:o,lengths:u}=s;if(!u)return!1;for(let c=0,l=0;c<u.length;c++,l+=a)if(!x(t,e,i,o[l],o[l+1]))return!1;return!0}(i,!1,!1,t,s,r)))}if(Object(h.d)(e)&&"esriGeometryPoint"===i&&("esriSpatialRelIntersects"===t||"esriSpatialRelContains"===t))return Object(a.u)((t=>Object(u.e)(e,F(i,s,r,t))));if(Object(h.d)(e)&&"esriGeometryMultipoint"===i&&"esriSpatialRelContains"===t)return Object(a.u)((t=>Object(u.d)(e,F(i,s,r,t))));if(Object(h.d)(e)&&"esriSpatialRelIntersects"===t){const t=Object(c.b)(i);return Object(a.u)((n=>t(e,F(i,s,r,n))))}return G().then((n=>{const a=n[Q[t]].bind(null,e.spatialReference,e);return t=>a(F(i,s,r,t))}))}async function Y(t,e,i){const{spatialRel:s,geometry:r}=t;if(r){if(!0!==E[s])throw new n.a("feature-store:unsupported-query","Unsupported query spatial relationship",{query:t});if(Object(o.i)(r.spatialReference)&&Object(o.i)(i)){if(!function(t){return!0===C[Object(h.c)(t)]}(r))throw new n.a("feature-store:unsupported-query","Unsupported query geometry type",{query:t});if(!function(t){return!0===P[t]}(e))throw new n.a("feature-store:unsupported-query","Unsupported layer geometry type",{query:t});if(t.outSR)return Object(y.a)(t.geometry&&t.geometry.spatialReference,t.outSR)}}}function V(t){if(Object(h.d)(t))return!0;if(Object(h.g)(t)){for(const e of t.rings){if(5!==e.length)return!1;if(e[0][0]!==e[1][0]||e[0][0]!==e[4][0]||e[2][0]!==e[3][0]||e[0][1]!==e[3][1]||e[0][1]!==e[4][1]||e[1][1]!==e[2][1])return!1}return!0}return!1}},750:function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));const s={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}}}]);