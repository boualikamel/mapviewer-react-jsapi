(this["webpackJsonptesting-ant-cra"]=this["webpackJsonptesting-ant-cra"]||[]).push([[55],{1025:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var n,r,o,i,s=a(598),c=a(790),l=a(597);function u(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(Object(l.a)(n||(n=Object(s.a)(["#ifndef GL_EXT_shader_texture_lod\nfloat calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\nfloat deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));\nreturn max(0.0, 0.5 * log2(deltaMaxSqr));\n}\n#endif\nvec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {\nvec2 atlasScale = atlasRegion.zw - atlasRegion.xy;\nvec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;\nfloat maxdUV = 0.125;\nvec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;\nvec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;\n#ifdef GL_EXT_shader_texture_lod\nreturn texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);\n#else\nvec2 dUVdxAuto = dFdx(uvAtlas);\nvec2 dUVdyAuto = dFdy(uvAtlas);\nfloat mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);\nfloat autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);\nreturn texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);\n#endif\n}"]))))}function d(e,t){e.include(c.a,t),e.fragment.code.add(Object(l.a)(r||(r=Object(s.a)(["\n  struct TextureLookupParameter {\n    vec2 uv;\n    ","\n  } vtc;\n  "])),t.supportsTextureAtlas?"vec2 size;":"")),1===t.attributeTextureCoordinates&&e.fragment.code.add(Object(l.a)(o||(o=Object(s.a)(["vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\nreturn texture2D(tex, params.uv);\n}"])))),2===t.attributeTextureCoordinates&&(e.include(u),e.fragment.code.add(Object(l.a)(i||(i=Object(s.a)(["vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\nreturn textureAtlasLookup(tex, params.size, params.uv, vuvRegion);\n}"])))))}},1200:function(e,t,a){"use strict";a.r(t),a.d(t,"fetch",(function(){return Ke})),a.d(t,"gltfToEngineResources",(function(){return Ze})),a.d(t,"parseUrl",(function(){return Je}));var n=a(8),r=a.n(n),o=a(15),i=a(11),s=a(14),c=a(418),l=a(10),u=a(146),d=a(616),m=a(236),v=a(603),p=a(54),f=a(85),h=a(625),b=a(682),g=a(726),x=a(992),O=a(1013),j=a(993),y=a(1006),w=a(994),T=a(60),C=a(184),M=a(22),S=a(12),_=a(25),A=a(497),P=a(749),F=a(720),z=a(792),D=a(4),R=a(5),k=a(47),I=a(46),E=a(6),L=a(7),B=a(700),N=a(657),V=a(817),H=a(716),G=a(706),q=a(767),U=a(783),W=a(694),X=a(0),K=a(626),Q=a(828),J=a(740),Z=a(674),$=a(636),Y=a(829),ee=a(696),te=a(705),ae=a(879),ne=a(717),re=a(672),oe=a(680),ie=a(681),se=a(688),ce=a(673),le=a(917),ue=a(939),de=a(467),me=function(e){Object(E.a)(a,e);var t=Object(L.a)(a);function a(){return Object(D.a)(this,a),t.apply(this,arguments)}return Object(R.a)(a,[{key:"initializeProgram",value:function(e){var t=a.shader.get(),n=this.configuration,r=t.build({OITEnabled:0===n.transparencyPassType,output:n.output,viewingMode:e.viewingMode,receiveShadows:n.receiveShadows,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:n.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:n.symbolColors,vvSize:n.vvSize,vvColor:n.vvColor,vvInstancingEnabled:!0,instanced:n.instanced,instancedColor:n.instancedColor,instancedDoublePrecision:n.instancedDoublePrecision,pbrMode:n.usePBR?n.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:n.hasMetalnessAndRoughnessTexture,hasEmissionTexture:n.hasEmissionTexture,hasOcclusionTexture:n.hasOcclusionTexture,hasNormalTexture:n.hasNormalTexture,hasColorTexture:n.hasColorTexture,receiveAmbientOcclusion:n.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:n.normalsTypeDerivate?3:0,doubleSidedMode:n.doubleSidedMode,vertexTangents:n.vertexTangents,attributeTextureCoordinates:n.hasMetalnessAndRoughnessTexture||n.hasEmissionTexture||n.hasOcclusionTexture||n.hasNormalTexture||n.hasColorTexture?1:0,textureAlphaPremultiplied:n.textureAlphaPremultiplied,attributeColor:n.vertexColors,screenSizePerspectiveEnabled:n.screenSizePerspective,verticalOffsetEnabled:n.verticalOffset,offsetBackfaces:n.offsetBackfaces,doublePrecisionRequiresObfuscation:Object(ae.b)(e.rctx),alphaDiscardMode:n.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:n.multipassTerrainEnabled,cullAboveGround:n.cullAboveGround});return new ce.a(e.rctx,r,se.a)}},{key:"bindPass",value:function(e,t){var a,n;Object(ne.b)(this.program,t.camera.projectionMatrix);var r=this.configuration.output;(1===this.configuration.output||t.multipassTerrainEnabled||3===r)&&this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object($.a)(this.program,t)),7===r&&(this.program.setUniform1f("opacity",e.opacity),this.program.setUniform1f("layerOpacity",e.layerOpacity),this.program.setUniform4fv("externalColor",e.externalColor),this.program.setUniform1i("colorMixMode",W.b[e.colorMixMode])),0===r?(t.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",e.ambient),this.program.setUniform3fv("diffuse",e.diffuse),this.program.setUniform4fv("externalColor",e.externalColor),this.program.setUniform1i("colorMixMode",W.b[e.colorMixMode]),this.program.setUniform1f("opacity",e.opacity),this.program.setUniform1f("layerOpacity",e.layerOpacity),this.configuration.usePBR&&Object(Y.b)(this.program,e,this.configuration.isSchematic)):4===r&&Object(Z.b)(this.program,t),Object(te.c)(this.program,e),Object(J.b)(this.program,e,t),Object(W.a)(e.screenSizePerspective,this.program,"screenSizePerspectiveAlignment"),2!==e.textureAlphaMode&&3!==e.textureAlphaMode||this.program.setUniform1f("textureAlphaCutoff",e.textureAlphaCutoff),null==(a=t.shadowMap)||a.bind(this.program),null==(n=t.ssaoHelper)||n.bind(this.program)}},{key:"bindDraw",value:function(e){var t=this.configuration.instancedDoublePrecision?Object(f.g)(e.camera.viewInverseTransposeMatrix[3],e.camera.viewInverseTransposeMatrix[7],e.camera.viewInverseTransposeMatrix[11]):e.origin;Object(ne.d)(this.program,t,e.camera.viewMatrix),this.program.rebindTextures(),(0===this.configuration.output||7===this.configuration.output||1===this.configuration.output&&this.configuration.screenSizePerspective||2===this.configuration.output&&this.configuration.screenSizePerspective||4===this.configuration.output&&this.configuration.screenSizePerspective)&&Object(ne.a)(this.program,t,e.camera.viewInverseTransposeMatrix),2===this.configuration.output&&this.program.setUniformMatrix4fv("viewNormal",e.camera.viewInverseTransposeMatrix),this.configuration.instancedDoublePrecision&&Q.a.bindCustomOrigin(this.program,t),Object(K.b)(this.program,this.configuration,e.slicePlane,t),0===this.configuration.output&&Object(ee.c)(this.program,e,t)}},{key:"setPipeline",value:function(e,t){var a=this.configuration,n=3===e,r=2===e;return Object(de.e)({blending:0!==a.output&&7!==a.output||!a.transparent?null:n?G.f:Object(G.a)(e),culling:ve(a)&&Object(de.b)(a.cullFace),depthTest:{func:Object(G.b)(e)},depthWrite:n||r?a.writeDepth&&de.d:null,colorWrite:de.c,stencilWrite:a.sceneHasOcludees?le.h:null,stencilTest:a.sceneHasOcludees?t?le.d:le.c:null,polygonOffset:n||r?null:Object(G.g)(a.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this.setPipeline(this.configuration.transparencyPassType,!0),this.setPipeline(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e){return e?this._occludeePipelineState:this.pipeline}}]),a}(oe.a);function ve(e){return e.cullFace?0!==e.cullFace:!e.slicePlaneEnabled&&!e.transparent&&!e.doubleSidedMode}me.shader=new re.a(ue.a,(function(){return a.e(191).then(a.bind(null,1183))}));var pe=function(e){Object(E.a)(a,e);var t=Object(L.a)(a);function a(){var e;return Object(D.a)(this,a),(e=t.apply(this,arguments)).output=0,e.alphaDiscardMode=1,e.doubleSidedMode=0,e.isSchematic=!1,e.vertexColors=!1,e.offsetBackfaces=!1,e.symbolColors=!1,e.vvSize=!1,e.vvColor=!1,e.verticalOffset=!1,e.receiveShadows=!1,e.slicePlaneEnabled=!1,e.sliceHighlightDisabled=!1,e.receiveAmbientOcclusion=!1,e.screenSizePerspective=!1,e.textureAlphaPremultiplied=!1,e.hasColorTexture=!1,e.usePBR=!1,e.hasMetalnessAndRoughnessTexture=!1,e.hasEmissionTexture=!1,e.hasOcclusionTexture=!1,e.hasNormalTexture=!1,e.instanced=!1,e.instancedColor=!1,e.instancedDoublePrecision=!1,e.vertexTangents=!1,e.normalsTypeDerivate=!1,e.writeDepth=!0,e.sceneHasOcludees=!1,e.transparent=!1,e.enableOffset=!0,e.cullFace=0,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return a}(ie.a);Object(X.a)([Object(ie.b)({count:8})],pe.prototype,"output",void 0),Object(X.a)([Object(ie.b)({count:4})],pe.prototype,"alphaDiscardMode",void 0),Object(X.a)([Object(ie.b)({count:3})],pe.prototype,"doubleSidedMode",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"isSchematic",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"vertexColors",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"offsetBackfaces",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"symbolColors",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"vvSize",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"vvColor",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"verticalOffset",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"receiveShadows",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"slicePlaneEnabled",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"sliceHighlightDisabled",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"receiveAmbientOcclusion",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"screenSizePerspective",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"textureAlphaPremultiplied",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"hasColorTexture",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"usePBR",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"hasMetalnessAndRoughnessTexture",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"hasEmissionTexture",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"hasOcclusionTexture",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"hasNormalTexture",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"instanced",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"instancedColor",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"instancedDoublePrecision",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"vertexTangents",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"normalsTypeDerivate",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"writeDepth",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"sceneHasOcludees",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"transparent",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"enableOffset",void 0),Object(X.a)([Object(ie.b)({count:3})],pe.prototype,"cullFace",void 0),Object(X.a)([Object(ie.b)({count:4})],pe.prototype,"transparencyPassType",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"multipassTerrainEnabled",void 0),Object(X.a)([Object(ie.b)()],pe.prototype,"cullAboveGround",void 0);var fe=a(940),he=function(e){Object(E.a)(a,e);var t=Object(L.a)(a);function a(){return Object(D.a)(this,a),t.apply(this,arguments)}return Object(R.a)(a,[{key:"initializeProgram",value:function(e){var t=a.shader.get(),n=this.configuration,r=t.build({OITEnabled:0===n.transparencyPassType,output:n.output,viewingMode:e.viewingMode,receiveShadows:n.receiveShadows,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:n.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:n.symbolColors,vvSize:n.vvSize,vvColor:n.vvColor,vvInstancingEnabled:!0,instanced:n.instanced,instancedColor:n.instancedColor,instancedDoublePrecision:n.instancedDoublePrecision,pbrMode:n.usePBR?1:0,hasMetalnessAndRoughnessTexture:!1,hasEmissionTexture:!1,hasOcclusionTexture:!1,hasNormalTexture:!1,hasColorTexture:n.hasColorTexture,receiveAmbientOcclusion:n.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:0,doubleSidedMode:2,vertexTangents:!1,attributeTextureCoordinates:n.hasColorTexture?1:0,textureAlphaPremultiplied:n.textureAlphaPremultiplied,attributeColor:n.vertexColors,screenSizePerspectiveEnabled:n.screenSizePerspective,verticalOffsetEnabled:n.verticalOffset,offsetBackfaces:n.offsetBackfaces,doublePrecisionRequiresObfuscation:Object(ae.b)(e.rctx),alphaDiscardMode:n.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:n.multipassTerrainEnabled,cullAboveGround:n.cullAboveGround});return new ce.a(e.rctx,r,se.a)}}]),a}(me);he.shader=new re.a(fe.a,(function(){return a.e(187).then(a.bind(null,1184))}));var be=function(e){Object(E.a)(a,e);var t=Object(L.a)(a);function a(e){var n;return Object(D.a)(this,a),(n=t.call(this,e,xe)).supportsEdges=!0,n.techniqueConfig=new pe,n.vertexBufferLayout=a.getVertexBufferLayout(n.params),n.instanceBufferLayout=e.instanced?a.getInstanceBufferLayout(n.params):null,n}return Object(R.a)(a,[{key:"isVisibleInPass",value:function(e){return 4!==e&&6!==e&&7!==e||this.params.castShadows}},{key:"isVisible",value:function(){var e=this.params;if(!Object(k.a)(Object(I.a)(a.prototype),"isVisible",this).call(this)||0===e.layerOpacity)return!1;var t=e.instanced,n=e.vertexColors,r=e.symbolColors,o=!!t&&t.indexOf("color")>-1,i=e.vvColorEnabled,s="replace"===e.colorMixMode,c=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0;return n&&(o||i||r)?!!s||c:n?s?l:c:o||i||r?!!s||c:s?l:c}},{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.hasNormalTexture=!!this.params.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.params.textureId,this.techniqueConfig.vertexTangents=this.params.vertexTangents,this.techniqueConfig.instanced=!!this.params.instanced,this.techniqueConfig.instancedDoublePrecision=this.params.instancedDoublePrecision,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.verticalOffset=null!==this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=null!==this.params.screenSizePerspective,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.sliceHighlightDisabled=this.params.sliceHighlightDisabled,this.techniqueConfig.alphaDiscardMode=this.params.textureAlphaMode,this.techniqueConfig.normalsTypeDerivate="screenDerivative"===this.params.normals,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.cullFace=this.params.slicePlaneEnabled?0:this.params.cullFace,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,0!==e&&7!==e||(this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.symbolColors=this.params.symbolColors,this.params.treeRendering?this.techniqueConfig.doubleSidedMode=2:this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0,this.techniqueConfig.instancedColor=!!this.params.instanced&&this.params.instanced.indexOf("color")>-1,this.techniqueConfig.receiveShadows=this.params.receiveShadows&&this.params.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!(!t||!t.ssaoEnabled)&&this.params.receiveSSAO,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.params.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.params.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.params.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.params.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.params.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.params.transparent||!this.params.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.params.usePBR&&this.params.isSchematic,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<G.e),this.techniqueConfig}},{key:"intersect",value:function(e,t,a,n,r,o,i){if(null!==this.params.verticalOffset){var s=n.camera;Object(p.t)(Me,a[12],a[13],a[14]);var c=null;switch(n.viewingMode){case 1:c=Object(p.o)(Te,Me);break;case 2:c=Object(p.h)(Te,we)}var l=0;if(null!==this.params.verticalOffset){var u=Object(p.g)(Se,Me,s.eye),d=Object(p.m)(u),m=Object(p.b)(u,u,1/d),v=null;this.params.screenSizePerspective&&(v=Object(p.e)(c,m)),l+=Object(W.f)(s,d,this.params.verticalOffset,v,this.params.screenSizePerspective)}Object(p.b)(c,c,l),Object(p.u)(Ce,c,n.transform.inverseRotation),r=Object(p.g)(je,r,Ce),o=Object(p.g)(ye,o,Ce)}Object(W.d)(e,t,n,r,o,Object(q.c)(n.verticalOffset),i)}},{key:"getGLMaterial",value:function(e){if(0===e.output||7===e.output||1===e.output||2===e.output||3===e.output||4===e.output)return new ge(e)}},{key:"createBufferWriter",value:function(){return new Oe(this.vertexBufferLayout,this.instanceBufferLayout)}}],[{key:"getVertexBufferLayout",value:function(e){var t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,a=Object(B.a)().vec3f("position").vec3f("normal");return e.vertexTangents&&a.vec4f("tangent"),t&&a.vec2f("uv0"),e.vertexColors&&a.vec4u8("color"),e.symbolColors&&a.vec4u8("symbolColor"),a}},{key:"getInstanceBufferLayout",value:function(e){var t=Object(B.a)();return t=e.instancedDoublePrecision?t.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):t.mat4f("model").mat4f("modelNormal"),e.instanced&&e.instanced.indexOf("color")>-1&&(t=t.vec4f("instanceColor")),e.instanced&&e.instanced.indexOf("featureAttribute")>-1&&(t=t.vec4f("instanceFeatureAttribute")),t}}]),a}(H.a),ge=function(e){Object(E.a)(a,e);var t=Object(L.a)(a);function a(e){var n;Object(D.a)(this,a);var r=e.material;return(n=t.call(this,Object(i.a)(Object(i.a)({},e),r.params))).updateParameters(),n}return Object(R.a)(a,[{key:"updateParameters",value:function(e){var t=this._material.params;this.updateTexture(t.textureId),this._technique=this._techniqueRep.releaseAndAcquire(t.treeRendering?he:me,this._material.getTechniqueConfig(this._output,e),this._technique)}},{key:"selectPipelines",value:function(){}},{key:"_updateShadowState",value:function(e){e.shadowMappingEnabled!==this._material.params.shadowMappingEnabled&&this._material.setParameterValues({shadowMappingEnabled:e.shadowMappingEnabled})}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:e.hasOccludees})}},{key:"ensureParameters",value:function(e){0!==this._output&&7!==this._output||(this._updateShadowState(e),this._updateOccludeeState(e)),this.updateParameters(e)}},{key:"bind",value:function(e){this._technique.bindPass(this._material.params,e),this.bindTextures(this._technique.program)}},{key:"beginSlot",value:function(e){return e===(this._material.params.transparent?this._material.params.writeDepth?5:8:3)}},{key:"getPipelineState",value:function(e,t){return this._technique.getPipelineState(t)}}]),a}(V.a),xe=Object(i.a)({textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:2,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:Object(d.b)(),transparent:!1,writeDepth:!0,textureAlphaMode:0,textureAlphaCutoff:N.b,textureAlphaPremultiplied:!1,sceneHasOcludees:!1},H.b),Oe=function(){function e(t,a){Object(D.a)(this,e),this.vertexBufferLayout=t,this.instanceBufferLayout=a}return Object(R.a)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get("position").length}},{key:"write",value:function(e,t,a,n){Object(U.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,a,n)}}]),e}(),je=Object(f.e)(),ye=Object(f.e)(),we=Object(f.g)(0,0,1),Te=Object(f.e)(),Ce=Object(f.e)(),Me=Object(f.e)(),Se=Object(f.e)(),_e=S.a.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");function Ae(e,t){return Pe.apply(this,arguments)}function Pe(){return(Pe=Object(s.a)(r.a.mark((function e(t,a){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe(t,a);case 2:return n=e.sent,e.t0=n,e.next=6,Be(n.textureDefinitions,a);case 6:return e.t1=e.sent,e.abrupt("return",{resource:e.t0,textures:e.t1});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Fe(e,t){return ze.apply(this,arguments)}function ze(){return(ze=Object(s.a)(r.a.mark((function e(t,a){var n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=Object(l.k)(a)&&a.streamDataRequester)){e.next=3;break}return e.abrupt("return",De(t,n,a));case 3:return e.next=5,Object(C.c)(Object(T.default)(t,Object(l.r)(a)));case 5:if(!0!==(o=e.sent).ok){e.next=8;break}return e.abrupt("return",o.value.data);case 8:Object(_.u)(o.error),ke(o.error);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function De(e,t,a){return Re.apply(this,arguments)}function Re(){return(Re=Object(s.a)(r.a.mark((function e(t,a,n){var o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(C.c)(a.request(t,"json",n));case 2:if(!0!==(o=e.sent).ok){e.next=5;break}return e.abrupt("return",o.value);case 5:Object(_.u)(o.error),ke(o.error.details.url);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ke(e){throw new M.a("","Request for object resource failed: ".concat(e))}function Ie(e){var t=e.params,a=t.topology,n=!0;switch(t.vertexAttributes||(_e.warn("Geometry must specify vertex attributes"),n=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:var r=t.faces;if(r){if(t.vertexAttributes)for(var o in t.vertexAttributes){var i=r[o];i&&i.values?(null!=i.valueType&&"UInt32"!==i.valueType&&(_e.warn("Unsupported indexed geometry indices type '".concat(i.valueType,"', only UInt32 is currently supported")),n=!1),null!=i.valuesPerElement&&1!==i.valuesPerElement&&(_e.warn("Unsupported indexed geometry values per element '".concat(i.valuesPerElement,"', only 1 is currently supported")),n=!1)):(_e.warn("Indexed geometry does not specify face indices for '".concat(o,"' attribute")),n=!1)}}else _e.warn("Indexed geometries must specify faces"),n=!1;break;default:_e.warn("Unsupported topology '".concat(a,"'")),n=!1}e.params.material||(_e.warn("Geometry requires material"),n=!1);var s=e.params.vertexAttributes;for(var c in s)s[c].values||(_e.warn("Geometries with externally defined attributes are not yet supported"),n=!1);return n}function Ee(e,t){var a=[],n=[],r=[],o=[],i=e.resource,s=A.a.parse(i.version||"1.0","wosr");Ge.validate(s);for(var c=i.model.name,u=i.model.geometries,d=i.materialDefinitions,m=e.textures,v=0,p=new Map,h=0;h<u.length;h++){var b=u[h];if(Ie(b)){var g=He(b),x=b.params.vertexAttributes,O=[];for(var j in x){var y=x[j],w=y.values;O.push([j,{data:w,size:y.valuesPerElement,exclusive:!0}])}var T=[];if("PerAttributeArray"!==b.params.topology){var C=b.params.faces;for(var M in C)T.push([M,new Uint32Array(C[M].values)])}var S=m&&m[g.texture];if(S&&!p.has(g.texture)){var _=S.image,P=S.params,D=new z.a(_,P);o.push(D),p.set(g.texture,D)}var R=p.get(g.texture),k=R?R.id:void 0,I=r[g.material]?r[g.material][g.texture]:null;if(!I){var E=d[g.material.substring(g.material.lastIndexOf("/")+1)].params;1===E.transparency&&(E.transparency=0);var L=S&&S.alphaChannelUsage,B=E.transparency>0||"transparency"===L||"maskAndTransparency"===L,N={ambient:Object(f.f)(E.diffuse),diffuse:Object(f.f)(E.diffuse),opacity:1-(E.transparency||0),transparent:B,textureAlphaMode:S?Ve(S.alphaChannelUsage):void 0,textureAlphaCutoff:.33,textureId:k,initTextureTransparent:!0,doubleSided:!0,cullFace:0,colorMixMode:E.externalColorMixMode||"tint",textureAlphaPremultiplied:!0};Object(l.k)(t)&&t.materialParamsMixin&&Object.assign(N,t.materialParamsMixin),I=new be(N),r[g.material]||(r[g.material]={}),r[g.material][g.texture]=I}n.push(I);var V=new F.a(O,T);v+=T.position?T.position.length:0,a.push(V)}}return{name:c,stageResources:{textures:o,materials:n,geometries:a},pivotOffset:i.model.pivotOffset,boundingBox:Le(a),numberOfVertices:v,lodThreshold:null}}function Le(e){var t=Object(h.d)();return e.forEach((function(e){var a=e.boundingInfo;Object(l.k)(a)&&(Object(h.i)(t,a.getBBMin()),Object(h.i)(t,a.getBBMax()))})),t}function Be(e,t){return Ne.apply(this,arguments)}function Ne(){return(Ne=Object(s.a)(r.a.mark((function e(t,a){var n,i,s,c,u,d,m,v;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],i=function(e){var r=t[e],o=r.images[0].data;if(!o)return _e.warn("Externally referenced texture data is not yet supported"),"continue";var i=r.encoding+";base64,"+o,s="/textureDefinitions/"+e,c={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:!0},u=Object(l.k)(a)&&a.disableTextures?Promise.resolve(null):Object(P.a)(i,a);n.push(u.then((function(e){return{refId:s,image:e,params:c,alphaChannelUsage:"rgba"===r.channels?r.alphaChannelUsage||"transparency":"none"}})))},e.t0=r.a.keys(t);case 3:if((e.t1=e.t0()).done){e.next=10;break}if(s=e.t1.value,"continue"!==i(s)){e.next=8;break}return e.abrupt("continue",3);case 8:e.next=3;break;case 10:return e.next=12,Promise.all(n);case 12:c=e.sent,u={},d=Object(o.a)(c);try{for(d.s();!(m=d.n()).done;)v=m.value,u[v.refId]=v}catch(p){d.e(p)}finally{d.f()}return e.abrupt("return",u);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ve(e){switch(e){case"mask":return 2;case"maskAndTransparency":return 3;case"none":return 1;case"transparency":default:return 0}}function He(e){var t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}var Ge=new A.a(1,2,"wosr"),qe=a(995),Ue=a(868),We=a(869),Xe=a(750);function Ke(e,t){return Qe.apply(this,arguments)}function Qe(){return(Qe=Object(s.a)(r.a.mark((function e(t,a){var n,o,s,u,d,m,v,p,f,h;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("wosr"!==(n=Je(Object(c.a)(t))).fileType){e.next=7;break}return e.next=4,a.cache?a.cache.loadWOSR(n.url,a):Ae(n.url,a);case 4:return o=e.sent,s=Ee(o,a),e.abrupt("return",{lods:[s],referenceBoundingBox:s.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:o.remove});case 7:return e.next=9,a.cache?a.cache.loadGLTF(n.url,a,a.usePBR):Object(y.a)(new j.a(a.streamDataRequester),n.url,a,a.usePBR);case 9:if(u=e.sent,d=Object(l.i)(u.model.meta,"ESRI_proxyEllipsoid"),u.meta.isEsriSymbolResource&&Object(l.k)(d)&&-1!==u.meta.uri.indexOf("/RealisticTrees/")&&Ye(u,d),m=u.meta.isEsriSymbolResource?{usePBR:a.usePBR,isSchematic:!1,treeRendering:u.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:a.usePBR,isSchematic:!1,mrrFactors:[0,1,.5]},v=Object(i.a)(Object(i.a)({},a.materialParamsMixin),{},{treeRendering:u.customMeta.esriTreeRendering}),null==n.specifiedLodIndex){e.next=18;break}return p=Ze(u,m,v,n.specifiedLodIndex),f=p[0].boundingBox,0!==n.specifiedLodIndex&&(f=Ze(u,m,v,0)[0].boundingBox),e.abrupt("return",{lods:p,referenceBoundingBox:f,isEsriSymbolResource:u.meta.isEsriSymbolResource,isWosr:!1,remove:u.remove});case 18:return h=Ze(u,m,v),e.abrupt("return",{lods:h,referenceBoundingBox:h[0].boundingBox,isEsriSymbolResource:u.meta.isEsriSymbolResource,isWosr:!1,remove:u.remove});case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Je(e){var t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:null!=t[4]?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function Ze(e,t,a,n){var r=e.model,o=Object(d.b)(),s=new Array,c=new Map,m=new Map;return r.lods.forEach((function(e,d){if(void 0===n||d===n){var v={name:e.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:Object(l.k)(e.lodThreshold)?e.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:Object(h.d)()};s.push(v),e.parts.forEach((function(e){var n=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),s=r.materials.get(e.material),d=Object(l.k)(e.attributes.texCoord0),p=Object(l.k)(e.attributes.normal);if(!c.has(n)){if(d){if(Object(l.k)(s.textureColor)&&!m.has(s.textureColor)){var f=r.textures.get(s.textureColor),j=Object(i.a)(Object(i.a)({},f.parameters),{},{preMultiplyAlpha:!0});m.set(s.textureColor,new z.a(f.data,j))}if(Object(l.k)(s.textureNormal)&&!m.has(s.textureNormal)){var y=r.textures.get(s.textureNormal),T=Object(i.a)(Object(i.a)({},y.parameters),{},{preMultiplyAlpha:!0});m.set(s.textureNormal,new z.a(y.data,T))}if(Object(l.k)(s.textureOcclusion)&&!m.has(s.textureOcclusion)){var C=r.textures.get(s.textureOcclusion),M=Object(i.a)(Object(i.a)({},C.parameters),{},{preMultiplyAlpha:!0});m.set(s.textureOcclusion,new z.a(C.data,M))}if(Object(l.k)(s.textureEmissive)&&!m.has(s.textureEmissive)){var S=r.textures.get(s.textureEmissive),_=Object(i.a)(Object(i.a)({},S.parameters),{},{preMultiplyAlpha:!0});m.set(s.textureEmissive,new z.a(S.data,_))}if(Object(l.k)(s.textureMetallicRoughness)&&!m.has(s.textureMetallicRoughness)){var A=r.textures.get(s.textureMetallicRoughness),P=Object(i.a)(Object(i.a)({},A.parameters),{},{preMultiplyAlpha:!0});m.set(s.textureMetallicRoughness,new z.a(A.data,P))}}var D=Math.pow(s.color[0],1/qe.a),R=Math.pow(s.color[1],1/qe.a),k=Math.pow(s.color[2],1/qe.a),I=Math.pow(s.emissiveFactor[0],1/qe.a),E=Math.pow(s.emissiveFactor[1],1/qe.a),L=Math.pow(s.emissiveFactor[2],1/qe.a);c.set(n,new be(Object(i.a)(Object(i.a)({},t),{},{transparent:"BLEND"===s.alphaMode,textureAlphaMode:$e(s.alphaMode),textureAlphaCutoff:s.alphaCutoff,diffuse:[D,R,k],ambient:[D,R,k],opacity:s.opacity,doubleSided:s.doubleSided,doubleSidedType:"winding-order",cullFace:s.doubleSided?0:2,vertexColors:!!e.attributes.color,vertexTangents:!!e.attributes.tangent,normals:p?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:Object(l.k)(s.textureColor)&&d?m.get(s.textureColor).id:void 0,colorMixMode:s.colorMixMode,normalTextureId:Object(l.k)(s.textureNormal)&&d?m.get(s.textureNormal).id:void 0,textureAlphaPremultiplied:!0,occlusionTextureId:Object(l.k)(s.textureOcclusion)&&d?m.get(s.textureOcclusion).id:void 0,emissiveTextureId:Object(l.k)(s.textureEmissive)&&d?m.get(s.textureEmissive).id:void 0,metallicRoughnessTextureId:Object(l.k)(s.textureMetallicRoughness)&&d?m.get(s.textureMetallicRoughness).id:void 0,emissiveFactor:[I,E,L],mrrFactors:[s.metallicFactor,s.roughnessFactor,t.mrrFactors[2]],isSchematic:!1},a)))}var B=function(e,t){switch(t){case 4:return Object(w.c)(e);case 5:return Object(w.b)(e);case 6:return Object(w.a)(e)}}(e.indices||e.attributes.position.count,e.primitiveType),N=e.attributes.position.count,V=Object(O.a)(b.u,N);Object(g.e)(V,e.attributes.position,e.transform);var H=[["position",{data:V.typedBuffer,size:V.elementCount,exclusive:!0}]],G=[["position",B]];if(Object(l.k)(e.attributes.normal)){var q=Object(O.a)(b.u,N);Object(u.a)(o,e.transform),Object(g.a)(q,e.attributes.normal,o),H.push(["normal",{data:q.typedBuffer,size:q.elementCount,exclusive:!0}]),G.push(["normal",B])}if(Object(l.k)(e.attributes.tangent)){var U=Object(O.a)(b.C,N);Object(u.a)(o,e.transform),Object(x.c)(U,e.attributes.tangent,o),H.push(["tangent",{data:U.typedBuffer,size:U.elementCount,exclusive:!0}]),G.push(["tangent",B])}if(Object(l.k)(e.attributes.texCoord0)){var W=Object(O.a)(b.m,N);Object(Ue.b)(W,e.attributes.texCoord0),H.push(["uv0",{data:W.typedBuffer,size:W.elementCount,exclusive:!0}]),G.push(["uv0",B])}if(Object(l.k)(e.attributes.color)){var X=Object(O.a)(b.J,N);if(4===e.attributes.color.elementCount)e.attributes.color instanceof b.C?Object(x.b)(X,e.attributes.color,255):e.attributes.color instanceof b.J?Object(We.a)(X,e.attributes.color):e.attributes.color instanceof b.H&&Object(x.b)(X,e.attributes.color,1/256);else{Object(We.b)(X,255,255,255,255);var K=new b.B(X.buffer,0,4);e.attributes.color instanceof b.u?Object(g.d)(K,e.attributes.color,255):e.attributes.color instanceof b.B?Object(Xe.a)(K,e.attributes.color):e.attributes.color instanceof b.z&&Object(g.d)(K,e.attributes.color,1/256)}H.push(["color",{data:X.typedBuffer,size:X.elementCount,exclusive:!0}]),G.push(["color",B])}var Q=new F.a(H,G);v.stageResources.geometries.push(Q),v.stageResources.materials.push(c.get(n)),d&&(Object(l.k)(s.textureColor)&&v.stageResources.textures.push(m.get(s.textureColor)),Object(l.k)(s.textureNormal)&&v.stageResources.textures.push(m.get(s.textureNormal)),Object(l.k)(s.textureOcclusion)&&v.stageResources.textures.push(m.get(s.textureOcclusion)),Object(l.k)(s.textureEmissive)&&v.stageResources.textures.push(m.get(s.textureEmissive)),Object(l.k)(s.textureMetallicRoughness)&&v.stageResources.textures.push(m.get(s.textureMetallicRoughness))),v.numberOfVertices+=N;var J=Q.boundingInfo;Object(l.k)(J)&&(Object(h.i)(v.boundingBox,J.getBBMin()),Object(h.i)(v.boundingBox,J.getBBMax()))}))}})),s}function $e(e){switch(e){case"BLEND":return 0;case"MASK":return 2;case"OPAQUE":return 1;default:return 0}}function Ye(e,t){for(var a=0;a<e.model.lods.length;++a){var n=e.model.lods[a];e.customMeta.esriTreeRendering=!0;var r,i=Object(o.a)(n.parts);try{for(i.s();!(r=i.n()).done;){var s=r.value,c=s.attributes.normal;if(Object(l.j)(c))return;for(var u=s.attributes.position,d=u.count,h=Object(f.e)(),g=Object(f.e)(),x=Object(f.e)(),j=Object(O.a)(b.J,d),y=Object(O.a)(b.u,d),w=Object(m.a)(Object(v.d)(),s.transform),T=0;T<d;T++){u.getVec(T,g),c.getVec(T,h),Object(p.n)(g,g,s.transform),Object(p.g)(x,g,t.center),Object(p.a)(x,x,t.radius);var C=x[2],M=Object(p.m)(x),S=Math.min(.45+.55*M*M,1);Object(p.a)(x,x,t.radius),Object(p.n)(x,x,w),Object(p.o)(x,x),a+1!==e.model.lods.length&&e.model.lods.length>1&&Object(p.f)(x,x,h,C>-1?.2:Math.min(-4*C-3.8,1)),y.setVec(T,x),j.set(T,0,255*S),j.set(T,1,255*S),j.set(T,2,255*S),j.set(T,3,255)}s.attributes.normal=y,s.attributes.color=j}}catch(_){i.e(_)}finally{i.f()}}}},696:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return c})),a.d(t,"c",(function(){return l}));var n,r=a(598),o=a(729),i=a(597);function s(e){e.fragment.include(o.a),e.fragment.uniforms.add("uShadowMapTex","sampler2D"),e.fragment.uniforms.add("uShadowMapNum","int"),e.fragment.uniforms.add("uShadowMapDistance","vec4"),e.fragment.uniforms.add("uShadowMapMatrix","mat4",4),e.fragment.uniforms.add("uDepthHalfPixelSz","float"),e.fragment.code.add(Object(i.a)(n||(n=Object(r.a)(["int chooseCascade(float _linearDepth, out mat4 mat) {\nvec4 distance = uShadowMapDistance;\nfloat depth = _linearDepth;\nint i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\nmat = i == 0 ? uShadowMapMatrix[0] : i == 1 ? uShadowMapMatrix[1] : i == 2 ? uShadowMapMatrix[2] : uShadowMapMatrix[3];\nreturn i;\n}\nvec3 lightSpacePosition(vec3 _vpos, mat4 mat) {\nvec4 lv = mat * vec4(_vpos, 1.0);\nlv.xy /= lv.w;\nreturn 0.5 * lv.xyz + vec3(0.5);\n}\nvec2 cascadeCoordinates(int i, vec3 lvpos) {\nreturn vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n}\nfloat readShadowMapDepth(vec2 uv, sampler2D _depthTex) {\nreturn rgba2float(texture2D(_depthTex, uv));\n}\nfloat posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {\nreturn readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;\n}\nfloat filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {\nfloat texSize = 0.5 / halfPixelSize;\nvec2 st = fract((vec2(halfPixelSize) + uv) * texSize);\nfloat s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);\nfloat s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);\nfloat s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);\nfloat s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);\nreturn mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n}\nfloat readShadowMap(const in vec3 _vpos, float _linearDepth) {\nmat4 mat;\nint i = chooseCascade(_linearDepth, mat);\nif (i >= uShadowMapNum) { return 0.0; }\nvec3 lvpos = lightSpacePosition(_vpos, mat);\nif (lvpos.z >= 1.0) { return 0.0; }\nif (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }\nvec2 uv = cascadeCoordinates(i, lvpos);\nreturn filterShadow(uv, lvpos, uDepthHalfPixelSz, uShadowMapTex);\n}"]))))}function c(e,t){t.shadowMappingEnabled&&(t.shadowMap.bind(e),t.shadowMap.bindView(e,t.origin))}function l(e,t,a){t.shadowMappingEnabled&&t.shadowMap.bindView(e,a)}},707:function(e,t,a){"use strict";a.d(t,"a",(function(){return v})),a.d(t,"b",(function(){return p}));var n,r,o,i,s,c,l,u=a(598),d=a(597),m=a(694);function v(e){e.vertex.code.add(Object(d.a)(n||(n=Object(u.a)(["float screenSizePerspectiveMinSize(float size, vec4 factor) {\nfloat nonZeroSize = 1.0 - step(size, 0.0);\nreturn (\nfactor.z * (\n1.0 +\nnonZeroSize *\n2.0 * factor.w / (\nsize + (1.0 - nonZeroSize)\n)\n)\n);\n}"])))),e.vertex.code.add(Object(d.a)(r||(r=Object(u.a)(["float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\nreturn absCosAngle * absCosAngle * absCosAngle;\n}"])))),e.vertex.code.add(Object(d.a)(o||(o=Object(u.a)(["vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\nreturn vec4(\nmin(params.x / (distanceToCamera - params.y), 1.0),\nscreenSizePerspectiveViewAngleDependentFactor(absCosAngle),\nparams.z,\nparams.w\n);\n}"])))),e.vertex.code.add(Object(d.a)(i||(i=Object(u.a)(["float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\nreturn max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n}"])))),e.vertex.code.add(Object(d.a)(s||(s=Object(u.a)(["float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\nreturn applyScreenSizePerspectiveScaleFactorFloat(\nsize,\nscreenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)\n);\n}"])))),e.vertex.code.add(Object(d.a)(c||(c=Object(u.a)(["vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\nreturn mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n}"])))),e.vertex.code.add(Object(d.a)(l||(l=Object(u.a)(["vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\nreturn applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n}"]))))}function p(e,t){if(t.screenSizePerspective){Object(m.a)(t.screenSizePerspective,e,"screenSizePerspective");var a=t.screenSizePerspectiveAlignment||t.screenSizePerspective;Object(m.a)(a,e,"screenSizePerspectiveAlignment")}}},726:function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a.d(t,"b",(function(){return c})),a.d(t,"c",(function(){return s})),a.d(t,"d",(function(){return i})),a.d(t,"e",(function(){return r}));var n=a(776);function r(e,t,a){if(e.count===t.count)for(var r=e.count,o=a[0],i=a[1],s=a[2],c=a[4],l=a[5],u=a[6],d=a[8],m=a[9],v=a[10],p=a[12],f=a[13],h=a[14],b=e.typedBuffer,g=e.typedBufferStride,x=t.typedBuffer,O=t.typedBufferStride,j=0;j<r;j++){var y=j*g,w=j*O,T=x[w],C=x[w+1],M=x[w+2];b[y]=o*T+c*C+d*M+p,b[y+1]=i*T+l*C+m*M+f,b[y+2]=s*T+u*C+v*M+h}else n.a.error("source and destination buffers need to have the same number of elements")}function o(e,t,a){if(e.count===t.count)for(var r=e.count,o=a[0],i=a[1],s=a[2],c=a[3],l=a[4],u=a[5],d=a[6],m=a[7],v=a[8],p=e.typedBuffer,f=e.typedBufferStride,h=t.typedBuffer,b=t.typedBufferStride,g=0;g<r;g++){var x=g*f,O=g*b,j=h[O],y=h[O+1],w=h[O+2];p[x]=o*j+c*y+d*w,p[x+1]=i*j+l*y+m*w,p[x+2]=s*j+u*y+v*w}else n.a.error("source and destination buffers need to have the same number of elements")}function i(e,t,a){for(var n=Math.min(e.count,t.count),r=e.typedBuffer,o=e.typedBufferStride,i=t.typedBuffer,s=t.typedBufferStride,c=0;c<n;c++){var l=c*o,u=c*s;r[l]=a*i[u],r[l+1]=a*i[u+1],r[l+2]=a*i[u+2]}}function s(e,t){for(var a=Math.min(e.count,t.count),n=e.typedBuffer,r=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,s=0;s<a;s++){var c=s*r,l=s*i,u=o[l],d=o[l+1],m=o[l+2],v=Math.sqrt(u*u+d*d+m*m);if(v>0){var p=1/v;n[c]=p*u,n[c+1]=p*d,n[c+2]=p*m}}}function c(e,t,a){for(var n=Math.min(e.count,t.count),r=e.typedBuffer,o=e.typedBufferStride,i=t.typedBuffer,s=t.typedBufferStride,c=0;c<n;c++){var l=c*o,u=c*s;r[l]=i[u]>>a,r[l+1]=i[u+1]>>a,r[l+2]=i[u+2]>>a}}Object.freeze({__proto__:null,transformMat4:r,transformMat3:o,scale:i,normalize:s,shiftRight:c})},740:function(e,t,a){"use strict";a.d(t,"a",(function(){return m})),a.d(t,"b",(function(){return v}));var n,r,o,i,s,c,l=a(598),u=a(707),d=a(597);function m(e,t){var a=e.vertex.code;t.verticalOffsetEnabled?(e.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&(e.include(u.a),e.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),a.add(Object(d.a)(n||(n=Object(l.a)(["\n    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);\n      ","\n      ","\n      // Screen sized offset in world space, used for example for line callouts\n      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n      return worldNormal * worldOffset;\n    }\n\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n    }\n    "])),1===t.viewingMode?Object(d.a)(r||(r=Object(l.a)(["vec3 worldNormal = normalize(worldPos + localOrigin);"]))):Object(d.a)(o||(o=Object(l.a)(["vec3 worldNormal = vec3(0.0, 0.0, 1.0);"]))),t.screenSizePerspectiveEnabled?Object(d.a)(i||(i=Object(l.a)(["\n          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));\n          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"]))):Object(d.a)(s||(s=Object(l.a)(["\n          float verticalOffsetScreenHeight = verticalOffset.x;"])))))):a.add(Object(d.a)(c||(c=Object(l.a)(["vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }"]))))}function v(e,t,a){if(t.verticalOffset){var n=p(t.verticalOffset,a.camera.fovY,a.camera.fullViewport[3]),r=a.camera.pixelRatio||1;e.setUniform4f("verticalOffset",n.screenLength*r,n.perDistance,n.minWorldLength,n.maxWorldLength)}}function p(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:f;return n.screenLength=e.screenLength,n.perDistance=Math.tan(.5*t)/(.5*a),n.minWorldLength=e.minWorldLength,n.maxWorldLength=e.maxWorldLength,n}var f={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}},741:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n,r,o,i=a(598),s=a(597);function c(e,t){0===t.output&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(Object(s.a)(n||(n=Object(i.a)(["void forwardLinearDepth() { linearDepth = gl_Position.w; }"]))))):1===t.output||3===t.output?(e.varyings.add("linearDepth","float"),e.vertex.uniforms.add("cameraNearFar","vec2"),e.vertex.code.add(Object(s.a)(r||(r=Object(i.a)(["void forwardLinearDepth() {\nlinearDepth = (-position_view().z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);\n}"]))))):e.vertex.code.add(Object(s.a)(o||(o=Object(i.a)(["void forwardLinearDepth() {}"]))))}},746:function(e,t,a){"use strict";a.d(t,"a",(function(){return j}));var n,r,o,i=a(598),s=a(597);function c(e){var t=e.fragment.code;t.add(Object(s.a)(n||(n=Object(i.a)(["vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n{\nreturn ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n}"])))),t.add(Object(s.a)(r||(r=Object(i.a)(["float integratedRadiance(float cosTheta2, float roughness)\n{\nreturn (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n}"])))),t.add(Object(s.a)(o||(o=Object(i.a)(["vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n{\nfloat cosTheta2 = 1.0 - RdotNG * RdotNG;\nfloat intRadTheta = integratedRadiance(cosTheta2, roughness);\nfloat ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\nfloat sky = 2.0 - ground;\nreturn (ground * ambientGround + sky * ambientSky) * 0.5;\n}"]))))}var l,u,d,m,v,p,f,h,b,g,x,O=a(782);function j(e,t){var a=e.fragment.code;e.include(O.a),3===t.pbrMode||4===t.pbrMode?(a.add(Object(s.a)(l||(l=Object(i.a)(["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent = ",";\n    "])),t.useCustomDTRExponentForWater?"2.2":"2.0")),a.add(Object(s.a)(u||(u=Object(i.a)(["vec3 fresnelReflection(float angle, vec3 f0, float f90) {\nreturn f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n}"])))),a.add(Object(s.a)(d||(d=Object(i.a)(["float normalDistributionWater(float NdotH, float roughness)\n{\nfloat r2 = roughness * roughness;\nfloat NdotH2 = NdotH * NdotH;\nfloat denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\nreturn r2 / denom;\n}"])))),a.add(Object(s.a)(m||(m=Object(i.a)(["float geometricOcclusionKelemen(float LoH)\n{\nreturn 0.25 / (LoH * LoH);\n}"])))),a.add(Object(s.a)(v||(v=Object(i.a)(["vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n{\nvec3  F = fresnelReflection(props.VdotH, F0, F0Max);\nfloat dSun = normalDistributionWater(props.NdotH, roughness);\nfloat V = geometricOcclusionKelemen(props.LdotH);\nfloat diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);\nfloat strengthSunHaze  = 1.2;\nfloat dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;\nreturn ((dSun + dSunHaze) * V) * F;\n}\nvec3 tonemapACES(const vec3 x) {\nreturn (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n}"]))))):1!==t.pbrMode&&2!==t.pbrMode||(e.include(c),a.add(Object(s.a)(p||(p=Object(i.a)(["struct PBRShadingInfo\n{\nfloat NdotL;\nfloat NdotV;\nfloat NdotH;\nfloat VdotH;\nfloat LdotH;\nfloat NdotNG;\nfloat RdotNG;\nfloat NdotAmbDir;\nfloat NdotH_Horizon;\nvec3 skyRadianceToSurface;\nvec3 groundRadianceToSurface;\nvec3 skyIrradianceToSurface;\nvec3 groundIrradianceToSurface;\nfloat averageAmbientRadiance;\nfloat ssao;\nvec3 albedoLinear;\nvec3 f0;\nvec3 f90;\nvec3 diffuseColor;\nfloat metalness;\nfloat roughness;\n};"])))),a.add(Object(s.a)(f||(f=Object(i.a)(["float normalDistribution(float NdotH, float roughness)\n{\nfloat a = NdotH * roughness;\nfloat b = roughness / (1.0 - NdotH * NdotH + a * a);\nreturn b * b * INV_PI;\n}"])))),a.add(Object(s.a)(h||(h=Object(i.a)(["const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);\nconst vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);\nconst vec2 c2 = vec2(-1.04, 1.04);\nvec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\nreturn c2 * a004 + r.zw;\n}"])))),a.add(Object(s.a)(b||(b=Object(i.a)(["vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\nvec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\nvec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\nvec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;\nvec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\nvec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;\nvec3 specularComponent = specularColor * indirectSpecular;\nreturn (diffuseComponent + specularComponent);\n}"])))),a.add(Object(s.a)(g||(g=Object(i.a)(["float gamutMapChanel(float x, vec2 p){\nreturn (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n}"])))),a.add(Object(s.a)(x||(x=Object(i.a)(["vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\nvec3 outColor;\nvec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\noutColor.x = gamutMapChanel(inColor.x, p) ;\noutColor.y = gamutMapChanel(inColor.y, p) ;\noutColor.z = gamutMapChanel(inColor.z, p) ;\nreturn outColor;\n}"])))))}},749:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a(8),r=a.n(n),o=a(11),i=a(14),s=a(60);function c(e,t){return l.apply(this,arguments)}function l(){return(l=Object(i.a)(r.a.mark((function e(t,a){var n,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(s.default)(t,Object(o.a)({responseType:"image"},a));case 2:return n=e.sent,i=n.data,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},750:function(e,t,a){"use strict";function n(e,t,a){for(var n=e.typedBuffer,r=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,s=a?a.count:t.count,c=(a&&a.dstIndex?a.dstIndex:0)*r,l=(a&&a.srcIndex?a.srcIndex:0)*i,u=0;u<s;++u)n[c]=o[l],n[c+1]=o[l+1],n[c+2]=o[l+2],c+=r,l+=i}function r(e,t,a,n,r){for(var o,i,s=e.typedBuffer,c=e.typedBufferStride,l=null!=(o=null==r?void 0:r.count)?o:e.count,u=(null!=(i=null==r?void 0:r.dstIndex)?i:0)*c,d=0;d<l;++d)s[u]=t,s[u+1]=a,s[u+2]=n,u+=c}a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return r}));Object.freeze({__proto__:null,copy:n,fill:r})},767:function(e,t,a){"use strict";a.d(t,"a",(function(){return b})),a.d(t,"b",(function(){return w})),a.d(t,"c",(function(){return y}));var n=a(4),r=a(5),o=a(10),i=a(146),s=a(616),c=a(236),l=a(603),u=a(686),d=a(656),m=a(54),v=a(752),p=a(85),f=a(463),h=a(764),b=function(){function e(){Object(n.a)(this,e),this._transform=Object(l.d)(),this._transformInverse=new g({value:this._transform},c.a,l.d),this._transformInverseTranspose=new g(this._transformInverse,c.e,l.d),this._transformTranspose=new g({value:this._transform},c.e,l.d),this._transformInverseRotation=new g({value:this._transform},i.i,s.b)}return Object(r.a)(e,[{key:"invalidateLazyTransforms",value:function(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}},{key:"transform",get:function(){return this._transform}},{key:"inverse",get:function(){return this._transformInverse.value}},{key:"inverseTranspose",get:function(){return this._transformInverseTranspose.value}},{key:"inverseRotation",get:function(){return this._transformInverseRotation.value}},{key:"transpose",get:function(){return this._transformTranspose.value}},{key:"setTransformMatrix",value:function(e){Object(c.d)(this._transform,e)}},{key:"multiplyTransform",value:function(e){Object(c.m)(this._transform,this._transform,e)}},{key:"set",value:function(e){Object(c.d)(this._transform,e),this.invalidateLazyTransforms()}},{key:"setAndInvalidateLazyTransforms",value:function(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this.invalidateLazyTransforms()}}]),e}(),g=function(){function e(t,a,r){Object(n.a)(this,e),this.original=t,this.update=a,this.dirty=!0,this.transform=r()}return Object(r.a)(e,[{key:"invalidate",value:function(){this.dirty=!0}},{key:"value",get:function(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}]),e}(),x=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(n.a)(this,e),this.offset=t,this.tmpVertex=Object(p.e)()}return Object(r.a)(e,[{key:"applyToVertex",value:function(e,t,a){var n=e+this.localOrigin[0],r=t+this.localOrigin[1],o=a+this.localOrigin[2],i=this.offset/Math.sqrt(n*n+r*r+o*o);return this.tmpVertex[0]=e+n*i,this.tmpVertex[1]=t+r*i,this.tmpVertex[2]=a+o*i,this.tmpVertex}},{key:"applyToAabb",value:function(e){var t=e[0]+this.localOrigin[0],a=e[1]+this.localOrigin[1],n=e[2]+this.localOrigin[2],r=e[3]+this.localOrigin[0],o=e[4]+this.localOrigin[1],i=e[5]+this.localOrigin[2],s=this.offset/Math.sqrt(t*t+a*a+n*n);e[0]+=t*s,e[1]+=a*s,e[2]+=n*s;var c=this.offset/Math.sqrt(r*r+o*o+i*i);return e[3]+=r*c,e[4]+=o*c,e[5]+=i*c,e}}]),e}(),O=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(n.a)(this,e),this.offset=t,this.componentLocalOriginLength=0,this.tmpVertex=Object(p.e)(),this.mbs=Object(f.e)(),this.obb={center:Object(p.e)(),halfSize:Object(v.b)(),quaternion:null}}return Object(r.a)(e,[{key:"localOrigin",set:function(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}},{key:"applyToVertex",value:function(e,t,a){var n=e,r=t,o=a+this.componentLocalOriginLength,i=this.offset/Math.sqrt(n*n+r*r+o*o);return this.tmpVertex[0]=e+n*i,this.tmpVertex[1]=t+r*i,this.tmpVertex[2]=a+o*i,this.tmpVertex}},{key:"applyToAabb",value:function(e){var t=e[0],a=e[1],n=e[2]+this.componentLocalOriginLength,r=e[3],o=e[4],i=e[5]+this.componentLocalOriginLength,s=this.offset/Math.sqrt(t*t+a*a+n*n);e[0]+=t*s,e[1]+=a*s,e[2]+=n*s;var c=this.offset/Math.sqrt(r*r+o*o+i*i);return e[3]+=r*c,e[4]+=o*c,e[5]+=i*c,e}},{key:"applyToMbs",value:function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),a=this.offset/t;return this.mbs[0]=e[0]+e[0]*a,this.mbs[1]=e[1]+e[1]*a,this.mbs[2]=e[2]+e[2]*a,this.mbs[3]=e[3]+e[3]*this.offset/t,this.mbs}},{key:"applyToObb",value:function(e){var t=e.center,a=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this.obb.center[0]=t[0]+t[0]*a,this.obb.center[1]=t[1]+t[1]*a,this.obb.center[2]=t[2]+t[2]*a,Object(m.r)(this.obb.halfSize,e.halfSize,e.quaternion),Object(m.c)(this.obb.halfSize,this.obb.halfSize,e.center);var n=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*n,this.obb.halfSize[1]+=this.obb.halfSize[1]*n,this.obb.halfSize[2]+=this.obb.halfSize[2]*n,Object(m.g)(this.obb.halfSize,this.obb.halfSize,e.center),Object(u.a)(T,e.quaternion),Object(m.r)(this.obb.halfSize,this.obb.halfSize,T),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=e.quaternion,this.obb}}]),e}(),j=new(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(n.a)(this,e),this.offset=t,this.sphere=Object(h.b)(),this.tmpVertex=Object(p.e)()}return Object(r.a)(e,[{key:"applyToVertex",value:function(e,t,a){var n=this.objectTransform.transform,r=n[0]*e+n[4]*t+n[8]*a+n[12],o=n[1]*e+n[5]*t+n[9]*a+n[13],i=n[2]*e+n[6]*t+n[10]*a+n[14],s=this.offset/Math.sqrt(r*r+o*o+i*i);r+=r*s,o+=o*s,i+=i*s;var c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*r+c[4]*o+c[8]*i+c[12],this.tmpVertex[1]=c[1]*r+c[5]*o+c[9]*i+c[13],this.tmpVertex[2]=c[2]*r+c[6]*o+c[10]*i+c[14],this.tmpVertex}},{key:"applyToMinMax",value:function(e,t){var a=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*a,e[1]+=e[1]*a,e[2]+=e[2]*a;var n=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*n,t[1]+=t[1]*n,t[2]+=t[2]*n}},{key:"applyToAabb",value:function(e){var t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;var a=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*a,e[4]+=e[4]*a,e[5]+=e[5]*a,e}},{key:"applyToBoundingSphere",value:function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),a=this.offset/t;return this.sphere[0]=e[0]+e[0]*a,this.sphere[1]=e[1]+e[1]*a,this.sphere[2]=e[2]+e[2]*a,this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}}]),e}());function y(e){return Object(o.k)(e)?(j.offset=e,j):null}new O;new x;var w="terrain",T=Object(d.b)()},776:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var n=a(12).a.getLogger("esri.views.3d.support.buffer.math")},790:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n,r,o,i=a(598),s=a(597);function c(e,t){1===t.attributeTextureCoordinates&&(e.attributes.add("uv0","vec2"),e.varyings.add("vuv0","vec2"),e.vertex.code.add(Object(s.a)(n||(n=Object(i.a)(["void forwardTextureCoordinates() {\nvuv0 = uv0;\n}"]))))),2===t.attributeTextureCoordinates&&(e.attributes.add("uv0","vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add("uvRegion","vec4"),e.varyings.add("vuvRegion","vec4"),e.vertex.code.add(Object(s.a)(r||(r=Object(i.a)(["void forwardTextureCoordinates() {\nvuv0 = uv0;\nvuvRegion = uvRegion;\n}"]))))),0===t.attributeTextureCoordinates&&e.vertex.code.add(Object(s.a)(o||(o=Object(i.a)(["void forwardTextureCoordinates() {}"]))))}},792:function(e,t,a){"use strict";a.d(t,"a",(function(){return J}));var n,r=a(8),o=a.n(r),i=a(14),s=a(4),c=a(5),l=a(6),u=a(7),d=a(300),m=a(22),v=a(112),p=a(66),f=a(10),h=a(25),b=a(137),g=a(32),x=a(749),O=a(484),j=a(11),y=a(27),w=a(65);function T(){if(Object(f.j)(n)){var e=function(e){return Object(w.a)("esri/libs/basisu/".concat(e))};n=Promise.all([a.e(82),a.e(149)]).then(a.bind(null,1175)).then((function(e){return e.b})).then((function(t){return(0,t.default)({locateFile:e}).then((function(e){return e.initializeBasis(),delete e.then,e}))}))}return n}var C=a(143),M=a(302),S=null,_=null;function A(){return P.apply(this,arguments)}function P(){return(P=Object(i.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=Object(f.j)(_),!e.t0){e.next=6;break}return _=T(),e.next=5,_;case 5:S=e.sent;case 6:return e.abrupt("return",_);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e,t,a,n,r){var o=Object(M.b)(t?37496:37492),i=r&&e>1?(Math.pow(4,e)-1)/(3*Math.pow(4,e-1)):1;return Math.ceil(a*n*o*i)}function z(e){return e.getNumImages()>=1&&!e.isUASTC()}function D(e){return e.getFaces()>=1&&e.isETC1S()}function R(){return(R=Object(i.a)(o.a.mark((function e(t,a,n){var r,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=Object(f.j)(S),!e.t0){e.next=5;break}return e.next=4,A();case 4:S=e.sent;case 5:if(z(r=new S.BasisFile(new Uint8Array(n)))){e.next=8;break}return e.abrupt("return",null);case 8:return r.startTranscoding(),i=I(t,a,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(function(e,t){return r.getImageTranscodedSizeInBytes(0,e,t)}),(function(e,t,a){return r.transcodeImage(a,0,e,t,0,0)})),e.abrupt("return",(r.close(),r.delete(),i));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(){return(k=Object(i.a)(o.a.mark((function e(t,a,n){var r,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=Object(f.j)(S),!e.t0){e.next=5;break}return e.next=4,A();case 4:S=e.sent;case 5:if(D(r=new S.KTX2File(new Uint8Array(n)))){e.next=8;break}return e.abrupt("return",null);case 8:return r.startTranscoding(),i=I(t,a,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(function(e,t){return r.getImageTranscodedSizeInBytes(e,0,0,t)}),(function(e,t,a){return r.transcodeImage(a,e,0,0,t,0,-1,-1)})),e.abrupt("return",(r.close(),r.delete(),i));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e,t,a,n,r,o,i,s){for(var c=e.capabilities,l=c.compressedTextureETC,u=c.compressedTextureS3TC,d=l?n?[1,37496]:[0,37492]:u?n?[3,33779]:[2,33776]:[13,6408],m=Object(y.a)(d,2),v=m[0],p=m[1],f=t.hasMipmap?a:Math.min(1,a),h=[],b=0;b<f;b++)h.push(new Uint8Array(i(b,v))),s(b,v,h[b]);var g=h.length>1,x=g?9987:9729,O=Object(j.a)(Object(j.a)({},t),{},{samplingMode:x,hasMipmap:g,internalFormat:p,width:r,height:o});return new C.a(e,O,{type:"compressed",levels:h})}var E=a(765),L=a(12).a.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),B=542327876,N=131072;function V(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var H=V("DXT1"),G=V("DXT3"),q=V("DXT5");function U(e,t,a){var n=function(e,t){var a=new Int32Array(e,0,31);if(a[0]!==B)return L.error("Invalid magic number in DDS header"),null;if(!(4&a[20]))return L.error("Unsupported format, must contain a FourCC code"),null;var n,r,o=a[21];switch(o){case H:n=8,r=33776;break;case G:n=16,r=33778;break;case q:n=16,r=33779;break;default:return L.error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(o)),null}var i=1,s=a[4],c=a[3];0==(3&s)&&0==(3&c)||(L.warn("Rounding up compressed texture size to nearest multiple of 4."),s=s+3&-4,c=c+3&-4);var l,u,d=s,m=c;a[2]&N&&!1!==t&&(i=Math.max(1,a[7])),1===i||Object(p.l)(s)&&Object(p.l)(c)||(L.warn("Ignoring mipmaps of non power of two sized compressed texture."),i=1);for(var v=a[1]+4,f=[],h=0;h<i;++h)u=(s+3>>2)*(c+3>>2)*n,l=new Uint8Array(e,v,u),f.push(l),v+=u,s=Math.max(1,s>>1),c=Math.max(1,c>>1);return{textureData:{type:"compressed",levels:f},internalFormat:r,width:d,height:m}}(a,t.hasMipmap),r=n.textureData,o=n.internalFormat,i=n.width,s=n.height;return t.samplingMode=r.levels.length>1?9987:9729,t.hasMipmap=r.levels.length>1,t.internalFormat=o,t.width=i,t.height=s,new C.a(e,t,r)}var W=a(794),X=a(365),K=a(440),Q=a(122),J=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e,n){var r;return Object(s.a)(this,a),(r=t.call(this)).data=e,r.type=4,r.glTexture=null,r.powerOfTwoStretchInfo=null,r.loadingPromise=null,r.loadingController=null,r.events=new v.a,r.params=n||{},r.params.mipmap=!1!==r.params.mipmap,r.params.noUnpackFlip=r.params.noUnpackFlip||!1,r.params.preMultiplyAlpha=r.params.preMultiplyAlpha||!1,r.params.wrap=r.params.wrap||{s:10497,t:10497},r.params.powerOfTwoResizeMode=r.params.powerOfTwoResizeMode||1,r.estimatedTexMemRequired=a.estimateTexMemRequired(r.data,r.params),r.startPreload(),r}return Object(c.a)(a,[{key:"startPreload",value:function(){var e=this.data;Object(f.j)(e)||(e instanceof HTMLVideoElement?this.startPreloadVideoElement(e):e instanceof HTMLImageElement&&this.startPreloadImageElement(e))}},{key:"startPreloadVideoElement",value:function(e){Object(g.t)(e.src)||"auto"===e.preload&&e.crossOrigin||(e.preload="auto",e.crossOrigin="anonymous",e.src=e.src)}},{key:"startPreloadImageElement",value:function(e){Object(g.u)(e.src)||Object(g.t)(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}},{key:"dispose",value:function(){this.data=void 0}},{key:"width",get:function(){return this.params.width}},{key:"height",get:function(){return this.params.height}},{key:"createDescriptor",value:function(e){var t;return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?9987:9729,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:null!=(t=this.params.maxAnisotropy)?t:this.params.mipmap?e.parameters.maxMaxAnisotropy:1}}},{key:"load",value:function(e,t){if(Object(f.k)(this.glTexture))return this.glTexture;if(Object(f.k)(this.loadingPromise))return this.loadingPromise;var n=this.data;return Object(f.j)(n)?(this.glTexture=new C.a(e,this.createDescriptor(e),null),this.glTexture):"string"==typeof n?this.loadFromURL(e,t,n):n instanceof Image?this.loadFromImageElement(e,t,n):n instanceof HTMLVideoElement?this.loadFromVideoElement(e,t,n):n instanceof ImageData||n instanceof HTMLCanvasElement?this.loadFromImage(e,n,t):(Object(b.c)(n)||Object(b.k)(n))&&this.params.encoding===a.DDS_ENCODING?this.loadFromDDSData(e,n):(Object(b.c)(n)||Object(b.k)(n))&&this.params.encoding===a.KTX2_ENCODING?this.loadFromKTX2(e,n):(Object(b.c)(n)||Object(b.k)(n))&&this.params.encoding===a.BASIS_ENCODING?this.loadFromBasis(e,n):Object(b.k)(n)?this.loadFromPixelData(e,n):Object(b.c)(n)?this.loadFromPixelData(e,new Uint8Array(n)):null}},{key:"requiresFrameUpdates",get:function(){return this.data instanceof HTMLVideoElement}},{key:"frameUpdate",value:function(e,t,a){if(!(this.data instanceof HTMLVideoElement)||Object(f.j)(this.glTexture))return a;if(this.data.readyState<2||a===this.data.currentTime)return a;if(Object(f.k)(this.powerOfTwoStretchInfo)){var n=this.powerOfTwoStretchInfo,r=n.framebuffer,o=n.vao,i=n.sourceTexture;i.setData(this.data),this.drawStretchedTexture(e,t,r,o,i,this.glTexture)}else{var s=this.data,c=s.width,l=s.height,u=this.glTexture.descriptor,d=u.width,m=u.height;c!==d||l!==m?this.glTexture.updateData(0,0,0,Math.min(c,d),Math.min(l,m),this.data):this.glTexture.setData(this.data)}return this.glTexture.descriptor.hasMipmap&&this.glTexture.generateMipmap(),this.data.currentTime}},{key:"loadFromDDSData",value:function(e,t){return this.glTexture=U(e,this.createDescriptor(e),t),this.glTexture}},{key:"loadFromKTX2",value:function(e,t){var a=this;return this.loadAsync((function(){return function(e,t,a){return k.apply(this,arguments)}(e,a.createDescriptor(e),t).then((function(e){return a.glTexture=e,e}))}))}},{key:"loadFromBasis",value:function(e,t){var a=this;return this.loadAsync((function(){return function(e,t,a){return R.apply(this,arguments)}(e,a.createDescriptor(e),t).then((function(e){return a.glTexture=e,e}))}))}},{key:"loadFromPixelData",value:function(e,t){Object(X.a)(this.params.width>0&&this.params.height>0);var a=this.createDescriptor(e);return a.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408,a.width=this.params.width,a.height=this.params.height,this.glTexture=new C.a(e,a,t),this.glTexture}},{key:"loadAsync",value:function(e){var t=this,a=Object(h.d)();this.loadingController=a;var n=e(a.signal);this.loadingPromise=n;var r=function(){t.loadingController===a&&(t.loadingController=null),t.loadingPromise===n&&(t.loadingPromise=null)};return n.then(r,r),n}},{key:"loadFromURL",value:function(e,t,a){var n=this;return this.loadAsync(function(){var r=Object(i.a)(o.a.mark((function r(i){var s;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(x.a)(a,{signal:i});case 2:return s=r.sent,r.abrupt("return",n.loadFromImage(e,s,t));case 4:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}},{key:"loadFromImageElement",value:function(e,t,a){var n=this;return a.complete?this.loadFromImage(e,a,t):this.loadAsync(function(){var r=Object(i.a)(o.a.mark((function r(i){var s;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(O.a)(a,a.src,!1,i);case 2:return s=r.sent,r.abrupt("return",n.loadFromImage(e,s,t));case 4:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}},{key:"loadFromVideoElement",value:function(e,t,a){return a.readyState>=2?this.loadFromImage(e,a,t):this.loadFromVideoElementAsync(e,t,a)}},{key:"loadFromVideoElementAsync",value:function(e,t,a){var n=this;return this.loadAsync((function(r){return new Promise((function(o,i){var s=function(){a.removeEventListener("loadeddata",c),a.removeEventListener("error",l),Object(f.k)(u)&&u.remove()},c=function(){a.readyState>=2&&(s(),o(n.loadFromImage(e,a,t)))},l=function(e){s(),i(e||new m.a("Failed to load video"))};a.addEventListener("loadeddata",c),a.addEventListener("error",l);var u=Object(h.q)(r,(function(){return l(Object(h.e)())}))}))}))}},{key:"loadFromImage",value:function(e,t,n){var r=a.getDataDimensions(t);this.params.width=r.width,this.params.height=r.height;var o=this.createDescriptor(e);return o.pixelFormat=3===this.params.components?6407:6408,!this.requiresPowerOfTwo(e,o)||Object(p.l)(r.width)&&Object(p.l)(r.height)?(o.width=r.width,o.height=r.height,this.glTexture=new C.a(e,o,t),this.glTexture):(this.glTexture=this.makePowerOfTwoTexture(e,t,r,o,n),this.glTexture)}},{key:"requiresPowerOfTwo",value:function(e,t){var a=33071,n="number"==typeof t.wrapMode?t.wrapMode===a:t.wrapMode.s===a&&t.wrapMode.t===a;return!Object(Q.a)(e.gl)&&(t.hasMipmap||!n)}},{key:"makePowerOfTwoTexture",value:function(e,t,a,n,r){var o,i=a.width,s=a.height,c=Object(p.p)(i),l=Object(p.p)(s);switch(n.width=c,n.height=l,this.params.powerOfTwoResizeMode){case 2:n.textureCoordinateScaleFactor=[i/c,s/l],(o=new C.a(e,n)).updateData(0,0,0,i,s,t);break;case 1:case null:case void 0:o=this.stretchToPowerOfTwo(e,t,n,r);break;default:Object(d.a)(this.params.powerOfTwoResizeMode)}return n.hasMipmap&&o.generateMipmap(),o}},{key:"stretchToPowerOfTwo",value:function(e,t,a,n){var r=new C.a(e,a),o=new K.a(e,{colorTarget:0,depthStencilTarget:0},r),i=new C.a(e,{target:3553,pixelFormat:a.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!a.flipped,maxAnisotropy:8,preMultiplyAlpha:a.preMultiplyAlpha},t),s=Object(W.b)(e);return this.drawStretchedTexture(e,n,o,s,i,r),this.requiresFrameUpdates?this.powerOfTwoStretchInfo={vao:s,sourceTexture:i,framebuffer:o}:(s.dispose(!0),i.dispose(),o.detachColorTexture(),e.bindFramebuffer(null),o.dispose()),r}},{key:"drawStretchedTexture",value:function(e,t,a,n,r,o){e.bindFramebuffer(a);var i=e.getViewport();e.setViewport(0,0,o.descriptor.width,o.descriptor.height);var s=t.program;e.useProgram(s),s.setUniform4f("color",1,1,1,1),s.bindTexture(r,"tex"),e.bindVAO(n),e.setPipelineState(t.pipeline),e.drawArrays(5,0,Object(M.f)(n,"geometry")),e.bindFramebuffer(null),e.setViewport(i.x,i.y,i.width,i.height)}},{key:"unload",value:function(){if(Object(f.k)(this.powerOfTwoStretchInfo)){var e=this.powerOfTwoStretchInfo,t=e.framebuffer,a=e.vao,n=e.sourceTexture;a.dispose(!0),n.dispose(),t.dispose(),this.glTexture=null,this.powerOfTwoStretchInfo=null}if(Object(f.k)(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null),Object(f.k)(this.loadingController)){var r=this.loadingController;this.loadingController=null,this.loadingPromise=null,r.abort()}this.events.emit("unloaded")}}],[{key:"getDataDimensions",value:function(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}},{key:"estimateTexMemRequired",value:function(e,t){if(Object(f.j)(e))return 0;if(Object(b.c)(e)||Object(b.k)(e))return t.encoding===a.KTX2_ENCODING?function(e,t){if(Object(f.j)(S))return e.byteLength;var a=new S.KTX2File(new Uint8Array(e)),n=D(a)?F(a.getLevels(),a.getHasAlpha(),a.getWidth(),a.getHeight(),t):0;return a.close(),a.delete(),n}(e,t.mipmap):t.encoding===a.BASIS_ENCODING?function(e,t){if(Object(f.j)(S))return e.byteLength;var a=new S.BasisFile(new Uint8Array(e)),n=z(a)?F(a.getNumLevels(0),a.getHasAlpha(),a.getImageWidth(0,0),a.getImageHeight(0,0),t):0;return a.close(),a.delete(),n}(e,t.mipmap):e.byteLength;var n=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?a.getDataDimensions(e):t,r=n.width,o=n.height;return(t.mipmap?4/3:1)*r*o*(t.components||4)||0}}]),a}(E.a);J.DDS_ENCODING="image/vnd-ms.dds",J.KTX2_ENCODING="image/ktx2",J.BASIS_ENCODING="image/x.basis"},795:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n,r,o,i,s=a(598),c=a(597);function l(e){var t=Object(c.a)(n||(n=Object(s.a)(["vec3 decodeNormal(vec2 f) {\nfloat z = 1.0 - abs(f.x) - abs(f.y);\nreturn vec3(f + sign(f) * min(z, 0.0), z);\n}"])));e.fragment.code.add(t),e.vertex.code.add(t)}function u(e,t){0===t.normalType&&(e.attributes.add("normal","vec3"),e.vertex.code.add(Object(c.a)(r||(r=Object(s.a)(["vec3 normalModel() {\nreturn normal;\n}"]))))),1===t.normalType&&(e.include(l),e.attributes.add("normalCompressed","vec2"),e.vertex.code.add(Object(c.a)(o||(o=Object(s.a)(["vec3 normalModel() {\nreturn decodeNormal(normalCompressed);\n}"]))))),3===t.normalType&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(Object(c.a)(i||(i=Object(s.a)(["vec3 screenDerivativeNormal(vec3 positionView) {\nreturn normalize(cross(dFdx(positionView), dFdy(positionView)));\n}"])))))}},817:function(e,t,a){"use strict";var n=a(4),r=a(5),o=a(6),i=a(7),s=a(10),c=function(e){Object(o.a)(a,e);var t=Object(i.a)(a);function a(e){var r;return Object(n.a)(this,a),(r=t.call(this,e))._textureIDs=new Set,r._textureRepository=e.textureRep,r._textureId=e.textureId,r._initTransparent=!!e.initTextureTransparent,r._texture=r._acquire(r._textureId),r._textureNormal=r._acquire(e.normalTextureId),r._textureEmissive=r._acquire(e.emissiveTextureId),r._textureOcclusion=r._acquire(e.occlusionTextureId),r._textureMetallicRoughness=r._acquire(e.metallicRoughnessTextureId),r}return Object(r.a)(a,[{key:"dispose",value:function(){var e=this;this._textureIDs.forEach((function(t){return e._textureRepository.release(t)})),this._textureIDs.clear()}},{key:"updateTexture",value:function(e){e!==this._textureId&&(this._release(this._textureId),this._textureId=e,this._texture=this._acquire(this._textureId))}},{key:"bindTextures",value:function(e){Object(s.k)(this._texture)&&e.bindTexture(this._texture.glTexture,"tex"),Object(s.k)(this._textureNormal)&&e.bindTexture(this._textureNormal.glTexture,"normalTexture"),Object(s.k)(this._textureEmissive)&&e.bindTexture(this._textureEmissive.glTexture,"texEmission"),Object(s.k)(this._textureOcclusion)&&e.bindTexture(this._textureOcclusion.glTexture,"texOcclusion"),Object(s.k)(this._textureMetallicRoughness)&&e.bindTexture(this._textureMetallicRoughness.glTexture,"texMetallicRoughness")}},{key:"bindTextureScale",value:function(e){var t=Object(s.k)(this._texture)&&this._texture.glTexture;t&&t.descriptor.textureCoordinateScaleFactor?e.setUniform2fv("textureCoordinateScaleFactor",t.descriptor.textureCoordinateScaleFactor):e.setUniform2f("textureCoordinateScaleFactor",1,1)}},{key:"_acquire",value:function(e){if(!Object(s.j)(e))return this._textureIDs.add(e),this._textureRepository.acquire(e,this._initTransparent)}},{key:"_release",value:function(e){Object(s.j)(e)||(this._textureIDs.delete(e),this._textureRepository.release(e))}}]),a}(a(715).a);t.a=c},828:function(e,t,a){"use strict";a.d(t,"a",(function(){return b}));var n,r,o,i,s,c,l,u,d=a(4),m=a(598),v=a(85),p=a(879),f=a(597),h=a(915);function b(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add("modelOriginHi","vec3"),e.attributes.add("modelOriginLo","vec3"),e.attributes.add("model","mat3"),e.attributes.add("modelNormal","mat3")),t.instancedDoublePrecision&&(e.vertex.include(p.a,t),e.vertex.uniforms.add("viewOriginHi","vec3"),e.vertex.uniforms.add("viewOriginLo","vec3"));var a=[Object(f.a)(n||(n=Object(m.a)(["\n    vec3 calculateVPos() {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"),Object(f.a)(r||(r=Object(m.a)(["\n    vec3 subtractOrigin(vec3 _pos) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?Object(f.a)(o||(o=Object(m.a)(["\n          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n          return _pos - originDelta;"]))):"return vpos;"),Object(f.a)(i||(i=Object(m.a)(["\n    vec3 dpNormal(vec4 _normal) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"),Object(f.a)(s||(s=Object(m.a)(["\n    vec3 dpNormalView(vec4 _normal) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"),t.vertexTangents?Object(f.a)(c||(c=Object(m.a)(["\n    vec4 dpTransformVertexTangent(vec4 _tangent) {\n      ","\n\n    }\n    "])),t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"):Object(f.a)(l||(l=Object(m.a)([""])))];e.vertex.code.add(a[0]),e.vertex.code.add(a[1]),e.vertex.code.add(a[2]),2===t.output&&e.vertex.code.add(a[3]),e.vertex.code.add(a[4])}(u=b||(b={})).Uniforms=function e(){Object(d.a)(this,e)},u.bindCustomOrigin=function(e,t){Object(h.b)(t,g,x,3),e.setUniform3fv("viewOriginHi",g),e.setUniform3fv("viewOriginLo",x)};var g=Object(v.e)(),x=Object(v.e)()},829:function(e,t,a){"use strict";a.d(t,"a",(function(){return f})),a.d(t,"b",(function(){return h}));var n,r,o,i,s,c,l,u,d=a(598),m=a(752),v=a(1025),p=a(597);Object(m.c)(0,.6,.2);function f(e,t){var a=e.fragment,m=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;1===t.pbrMode&&m&&e.include(v.a,t),2!==t.pbrMode?(0===t.pbrMode&&a.code.add(Object(p.a)(n||(n=Object(d.a)(["float getBakedOcclusion() { return 1.0; }"])))),1===t.pbrMode&&(a.uniforms.add("emissionFactor","vec3"),a.uniforms.add("mrrFactors","vec3"),a.code.add(Object(p.a)(r||(r=Object(d.a)(["vec3 mrr;\nvec3 emission;\nfloat occlusion;"])))),t.hasMetalnessAndRoughnessTexture&&(a.uniforms.add("texMetallicRoughness","sampler2D"),t.supportsTextureAtlas&&a.uniforms.add("texMetallicRoughnessSize","vec2"),a.code.add(Object(p.a)(o||(o=Object(d.a)(["void applyMetallnessAndRoughness(TextureLookupParameter params) {\nvec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;\nmrr[0] *= metallicRoughness.b;\nmrr[1] *= metallicRoughness.g;\n}"]))))),t.hasEmissionTexture&&(a.uniforms.add("texEmission","sampler2D"),t.supportsTextureAtlas&&a.uniforms.add("texEmissionSize","vec2"),a.code.add(Object(p.a)(i||(i=Object(d.a)(["void applyEmission(TextureLookupParameter params) {\nemission *= textureLookup(texEmission, params).rgb;\n}"]))))),t.hasOcclusionTexture?(a.uniforms.add("texOcclusion","sampler2D"),t.supportsTextureAtlas&&a.uniforms.add("texOcclusionSize","vec2"),a.code.add(Object(p.a)(s||(s=Object(d.a)(["void applyOcclusion(TextureLookupParameter params) {\nocclusion *= textureLookup(texOcclusion, params).r;\n}\nfloat getBakedOcclusion() {\nreturn occlusion;\n}"]))))):a.code.add(Object(p.a)(c||(c=Object(d.a)(["float getBakedOcclusion() { return 1.0; }"])))),a.code.add(Object(p.a)(l||(l=Object(d.a)(["\n    void applyPBRFactors() {\n      mrr = mrrFactors;\n      emission = emissionFactor;\n      occlusion = 1.0;\n      ","\n      ","\n      ","\n      ","\n    }\n  "])),m?"vtc.uv = vuv0;":"",t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":"",t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":"",t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":"")))):a.code.add(Object(p.a)(u||(u=Object(d.a)(["const vec3 mrr = vec3(0.0, 0.6, 0.2);\nconst vec3 emission = vec3(0.0);\nfloat occlusion = 1.0;\nvoid applyPBRFactors() {}\nfloat getBakedOcclusion() { return 1.0; }"]))))}function h(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];a||(e.setUniform3fv("mrrFactors",t.mrrFactors),e.setUniform3fv("emissionFactor",t.emissiveFactor))}},830:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n,r=a(598),o=a(597);function i(e){e.attributes.add("position","vec3"),e.vertex.code.add(Object(o.a)(n||(n=Object(r.a)(["vec3 positionModel() { return position; }"]))))}},831:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n,r,o=a(598),i=a(597);function s(e,t){var a=e.fragment;t.receiveAmbientOcclusion?(a.uniforms.add("ssaoTex","sampler2D"),a.uniforms.add("viewportPixelSz","vec4"),a.code.add(Object(i.a)(n||(n=Object(o.a)(["float evaluateAmbientOcclusion() {\nreturn 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n}\nfloat evaluateAmbientOcclusionInverse() {\nfloat ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\nreturn viewportPixelSz.z < 0.0 ? 1.0 : ssao;\n}"]))))):a.code.add(Object(i.a)(r||(r=Object(o.a)(["float evaluateAmbientOcclusion() { return 0.0; }\nfloat evaluateAmbientOcclusionInverse() { return 1.0; }"]))))}},870:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n,r=a(598),o=a(597);function i(e){e.vertex.code.add(Object(o.a)(n||(n=Object(r.a)(["vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {\nvec3 camToVert = posWorld - camPosWorld;\nbool isBackface = dot(camToVert, normalWorld) > 0.0;\nif (isBackface) {\nposClip.z += 0.0000003 * posClip.w;\n}\nreturn posClip;\n}"]))))}},871:function(e,t,a){"use strict";a.d(t,"a",(function(){return M}));var n,r,o,i,s,c,l,u,d,m,v,p,f=a(598),h=a(626),b=a(695),g=a(795),x=a(790),O=a(957),j=a(816),y=a(674),w=a(705),T=a(657),C=a(597);function M(e,t){var a=e.vertex.code,M=e.fragment.code;1!==t.output&&3!==t.output||(e.include(b.a,{linearDepth:!0}),e.include(x.a,t),e.include(w.a,t),e.include(j.a,t),e.include(h.a,t),e.vertex.uniforms.add("cameraNearFar","vec2"),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),a.add(Object(C.a)(n||(n=Object(f.a)(["void main(void) {\nvpos = calculateVPos();\nvpos = subtractOrigin(vpos);\nvpos = addVerticalOffset(vpos, localOrigin);\ngl_Position = transformPositionWithDepth(proj, view, vpos, cameraNearFar, depth);\nforwardTextureCoordinates();\n}"])))),e.include(T.a,t),M.add(Object(C.a)(r||(r=Object(f.a)(["\n      void main(void) {\n        discardBySlice(vpos);\n        ","\n        outputDepth(depth);\n      }\n    "])),t.hasColorTexture?Object(C.a)(o||(o=Object(f.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):""))),2===t.output&&(e.include(b.a,{linearDepth:!1}),e.include(g.a,t),e.include(O.a,t),e.include(x.a,t),e.include(w.a,t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),e.vertex.uniforms.add("viewNormal","mat4"),e.varyings.add("vPositionView","vec3"),a.add(Object(C.a)(i||(i=Object(f.a)(["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        ","\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "])),0===t.normalType?Object(C.a)(s||(s=Object(f.a)(["\n        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));"]))):"")),e.include(h.a,t),e.include(T.a,t),M.add(Object(C.a)(c||(c=Object(f.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n\n        ","\n        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);\n      }\n    "])),t.hasColorTexture?Object(C.a)(l||(l=Object(f.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"",3===t.normalType?Object(C.a)(u||(u=Object(f.a)(["\n            vec3 normal = screenDerivativeNormal(vPositionView);"]))):Object(C.a)(d||(d=Object(f.a)(["\n            vec3 normal = normalize(vNormalWorld);\n            if (gl_FrontFacing == false) normal = -normal;"])))))),4===t.output&&(e.include(b.a,{linearDepth:!1}),e.include(x.a,t),e.include(w.a,t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),a.add(Object(C.a)(m||(m=Object(f.a)(["void main(void) {\nvpos = calculateVPos();\nvpos = subtractOrigin(vpos);\nvpos = addVerticalOffset(vpos, localOrigin);\ngl_Position = transformPosition(proj, view, vpos);\nforwardTextureCoordinates();\n}"])))),e.include(h.a,t),e.include(T.a,t),e.include(y.a),M.add(Object(C.a)(v||(v=Object(f.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        outputHighlight();\n      }\n    "])),t.hasColorTexture?Object(C.a)(p||(p=Object(f.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"")))}},872:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n,r=a(598),o=a(675),i=a(597);function s(e){e.include(o.a),e.code.add(Object(i.a)(n||(n=Object(r.a)(["\n    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      vec3 internalMixed = internalColor * textureColor;\n      vec3 allMixed = internalMixed * externalColor;\n\n      if (mode == ",") {\n        return allMixed;\n      }\n      else if (mode == ",") {\n        return internalMixed;\n      }\n      else if (mode == ",") {\n        return externalColor;\n      }\n      else {\n        // tint (or something invalid)\n        float vIn = rgb2v(internalMixed);\n        vec3 hsvTint = rgb2hsv(externalColor);\n        vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\n        return hsv2rgb(hsvOut);\n      }\n    }\n\n    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      float internalMixed = internalOpacity * textureOpacity;\n      float allMixed = internalMixed * externalOpacity;\n\n      if (mode == ",") {\n        return internalMixed;\n      }\n      else if (mode == ",") {\n        return externalOpacity;\n      }\n      else {\n        // multiply or tint (or something invalid)\n        return allMixed;\n      }\n    }\n  "])),i.a.int(1),i.a.int(2),i.a.int(3),i.a.int(2),i.a.int(3)))}},876:function(e,t,a){"use strict";a.d(t,"a",(function(){return A}));var n,r,o,i,s=a(598),c=a(597);function l(e,t){var a=e.fragment,l=void 0!==t.lightingSphericalHarmonicsOrder?t.lightingSphericalHarmonicsOrder:2;0===l?(a.uniforms.add("lightingAmbientSH0","vec3"),a.code.add(Object(c.a)(n||(n=Object(s.a)(["vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\nvec3 ambientLight = 0.282095 * lightingAmbientSH0;\nreturn ambientLight * (1.0 - ambientOcclusion);\n}"]))))):1===l?(a.uniforms.add("lightingAmbientSH_R","vec4"),a.uniforms.add("lightingAmbientSH_G","vec4"),a.uniforms.add("lightingAmbientSH_B","vec4"),a.code.add(Object(c.a)(r||(r=Object(s.a)(["vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\nvec4 sh0 = vec4(\n0.282095,\n0.488603 * normal.x,\n0.488603 * normal.z,\n0.488603 * normal.y\n);\nvec3 ambientLight = vec3(\ndot(lightingAmbientSH_R, sh0),\ndot(lightingAmbientSH_G, sh0),\ndot(lightingAmbientSH_B, sh0)\n);\nreturn ambientLight * (1.0 - ambientOcclusion);\n}"]))))):2===l&&(a.uniforms.add("lightingAmbientSH0","vec3"),a.uniforms.add("lightingAmbientSH_R1","vec4"),a.uniforms.add("lightingAmbientSH_G1","vec4"),a.uniforms.add("lightingAmbientSH_B1","vec4"),a.uniforms.add("lightingAmbientSH_R2","vec4"),a.uniforms.add("lightingAmbientSH_G2","vec4"),a.uniforms.add("lightingAmbientSH_B2","vec4"),a.code.add(Object(c.a)(o||(o=Object(s.a)(["vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\nvec3 ambientLight = 0.282095 * lightingAmbientSH0;\nvec4 sh1 = vec4(\n0.488603 * normal.x,\n0.488603 * normal.z,\n0.488603 * normal.y,\n1.092548 * normal.x * normal.y\n);\nvec4 sh2 = vec4(\n1.092548 * normal.y * normal.z,\n0.315392 * (3.0 * normal.z * normal.z - 1.0),\n1.092548 * normal.x * normal.z,\n0.546274 * (normal.x * normal.x - normal.y * normal.y)\n);\nambientLight += vec3(\ndot(lightingAmbientSH_R1, sh1),\ndot(lightingAmbientSH_G1, sh1),\ndot(lightingAmbientSH_B1, sh1)\n);\nambientLight += vec3(\ndot(lightingAmbientSH_R2, sh2),\ndot(lightingAmbientSH_G2, sh2),\ndot(lightingAmbientSH_B2, sh2)\n);\nreturn ambientLight * (1.0 - ambientOcclusion);\n}"])))),1!==t.pbrMode&&2!==t.pbrMode||a.code.add(Object(c.a)(i||(i=Object(s.a)(["const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);\nvec3 calculateAmbientRadiance(float ambientOcclusion)\n{\nvec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;\nreturn ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;\n}"])))))}var u,d=a(831);function m(e){var t=e.fragment;t.uniforms.add("lightingMainDirection","vec3"),t.uniforms.add("lightingMainIntensity","vec3"),t.uniforms.add("lightingFixedFactor","float"),t.code.add(Object(c.a)(u||(u=Object(s.a)(["vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {\nfloat dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);\ndotVal = mix(dotVal, 1.0, lightingFixedFactor);\nreturn lightingMainIntensity * ((1.0 - shadowing) * dotVal);\n}"]))))}var v,p,f,h,b,g,x,O,j,y,w,T,C,M=a(746),S=a(782),_=a(696);function A(e,t){var a=e.fragment;e.include(m),e.include(d.a,t),0!==t.pbrMode&&e.include(M.a,t),e.include(l,t),t.receiveShadows&&e.include(_.a,t),a.uniforms.add("lightingGlobalFactor","float"),a.uniforms.add("ambientBoostFactor","float"),e.include(S.a),a.code.add(Object(c.a)(v||(v=Object(s.a)(["\n    const float GAMMA_SRGB = 2.1;\n    const float INV_GAMMA_SRGB = 0.4761904;\n    ","\n  "])),0===t.pbrMode?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);")),a.code.add(Object(c.a)(p||(p=Object(s.a)(["\n    float additionalDirectedAmbientLight(vec3 vPosWorld) {\n      float vndl = dot(",", lightingMainDirection);\n      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n    }\n  "])),1===t.viewingMode?Object(c.a)(f||(f=Object(s.a)(["normalize(vPosWorld)"]))):Object(c.a)(h||(h=Object(s.a)(["vec3(0.0, 0.0, 1.0)"]))))),a.code.add(Object(c.a)(b||(b=Object(s.a)(["vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {\nfloat additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);\nreturn (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;\n}"])))),0===t.pbrMode||4===t.pbrMode?a.code.add(Object(c.a)(g||(g=Object(s.a)(["vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)\n{\nvec3 mainLighting = evaluateMainLighting(normalWorld, shadow);\nvec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);\nvec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));\nvec3 totalLight = mainLighting + ambientLighting + additionalLight;\ntotalLight = min(totalLight, vec3(PI));\nvec3 outColor = vec3((albedoLinear / PI) * totalLight);\nreturn pow(outColor, vec3(INV_GAMMA_SRGB));\n}"])))):1!==t.pbrMode&&2!==t.pbrMode||(a.code.add(Object(c.a)(x||(x=Object(s.a)(["const float fillLightIntensity = 0.25;\nconst float horizonLightDiffusion = 0.4;\nconst float additionalAmbientIrradianceFactor = 0.02;\nvec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)\n{\nvec3 viewDirection = -viewDir;\nvec3 mainLightDirection = lightingMainDirection;\nvec3 h = normalize(viewDirection + mainLightDirection);\nPBRShadingInfo inputs;\ninputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);\ninputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);\ninputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);\ninputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);\ninputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);\nvec3 reflectedView = normalize(reflect(viewDirection, normal));\ninputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);\ninputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));\ninputs.ssao = ssao;\ninputs.metalness = mrr[0];\ninputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);"])))),a.code.add(Object(c.a)(O||(O=Object(s.a)(["inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;\ninputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));\ninputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);"])))),a.code.add(Object(c.a)(j||(j=Object(s.a)(["vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);\nambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));\ninputs.NdotAmbDir = abs(dot(normal, ambientDir));\nvec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;\nvec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;\nvec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;\ninputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\ninputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;"])))),a.code.add(Object(c.a)(y||(y=Object(s.a)(["vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;\nvec3 horizonRingH = normalize(viewDirection + horizonRingDir);\ninputs.NdotH_Horizon = dot(normal, horizonRingH);\nvec3 mainLightRadianceComponent = normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);\nvec3 horizonLightRadianceComponent = normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;\nvec3 ambientLightRadianceComponent = calculateAmbientRadiance(ssao) + additionalLight;\ninputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;\ninputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;\ninputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);"])))),a.code.add(Object(c.a)(w||(w=Object(s.a)(["\n        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);\n        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;\n        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));\n        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;\n        ","\n        return outColor;\n      }\n    "])),2===t.pbrMode?Object(c.a)(T||(T=Object(s.a)(["vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));"]))):Object(c.a)(C||(C=Object(s.a)(["vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));"]))))))}},879:function(e,t,a){"use strict";a.d(t,"a",(function(){return y})),a.d(t,"b",(function(){return w}));var n,r,o=a(598),i=a(13),s=a(597),c=a(4),l=a(5),u=a(10),d=a(85),m=a(144),v=a(440),p=a(708),f=(a(102),a(338),a(143),a(266)),h=a(915),b=a(365),g=a(890),x=function(){function e(t){var a=this;Object(c.a)(this,e),this.context=t,this.svgAlwaysPremultipliesAlpha=!1,this._doublePrecisionRequiresObfuscation=null,Object(g.a)(t).then((function(e){return a.svgAlwaysPremultipliesAlpha=!e}))}return Object(l.a)(e,[{key:"doublePrecisionRequiresObfuscation",get:function(){if(Object(u.j)(this._doublePrecisionRequiresObfuscation)){var e=j(this.context,!1),t=j(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==e&&(0===t||e/t>5)}return this._doublePrecisionRequiresObfuscation}}]),e}(),O=null;function j(e,t){var a=new v.a(e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1});var n=m.a.createVertex(e,35044,new Uint16Array([0,0,1,0,0,1,1,1])),r=new f.a(e,new Map([["position",0]]),{geometry:[{name:"position",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:n}),o=Object(d.g)(5633261.287538229,2626832.878767164,1434988.0495278358),i=Object(d.g)(5633271.46742708,2626873.6381334523,1434963.231608387),s=function(a,n){var r=new p.a(e,"\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ".concat(t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":"","\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  "),"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor = v_color;\n  }\n  ",new Map([["position",0]])),o=new Float32Array(6);Object(h.a)(a,o,3);var i=new Float32Array(6);return Object(h.a)(n,i,3),e.useProgram(r),r.setUniform3f("u_highA",o[0],o[2],o[4]),r.setUniform3f("u_lowA",o[1],o[3],o[5]),r.setUniform3f("u_highB",i[0],i[2],i[4]),r.setUniform3f("u_lowB",i[1],i[3],i[5]),r}(o,i),c=e.getBoundFramebufferObject(),l=e.getViewport(),u=l.x,g=l.y,x=l.width,O=l.height;e.bindFramebuffer(a),e.setViewport(0,0,1,1),e.bindVAO(r),e.drawArrays(5,0,4);var j=new Uint8Array(4);a.readPixels(0,0,1,1,6408,5121,j),s.dispose(),r.dispose(!1),n.dispose(),a.dispose(),e.setViewport(u,g,x,O),e.bindFramebuffer(c);var y=(o[2]-i[2])/25,w=Object(b.k)(j);return Math.abs(y-w)}function y(e,t){var a=e.code;t.doublePrecisionRequiresObfuscation?a.add(Object(s.a)(n||(n=Object(o.a)(["vec3 dpPlusFrc(vec3 a, vec3 b) {\nreturn mix(a, a + b, vec3(notEqual(b, vec3(0))));\n}\nvec3 dpMinusFrc(vec3 a, vec3 b) {\nreturn mix(vec3(0), a - b, vec3(notEqual(a, b)));\n}\nvec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\nvec3 t1 = dpPlusFrc(hiA, hiB);\nvec3 e = dpMinusFrc(t1, hiA);\nvec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\nreturn t1 + t2;\n}"])))):a.add(Object(s.a)(r||(r=Object(o.a)(["vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\nvec3 t1 = hiA + hiB;\nvec3 e = t1 - hiA;\nvec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\nreturn t1 + t2;\n}"]))))}function w(e){return!!Object(i.a)("force-double-precision-obfuscation")||(t=e,(Object(u.j)(O)||O.context!==t)&&(O=new x(t)),O).doublePrecisionRequiresObfuscation;var t}},880:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n,r,o,i=a(598),s=a(597);function c(e){e.vertex.code.add(Object(s.a)(n||(n=Object(i.a)(["\n    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n      float symbolAlpha = 0.0;\n\n      const float maxTint = 85.0;\n      const float maxReplace = 170.0;\n      const float scaleAlpha = 3.0;\n\n      if (symbolColor.a > maxReplace) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);\n      } else if (symbolColor.a > maxTint) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);\n      } else if (symbolColor.a > 0.0) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * symbolColor.a;\n      } else {\n        colorMixMode = ",";\n        symbolAlpha = 0.0;\n      }\n\n      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\n    }\n  "])),s.a.int(1),s.a.int(3),s.a.int(4),s.a.int(1)))}function l(e,t){t.symbolColor?(e.include(c),e.attributes.add("symbolColor","vec4"),e.varyings.add("colorMixMode","mediump float")):e.fragment.uniforms.add("colorMixMode","int"),t.symbolColor?e.vertex.code.add(Object(s.a)(r||(r=Object(i.a)(["int symbolColorMixMode;\nvec4 getSymbolColor() {\nreturn decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;\n}\nvoid forwardColorMixMode() {\ncolorMixMode = float(symbolColorMixMode) + 0.5;\n}"])))):e.vertex.code.add(Object(s.a)(o||(o=Object(i.a)(["vec4 getSymbolColor() { return vec4(1.0); }\nvoid forwardColorMixMode() {}"]))))}},890:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var n=a(8),r=a.n(n),o=a(14),i=a(144),s=a(440),c=a(708),l=a(143),u=a(266);function d(e){return m.apply(this,arguments)}function m(){return(m=Object(o.a)(r.a.mark((function e(t){var a,n,o,d,m,v,p,f,h,b,g,x,O;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new Image).src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",a.width=5,a.height=5,e.next=6,a.decode();case 6:if(t.gl){e.next=8;break}return e.abrupt("return",!0);case 8:return n=new s.a(t,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),o=i.a.createVertex(t,35044,new Uint16Array([0,0,1,0,0,1,1,1])),d=new u.a(t,new Map([["a_pos",0]]),{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:o}),m=new c.a(t,"\n  precision highp float;\n\n  attribute vec2 a_pos;\n  varying vec2 v_uv;\n\n  void main() {\n    v_uv = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n  precision highp float;\n\n  varying vec2 v_uv;\n  uniform sampler2D u_texture;\n\n  void main() {\n    gl_FragColor = texture2D(u_texture, v_uv);\n  }\n  ",new Map([["a_pos",0]])),t.useProgram(m),v=new l.a(t,{dataType:5121,pixelFormat:6408,preMultiplyAlpha:!1,wrapMode:33071,samplingMode:9729},a),t.bindTexture(v,0),m.setUniform1i("u_texture",0),p=t.getBoundFramebufferObject(),f=t.getViewport(),h=f.x,b=f.y,g=f.width,x=f.height,t.bindFramebuffer(n),t.setViewport(0,0,1,1),t.bindVAO(d),t.drawArrays(5,0,4),O=new Uint8Array(4),e.abrupt("return",(n.readPixels(0,0,1,1,6408,5121,O),m.dispose(),d.dispose(!1),o.dispose(),n.dispose(),v.dispose(),t.setViewport(h,b,g,x),t.bindFramebuffer(p),a.src="",255===O[0]));case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},939:function(e,t,a){"use strict";a.d(t,"a",(function(){return $})),a.d(t,"b",(function(){return Z}));var n,r,o,i,s,c,l,u,d,m,v,p,f,h,b,g,x,O,j,y=a(598),w=a(741),T=a(870),C=a(626),M=a(695),S=a(828),_=a(795),A=a(830),P=a(880),F=a(790),z=a(785),D=a(957),R=a(740),k=a(871),I=a(643),E=a(996),L=a(831),B=a(876),N=a(636),V=a(997),H=a(746),G=a(829),q=a(696),U=a(705),W=a(657),X=a(998),K=a(872),Q=a(597),J=a(617);function Z(e){var t=new J.a,a=t.vertex.code,Z=t.fragment.code;return t.include(X.a,{name:"Default Material Shader",output:e.output}),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.include(A.a),t.varyings.add("vpos","vec3"),t.include(U.a,e),t.include(S.a,e),t.include(R.a,e),0!==e.output&&7!==e.output||(t.include(_.a,e),t.include(M.a,{linearDepth:!1}),0===e.normalType&&e.offsetBackfaces&&t.include(T.a),t.include(E.a,e),t.include(D.a,e),e.instancedColor&&t.attributes.add("instanceColor","vec4"),t.varyings.add("localvpos","vec3"),t.include(F.a,e),t.include(w.a,e),t.include(P.a,e),t.include(z.a,e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),a.add(Object(Q.a)(n||(n=Object(y.a)(["\n      void main(void) {\n        forwardNormalizedVertexColor();\n        vcolorExt = externalColor;\n        ","\n        vcolorExt *= vvColor();\n        vcolorExt *= getSymbolColor();\n        forwardColorMixMode();\n\n        if (vcolorExt.a < ",") {\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        }\n        else {\n          vpos = calculateVPos();\n          localvpos = vpos - view[3].xyz;\n          vpos = subtractOrigin(vpos);\n          ","\n          vpos = addVerticalOffset(vpos, localOrigin);\n          ","\n          gl_Position = transformPosition(proj, view, vpos);\n          ","\n        }\n\n        ","\n        forwardLinearDepth();\n        forwardTextureCoordinates();\n      }\n    "])),e.instancedColor?"vcolorExt *= instanceColor;":"",Q.a.float(W.c),0===e.normalType?Object(Q.a)(r||(r=Object(y.a)(["\n          vNormalWorld = dpNormal(vvLocalNormal(normalModel()));"]))):"",e.vertexTangents?"vTangent = dpTransformVertexTangent(tangent);":"",0===e.normalType&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":"",e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""))),7===e.output&&(t.include(C.a,e),t.include(W.a,e),e.multipassTerrainEnabled&&(t.fragment.include(I.a),t.include(N.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(K.a),Z.add(Object(Q.a)(o||(o=Object(y.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        ","\n        gl_FragColor = vec4(opacity_);\n      }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.hasColorTexture?Object(Q.a)(i||(i=Object(y.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(Q.a)(s||(s=Object(y.a)(["vec4 texColor = vec4(1.0);"]))),e.attributeColor?Object(Q.a)(c||(c=Object(y.a)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):Object(Q.a)(l||(l=Object(y.a)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "])))))),0===e.output&&(t.include(C.a,e),t.include(B.a,e),t.include(L.a,e),t.include(W.a,e),e.receiveShadows&&t.include(q.a,e),e.multipassTerrainEnabled&&(t.fragment.include(I.a),t.include(N.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(G.a,e),t.include(H.a,e),t.fragment.include(K.a),t.include(V.a,e),Z.add(Object(Q.a)(u||(u=Object(y.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        shadingParams.viewDirection = normalize(vpos - camPos);\n        ","\n        ","\n        float ssao = evaluateAmbientOcclusionInverse();\n        ssao *= getBakedOcclusion();\n\n        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor = max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n        ","\n      }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.hasColorTexture?Object(Q.a)(d||(d=Object(y.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(Q.a)(m||(m=Object(y.a)(["vec4 texColor = vec4(1.0);"]))),3===e.normalType?Object(Q.a)(v||(v=Object(y.a)(["\n        vec3 normal = screenDerivativeNormal(localvpos);"]))):Object(Q.a)(p||(p=Object(y.a)(["\n        shadingParams.normalView = vNormalWorld;\n        vec3 normal = shadingNormal(shadingParams);"]))),1===e.pbrMode?"applyPBRFactors();":"",e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;",e.attributeColor?Object(Q.a)(f||(f=Object(y.a)(["\n        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):Object(Q.a)(h||(h=Object(y.a)(["\n        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]))),e.hasNormalTexture?Object(Q.a)(b||(b=Object(y.a)(["\n              mat3 tangentSpace = ","\n              vec3 shadedNormal = computeTextureNormal(tangentSpace, vuv0);"])),e.vertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"):"vec3 shadedNormal = normal;",1===e.pbrMode||2===e.pbrMode?1===e.viewingMode?Object(Q.a)(g||(g=Object(y.a)(["vec3 normalGround = normalize(vpos + localOrigin);"]))):Object(Q.a)(x||(x=Object(y.a)(["vec3 normalGround = vec3(0.0, 0.0, 1.0);"]))):Object(Q.a)(O||(O=Object(y.a)([""]))),1===e.pbrMode||2===e.pbrMode?Object(Q.a)(j||(j=Object(y.a)(["\n            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]))):"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);",e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),t.include(k.a,e),t}var $=Object.freeze({__proto__:null,build:Z})},940:function(e,t,a){"use strict";a.d(t,"a",(function(){return K})),a.d(t,"b",(function(){return X}));var n,r,o,i,s,c,l,u,d,m,v,p,f,h,b,g,x,O,j,y=a(598),w=a(741),T=a(870),C=a(626),M=a(695),S=a(828),_=a(795),A=a(830),P=a(880),F=a(790),z=a(785),D=a(740),R=a(871),k=a(643),I=a(831),E=a(876),L=a(636),B=a(746),N=a(829),V=a(696),H=a(705),G=a(657),q=a(872),U=a(597),W=a(617);function X(e){var t=new W.a,a=t.vertex.code,X=t.fragment.code;return t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.include(A.a),t.varyings.add("vpos","vec3"),t.include(H.a,e),t.include(S.a,e),t.include(D.a,e),0!==e.output&&7!==e.output||(t.include(_.a,e),t.include(M.a,{linearDepth:!1}),e.offsetBackfaces&&t.include(T.a),e.instancedColor&&t.attributes.add("instanceColor","vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.include(F.a,e),t.include(w.a,e),t.include(P.a,e),t.include(z.a,e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),a.add(Object(U.a)(n||(n=Object(y.a)(["\n        void main(void) {\n          forwardNormalizedVertexColor();\n          vcolorExt = externalColor;\n          ","\n          vcolorExt *= vvColor();\n          vcolorExt *= getSymbolColor();\n          forwardColorMixMode();\n\n          if (vcolorExt.a < ",") {\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          }\n          else {\n            vpos = calculateVPos();\n            localvpos = vpos - view[3].xyz;\n            vpos = subtractOrigin(vpos);\n            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));\n            vpos = addVerticalOffset(vpos, localOrigin);\n            gl_Position = transformPosition(proj, view, vpos);\n            ","\n          }\n          ","\n          forwardLinearDepth();\n          forwardTextureCoordinates();\n        }\n      "])),e.instancedColor?"vcolorExt *= instanceColor;":"",U.a.float(G.c),e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":"",e.multipassTerrainEnabled?Object(U.a)(r||(r=Object(y.a)(["depth = (view * vec4(vpos, 1.0)).z;"]))):""))),7===e.output&&(t.include(C.a,e),t.include(G.a,e),e.multipassTerrainEnabled&&(t.fragment.include(k.a),t.include(L.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(q.a),X.add(Object(U.a)(o||(o=Object(y.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        ","\n\n        gl_FragColor = vec4(opacity_);\n      }\n    "])),e.multipassTerrainEnabled?Object(U.a)(i||(i=Object(y.a)(["terrainDepthTest(gl_FragCoord, depth);"]))):"",e.hasColorTexture?Object(U.a)(s||(s=Object(y.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(U.a)(c||(c=Object(y.a)(["vec4 texColor = vec4(1.0);"]))),e.attributeColor?Object(U.a)(l||(l=Object(y.a)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):Object(U.a)(u||(u=Object(y.a)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "])))))),0===e.output&&(t.include(C.a,e),t.include(E.a,e),t.include(I.a,e),t.include(G.a,e),e.receiveShadows&&t.include(V.a,e),e.multipassTerrainEnabled&&(t.fragment.include(k.a),t.include(L.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(N.a,e),t.include(B.a,e),t.fragment.include(q.a),X.add(Object(U.a)(d||(d=Object(y.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        vec3 viewDirection = normalize(vpos - camPos);\n        ","\n        float ssao = evaluateAmbientOcclusionInverse();\n        ssao *= getBakedOcclusion();\n\n        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor = max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n        ","\n      }\n    "])),e.multipassTerrainEnabled?Object(U.a)(m||(m=Object(y.a)(["terrainDepthTest(gl_FragCoord, depth);"]))):"",e.hasColorTexture?Object(U.a)(v||(v=Object(y.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(U.a)(p||(p=Object(y.a)(["vec4 texColor = vec4(1.0);"]))),1===e.pbrMode?"applyPBRFactors();":"",e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;",e.attributeColor?Object(U.a)(f||(f=Object(y.a)(["\n        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):Object(U.a)(h||(h=Object(y.a)(["\n        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]))),Object(U.a)(b||(b=Object(y.a)(["\n        vec3 shadedNormal = normalize(vNormalWorld);\n        albedo_ *= 1.2;\n        vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);\n        float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);\n        float transmittance = 1.0 - clamp(dot(viewForward, shadedNormal), 0.0, 1.0);\n        float treeRadialFalloff = vColor.r;\n        float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\n        additionalLight += backLightFactor * lightingMainIntensity;"]))),1===e.pbrMode||2===e.pbrMode?1===e.viewingMode?Object(U.a)(g||(g=Object(y.a)(["vec3 normalGround = normalize(vpos + localOrigin);"]))):Object(U.a)(x||(x=Object(y.a)(["vec3 normalGround = vec3(0.0, 0.0, 1.0);"]))):Object(U.a)(O||(O=Object(y.a)([""]))),1===e.pbrMode||2===e.pbrMode?Object(U.a)(j||(j=Object(y.a)(["\n            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]))):"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);",e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),t.include(R.a,e),t}var K=Object.freeze({__proto__:null,build:X})},957:function(e,t,a){"use strict";a.d(t,"a",(function(){return O}));var n,r,o,i,s,c,l,u=a(598),d=a(795),m=a(4),v=a(616),p=a(603),f=a(85),h=a(830),b=a(879),g=a(597);function x(e,t){e.include(h.a),e.vertex.include(b.a,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),e.vertex.uniforms.add("uTransform_WorldFromModel_RS","mat3"),e.vertex.uniforms.add("uTransform_WorldFromModel_TH","vec3"),e.vertex.uniforms.add("uTransform_WorldFromModel_TL","vec3"),e.vertex.uniforms.add("uTransform_WorldFromView_TH","vec3"),e.vertex.uniforms.add("uTransform_WorldFromView_TL","vec3"),e.vertex.uniforms.add("uTransform_ViewFromCameraRelative_RS","mat3"),e.vertex.uniforms.add("uTransform_ProjFromView","mat4"),e.vertex.code.add(Object(g.a)(n||(n=Object(u.a)(["vec3 positionWorldCameraRelative() {\nvec3 rotatedModelPosition = uTransform_WorldFromModel_RS * positionModel();\nvec3 transform_CameraRelativeFromModel = dpAdd(\nuTransform_WorldFromModel_TL,\nuTransform_WorldFromModel_TH,\n-uTransform_WorldFromView_TL,\n-uTransform_WorldFromView_TH\n);\nreturn transform_CameraRelativeFromModel + rotatedModelPosition;\n}\nvec3 position_view() {\nreturn uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();\n}\nvoid forwardPosition() {\nvPositionWorldCameraRelative = positionWorldCameraRelative();\nvPosition_view = position_view();\ngl_Position = uTransform_ProjFromView * vec4(vPosition_view, 1.0);\n}\nvec3 positionWorld() {\nreturn uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n}"])))),e.fragment.uniforms.add("uTransform_WorldFromView_TL","vec3"),e.fragment.code.add(Object(g.a)(r||(r=Object(u.a)(["vec3 positionWorld() {\nreturn uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n}"]))))}function O(e,t){0===t.normalType||1===t.normalType?(e.include(d.a,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add("uTransformNormal_GlobalFromModel","mat3"),e.vertex.uniforms.add("uTransformNormal_ViewFromGlobal","mat3"),e.vertex.code.add(Object(g.a)(o||(o=Object(u.a)(["void forwardNormal() {\nvNormalWorld = uTransformNormal_GlobalFromModel * normalModel();\nvNormalView = uTransformNormal_ViewFromGlobal * vNormalWorld;\n}"]))))):2===t.normalType?(e.include(x,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(Object(g.a)(i||(i=Object(u.a)(["\n    void forwardNormal() {\n      vNormalWorld = ","\n    }\n    "])),1===t.viewingMode?Object(g.a)(s||(s=Object(u.a)(["normalize(vPositionWorldCameraRelative);"]))):Object(g.a)(c||(c=Object(u.a)(["vec3(0.0, 0.0, 1.0);"])))))):e.vertex.code.add(Object(g.a)(l||(l=Object(u.a)(["void forwardNormal() {}"]))))}!function(e){e.ModelTransform=function e(){Object(m.a)(this,e),this.worldFromModel_RS=Object(v.b)(),this.worldFromModel_TH=Object(f.e)(),this.worldFromModel_TL=Object(f.e)()};e.ViewProjectionTransform=function e(){Object(m.a)(this,e),this.worldFromView_TH=Object(f.e)(),this.worldFromView_TL=Object(f.e)(),this.viewFromCameraRelative_RS=Object(v.b)(),this.projFromView=Object(p.d)()},e.bindModelTransform=function(e,t){e.setUniformMatrix3fv("uTransform_WorldFromModel_RS",t.worldFromModel_RS),e.setUniform3fv("uTransform_WorldFromModel_TH",t.worldFromModel_TH),e.setUniform3fv("uTransform_WorldFromModel_TL",t.worldFromModel_TL)},e.bindViewProjTransform=function(e,t){e.setUniform3fv("uTransform_WorldFromView_TH",t.worldFromView_TH),e.setUniform3fv("uTransform_WorldFromView_TL",t.worldFromView_TL),e.setUniformMatrix4fv("uTransform_ProjFromView",t.projFromView),e.setUniformMatrix3fv("uTransform_ViewFromCameraRelative_RS",t.viewFromCameraRelative_RS)}}(x||(x={})),(O||(O={})).bindUniforms=function(e,t){e.setUniformMatrix4fv("viewNormal",t)}},996:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n,r,o,i,s=a(598),c=a(1025),l=a(597);function u(e,t){var a=e.fragment;t.vertexTangents?(e.attributes.add("tangent","vec4"),e.varyings.add("vTangent","vec4"),2===t.doubleSidedMode?a.code.add(Object(l.a)(n||(n=Object(s.a)(["mat3 computeTangentSpace(vec3 normal) {\nfloat tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;\nvec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\nvec3 bitangent = cross(normal, tangent) * tangentHeadedness;\nreturn mat3(tangent, bitangent, normal);\n}"])))):a.code.add(Object(l.a)(r||(r=Object(s.a)(["mat3 computeTangentSpace(vec3 normal) {\nfloat tangentHeadedness = vTangent.w;\nvec3 tangent = normalize(vTangent.xyz);\nvec3 bitangent = cross(normal, tangent) * tangentHeadedness;\nreturn mat3(tangent, bitangent, normal);\n}"]))))):(e.extensions.add("GL_OES_standard_derivatives"),a.code.add(Object(l.a)(o||(o=Object(s.a)(["mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {\nvec3 Q1 = dFdx(pos);\nvec3 Q2 = dFdy(pos);\nvec2 stx = dFdx(st);\nvec2 sty = dFdy(st);\nfloat det = stx.t * sty.s - sty.t * stx.s;\nvec3 T = stx.t * Q2 - sty.t * Q1;\nT = T - normal * dot(normal, T);\nT *= inversesqrt(max(dot(T,T), 1.e-10));\nvec3 B = sign(det) * cross(normal, T);\nreturn mat3(T, B, normal);\n}"]))))),0!==t.attributeTextureCoordinates&&(e.include(c.a,t),a.uniforms.add("normalTexture","sampler2D"),a.uniforms.add("normalTextureSize","vec2"),a.code.add(Object(l.a)(i||(i=Object(s.a)(["\n    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {\n      vtc.uv = uv;\n      ","\n      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;\n      return tangentSpace * rawNormal;\n    }\n  "])),t.supportsTextureAtlas?"vtc.size = normalTextureSize;":"")))}},997:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n,r,o,i,s=a(598),c=a(597);function l(e,t){var a=e.fragment;a.code.add(Object(c.a)(n||(n=Object(s.a)(["struct ShadingNormalParameters {\nvec3 normalView;\nvec3 viewDirection;\n} shadingParams;"])))),1===t.doubleSidedMode?a.code.add(Object(c.a)(r||(r=Object(s.a)(["vec3 shadingNormal(ShadingNormalParameters params) {\nreturn dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);\n}"])))):2===t.doubleSidedMode?a.code.add(Object(c.a)(o||(o=Object(s.a)(["vec3 shadingNormal(ShadingNormalParameters params) {\nreturn gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);\n}"])))):a.code.add(Object(c.a)(i||(i=Object(s.a)(["vec3 shadingNormal(ShadingNormalParameters params) {\nreturn normalize(params.normalView);\n}"]))))}},998:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n,r=a(598),o=a(597),i=a(338);function s(e,t){var a=Object(o.a)(n||(n=Object(r.a)(["\n  /*\n  *  ","\n  *  ","\n  */\n  "])),t.name,0===t.output?"RenderOutput: Color":1===t.output?"RenderOutput: Depth":3===t.output?"RenderOutput: Shadow":2===t.output?"RenderOutput: Normal":4===t.output?"RenderOutput: Highlight":"");Object(i.c)()&&(e.fragment.code.add(a),e.vertex.code.add(a))}}}]);
//# sourceMappingURL=55.d53881d0.chunk.js.map