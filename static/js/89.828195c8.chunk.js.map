{"version":3,"sources":["../node_modules/@arcgis/core/views/layers/TileLayerView.js","../node_modules/@arcgis/core/views/2d/layers/TileLayerView2D.js","../node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js","../node_modules/@arcgis/core/views/support/drapedUtils.js"],"names":["i","c","e","s","a","this","layer","Promise","reject","r","type","get","allSublayers","toArray","filter","minScale","t","maxScale","popupTemplate","popupEnabled","visible","o","map","createQuery","event","p","renderer","geometry","createFetchPopupFeaturesQueryGeometry","getRequiredFields","outFields","queryFeatures","features","then","concat","value","Boolean","prototype","w","getLogger","d","_","arguments","_tileStrategy","_fetchQueue","tileInfo","spatialReference","equals","view","watch","refresh","addResolvingPromise","resampling","pause","state","update","resume","notifyChange","tileServers","_tileInfoView","n","fullExtent","u","tileInfoView","concurrency","length","process","fetchTile","m","cachePolicy","acquireTile","releaseTile","requestUpdate","container","requestRender","destroy","clear","removeAllChildren","y","updateRequested","suspended","reset","tiles","forEach","_enqueueTileFetch","_bitmapView","createTile","bitmap","getTileCoords","key","x","resolution","getTileResolution","size","width","height","addChild","abort","id","removeChild","once","tilemapCache","signal","_fetchImage","_createBlankImage","l","fetchAvailabilityUpsample","level","row","col","h","_resampleImage","has","push","source","error","timestamp","refreshTimestamp","getLODInfoAt","getXForColumn","getYForRow","f","g","Math","round","getContext","drawImage","document","createElement","I","xoffset","max","abs","yoffset","stops","maxSize","minSize","floor","pointerType","visualVariables","symbol","uniqueValueInfos","classBreakInfos","overlayPixelSizeInMapUnits","basemapSpatialReference","xmin","min","ymin","xmax","ymax","toMap","intersects"],"mappings":"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","file":"static/js/89.828195c8.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Error.js\";import{isSome as t}from\"../../core/maybe.js\";import{eachAlways as o}from\"../../core/promiseUtils.js\";import{property as s}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/Logger.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";import{calculateTolerance as p}from\"../../renderers/support/clickToleranceUtils.js\";const i=i=>{let c=class extends i{async fetchPopupFeatures(e,s){const{layer:a}=this;if(!e)return Promise.reject(new r(\"tilelayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:a}));if(\"tile\"!==a.type)return Promise.reject(new r(\"tilelayerview:fetchPopupFeatures\",\"Layer type should be 'tile'\",{type:a.type}));const i=this.get(\"view.scale\"),c=a.allSublayers.toArray().filter((e=>{const r=0===e.minScale||i<=e.minScale,t=0===e.maxScale||i>=e.maxScale;return e.popupTemplate&&e.popupEnabled&&e.visible&&r&&t}));return o(c.map((async r=>{const o=r.createQuery(),a=t(s)?s.event:null,i=p({renderer:r.renderer,event:a});o.geometry=this.createFetchPopupFeaturesQueryGeometry(e,i),o.outFields=await r.popupTemplate.getRequiredFields();return(await r.queryFeatures(o)).features}))).then((e=>[].concat(...e.map((e=>e.value)).filter(Boolean))))}};return e([s()],c.prototype,\"layer\",void 0),c=e([a(\"esri.layers.mixins.TileLayerView\")],c),c};export default i;export{i as TileLayerView};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Error.js\";import i from\"../../../core/Logger.js\";import{isNone as r}from\"../../../core/maybe.js\";import{isAbortError as s}from\"../../../core/promiseUtils.js\";import{property as a}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as l}from\"../../../core/accessorSupport/decorators/subclass.js\";import{BitmapTileLayerView2D as o}from\"./BitmapTileLayerView2D.js\";import{LayerView2DMixin as h}from\"./LayerView2D.js\";import n from\"../tiling/TileInfoView.js\";import c from\"../tiling/TileKey.js\";import u from\"../tiling/TileQueue.js\";import m from\"../tiling/TileStrategy.js\";import p from\"../../layers/LayerView.js\";import{RefreshableLayerView as f}from\"../../layers/RefreshableLayerView.js\";import{TileLayerView as g}from\"../../layers/TileLayerView.js\";import{createQueryGeometry as y}from\"../../support/drapedUtils.js\";const w=i.getLogger(\"esri.views.2d.layers.TileLayerView2D\"),d=[0,0];let _=class extends(g(f(o(h(p))))){constructor(){super(...arguments),this._tileStrategy=null,this._fetchQueue=null,this.layer=null}initialize(){const e=this.layer.tileInfo,i=e&&e.spatialReference;let r;i||(r=new t(\"layerview:tiling-information-missing\",\"The layer doesn't provide tiling information\",{layer:this.layer})),i.equals(this.view.spatialReference)||(r=new t(\"layerview:spatial-reference-incompatible\",\"The spatial reference of this layer does not meet the requirements of the view\",{layer:this.layer})),this.watch(\"resampling\",(()=>{this.refresh()})),r&&this.addResolvingPromise(Promise.reject(r))}get resampling(){return!(\"resampling\"in this.layer)||!1!==this.layer.resampling}hitTest(){return null}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume(),this.notifyChange(\"updating\")}attach(){const e=\"tileServers\"in this.layer?this.layer.tileServers:null;this._tileInfoView=new n(this.layer.tileInfo,this.layer.fullExtent),this._fetchQueue=new u({tileInfoView:this._tileInfoView,concurrency:e&&10*e.length||10,process:(e,t)=>this.fetchTile(e,t)}),this._tileStrategy=new m({cachePolicy:\"keep\",resampling:this.resampling,acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView}),this.requestUpdate(),this.container.requestRender(),super.attach()}detach(){super.detach(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQueryGeometry(e,t){return y(e,t,this.view)}async doRefresh(){this.updateRequested||this.suspended||(this._fetchQueue.reset(),this._tileStrategy.tiles.forEach((e=>this._enqueueTileFetch(e))),this.notifyChange(\"updating\"))}isUpdating(){var e;return(null==(e=this._fetchQueue)?void 0:e.length)>0}acquireTile(e){const t=this._bitmapView.createTile(e),i=t.bitmap;return[i.x,i.y]=this._tileInfoView.getTileCoords(d,t.key),i.resolution=this._tileInfoView.getTileResolution(t.key),[i.width,i.height]=this._tileInfoView.tileInfo.size,this._enqueueTileFetch(t),this._bitmapView.addChild(t),this.requestUpdate(),t}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once(\"detach\",(()=>e.destroy())),this.requestUpdate()}async fetchTile(e,t){const i=\"tilemapCache\"in this.layer?this.layer.tilemapCache:null,a=!r(t)&&t.signal;if(!i)try{return await this._fetchImage(e,a)}catch(m){if(!s(m)&&!this.resampling)return this._createBlankImage();throw m}const l=new c(0,0,0,0);let o;try{if(await i.fetchAvailabilityUpsample(e.level,e.row,e.col,l,{signal:a}),l.level!==e.level&&!this.resampling)return this._createBlankImage();o=await this._fetchImage(l,a)}catch(m){if(s(m))throw m;o=await this._fetchImage(e,a)}const{level:h,row:n,col:u}=l;return this.resampling&&h!==e.level?this._resampleImage(o,h,n,u,e.level,e.row,e.col):o}async _enqueueTileFetch(e){if(!this._fetchQueue.has(e.key.id)){try{const t=await this._fetchQueue.push(e.key);e.bitmap.source=t,e.bitmap.width=this._tileInfoView.tileInfo.size[0],e.bitmap.height=this._tileInfoView.tileInfo.size[1],e.once(\"attach\",(()=>this.requestUpdate()))}catch(t){s(t)||w.error(t)}this.requestUpdate()}}async _fetchImage(e,t){return this.layer.fetchTile(e.level,e.row,e.col,{timestamp:this.refreshTimestamp,signal:t})}_resampleImage(e,t,i,r,s,a,l){const o=this._tileInfoView.tileInfo.size,h=this._tileInfoView.getTileResolution(t),n=this._tileInfoView.getTileResolution(s);let c=this._tileInfoView.getLODInfoAt(s);const u=c.getXForColumn(l),m=c.getYForRow(a);c=this._tileInfoView.getLODInfoAt(t);const p=c.getXForColumn(r),f=c.getYForRow(i),g=Math.round((u-p)/h),y=Math.round(-(m-f)/h),w=Math.round(o[0]*(n/h)),d=Math.round(o[1]*(n/h)),_=this._createBlankImage();return _.getContext(\"2d\").drawImage(e,g,y,w,d,0,0,o[0],o[1]),_}_createBlankImage(){const e=this._tileInfoView.tileInfo.size,t=document.createElement(\"canvas\");return[t.width,t.height]=e,t}};e([a()],_.prototype,\"resampling\",null),_=e([l(\"esri.views.2d.layers.TileLayerView2D\")],_);var I=_;export default I;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nfunction t(t,e){return e?\"xoffset\"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):\"yoffset\"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function e(t){let e=0,n=0;for(let r=0;r<t.length;r++){const s=t[r].size;\"number\"==typeof s&&(e+=s,n++)}return e/n}function n(t,n){return\"number\"==typeof t?t:t&&t.stops&&t.stops.length?e(t.stops):n}function r(t,e){if(!e)return t;const r=e.filter((t=>\"size\"===t.type)).map((e=>{const{maxSize:r,minSize:s}=e;return(n(r,t)+n(s,t))/2}));let s=0;const o=r.length;if(0===o)return t;for(let n=0;n<o;n++)s+=r[n];const f=Math.floor(s/o);return Math.max(f,t)}function s(e){const n=e&&e.renderer,s=\"touch\"===(e&&e.event&&e.event.pointerType)?9:6;if(!n)return s;const o=\"visualVariables\"in n?r(s,n.visualVariables):s;if(\"simple\"===n.type)return t(o,n.symbol);if(\"unique-value\"===n.type){let e=o;return n.uniqueValueInfos.forEach((n=>{e=t(e,n.symbol)})),e}if(\"class-breaks\"===n.type){let e=o;return n.classBreakInfos.forEach((n=>{e=t(e,n.symbol)})),e}return n.type,o}export{s as calculateTolerance};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport\"../../geometry.js\";import{isSome as e,isNone as t}from\"../../core/maybe.js\";import{getMetersPerUnitForSR as r}from\"../../core/unitUtils.js\";import{calculateTolerance as n}from\"../../renderers/support/clickToleranceUtils.js\";import i from\"../../geometry/Extent.js\";function a(t,n,a,o=new i){let s;if(\"2d\"===a.type)s=n*a.resolution;else if(\"3d\"===a.type){const i=a.overlayPixelSizeInMapUnits(t),o=a.basemapSpatialReference;s=e(o)&&!o.equals(a.spatialReference)?r(o)/r(a.spatialReference):n*i}const m=t.x-s,p=t.y-s,c=t.x+s,l=t.y+s,{spatialReference:f}=a;return o.xmin=Math.min(m,c),o.ymin=Math.min(p,l),o.xmax=Math.max(m,c),o.ymax=Math.max(p,l),o.spatialReference=f,o}function o(e,r,i){const o=i.toMap(e);if(t(o))return!1;return a(o,n(),i,s).intersects(r)}const s=new i;export{a as createQueryGeometry,o as intersectsDrapedGeometry};\n"],"sourceRoot":""}