(this["webpackJsonpjsapi-create-react-app"]=this["webpackJsonpjsapi-create-react-app"]||[]).push([[50],{662:function(e,t,i){"use strict";i.r(t);var s=i(2),r=i(6),n=i(13),a=i(9),o=i(267),l=i(82),c=i(149),u=i(736),d=i(699),h=i(754);const p=r.a.getLogger("esri.views.2d.layers.features.support.whereUtils"),f={getAttribute:(e,t)=>e.field(t)};const b=r.a.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter");t.default=class{constructor(e){this._geometryBounds=Object(l.f)(),this._idToVisibility=new Map,this._serviceInfo=e}get hash(){return this._hash}check(e){return this._applyFilter(e)}clear(){const e=this._resetAllHiddenIds();return this.update(),{show:e,hide:[]}}invalidate(){this._idToVisibility.forEach(((e,t)=>{this._idToVisibility.set(t,0)}))}setKnownIds(e){for(const t of e)this._idToVisibility.set(t,1)}setTrue(e){const t=[],i=[],s=new Set(e);return this._idToVisibility.forEach(((e,r)=>{const n=!!(1&this._idToVisibility.get(r)),a=s.has(r);!n&&a?t.push(r):n&&!a&&i.push(r),this._idToVisibility.set(r,a?3:0)})),{show:t,hide:i}}createQuery(){const{geometry:e,spatialRel:t,where:i,timeExtent:s,objectIds:r}=this;return c.a.fromJSON({geometry:e,spatialRel:t,where:i,timeExtent:s,objectIds:r})}async update(e,t){this._hash=JSON.stringify(e);const i=await Object(u.h)(e,null,t);await Object(a.b)([this._setGeometryFilter(i),this._setIdFilter(i),this._setAttributeFilter(i),this._setTimeFilter(i)])}async _setAttributeFilter(e){if(!e||!e.where)return this._clause=null,void(this.where=null);this._clause=await async function(e,t){const s=await i.e(5).then(i.bind(null,549));try{const i=s.WhereClause.create(e,t);if(!i.isStandardized){const e=new n.a("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",i);p.error(e)}return e=>{const t=e.readArcadeFeature();return i.testFeature(t,f)}}catch(r){return p.warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",e),e=>!0}}(e.where,this._serviceInfo.fieldsIndex),this.where=e.where}_setIdFilter(e){this._idsToShow=e&&e.objectIds&&new Set(e.objectIds),this._idsToHide=e&&e.hiddenIds&&new Set(e.hiddenIds),this.objectIds=e&&e.objectIds}async _setGeometryFilter(e){if(!e||!e.geometry)return this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null);const t=e.geometry,i=e.spatialRel||"esriSpatialRelIntersects",s=await Object(u.g)(i,t,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);Object(o.a)(this._geometryBounds,t),this._spatialQueryOperator=s,this.geometry=t,this.spatialRel=i}_setTimeFilter(e){if(this.timeExtent=this._timeOperator=null,e&&e.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=e.timeExtent,this._timeOperator=Object(d.b)(this._serviceInfo.timeInfo,e.timeExtent,h.b);else{const t=new n.a("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",e.timeExtent);b.error(t)}}_applyFilter(e){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e)}_filterByExpression(e){return!this.where||this._clause(e)}_filterById(e){return(!this._idsToHide||!this._idsToHide.size||!this._idsToHide.has(e.getObjectId()))&&(!this._idsToShow||!this._idsToShow.size||this._idsToShow.has(e.getObjectId()))}_filterByGeometry(e){if(!this.geometry)return!0;const t=e.readHydratedGeometry();return!!t&&this._spatialQueryOperator(t)}_filterByTime(e){return!Object(s.i)(this._timeOperator)||this._timeOperator(e)}_resetAllHiddenIds(){const e=[];return this._idToVisibility.forEach(((t,i)=>{1&t||(this._idToVisibility.set(i,1),e.push(i))})),e}}},699:function(e,t,i){"use strict";function s(e,t){if(!e)return null;const i=t.featureAdapter,{startTimeField:s,endTimeField:r}=e;let n=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(s&&r)t.forEach((e=>{const t=i.getAttribute(e,s),o=i.getAttribute(e,r);null==t||isNaN(t)||(n=Math.min(n,t)),null==o||isNaN(o)||(a=Math.max(a,o))}));else{const e=s||r;t.forEach((t=>{const s=i.getAttribute(t,e);null==s||isNaN(s)||(n=Math.min(n,s),a=Math.max(a,s))}))}return{start:n,end:a}}function r(e,t,i){if(!t||!e)return null;const{startTimeField:s,endTimeField:r}=e;if(!s&&!r)return null;const{start:n,end:a}=t;return null===n&&null===a?null:void 0===n&&void 0===a?()=>!1:s&&r?function(e,t,i,s,r){return null!=s&&null!=r?n=>{const a=e.getAttribute(n,t),o=e.getAttribute(n,i);return(null==a||a<=r)&&(null==o||o>=s)}:null!=s?t=>{const r=e.getAttribute(t,i);return null==r||r>=s}:null!=r?i=>{const s=e.getAttribute(i,t);return null==s||s<=r}:void 0}(i,s,r,n,a):function(e,t,i,s){return null!=i&&null!=s&&i===s?s=>e.getAttribute(s,t)===i:null!=i&&null!=s?r=>{const n=e.getAttribute(r,t);return n>=i&&n<=s}:null!=i?s=>e.getAttribute(s,t)>=i:null!=s?i=>e.getAttribute(i,t)<=s:void 0}(i,s||r,n,a)}i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return r}))},736:function(e,t,i){"use strict";i.d(t,"a",(function(){return O})),i.d(t,"b",(function(){return v})),i.d(t,"c",(function(){return V})),i.d(t,"d",(function(){return A})),i.d(t,"e",(function(){return k})),i.d(t,"f",(function(){return F})),i.d(t,"g",(function(){return U})),i.d(t,"h",(function(){return T})),i.d(t,"i",(function(){return R}));var s=i(2),r=i(36),n=i(13),a=i(9),o=i(34),l=i(116),c=i(359),u=i(360),d=i(63),h=i(50),p=i(449),f=i(147),b=i(426),y=(i(606),i(598));function _(e,t){return e?t?4:3:t?3:2}function m(e,t,i,s,r){if(!e)return!1;const n=_(t,i),{coords:a,lengths:o}=e;let l=!1,c=0;for(const u of o)l=g(l,a,n,c,u,s,r),c+=u*n;return l}function g(e,t,i,s,r,n,a){let o=e,l=s;for(let c=s,u=s+r*i;c<u;c+=i){l=c+i,l===u&&(l=s);const e=t[c],r=t[c+1],d=t[l],h=t[l+1];(r<a&&h>=a||h<a&&r>=a)&&e+(a-r)/(h-r)*(d-e)<n&&(o=!o)}return o}const I=new r.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),O=Object.freeze({}),j=new f.a,w=new f.a,S=new f.a,x={esriGeometryPoint:b.m,esriGeometryPolyline:b.o,esriGeometryPolygon:b.n,esriGeometryMultipoint:b.l};function R(e,t,i,s=e.hasZ,r=e.hasM){const n=e.hasZ&&s,a=e.hasM&&r;if(i){const o=Object(b.u)(S,t,e.hasZ,e.hasM,"esriGeometryPoint",i,s,r);return Object(b.m)(o,n,a)}return Object(b.m)(t,n,a)}function F(e,t,i,s,r,n,a=t,o=i){const l=t&&a,c=i&&o,u=s?"coords"in s?s:s.geometry:null;if(!u)return null;if(r){let s=Object(b.q)(w,u,t,i,e,r,a,o);return n&&(s=Object(b.u)(S,s,l,c,e,n)),x[e](s,l,c)}if(n){const s=Object(b.u)(S,u,t,i,e,n,a,o);return x[e](s,l,c)}return Object(b.x)(j,u,t,i,a,o),x[e](j,l,c)}async function v(e,t,i){const{outFields:s,orderByFields:r,groupByFieldsForStatistics:n,outStatistics:a}=e;if(s)for(let o=0;o<s.length;o++)s[o]=s[o].trim();if(r)for(let o=0;o<r.length;o++)r[o]=r[o].trim();if(n)for(let o=0;o<n.length;o++)n[o]=n[o].trim();if(a)for(let o=0;o<a.length;o++)a[o].onStatisticField&&(a[o].onStatisticField=a[o].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),T(e,t,i)}async function T(e,t,i){if(!e)return null;let{where:r}=e;if(e.where=r=r&&r.trim(),(!r||/^1 *= *1$/.test(r)||t&&t===r)&&(e.where=null),!e.geometry)return e;let n=await async function(e){const{geometry:t,distance:i,units:s}=e;if(null==i||"vertexAttributes"in t)return t;const r=t.spatialReference,n=s?I.fromJSON(s):Object(h.e)(r),a=r&&(Object(o.f)(r)||Object(o.m)(r))?t:await Object(y.a)(r,o.a).then((()=>Object(y.b)(t,o.a)));return(await N().then((e=>e.geodesicBuffer)))(a.spatialReference,a,i,n)}(e);if(e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel){const{spatialReference:t}=e.geometry;n=Object(u.a)(n),n.spatialReference=t}e.geometry=n,await Object(y.a)(n.spatialReference,i);const a=(await Object(p.a)(Object(d.a)(n)))[0];if(Object(s.h)(a))throw O;const l=a.toJSON(),c=await Object(y.b)(l,l.spatialReference,i);if(!c)throw O;return c.spatialReference=i,e.geometry=c,e}function A(e){return e&&E in e?JSON.parse(JSON.stringify(e,G)):e}const E="_geVersion",G=(e,t)=>e!==E?t:void 0,B={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},M={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},C={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},D={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function N(){return i.e(23).then(i.bind(null,797))}function U(e,t,i,s,r){if(Object(d.g)(t)&&"esriGeometryPoint"===i&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){const e=Object(b.g)(new f.a,t,!1,!1);return Object(a.u)((t=>function(e,t,i,s){return m(e,t,i,s.coords[0],s.coords[1])}(e,!1,!1,t)))}if(Object(d.g)(t)&&"esriGeometryMultipoint"===i){const i=Object(b.g)(new f.a,t,!1,!1);if("esriSpatialRelContains"===e)return Object(a.u)((e=>function(e,t,i,s,r,n){const a=_(r,n),{coords:o,lengths:l}=s;if(!l)return!1;for(let c=0,u=0;c<l.length;c++,u+=a)if(!m(e,t,i,o[u],o[u+1]))return!1;return!0}(i,!1,!1,e,s,r)))}if(Object(d.d)(t)&&"esriGeometryPoint"===i&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Object(a.u)((e=>Object(l.e)(t,F(i,s,r,e))));if(Object(d.d)(t)&&"esriGeometryMultipoint"===i&&"esriSpatialRelContains"===e)return Object(a.u)((e=>Object(l.d)(t,F(i,s,r,e))));if(Object(d.d)(t)&&"esriSpatialRelIntersects"===e){const e=Object(c.b)(i);return Object(a.u)((n=>e(t,F(i,s,r,n))))}return N().then((n=>{const a=n[B[e]].bind(null,t.spatialReference,t);return e=>a(F(i,s,r,e))}))}async function k(e,t,i){const{spatialRel:s,geometry:r}=e;if(r){if(!0!==M[s])throw new n.a("feature-store:unsupported-query","Unsupported query spatial relationship",{query:e});if(Object(o.i)(r.spatialReference)&&Object(o.i)(i)){if(!function(e){return!0===C[Object(d.c)(e)]}(r))throw new n.a("feature-store:unsupported-query","Unsupported query geometry type",{query:e});if(!function(e){return!0===D[e]}(t))throw new n.a("feature-store:unsupported-query","Unsupported layer geometry type",{query:e});if(e.outSR)return Object(y.a)(e.geometry&&e.geometry.spatialReference,e.outSR)}}}function V(e){if(Object(d.d)(e))return!0;if(Object(d.g)(e)){for(const t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1}},737:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var s=i(7),r=i(2),n=i(9),a=i(137),o=i(450),l=i(6);var c=function(e,t,i){e.referencesGeometry();const s=t.readArcadeFeature();try{return e.evaluate({...i,$feature:s})}catch(e){return l.a.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}};const u=i.e(137).then(i.bind(null,944));class d{constructor(e,t){this._canCacheExpressionValue=!1,this._sourceInfo=e,this._bitsets={computed:t.getBitset(t.createBitset())}}async updateSchema(e,t){const i=Object(o.a)(this._schema,t);if(this._schema=t,!t||Object(r.h)(i)||!Object(o.b)(i,"attributes"))return;Object(s.a)("esri-2d-update-debug")&&console.debug("Applying Update - Store:",i),this._bitsets.computed.clear(),e.targets[t.name]=!0;const a=t.attributes,l=[],c=[];for(const s in a){const e=a[s];switch(e.type){case"field":break;case"expression":l.push(this._createArcadeComputedField(e));break;case"label-expression":l.push(this._createLabelArcadeComputedField(e));break;case"statistic":c.push(e)}}this._computedFields=await Object(n.b)(l),this._canCacheExpressionValue=!this._computedFields.some((e=>"expression"===e.type&&e.expression.referencesScale())),this._statisticFields=c}setComputedAttributes(e,t,i,s){const r=this._bitsets.computed;if(!this._canCacheExpressionValue||!r.has(i)){r.set(i);for(const r of this._computedFields){const n=this._evaluateField(t,r,s);switch(r.resultType){case"numeric":e.setComputedNumericAtIndex(i,r.fieldIndex,n);break;case"string":e.setComputedStringAtIndex(i,r.fieldIndex,n)}}}}async _createArcadeComputedField(e){const t=this._sourceInfo.spatialReference,i=this._sourceInfo.fieldsIndex;return{...e,expression:await Object(a.d)(e.valueExpression,t,i)}}async _createLabelArcadeComputedField(e){const t=this._sourceInfo.spatialReference,i=this._sourceInfo.fields,{createLabelFunction:s}=await u,r=await s(e.label,i,t);return{...e,builder:r}}_evaluateField(e,t,i){switch(t.type){case"label-expression":{const i=e.readArcadeFeature();return t.builder.evaluate(i)||""}case"expression":{const{expression:s}=t;return c(s,e,{$view:{scale:i}})}}}}},754:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return u}));var s=i(2),r=i(70),n=i(132),a=i(582),o=i(737);function l(e){return(4294901760&e)>>>16}function c(e){return 65535&e}const u={getObjectId:e=>e.getObjectId(),getAttributes:e=>e.readAttributes(),getAttribute:(e,t)=>e.readAttribute(t),cloneWithGeometry:(e,t)=>e,getGeometry:e=>e.readHydratedGeometry(),getCentroid:(e,t)=>e.readCentroid()};class d extends o.a{constructor(e,t){super(e,t),this.featureAdapter=u,this.events=new r.a,this._featureSetsByInstance=new Map,this._objectIdToDisplayId=new Map,this._spatialIndexInvalid=!0,this._index=Object(a.a)(9,(e=>({minX:this._storage.getXMin(e),minY:this._storage.getYMin(e),maxX:this._storage.getXMax(e),maxY:this._storage.getYMax(e)})))}get storeStatistics(){return{featureCount:0,vertexCount:0}}onTileData(e,t,i){if(Object(s.h)(t.addOrUpdate))return t;this._featureSetsByInstance.set(t.addOrUpdate.instance,t.addOrUpdate),this._storage=i,t.addOrUpdate._storage=i;const r=t.addOrUpdate.getCursor();for(;r.next();){const t=r.getObjectId(),s=r.instance<<16|r.getIndex();let n=this._objectIdToDisplayId.get(t);n||(n=i.createDisplayId(),this._objectIdToDisplayId.set(t,n),this._spatialIndexInvalid=!0),r.setDisplayId(n),i.setInstanceId(n,s),this.setComputedAttributes(i,r,n,e.scale)}return"update"===t.type&&(this._spatialIndexInvalid=!0),this.events.emit("changed"),t}forEach(e){this._objectIdToDisplayId.forEach((t=>{const i=this._storage.getInstanceId(t),s=this._lookupFeature(i);e(s)}))}forEachUnsafe(e){this._objectIdToDisplayId.forEach((t=>{const i=this._storage.getInstanceId(t),s=l(i),r=c(i),n=this._getFeatureSet(s);n.setIndex(r),e(n)}))}forEachInBounds(e,t){const i=this._searchIndex(e);for(const r of i){const e=this.lookupFeatureByDisplayId(r,this._storage);t(Object(s.o)(e))}}forEachBounds(e,t,i){this._rebuildIndex();const s=[0,0,0,0];for(const r of e){if(!r.readGeometry())continue;const e=r.getDisplayId();s[0]=this._storage.getXMin(e),s[1]=this._storage.getYMin(e),s[2]=this._storage.getXMax(e),s[3]=this._storage.getYMax(e),t(Object(n.i)(i,s))}}sweepFeatures(e,t,i){this._objectIdToDisplayId.forEach(((s,r)=>{e.has(s)||(t.releaseDisplayId(s),i.unsetAttributeData(s),this._objectIdToDisplayId.delete(r))})),this.events.emit("changed")}sweepFeatureSets(e){this._featureSetsByInstance.forEach(((t,i)=>{e.has(i)||this._featureSetsByInstance.delete(i)}))}lookupObjectId(e,t){const i=this.lookupFeatureByDisplayId(e,t);return Object(s.h)(i)?null:i.getObjectId()}lookupDisplayId(e){return this._objectIdToDisplayId.get(e)}lookupFeatureByDisplayId(e,t){const i=t.getInstanceId(e);return this._lookupFeature(i)}lookupByDisplayIdUnsafe(e){const t=this._storage.getInstanceId(e),i=l(t),s=c(t),r=this._getFeatureSet(i);return r?(r.setIndex(s),r):null}hasInstance(e){return this._featureSetsByInstance.has(e)}_rebuildIndex(){if(!this._spatialIndexInvalid)return;this._index.clear();const e=[];this._objectIdToDisplayId.forEach((t=>{const i=this._storage.getInstanceId(t);this._storage.setBounds(t,this._lookupFeature(i))&&e.push(t)})),this._index.load(e),this._spatialIndexInvalid=!1}_lookupFeature(e){const t=l(e),i=c(e),s=this._getFeatureSet(t);if(!s)return null;const r=s.getCursor();return r.setIndex(i),r}_getFeatureSet(e){return this._featureSetsByInstance.get(e)}_searchIndex(e){this._rebuildIndex();const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this._index.search(t)}}}}]);