(this["webpackJsonptesting-ant-cra"]=this["webpackJsonptesting-ant-cra"]||[]).push([[27],{1197:function(e,t,r){"use strict";r.r(t);var i=r(27),a=r(8),n=r.n(a),s=r(14),o=r(4),l=r(5),u=r(6),c=r(7),h=r(0),f=(r(90),r(114)),p=r(12),d=r(10),b=r(25),y=r(38),m=r(30),v=r(1),g=(r(13),r(16),r(9)),x=r(701),j=r(194),_=r(952),O=r(702),k=r(755),w=r(35),R=r(47),T=r(46),I=r(142),P=r(100),S=r(730),M=r(146),C=r(220),z=r(442),U=r(471),B=r(214),q={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,type:"stretch"},G=function(e){Object(u.a)(r,e);var t=Object(c.a)(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(o.a)(this,r),(e=t.call(this))._textureInvalidated=!0,e._memoryUsed=null,e._supportsBilinear=!0,e.stencilRef=0,e.coordScale=[1,1],e._symbolizerParameters=null,e.height=null,e.isRendereredSource=!1,e.pixelRatio=1,e.resolution=0,e.rotation=0,e._source=null,e.rawPixelData=null,e._suspended=!1,e._bandIds=null,e._interpolation=null,e._transformGrid=null,e.width=null,e.x=0,e.y=0,e.transforms={dvs:Object(C.b)()},e.source=i,e.transformGrid=a,e.interpolation=n,e}return Object(l.a)(r,[{key:"destroy",value:function(){var e=this.getTextures();null==e||e.textures.forEach((function(e){return e.dispose()})),this._rasterTexture=null,this._transformGridTexture=null,this._colormapTexture=null}},{key:"symbolizerParameters",get:function(){return this._symbolizerParameters||q},set:function(e){this._symbolizerParameters=e}},{key:"source",get:function(){return this._source},set:function(e){this._source=e,this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null,this._memoryUsed=null)}},{key:"suspended",get:function(){return this._suspended},set:function(e){this._suspended&&!e&&this.stage&&(this.ready(),this.requestRender()),this._suspended=e}},{key:"bandIds",get:function(){return this._bandIds},set:function(e){this._bandIds=e,this.invalidateTexture()}},{key:"interpolation",get:function(){return this._interpolation},set:function(e){this._interpolation=e,this._rasterTexture&&this._rasterTexture.setSamplingMode(!this._supportsBilinear||"bilinear"!==e&&"cubic"!==e?9728:9729)}},{key:"transformGrid",get:function(){return this._transformGrid},set:function(e){this._transformGrid=e,this._transformGridTexture&&(this._transformGridTexture.dispose(),this._transformGridTexture=null,this._memoryUsed=null)}},{key:"invalidateTexture",value:function(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRender())}},{key:"setTransform",value:function(e){var t=Object(M.b)(this.transforms.dvs),r=e.toScreenNoRotation([0,0],this.x,this.y),a=Object(i.a)(r,2),n=a[0],s=a[1],o=this.resolution/this.pixelRatio/e.resolution,l=o*this.width,u=o*this.height,c=Math.PI*this.rotation/180;Object(M.c)(t,t,Object(z.b)(n,s)),Object(M.c)(t,t,Object(z.b)(l/2,u/2)),Object(M.j)(t,t,-c),Object(M.c)(t,t,Object(z.b)(-l/2,-u/2)),Object(M.g)(t,t,Object(z.b)(l,u)),Object(M.h)(this.transforms.dvs,e.displayViewMat3,t)}},{key:"getTextures",value:function(){if(!this._rasterTexture)return null;var e=[],t=[];return this._transformGridTexture&&(t.push(this._transformGridTexture),e.push("u_transformGrid")),this._rasterTexture&&(t.push(this._rasterTexture),e.push("u_image")),this._colormapTexture&&(t.push(this._colormapTexture),e.push("u_colormap")),{names:e,textures:t}}},{key:"getMemoryUsage",value:function(){if(Object(d.j)(this._memoryUsed)){var e=this.getTextures();if(null==e)return 0;this._memoryUsed=e.textures.map((function(e){return e.descriptor.width*e.descriptor.height*4})).reduce((function(e,t){return e+t}))}return this._memoryUsed}},{key:"onAttach",value:function(){this.invalidateTexture()}},{key:"onDetach",value:function(){this.invalidateTexture()}},{key:"updateTexture",value:function(e){var t,r,i,a=e.context;if(!this.stage)return null==(t=this._rasterTexture)||t.dispose(),null==(r=this._transformGridTexture)||r.dispose(),null==(i=this._colormapTexture)||i.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null,this._transformGridTexture=null,void(this._colormapTexture=null);if(this._textureInvalidated){this._textureInvalidated=!1;var n=this.source,s=n&&n.pixels&&n.pixels.length>0;this._createOrDestroyRasterTexture(a),this._rasterTexture&&(s?(this._updateColormapTexture(a),this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=Object(B.c)(a,this.transformGrid))):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender())}}},{key:"_createOrDestroyRasterTexture",value:function(e){var t,r,i=this.source?Object(O.h)(this.source,this.bandIds):null;if(i&&i.pixels&&i.pixels.length>0){var a=null==this._rasterTextureBandIds&&null==this.bandIds||this._rasterTextureBandIds&&this.bandIds&&this._rasterTextureBandIds.join("")===this.bandIds.join("");if(this._rasterTexture){if(a)return;this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null}var n=this.interpolation||"nearest",s=this.isRendereredSource||!(null!=(t=e.capabilities.textureFloat)&&t.textureFloat);this._rasterTexture=Object(B.b)(e,i,n,s),this._supportsBilinear=null==(r=e.capabilities.textureFloat)?void 0:r.textureFloatLinear,this._rasterTextureBandIds=this.bandIds?Object(w.a)(this.bandIds):null}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null)}},{key:"_updateColormapTexture",value:function(e){var t=this._colormap,r=this.symbolizerParameters.colormap;return r?t?r.length!==t.length||r.some((function(e,r){return e!==t[r]}))?(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=Object(B.a)(e,r),void(this._colormap=r)):void 0:(this._colormapTexture=Object(B.a)(e,r),void(this._colormap=r)):(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),void(this._colormap=null))}}]),r}(U.a),V=function(e){Object(u.a)(r,e);var t=Object(c.a)(r);function r(e,i,a){var n,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Object(o.a)(this,r),(n=t.call(this,e,i,a)).bitmap=new G(s,null,null),n.bitmap.coordScale=a,n.bitmap.once("isReady",(function(){return n.ready()})),n}return Object(l.a)(r,[{key:"destroy",value:function(){Object(R.a)(Object(T.a)(r.prototype),"destroy",this).call(this),this.bitmap.destroy(),this.bitmap=null,this.stage=null}},{key:"stencilRef",get:function(){return this.bitmap.stencilRef},set:function(e){this.bitmap.stencilRef=e}},{key:"getMemoryUsage",value:function(){return this.bitmap.getMemoryUsage()}},{key:"setTransform",value:function(e,t){Object(R.a)(Object(T.a)(r.prototype),"setTransform",this).call(this,e,t),this.bitmap.transforms.dvs=this.transforms.dvs}},{key:"onAttach",value:function(){this.bitmap.stage=this.stage}},{key:"onDetach",value:function(){this.bitmap.stage=null}}]),r}(r(470).a),L=r(593),F=function(e){Object(u.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(o.a)(this,r),(e=t.apply(this,arguments)).isCustomTilingScheme=!1,e}return Object(l.a)(r,[{key:"createTile",value:function(e){var t=this._getTileBounds(e);return new V(e,t,this._tileInfoView.tileInfo.size)}},{key:"destroyTile",value:function(){}},{key:"prepareRenderPasses",value:function(e){var t=this,i=e.registerRenderPass({name:"bitmap (tile)",brushes:[S.a.raster],target:function(){return t.children.map((function(e){return e.bitmap}))},drawPhase:L.c.MAP});return[].concat(Object(w.a)(Object(R.a)(Object(T.a)(r.prototype),"prepareRenderPasses",this).call(this,e)),[i])}},{key:"doRender",value:function(e){this.visible&&e.drawPhase===L.c.MAP&&Object(R.a)(Object(T.a)(r.prototype),"doRender",this).call(this,e)}},{key:"_getTileBounds",value:function(e){var t=this._tileInfoView.getTileBounds(Object(I.h)(),e);if(this.isCustomTilingScheme&&e.world){var r=this._tileInfoView.tileInfo,i=Object(P.o)(r.spatialReference);if(i){var a=r.lodAt(e.level).resolution,n=i/a%r.size[0],s=n?(r.size[0]-n)*a:0;t[0]-=s*e.world,t[2]-=s*e.world}}return t}}]),r}(r(639).a),E=r(627),D=r(466),N=r(540),W=r(541),A=r(22),Q=r(762),H=function(e){var t=function(e){Object(u.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(o.a)(this,r),(e=t.apply(this,arguments))._rasterFieldPrefix="Raster.",e.layer=null,e.view=null,e.fullExtent=null,e.tileInfo=null,e.datumTransformation=null,e}return Object(l.a)(r,[{key:"hasTilingEffects",get:function(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}},{key:"fetchPopupFeatures",value:function(){var e=Object(s.a)(n.a.mark((function e(t,r){var i,a,s,o,l,u,c,h,p,b,y,m,v,g,x,j,_;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.layer,t){e.next=3;break}return e.abrupt("return",Promise.reject(new A.a("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:i})));case 3:if(a=i.popupEnabled,s=Object(Q.a)(i,r),a&&Object(d.k)(s)){e.next=6;break}throw new A.a("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:a,popupTemplate:s});case 6:return o=[],e.next=9,i.identify(t);case 9:if(l=e.sent,u=l.value,c="",u&&u.length){if(c="imagery-tile"===i.type&&i.hasStandardTime()&&null!=u[0]?u.map((function(e){return i.getStandardTimeValue(e)})).join(", "):u.join(", "),(b={ObjectId:0})[y="Raster.ServicePixelValue"]=this._formatAttributeValue(c,y),(m=null==(h=i.rasterInfo)||null==(p=h.attributeTable)?void 0:p.features)&&m.length>0&&(v=m.filter((function(e){var t=e.attributes.value||e.attributes.Value||e.attributes.VALUE;return String(t)===c}))).length>0&&(g=v[0]))for(x in g.attributes)g.attributes.hasOwnProperty(x)&&(j=this._rasterFieldPrefix+x,b[j]=this._formatAttributeValue(g.attributes[x],j));(_=new f.a(this.fullExtent.clone(),null,b)).layer=i,_.sourceLayer=_.layer,o.push(_)}return e.abrupt("return",o);case 14:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateFullExtent",value:function(){var e,t=this.layer.tileInfo;t&&t.spatialReference||(e=new A.a("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer}));var r=Object(k.b)(this.layer.fullExtent,this.view.spatialReference,!1),i=Object(k.g)(this.layer.fullExtent,this.view.spatialReference,r);return null==i&&(e=new A.a("layerview:projection-not-supported","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer})),this._set("fullExtent",i),this.datumTransformation||(this.datumTransformation=Object(k.b)(this.layer.fullExtent,this.view.spatialReference,!0)),e?Promise.reject(e):Promise.resolve()}},{key:"_formatAttributeValue",value:function(e,t){if("string"==typeof e){var r,i,a=this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,n=this._getFieldInfo(a,t),s=n&&n.format;if(s)return e.trim().indexOf(",")>-1?(i=(r=",")+" ",this._formatDelimitedString(e,r,i,s)):e.trim().indexOf(" ")>-1?(r=i=" ",this._formatDelimitedString(e,r,i,s)):this._formatNumberFromString(e,s)}return e}},{key:"_getFieldInfo",value:function(e,t){if(e&&e.length&&t){var r,i=t.toLowerCase();return e.some((function(e){return!(!e.fieldName||e.fieldName.toLowerCase()!==i&&e.fieldName.toLowerCase()!==i.replace(/ /g,"_"))&&(r=e,!0)})),r}}},{key:"_formatDelimitedString",value:function(e,t,r,i){var a=this;return e&&t&&r&&i?e.trim().split(t).map((function(e){return a._formatNumberFromString(e,i)})).join(r):e}},{key:"_formatNumberFromString",value:function(e,t){if(!e||!t)return e;var r=Number(e);return isNaN(r)?e:t.format(r)}}]),r}(e);return Object(h.a)([Object(v.b)()],t.prototype,"layer",void 0),Object(h.a)([Object(v.b)()],t.prototype,"view",void 0),Object(h.a)([Object(v.b)()],t.prototype,"fullExtent",void 0),Object(h.a)([Object(v.b)()],t.prototype,"tileInfo",void 0),Object(h.a)([Object(v.b)({readOnly:!0})],t.prototype,"hasTilingEffects",null),t=Object(h.a)([Object(g.a)("esri.views.layers.ImageryTileLayerView")],t)},J=r(611),X=r(375),Z=r(713),K=r(464),Y=r(53),$=r(55),ee=p.a.getLogger("esri.views.2d.layers.ImageryTileLayerView2D"),te=[0,0],re=function(e){Object(u.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(o.a)(this,r),(e=t.apply(this,arguments))._tileStrategy=null,e._tileInfoView=null,e._fetchQueue=null,e._blockCacheRegistryUrl=null,e._blockCacheRegistryId=null,e._bitmapView=null,e._emptyTilePixelBlock=null,e._srcResolutions=null,e._previousLOD=null,e._needBlockCacheUpdate=!1,e._globalSymbolizerParams=null,e._symbolizerParams=null,e._abortController=null,e._globalUpdateRequested=!1,e._isCustomTilingScheme=!1,e.useWebGLForProcessing=!0,e._redrawOrRefreshDebounced=Object(b.i)((function(t,r){return t?(e._set("refreshTimestamp",Date.now()),e.doRefresh()):e._redrawImage(r)})),e}return Object(l.a)(r,[{key:"initialize",value:function(){var e=this.updateFullExtent();this.addResolvingPromise(e)}},{key:"useProgressiveUpdate",get:function(){return null==this._get("useProgressiveUpdate")||this._get("useProgressiveUpdate")},set:function(e){var t=this;if(this._tileStrategy&&this.useProgressiveUpdate!==e){this._tileStrategy.destroy(),this._bitmapView.removeAllChildren();var r=this._getCacheSize(e);this._tileStrategy=new W.a({cachePolicy:"purge",acquireTile:function(e){return t.acquireTile(e)},releaseTile:function(e){return t.releaseTile(e)},cacheSize:r,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",e),this.requestUpdate()}}},{key:"hitTest",value:function(e,t){if(this.suspended)return Promise.resolve(null);var r=this.view.toMap(Object(y.f)(e,t));return Promise.resolve(new f.a({attributes:{},geometry:r}))}},{key:"update",value:function(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();var t=e.state,r=t.extent,i=t.resolution,a=t.scale,n=this._tileInfoView.getClosestInfoForScale(a);if(this.layer.raster){var s;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){var o=this._srcResolutions[n.level],l=r.toJSON?r:Y.a.fromJSON(r);Object(_.h)(this._blockCacheRegistryUrl,this._blockCacheRegistryId,l,i,o,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,(null==(s=this._previousLOD)?void 0:s.level)!==n.level&&(this._previousLOD=n,null!=this._symbolizerParams&&this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}this.notifyChange("updating")}},{key:"attach",value:function(){var e=this;this.layer.increaseRasterJobHandlerUsage(),Object(K.a)().supportsTextureFloat||(this.useWebGLForProcessing=!1),this.layer.raster&&(this.layer.raster.ioConfig.allowPartialFill=!0),this._initializeTileInfo(),this._tileInfoView=new D.a(this.tileInfo,this.fullExtent);var t=this._computeFetchConcurrency();this._fetchQueue=new N.a({tileInfoView:this._tileInfoView,concurrency:t,process:function(t,r){return e.fetchTile(t,r)}});var r=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new W.a({cachePolicy:"purge",acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},cacheSize:r,tileInfoView:this._tileInfoView}),this._bitmapView=new F(this._tileInfoView),this._bitmapView.isCustomTilingScheme=this._isCustomTilingScheme,this.container.addChild(this._bitmapView),this.handles.add([Object(m.d)(this.layer,["bandIds","renderer","interpolation","multidimensionalDefinition"],(function(t,r,i){var a="multidimensionalDefinition"===i,n="interpolation"===i&&("majority"===t||"majority"===r)&&e._canUseMajorityInterpolationOnDataSource(),s=a||n;e._redrawOrRefreshDebounced(s).catch((function(e){Object(b.m)(e)||ee.error(e)}))}))],"attach"),this._updateBlockCacheRegistry()}},{key:"detach",value:function(){this.handles.remove("attach"),this.layer.decreaseRasterJobHandlerUsage(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,Object(_.g)(this._blockCacheRegistryUrl,this._blockCacheRegistryId)}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){var e=this;!this.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=Object(b.d)(),0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then((function(){e._globalUpdateRequested=!1,e.requestUpdate()})));var t=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(t),this.requestUpdate()}},{key:"createFetchPopupFeaturesQueryGeometry",value:function(e,t){return Object(Z.a)(e,t,this.view)}},{key:"doRefresh",value:function(){var e=Object(s.a)(n.a.mark((function e(){var t,r=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.suspended){e.next=2;break}return e.abrupt("return");case 2:return this.layer.updateRenderer(),this._updateSymbolizerParams(),this._updateBlockCacheRegistry(!0),this._fetchQueue.reset(),t=[],this._tileStrategy.tiles.forEach((function(e){return t.push(r._enqueueTileFetch(e))})),e.next=7,Object(b.j)(t);case 7:this.notifyChange("updating");case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isUpdating",value:function(){return this._fetchQueue.length>0||this._globalUpdateRequested}},{key:"acquireTile",value:function(e){var t,r,a,n,s=this._bitmapView.createTile(e),o=s.bitmap;return t=this._tileInfoView.getTileCoords(te,s.key),r=Object(i.a)(t,2),o.x=r[0],o.y=r[1],o.resolution=this._tileInfoView.getTileResolution(s.key),a=this._tileInfoView.tileInfo.size,n=Object(i.a)(a,2),o.width=n[0],o.height=n[1],this._enqueueTileFetch(s),this.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.hasTilingEffects||!this.useProgressiveUpdate,s}},{key:"releaseTile",value:function(e){var t=this;this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once("detach",(function(){e.destroy(),t.requestUpdate()})),this.requestUpdate()}},{key:"fetchTile",value:function(e,t){var r=!Object(d.j)(t)&&t.signal,i=this._canUseWebGLForProcessing(),a={tileInfo:this.tileInfo,signal:Object(d.r)(r),registryId:this._blockCacheRegistryId,requestRawData:i,srcResolution:this._srcResolutions[e.level],datumTransformation:this.datumTransformation,interpolation:i?"nearest":this.layer.interpolation};return this.layer.fetchTile(e.level,e.row,e.col,a)}},{key:"_canUseWebGLForProcessing",value:function(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&this._canUseMajorityInterpolationOnDataSource())}},{key:"_getCacheSize",value:function(e){return e?40:0}},{key:"_initializeTileInfo",value:function(){var e=this.view.spatialReference,t=new $.a({x:this.fullExtent.xmin,y:this.fullExtent.ymax,spatialReference:e}),r=Object(k.a)(this.layer.rasterInfo,e),i=r.scales,a=r.srcResolutions,n=r.isCustomTilingScheme,s=j.a.create({spatialReference:e,size:512,scales:i});(0===s.origin.x||s.origin.x>t.x)&&(s.origin=t),this._isCustomTilingScheme=n,this._set("tileInfo",s),this._srcResolutions=null!=a?a:[]}},{key:"_computeFetchConcurrency",value:function(){var e=this.layer.rasterInfo.storageInfo.blockBoundary,t=e[e.length-1];return(t.maxCol-t.minCol+1)*(t.maxRow-t.minRow+1)>64?2:10}},{key:"_enqueueTileFetch",value:function(){var e=Object(s.a)(n.a.mark((function e(t,r){var i,a,s,o,l,u,c,h=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._fetchQueue.has(t.key.id)){e.next=41;break}return e.prev=1,e.next=4,this._fetchQueue.push(t.key);case 4:if(i=e.sent,a=this.layer.bandIds,s=!this.useProgressiveUpdate||this.hasTilingEffects&&!this._globalSymbolizerParams,!this._globalUpdateRequested||this.moving||0!==this._fetchQueue.length){e.next=18;break}return s=!1,e.prev=9,e.next=12,this._redrawImage(this._abortController&&this._abortController.signal);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(9),Object(b.m)(e.t0)&&ee.error(e.t0);case 17:this._globalUpdateRequested=!1;case 18:if((o=this._canUseWebGLForProcessing())&&!this.hasTilingEffects&&null==this._symbolizerParams&&this._updateSymbolizerParams(),!i||!i.pixelBlock){e.next=32;break}if(l={extent:i.extent,pixelBlock:i.pixelBlock},t.bitmap.rawPixelData=l,!o){e.next=25;break}t.bitmap.source=i.pixelBlock,t.bitmap.isRendereredSource=!1,e.next=29;break;case 25:return e.next=27,this.layer.applyRenderer(l,this.hasTilingEffects&&this._globalSymbolizerParams&&"stretch"===this._globalSymbolizerParams.type?this._globalSymbolizerParams:null);case 27:u=e.sent,t.bitmap.source=u,t.bitmap.isRendereredSource=!0;case 29:t.bitmap.symbolizerParameters=o?this._globalSymbolizerParams||this._symbolizerParams:null,o?t.bitmap.transformGrid||(t.bitmap.transformGrid=i.transformGrid):t.bitmap.transformGrid=null,e.next=34;break;case 32:c=this._createEmptyTilePixelBlock(),t.bitmap.source=c,t.bitmap.symbolizerParameters=o?this._symbolizerParams:null,t.bitmap.transformGrid=null;case 34:t.bitmap.bandIds=a,t.bitmap.width=this._tileInfoView.tileInfo.size[0],t.bitmap.height=this._tileInfoView.tileInfo.size[1],t.bitmap.interpolation=this._getLayerInterpolation(),t.bitmap.suspended=s,t.bitmap.invalidateTexture(),t.once("attach",(function(){return h.requestUpdate()})),this._bitmapView.addChild(t),e.next=40;break;case 37:e.prev=37,e.t1=e.catch(1),Object(b.m)(e.t1)||ee.error(e.t1);case 40:this.requestUpdate();case 41:case"end":return e.stop()}}),e,this,[[1,37],[9,14]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_redrawImage",value:function(){var e=Object(s.a)(n.a.mark((function e(t){var r,i,a=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.layer.updateRenderer(),!this.hasTilingEffects){e.next=6;break}return e.next=4,this._updateGlobalSymbolizerParams(t);case 4:e.next=7;break;case 6:this._updateSymbolizerParams(),this._globalSymbolizerParams=null;case 7:return r=this.layer.bandIds,i=this._bitmapView.children.map(function(){var e=Object(s.a)(n.a.mark((function e(t){var i;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=a._canUseWebGLForProcessing())||!t.bitmap.rawPixelData){e.next=8;break}return e.next=4,a.layer.applyRenderer(t.bitmap.rawPixelData,a.hasTilingEffects&&a._globalSymbolizerParams&&"stretch"===a._globalSymbolizerParams.type?a._globalSymbolizerParams:null);case 4:t.bitmap.source=e.sent,t.bitmap.isRendereredSource=!0,e.next=9;break;case 8:t.bitmap.isRendereredSource&&t.bitmap.rawPixelData&&(t.bitmap.source=t.bitmap.rawPixelData.pixelBlock),t.bitmap.isRendereredSource=!1;case 9:t.bitmap.symbolizerParameters=i?a._globalSymbolizerParams||a._symbolizerParams:null,t.bitmap.bandIds=r,t.bitmap.interpolation=a._getLayerInterpolation(),t.bitmap.suspended=!1;case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=10,Object(b.j)(i);case 10:this.container.requestRender();case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createEmptyTilePixelBlock",value:function(){if(!this._emptyTilePixelBlock){var e=this._tileInfoView.tileInfo.size[0],t=this._tileInfoView.tileInfo.size[1];this._emptyTilePixelBlock=new x.a({width:e,height:t,pixels:[new Uint8Array(e*t)],mask:new Uint8Array(e*t),pixelType:"u8"})}return this._emptyTilePixelBlock}},{key:"_updateGlobalSymbolizerParams",value:function(){var e=Object(s.a)(n.a.mark((function e(t){var r,i,a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={srcResolution:this._srcResolutions[this._previousLOD.level],registryId:this._blockCacheRegistryId,signal:t},e.next=3,this.layer.fetchPixels(this.view.extent,this.view.width,this.view.height,r);case 3:if((i=e.sent)&&i.pixelBlock){e.next=6;break}return e.abrupt("return");case 6:a=this.layer.symbolizer.generateWebGLParameters({pixelBlock:Object(O.h)(i.pixelBlock,this.layer.bandIds),isGCS:this.view.spatialReference.isGeographic,resolution:{x:this._previousLOD.resolution,y:this._previousLOD.resolution},bandIds:this.layer.bandIds}),!this._canUseWebGLForProcessing()&&a&&"stretch"===a.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(a.factor=a.factor.map((function(e){return 255*e})),a.outMin=Math.round(255*a.outMin),a.outMax=Math.round(255*a.outMax)),this._globalSymbolizerParams=a;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateSymbolizerParams",value:function(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.view.spatialReference.isGeographic,resolution:{x:this._previousLOD.resolution,y:this._previousLOD.resolution},bandIds:this.layer.bandIds})}},{key:"_updateBlockCacheRegistry",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.layer,r=t.url,i=t.rasterInfo,a=t.multidimensionalDefinition,n=t.raster,s=null!=i&&i.multidimensionalInfo?n.getSliceIndex(a):null,o=Object(_.d)(r,s);if(o!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&Object(_.g)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=Object(_.f)(o,this.layer.raster.rasterInfo),e){var l=this._tileInfoView.getClosestInfoForScale(this.view.scale),u=this._srcResolutions[l.level];Object(_.h)(o,this._blockCacheRegistryId,this.view.extent,this.view.resolution,u,this.layer.raster.ioConfig.sampling)}this._blockCacheRegistryUrl=o}}},{key:"_canUseMajorityInterpolationOnDataSource",value:function(){var e=this.layer.rasterInfo,t=e.bandCount,r=e.attributeTable,i=e.colormap,a=e.pixelType;return 1===t&&(null!=r||null!=i||"u8"===a||"s8"===a)}},{key:"_getLayerInterpolation",value:function(){var e=this.layer.renderer.type;if("raster-colormap"===e||"unique-value"===e||"class-breaks"===e)return"nearest";var t=this.layer.renderer;return"raster-stretch"===t.type&&null!=t.colorRamp?"nearest":this.layer.interpolation}}]),r}(H(Object(X.a)(Object(E.a)(J.a))));Object(h.a)([Object(v.b)()],re.prototype,"useProgressiveUpdate",null);var ie=re=Object(h.a)([Object(g.a)("esri.views.2d.layers.ImageryTileLayerView2D")],re);t.default=ie},611:function(e,t,r){"use strict";var i=r(4),a=r(5),n=r(6),s=r(7),o=r(0),l=r(36),u=r(112),c=r(113),h=r(295),f=r(12),p=r(167),d=r(1),b=(r(13),r(16),r(9)),y=function(e){Object(n.a)(r,e);var t=Object(s.a)(r);function r(e){var a;return Object(i.a)(this,r),(a=t.call(this,e)).layer=null,a.parent=null,a}return Object(a.a)(r,[{key:"initialize",value:function(){var e=this;this.when().catch((function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",i=e.layer&&e.layer.title||"no title";throw f.a.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '".concat(i,"', id: '").concat(r,"')"),t),t}}))}},{key:"fullOpacity",get:function(){var e=function(e){return null==e?1:e};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))}},{key:"suspended",get:function(){return!this.canResume()}},{key:"suspendInfo",get:function(){return this.getSuspendInfo()}},{key:"legendEnabled",get:function(){return!this.suspended&&!0===this.layer.legendEnabled}},{key:"updating",get:function(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}},{key:"updatingProgress",get:function(){return this.updating?0:1}},{key:"visible",get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}},{key:"canResume",value:function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}},{key:"getSuspendInfo",value:function(){var e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}},{key:"isUpdating",value:function(){return!1}}]),r}(Object(c.b)(Object(h.a)(Object(p.b)(u.a.EventedMixin(l.a)))));Object(o.a)([Object(d.b)()],y.prototype,"fullOpacity",null),Object(o.a)([Object(d.b)()],y.prototype,"layer",void 0),Object(o.a)([Object(d.b)()],y.prototype,"parent",void 0),Object(o.a)([Object(d.b)({readOnly:!0})],y.prototype,"suspended",null),Object(o.a)([Object(d.b)({readOnly:!0})],y.prototype,"suspendInfo",null),Object(o.a)([Object(d.b)({readOnly:!0})],y.prototype,"legendEnabled",null),Object(o.a)([Object(d.b)({type:Boolean,readOnly:!0})],y.prototype,"updating",null),Object(o.a)([Object(d.b)({readOnly:!0})],y.prototype,"updatingProgress",null),Object(o.a)([Object(d.b)()],y.prototype,"visible",null);var m=y=Object(o.a)([Object(b.a)("esri.views.layers.LayerView")],y);t.a=m},627:function(e,t,r){"use strict";r.d(t,"a",(function(){return C}));var i,a=r(4),n=r(5),s=r(47),o=r(46),l=r(6),u=r(7),c=r(0),h=r(37),f=r(147),p=r(30),d=r(1),b=(r(13),r(16),r(12),r(9)),y=r(664),m=function(e){Object(l.a)(r,e);var t=Object(u.a)(r);function r(){return Object(a.a)(this,r),t.apply(this,arguments)}return r}(r(24).a),v=m=Object(c.a)([Object(b.a)("esri.views.layers.support.ClipArea")],m),g=i=function(e){Object(l.a)(r,e);var t=Object(u.a)(r);function r(){var e;return Object(a.a)(this,r),(e=t.apply(this,arguments)).type="rect",e.left=null,e.right=null,e.top=null,e.bottom=null,e}return Object(n.a)(r,[{key:"clone",value:function(){return new i({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}},{key:"version",get:function(){return(this._get("version")||0)+1}}]),r}(v);Object(c.a)([Object(d.b)({type:[Number,String],json:{write:!0}})],g.prototype,"left",void 0),Object(c.a)([Object(d.b)({type:[Number,String],json:{write:!0}})],g.prototype,"right",void 0),Object(c.a)([Object(d.b)({type:[Number,String],json:{write:!0}})],g.prototype,"top",void 0),Object(c.a)([Object(d.b)({type:[Number,String],json:{write:!0}})],g.prototype,"bottom",void 0),Object(c.a)([Object(d.b)({readOnly:!0})],g.prototype,"version",null);var x,j=g=i=Object(c.a)([Object(b.a)("esri.views.layers.support.ClipRect")],g),_=(r(90),r(116)),O=r(82),k=r(53),w=r(129),R={base:_.a,key:"type",typeMap:{extent:k.a,polygon:w.a}},T=x=function(e){Object(l.a)(r,e);var t=Object(u.a)(r);function r(){var e;return Object(a.a)(this,r),(e=t.apply(this,arguments)).type="geometry",e.geometry=null,e}return Object(n.a)(r,[{key:"version",get:function(){return(this._get("version")||0)+1}},{key:"clone",value:function(){return new x({geometry:this.geometry.clone()})}}]),r}(v);Object(c.a)([Object(d.b)({types:R,json:{read:O.a,write:!0}})],T.prototype,"geometry",void 0),Object(c.a)([Object(d.b)({readOnly:!0})],T.prototype,"version",null);var I=T=x=Object(c.a)([Object(b.a)("esri.views.layers.support.Geometry")],T),P=function(e){Object(l.a)(r,e);var t=Object(u.a)(r);function r(){var e;return Object(a.a)(this,r),(e=t.apply(this,arguments)).type="path",e.path=[],e}return Object(n.a)(r,[{key:"version",get:function(){return(this._get("version")||0)+1}}]),r}(v);Object(c.a)([Object(d.b)({type:[[[Number]]],json:{write:!0}})],P.prototype,"path",void 0),Object(c.a)([Object(d.b)({readOnly:!0})],P.prototype,"version",null);var S=P=Object(c.a)([Object(b.a)("esri.views.layers.support.Path")],P),M=h.a.ofType({key:"type",base:v,typeMap:{rect:j,path:S,geometry:I}}),C=function(e){var t=function(e){Object(l.a)(r,e);var t=Object(u.a)(r);function r(){var e;return Object(a.a)(this,r),(e=t.apply(this,arguments)).clips=new M,e.moving=!1,e.attached=!1,e.lastUpdateId=-1,e.updateRequested=!1,e}return Object(n.a)(r,[{key:"initialize",value:function(){var e,t=this;this.container||(this.container=new y.a),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([Object(p.a)(this,"suspended",(function(e){t.container&&(t.container.visible=!e),t.view&&!e&&t.updateRequested&&t.view.requestUpdate()}),!0),Object(p.a)(this,["layer.opacity","container"],(function(){var e,r;t.container&&(t.container.opacity=null!=(e=null==(r=t.layer)?void 0:r.opacity)?e:1)}),!0),Object(p.a)(this,["layer.blendMode"],(function(e){t.container&&(t.container.blendMode=e)}),!0),Object(p.a)(this,["layer.effect"],(function(e){t.container&&(t.container.effect=e)}),!0),this.clips.on("change",(function(){t.container.clips=t.clips,t.notifyChange("clips")}))]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then((function(e){e!==t||t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){})):this.when().then((function(){t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){}))}},{key:"destroy",value:function(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}},{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}},{key:"isVisibleAtScale",value:function(e){var t=!0,r=this.layer,i=r.minScale,a=r.maxScale;if(null!=i&&null!=a){var n=!i,s=!a;!n&&e<=i&&(n=!0),!s&&e>=a&&(s=!0),t=n&&s}return t}},{key:"requestUpdate",value:function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}},{key:"processUpdate",value:function(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}},{key:"isUpdating",value:function(){return!1}},{key:"isRendering",value:function(){return!1}},{key:"canResume",value:function(){return!!Object(s.a)(Object(o.a)(r.prototype),"canResume",this).call(this)&&this.isVisibleAtScale(this.view.scale)}}]),r}(e);return Object(c.a)([Object(d.b)({type:M,set:function(e){var t=Object(f.b)(e,this._get("clips"),M);this._set("clips",t)}})],t.prototype,"clips",void 0),Object(c.a)([Object(d.b)()],t.prototype,"moving",void 0),Object(c.a)([Object(d.b)()],t.prototype,"attached",void 0),Object(c.a)([Object(d.b)()],t.prototype,"container",void 0),Object(c.a)([Object(d.b)()],t.prototype,"suspended",void 0),Object(c.a)([Object(d.b)({readOnly:!0})],t.prototype,"updateParameters",void 0),Object(c.a)([Object(d.b)()],t.prototype,"updateRequested",void 0),Object(c.a)([Object(d.b)()],t.prototype,"updating",null),Object(c.a)([Object(d.b)()],t.prototype,"view",void 0),t=Object(c.a)([Object(b.a)("esri.views.2d.layers.LayerView2D")],t)}},639:function(e,t,r){"use strict";var i=r(15),a=r(11),n=r(4),s=r(5),o=r(47),l=r(46),u=r(6),c=r(7),h=r(13),f=r(593),p=r(663),d=r(690),b=r(683),y=function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col},m=function(e){Object(u.a)(r,e);var t=Object(c.a)(r);function r(e){var i;return Object(n.a)(this,r),(i=t.call(this))._tileInfoView=e,i}return Object(s.a)(r,[{key:"requiresDedicatedFBO",get:function(){return!1}},{key:"renderChildren",value:function(e){this.sortChildren(y),this.setStencilReference(),Object(o.a)(Object(l.a)(r.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){var t=e.state;return Object(a.a)(Object(a.a)({},Object(o.a)(Object(l.a)(r.prototype),"createRenderParams",this).call(this,e)),{},{requiredLevel:this._tileInfoView.getClosestInfoForScale(t.scale).level,displayLevel:this._tileInfoView.tileInfo.scaleToZoom(t.scale)})}},{key:"prepareRenderPasses",value:function(e){var t=this,i=Object(o.a)(Object(l.a)(r.prototype),"prepareRenderPasses",this).call(this,e);return i.push(e.registerRenderPass({name:"stencil",brushes:[b.a],drawPhase:f.c.DEBUG|f.c.MAP|f.c.HIGHLIGHT,target:function(){return t.getStencilTarget()}})),Object(h.a)("esri-tiles-debug")&&i.push(e.registerRenderPass({name:"tileInfo",brushes:[d.a],drawPhase:f.c.DEBUG,target:function(){return t.children}})),i}},{key:"getStencilTarget",value:function(){return this.children}},{key:"updateTransforms",value:function(e){var t,r=Object(i.a)(this.children);try{for(r.s();!(t=r.n()).done;){var a=t.value,n=this._tileInfoView.getTileResolution(a.key);a.setTransform(e,n)}}catch(s){r.e(s)}finally{r.f()}}},{key:"setStencilReference",value:function(){var e,t=1,r=Object(i.a)(this.children);try{for(r.s();!(e=r.n()).done;){e.value.stencilRef=t++}}catch(a){r.e(a)}finally{r.f()}}}]),r}(p.a);t.a=m},687:function(e,t,r){"use strict";function i(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function a(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){for(var t=0,r=0,i=0;i<e.length;i++){var a=e[i].size;"number"==typeof a&&(t+=a,r++)}return t/r}(e.stops):t}function n(e,t){if(!t)return e;var r=t.filter((function(e){return"size"===e.type})).map((function(t){var r=t.maxSize,i=t.minSize;return(a(r,e)+a(i,e))/2})),i=0,n=r.length;if(0===n)return e;for(var s=0;s<n;s++)i+=r[s];var o=Math.floor(i/n);return Math.max(o,e)}function s(e){var t=e&&e.renderer,r="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return r;var a="visualVariables"in t?n(r,t.visualVariables):r;if("simple"===t.type)return i(a,t.symbol);if("unique-value"===t.type){var s=a;return t.uniqueValueInfos.forEach((function(e){s=i(s,e.symbol)})),s}if("class-breaks"===t.type){var o=a;return t.classBreakInfos.forEach((function(e){o=i(o,e.symbol)})),o}return t.type,a}r.d(t,"a",(function(){return s}))},713:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return l}));r(90);var i=r(10),a=r(56),n=r(687),s=r(53);function o(e,t,r){var n,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new s.a;if("2d"===r.type)n=t*r.resolution;else if("3d"===r.type){var l=r.overlayPixelSizeInMapUnits(e),u=r.basemapSpatialReference;n=Object(i.k)(u)&&!u.equals(r.spatialReference)?Object(a.f)(u)/Object(a.f)(r.spatialReference):t*l}var c=e.x-n,h=e.y-n,f=e.x+n,p=e.y+n,d=r.spatialReference;return o.xmin=Math.min(c,f),o.ymin=Math.min(h,p),o.xmax=Math.max(c,f),o.ymax=Math.max(h,p),o.spatialReference=d,o}function l(e,t,r){var a=r.toMap(e);return!Object(i.j)(a)&&o(a,Object(n.a)(),r,u).intersects(t)}var u=new s.a},755:function(e,t,r){"use strict";r.d(t,"a",(function(){return B})),r.d(t,"b",(function(){return x})),r.d(t,"c",(function(){return C})),r.d(t,"d",(function(){return M})),r.d(t,"e",(function(){return S})),r.d(t,"f",(function(){return v})),r.d(t,"g",(function(){return w})),r.d(t,"h",(function(){return O})),r.d(t,"i",(function(){return j})),r.d(t,"j",(function(){return z})),r.d(t,"k",(function(){return U}));var i=r(8),a=r.n(i),n=r(27),s=r(14),o=(r(90),r(22)),l=r(10),u=r(56),c=r(267),h=r(57),f=r(53),p=r(55),d=5e-4,b=function(e,t){var r=(e.isWGS84||e.isWebMercator)&&(t.isWGS84||t.isWebMercator);return!(e.equals(t)||r)},y=function(e,t){var r=(e[0]+e[4]+e[4*t.cols]+e[4*t.cols+4])/4,i=(e[1]+e[5]+e[4*t.rows+1]+e[4*t.rows+5])/4;return[Math.abs(r-e[2*t.rows+2]),Math.abs(i-e[2*t.rows+3])]},m={3395:20037508.342789244,3410:17334193.943686873,3832:3339584.723798206,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,8858:7396237.374497803,8859:2465412.4581659334,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53025:7276828.3848298555,53031:10384677.558821043,53034:20015086.79602057,53036:7389443.187332862,53037:2463147.729110953,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54025:7311399.09166516,54031:10396310.810074743,54034:20037508.342789244,54050:808820.9223376509,54053:1920897.3915568967,54079:20037508.342789244,54080:20037508.342789244,54099:13524439.768288724,54100:20037508.342789244,54101:20037508.342789244,102038:4297258.582585486,102299:5013965.117483125};function v(){return g.apply(this,arguments)}function g(){return(g=Object(s.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(c.g)()&&Object(c.h)()){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,Object(c.i)();case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e,t,r){if(!b(e.spatialReference,t))return null;if(!Object(c.g)())throw new o.a("rasterprojectionhelper-projectResolution","projection engine is not loaded");return r?Object(c.e)(t,e.spatialReference,e):Object(c.e)(e.spatialReference,t,e)}function j(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(e.spatialReference.equals(t))return e;var a=b(e.spatialReference,t);if(a&&!Object(c.g)())throw new o.a("rasterprojectionhelper-projectResolution","projection engine is not loaded");var n=r.center,s=new f.a({xmin:n.x-e.x/2,xmax:n.x+e.x/2,ymin:n.y-e.y/2,ymax:n.y+e.y/2,spatialReference:e.spatialReference}),l=a?Object(c.j)(s,t,i):Object(h.d)(s,t);return null==l?null:{x:l.xmax-l.xmin,y:l.ymax-l.ymin}}function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01;return Object(u.f)(e)?t/Object(u.f)(e):0}function O(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=e.spatialReference;if(a.equals(t))return e;var s=b(a,t);if(s&&!Object(c.g)())throw new o.a("rasterprojectionhelper-projectResolution","projection engine is not loaded");var l=s?Object(c.j)(e,t,r):Object(h.d)(e,t);if(l&&i&&t.isGeographic){var u=I(a,!0),f=Object(n.a)(u,2),p=f[0],y=f[1],m=_(a);m&&null!=p&&null!=y&&(Math.abs(e.x-p)<m&&Math.abs(180-l.x)<d?l.x-=360:Math.abs(e.x-y)<m&&Math.abs(180+l.x)<d&&(l.x+=360))}return l}function k(e){var t=T(e[0].spatialReference);if(e.length<2||!Object(l.k)(t))return e[0];for(var r=e[0],i=r.xmin,a=r.xmax,n=r.ymin,s=r.ymax,o=1;o<e.length;o++){var u=e[o];a=u.xmax+t*o,n=Math.min(n,u.ymin),s=Math.max(s,u.ymax)}return new f.a({xmin:i,xmax:a,ymin:n,ymax:s,spatialReference:e[0].spatialReference})}function w(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e.spatialReference.equals(t))return e;var a=S(e),n=T(e.spatialReference,!0);return Object(l.k)(n)&&0!==a?k(e.clone().normalize().map((function(e){return R(e,t,r,i)}))):R(e,t,r,i)}function R(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=e.spatialReference;if(a.equals(t))return e;var s=b(a,t);if(s&&!Object(c.g)())throw new o.a("rasterprojectionhelper-projectExtent","projection engine is not loaded");var l=s?Object(c.j)(e,t,r):Object(h.d)(e,t),u=I(a,!0),f=Object(n.a)(u,2),y=f[0],m=f[1];if(l&&i&&a.isWebMercator&&t.isGeographic&&null!=y&&null!=m){var v=.001,g=1e3;if(Math.abs(e.xmin-y)<v&&Math.abs(m-e.xmax)>g&&Math.abs(180-l.xmax)<d){l.xmin=-180;var x=[];x.push(new p.a(e.xmax,e.ymin,a)),x.push(new p.a(e.xmax,(e.ymin+e.ymax)/2,a)),x.push(new p.a(e.xmax,e.ymax,a));var j=x.map((function(e){return O(e,t,r)})).filter((function(e){return!isNaN(null==e?void 0:e.x)})).map((function(e){return e.x}));l.xmax=Math.max.apply(null,j)}if(Math.abs(e.xmax-m)<v&&Math.abs(y-e.xmin)>g&&Math.abs(180+l.xmin)<d){l.xmax=180;var k=[];k.push(new p.a(e.xmin,e.ymin,a)),k.push(new p.a(e.xmin,(e.ymin+e.ymax)/2,a)),k.push(new p.a(e.xmin,e.ymax,a));var w=k.map((function(e){return O(e,t,r)})).filter((function(e){return!isNaN(null==e?void 0:e.x)})).map((function(e){return e.x}));l.xmin=Math.min.apply(null,w)}}var R=I(t,!0),T=Object(n.a)(R,2);y=T[0],m=T[1];var P=_(t);return P&&null!=y&&null!=m&&(Math.abs(l.xmin-y)<P&&(l.xmin=y),Math.abs(l.xmax-m)<P&&(l.xmax=m)),l}function T(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t?20037508.342787:20037508.342788905;return e.isWebMercator?2*r:e.wkid&&e.isGeographic?360:2*m[e.wkid]||null}function I(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=[],i=T(e,t);return Object(l.k)(i)&&(r.push(-i/2),r.push(i/2)),r}function P(e,t,r,i){var a=(e-t)/r;return a-Math.floor(a)!=0?a=Math.floor(a):i&&(a-=1),a}function S(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=T(e.spatialReference);if(!Object(l.k)(r))return 0;var i=t?0:-r/2;return P(e.xmax,i,r,!0)-P(e.xmin,i,r,!1)}function M(e){var t=e.storageInfo.origin.x,r=T(e.spatialReference,!0);if(!Object(l.k)(r))return{originX:t,halfWorldWidth:null,pyramidsInfo:null};for(var i=r/2,a=e.nativePixelSize,n=e.storageInfo,s=e.extent,o=n.maximumPyramidLevel,u=n.blockWidth,c=n.pyramidScalingFactor,h=a.x,f=[],p=Object(l.k)(e.transform)&&"gcs-shift"===e.transform.type,d=t+i,b=p?r-t:i-t,y=0;y<=o;y++){var m=(s.xmax-t)/h/u,v=m-Math.floor(m)==0?m:Math.ceil(m),g=(r/2-t)/h/u,x=g-Math.floor(g)==0?g:Math.ceil(g),j=Math.floor(d/h/u),_=Math.round(d/h)%u,O=(u-Math.round(b/h)%u)%u;f.push({resolutionX:h,blockWidth:u,datsetColumnCount:v,worldColumnCountFromOrigin:x,leftMargin:_,rightPadding:O,originColumnOffset:j}),h*=c}return{originX:t,halfWorldWidth:i,pyramidsInfo:f,hasGCSSShiftTransform:p}}function C(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[32,32];if(b(e.spatialReference,t.spatialReference)&&!Object(c.g)())throw new o.a("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(e&&t&&r))return null;var u=e.xmin,h=e.ymin,f=e.xmax,d=e.ymax,m=e.spatialReference,v=t.spatialReference,g=T(v);n=n||"gcs-shift"===(null==a?void 0:a.type);for(var x,j={x:s[0]*r.x,y:s[1]*r.y},_={cols:Math.ceil((f-u)/j.x-.1)+1,rows:Math.ceil((d-h)/j.y-.1)+1},k=j.x,w=j.y,R=[],I=!1,P=0;P<_.cols;P++){for(var S=[],M=0;M<_.rows;M++){var C=O(new p.a({x:u+k*P,y:d-w*M,spatialReference:m}),v,i);a&&(C=a.inverseTransform(C)),S.push(C),P>0&&n&&C&&x[M]&&Object(l.k)(g)&&C.x<x[M].x&&(C.x+=g),C?(R.push((C.x-t.xmin)/(t.xmax-t.xmin)),R.push((t.ymax-C.y)/(t.ymax-t.ymin))):(R.push(NaN),R.push(NaN),I=!0)}x=S}for(var z=y(R,_),U=new Float32Array((_.cols-1)*(_.rows-1)*2*6),B=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),q=new Float32Array([-1,1,0,0,-1,1,1,0,0]),G=0;G<_.cols-1;G++){for(var V=0;V<_.rows-1;V++){for(var L=G*_.rows*2+2*V,F=R[L],E=R[L+1],D=R[L+2],N=R[L+3],W=R[L+=2*_.rows],A=R[L+1],Q=R[L+2],H=R[L+3],J=0,X=12*(V*(_.cols-1)+G),Z=0;Z<3;Z++)U[X++]=B[J++]*F+B[J++]*D+B[J++]*Q;J=0;for(var K=0;K<3;K++)U[X++]=B[J++]*E+B[J++]*N+B[J++]*H;J=0;for(var Y=0;Y<3;Y++)U[X++]=q[J++]*F+q[J++]*W+q[J++]*Q;J=0;for(var $=0;$<3;$++)U[X++]=q[J++]*E+q[J++]*A+q[J++]*H}if(I)for(var ee=0;ee<U.length;ee++)isNaN(U[ee])&&(U[ee]=-1)}return{offsets:R,error:z,coefficients:U,spacing:s,size:[_.cols-1,_.rows-1]}}function z(e){var t=e.clone().normalize();return 1===t.length?t[0]:k(t)}function U(e,t,r){var i,a=t.storageInfo,n=t.pixelSize,s=!1,o=a.pyramidResolutions;if(Object(l.k)(o)&&o.length){var u=(e.x+e.y)/2,c=o[o.length-1],h=(c.x+c.y)/2,f=(n.x+n.y)/2;if(u<=f)i=0;else if(u>=h)i=o.length,s=u/h>8;else for(var d,b=f,y=1;y<=o.length;y++){if(u<=(d=(o[y-1].x+o[y-1].y)/2)){u===d?i=y:"down"===r?(i=y-1,s=u/b>8):i="up"===r||u-b>d-u||u/b>2?y:y-1;break}b=d}var m=0===i?n:o[i-1];return{pyramidLevel:i,pyramidResolution:new p.a({x:m.x,y:m.y,spatialReference:t.spatialReference}),excessiveReading:s}}var v=Math.log(e.x/n.x)/Math.LN2,g=Math.log(e.y/n.y)/Math.LN2,x=t.storageInfo.maximumPyramidLevel||0;(i="down"===r?Math.floor(Math.min(v,g)):"up"===r?Math.ceil(Math.max(v,g)):Math.round((v+g)/2))<0?i=0:i>x&&(s=i>x+3,i=x);var j=Math.pow(2,i);return{pyramidLevel:i,pyramidResolution:new p.a({x:j*t.nativePixelSize.x,y:j*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:s}}function B(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=e.extent,n=e.spatialReference,s=e.pixelSize,o=j(new p.a({x:s.x,y:s.y,spatialReference:n}),t,a);if(null==o)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};var l=(o.x+o.y)/2,c=Object(u.f)(t),h=l*c*96*39.37,f=t.isGeographic?256/r*295828763.7958547:256/r*591657527.591555,d=!1,b=w(a,t);i&&(t.isGeographic||t.isWebMercator)&&(d=b.xmin*b.xmax<0);var y,m=h,v=1.001;if(d){m=f;var g=t.isGeographic?1341104507446289e-21:.29858214164761665,x=g*(96*c*39.37),_=t.isGeographic?4326:3857;(y=j(new p.a({x:g,y:g,spatialReference:{wkid:_}}),n,b)).x*=m/x,y.y*=m/x}else{y={x:s.x,y:s.y};for(var O=Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2),k=0;m<f*(v/2)&&k<O;)k++,m*=2,y.x*=2,y.y*=2;Math.max(m,f)/Math.min(m,f)<=v&&(m=f)}for(var R=[m],T=[{x:y.x,y:y.y}],I=70.5310735,P=Math.min(I,h)/v;m>=P;)m/=2,y.x/=2,y.y/=2,R.push(m),T.push({x:y.x,y:y.y});return{projectedPixelSize:o,scales:R,srcResolutions:T,isCustomTilingScheme:!d}}},762:function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return u}));var i=r(8),a=r.n(i),n=r(35),s=r(14),o=r(10),l=r(70);function u(e){return c.apply(this,arguments)}function c(){return(c=Object(s.a)(a.a.mark((function e(t){var r,i,s,u,c,h,f,p,d,b=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=b.length>1&&void 0!==b[1]?b[1]:t.popupTemplate,Object(o.k)(r)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,r.getRequiredFields(t.fieldsIndex);case 5:if(i=e.sent,s=r.lastEditInfoEnabled,u=t.objectIdField,c=t.typeIdField,h=t.globalIdField,f=t.relationships,!i.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!s){e.next=19;break}return e.next=16,Object(l.m)(t);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return p=e.t0,d=Object(l.i)(t.fieldsIndex,[].concat(Object(n.a)(i),Object(n.a)(p))),e.abrupt("return",(c&&d.push(c),d&&u&&t.fieldsIndex.has(u)&&-1===d.indexOf(u)&&d.push(u),d&&h&&t.fieldsIndex.has(h)&&-1===d.indexOf(h)&&d.push(h),f&&f.forEach((function(e){var r=e.keyField;d&&r&&t.fieldsIndex.has(r)&&-1===d.indexOf(r)&&d.push(r)})),d));case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e,t){return e.popupTemplate?e.popupTemplate:Object(o.k)(t)&&t.defaultPopupTemplateEnabled&&Object(o.k)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}},952:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return m})),r.d(t,"c",(function(){return b})),r.d(t,"d",(function(){return h})),r.d(t,"e",(function(){return y})),r.d(t,"f",(function(){return f})),r.d(t,"g",(function(){return p})),r.d(t,"h",(function(){return g}));r(90);var i=r(10),a=r(4),n=r(5),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;Object(a.a)(this,e),this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=t,this._interval=Math.min(t,r)}return Object(n.a)(e,[{key:"decreaseRefCount",value:function(e,t){var r=e+"/"+t,i=this._cachedBlocks;if(i.has(r)){var a=i.get(r);return a.refCount--,a.refCount<=0&&(i.delete(r),a.controller&&a.controller.abort()),a.refCount}return 0}},{key:"getBlock",value:function(e,t){var r=e+"/"+t,i=this._cachedBlocks;if(i.has(r)){var a=i.get(r);return a.ts=Date.now(),a.refCount++,i.delete(r),i.set(r,a),a.block}return null}},{key:"putBlock",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=this._cachedBlocks,n=e+"/"+t;if(a.has(n)){var s=a.get(n);s.ts=Date.now(),s.refCount++}else a.set(n,{block:r,ts:Date.now(),refCount:1,controller:i});this.trim(),this.updateTimer()}},{key:"deleteBlock",value:function(e,t){var r=this._cachedBlocks,i=e+"/"+t;r.has(i)&&r.delete(i)}},{key:"updateMaxSize",value:function(e){this._size=e,this.trim()}},{key:"empty",value:function(){this._cachedBlocks.clear(),this.clearTimer()}},{key:"getCurrentSize",value:function(){return this._cachedBlocks.size}},{key:"updateTimer",value:function(){var e=this;if(null==this._timer){var t=this._cachedBlocks;this._timer=setInterval((function(){for(var r=Array.from(t),i=Date.now(),a=0;a<r.length&&r[a][1].ts<=i-e._duration;a++)t.delete(r[a][0]);0===t.size&&e.clearTimer()}),this._interval)}}},{key:"trim",value:function(){var e=this._cachedBlocks;if(!(-1===this._size||this._size>=e.size))for(var t=Array.from(e),r=0;r<t.length-this._size;r++)e.delete(t[r][0])}},{key:"clearTimer",value:function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}]),e}(),o=r(755),l=r(55),u=new Map,c=new s;function h(e,t){return null==t?e:"".concat(e,"?sliceId=").concat(t)}function f(e,t){var r={extent:null,rasterInfo:t,cache:new Map};if(u.has(e)){var i=u.get(e);return i.push(r),i.length-1}return u.set(e,[r]),0}function p(e,t){if(u.has(e)){var r=u.get(e);r[t]=null,r.some((function(e){return null!=e}))||u.delete(e)}}function d(e,t,r){if(!u.has(e))return null==t?c.decreaseRefCount(e,r):0;var i=u.get(e);if(null==i[t])return c.decreaseRefCount(e,r);var a=i[t].cache;if(a.has(r)){var n=a.get(r);if(n.refCount--,0===n.refCount){a.delete(r);for(var s=0;s<i.length;s++)i[s]&&i[s].cache.has(r)&&i[s].cache.delete(r);n.controller&&n.controller.abort()}return n.refCount}return 0}function b(e,t,r){if(!u.has(e))return null==t?c.getBlock(e,r):null;var i=u.get(e);if(null==i[t]){for(var a=0;a<i.length;a++)if(i[a]&&i[a].cache.has(r)){var n=i[a].cache.get(r);return n.refCount++,n.block}return c.getBlock(e,r)}var s=i[t].cache;if(s.has(r)){var o=s.get(r);return o.refCount++,o.block}for(var l=0;l<i.length;l++)if(l!==t&&i[l]&&i[l]&&i[l].cache.has(r)){var h=i[l].cache.get(r);return h.refCount++,s.set(r,h),h.block}return null}function y(e,t,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(u.has(e)){var n=u.get(e);if(null!=n[t]){var s={refCount:1,block:i,isResolved:!1,isRejected:!1,controller:a};i.then((function(){return s.isResolved=!0})).catch((function(){return s.isRejected=!0})),n[t].cache.set(r,s)}else c.putBlock(e,r,i,a)}else null==t&&c.putBlock(e,r,i,a)}function m(e,t,r){if(u.has(e)){var i=u.get(e);null!=i[t]?i[t].cache.delete(r):c.deleteBlock(e,r)}else null==t&&c.deleteBlock(e,r)}function v(e,t){if(!u.has(e))return null;var r=u.get(e);return null==r[t]?null:r[t]}function g(e,t,r,a,n,s){var u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=v(e,t),h=c.extent,f=c.cache,p=c.rasterInfo;if(!h||h.xmin!==r.xmin||h.xmax!==r.xmax||h.ymin!==r.ymin||h.ymax!==r.ymax){for(var d=r.clone().normalize(),b=p.spatialReference,y=p.transform,m=new Set,g=0;g<d.length;g++){var x=d[g];if(!(x.xmax-x.xmin<=a||x.ymax-x.ymin<=a)){var j=Object(o.g)(x,b,u);Object(i.k)(y)&&(j=y.inverseTransform(j));var _=new l.a({x:a,y:a,spatialReference:x.spatialReference});if(null==n&&!(n=Object(o.i)(_,b,x,u)))return;var O=Object(o.k)(n,p,s||"closest"),k=O.pyramidLevel,w=O.pyramidResolution,R=O.excessiveReading;if(R)return;for(var T=p.storageInfo,I=T.origin,P={x:Math.max(0,Math.floor((j.xmin-I.x)/w.x)),y:Math.max(0,Math.floor((I.y-j.ymax)/w.y))},S=Math.ceil((j.xmax-j.xmin)/w.x-.1),M=Math.ceil((j.ymax-j.ymin)/w.y-.1),C=k>0?T.pyramidBlockWidth:T.blockWidth,z=k>0?T.pyramidBlockHeight:T.blockHeight,U=1,B=Math.max(0,Math.floor(P.x/C)-U),q=Math.max(0,Math.floor(P.y/z)-U),G=Math.floor((P.x+S-1)/C)+U,V=Math.floor((P.y+M-1)/z)+U,L=q;L<=V;L++)for(var F=B;F<=G;F++)m.add("".concat(k,"/").concat(L,"/").concat(F))}}f.forEach((function(e,t){if(!m.has(t)){var r=f.get(t);(null==r||r.isResolved||r.isRejected)&&f.delete(t)}})),c.extent={xmin:r.xmin,ymin:r.ymin,xmax:r.xmax,ymax:r.ymax}}}}}]);
//# sourceMappingURL=27.e7fb597c.chunk.js.map