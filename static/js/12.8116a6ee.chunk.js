(this["webpackJsonptesting-ant-cra"]=this["webpackJsonptesting-ant-cra"]||[]).push([[12],{611:function(e,t,r){"use strict";var n=r(4),i=r(5),a=r(6),s=r(7),u=r(0),c=r(36),o=r(112),l=r(113),p=r(295),d=r(12),h=r(167),f=r(1),b=(r(13),r(16),r(9)),y=function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(e){var i;return Object(n.a)(this,r),(i=t.call(this,e)).layer=null,i.parent=null,i}return Object(i.a)(r,[{key:"initialize",value:function(){var e=this;this.when().catch((function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",n=e.layer&&e.layer.title||"no title";throw d.a.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '".concat(n,"', id: '").concat(r,"')"),t),t}}))}},{key:"fullOpacity",get:function(){var e=function(e){return null==e?1:e};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))}},{key:"suspended",get:function(){return!this.canResume()}},{key:"suspendInfo",get:function(){return this.getSuspendInfo()}},{key:"legendEnabled",get:function(){return!this.suspended&&!0===this.layer.legendEnabled}},{key:"updating",get:function(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}},{key:"updatingProgress",get:function(){return this.updating?0:1}},{key:"visible",get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}},{key:"canResume",value:function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}},{key:"getSuspendInfo",value:function(){var e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}},{key:"isUpdating",value:function(){return!1}}]),r}(Object(l.b)(Object(p.a)(Object(h.b)(o.a.EventedMixin(c.a)))));Object(u.a)([Object(f.b)()],y.prototype,"fullOpacity",null),Object(u.a)([Object(f.b)()],y.prototype,"layer",void 0),Object(u.a)([Object(f.b)()],y.prototype,"parent",void 0),Object(u.a)([Object(f.b)({readOnly:!0})],y.prototype,"suspended",null),Object(u.a)([Object(f.b)({readOnly:!0})],y.prototype,"suspendInfo",null),Object(u.a)([Object(f.b)({readOnly:!0})],y.prototype,"legendEnabled",null),Object(u.a)([Object(f.b)({type:Boolean,readOnly:!0})],y.prototype,"updating",null),Object(u.a)([Object(f.b)({readOnly:!0})],y.prototype,"updatingProgress",null),Object(u.a)([Object(f.b)()],y.prototype,"visible",null);var v=y=Object(u.a)([Object(b.a)("esri.views.layers.LayerView")],y);t.a=v},627:function(e,t,r){"use strict";r.d(t,"a",(function(){return T}));var n,i=r(4),a=r(5),s=r(47),u=r(46),c=r(6),o=r(7),l=r(0),p=r(37),d=r(147),h=r(30),f=r(1),b=(r(13),r(16),r(12),r(9)),y=r(664),v=function(e){Object(c.a)(r,e);var t=Object(o.a)(r);function r(){return Object(i.a)(this,r),t.apply(this,arguments)}return r}(r(24).a),O=v=Object(l.a)([Object(b.a)("esri.views.layers.support.ClipArea")],v),j=n=function(e){Object(c.a)(r,e);var t=Object(o.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).type="rect",e.left=null,e.right=null,e.top=null,e.bottom=null,e}return Object(a.a)(r,[{key:"clone",value:function(){return new n({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}},{key:"version",get:function(){return(this._get("version")||0)+1}}]),r}(O);Object(l.a)([Object(f.b)({type:[Number,String],json:{write:!0}})],j.prototype,"left",void 0),Object(l.a)([Object(f.b)({type:[Number,String],json:{write:!0}})],j.prototype,"right",void 0),Object(l.a)([Object(f.b)({type:[Number,String],json:{write:!0}})],j.prototype,"top",void 0),Object(l.a)([Object(f.b)({type:[Number,String],json:{write:!0}})],j.prototype,"bottom",void 0),Object(l.a)([Object(f.b)({readOnly:!0})],j.prototype,"version",null);var g,m=j=n=Object(l.a)([Object(b.a)("esri.views.layers.support.ClipRect")],j),k=(r(90),r(116)),x=r(82),_=r(53),w=r(129),R={base:k.a,key:"type",typeMap:{extent:_.a,polygon:w.a}},S=g=function(e){Object(c.a)(r,e);var t=Object(o.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).type="geometry",e.geometry=null,e}return Object(a.a)(r,[{key:"version",get:function(){return(this._get("version")||0)+1}},{key:"clone",value:function(){return new g({geometry:this.geometry.clone()})}}]),r}(O);Object(l.a)([Object(f.b)({types:R,json:{read:x.a,write:!0}})],S.prototype,"geometry",void 0),Object(l.a)([Object(f.b)({readOnly:!0})],S.prototype,"version",null);var I=S=g=Object(l.a)([Object(b.a)("esri.views.layers.support.Geometry")],S),F=function(e){Object(c.a)(r,e);var t=Object(o.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).type="path",e.path=[],e}return Object(a.a)(r,[{key:"version",get:function(){return(this._get("version")||0)+1}}]),r}(O);Object(l.a)([Object(f.b)({type:[[[Number]]],json:{write:!0}})],F.prototype,"path",void 0),Object(l.a)([Object(f.b)({readOnly:!0})],F.prototype,"version",null);var E=F=Object(l.a)([Object(b.a)("esri.views.layers.support.Path")],F),q=p.a.ofType({key:"type",base:O,typeMap:{rect:m,path:E,geometry:I}}),T=function(e){var t=function(e){Object(c.a)(r,e);var t=Object(o.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).clips=new q,e.moving=!1,e.attached=!1,e.lastUpdateId=-1,e.updateRequested=!1,e}return Object(a.a)(r,[{key:"initialize",value:function(){var e,t=this;this.container||(this.container=new y.a),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([Object(h.a)(this,"suspended",(function(e){t.container&&(t.container.visible=!e),t.view&&!e&&t.updateRequested&&t.view.requestUpdate()}),!0),Object(h.a)(this,["layer.opacity","container"],(function(){var e,r;t.container&&(t.container.opacity=null!=(e=null==(r=t.layer)?void 0:r.opacity)?e:1)}),!0),Object(h.a)(this,["layer.blendMode"],(function(e){t.container&&(t.container.blendMode=e)}),!0),Object(h.a)(this,["layer.effect"],(function(e){t.container&&(t.container.effect=e)}),!0),this.clips.on("change",(function(){t.container.clips=t.clips,t.notifyChange("clips")}))]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then((function(e){e!==t||t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){})):this.when().then((function(){t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){}))}},{key:"destroy",value:function(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}},{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}},{key:"isVisibleAtScale",value:function(e){var t=!0,r=this.layer,n=r.minScale,i=r.maxScale;if(null!=n&&null!=i){var a=!n,s=!i;!a&&e<=n&&(a=!0),!s&&e>=i&&(s=!0),t=a&&s}return t}},{key:"requestUpdate",value:function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}},{key:"processUpdate",value:function(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}},{key:"isUpdating",value:function(){return!1}},{key:"isRendering",value:function(){return!1}},{key:"canResume",value:function(){return!!Object(s.a)(Object(u.a)(r.prototype),"canResume",this).call(this)&&this.isVisibleAtScale(this.view.scale)}}]),r}(e);return Object(l.a)([Object(f.b)({type:q,set:function(e){var t=Object(d.b)(e,this._get("clips"),q);this._set("clips",t)}})],t.prototype,"clips",void 0),Object(l.a)([Object(f.b)()],t.prototype,"moving",void 0),Object(l.a)([Object(f.b)()],t.prototype,"attached",void 0),Object(l.a)([Object(f.b)()],t.prototype,"container",void 0),Object(l.a)([Object(f.b)()],t.prototype,"suspended",void 0),Object(l.a)([Object(f.b)({readOnly:!0})],t.prototype,"updateParameters",void 0),Object(l.a)([Object(f.b)()],t.prototype,"updateRequested",void 0),Object(l.a)([Object(f.b)()],t.prototype,"updating",null),Object(l.a)([Object(f.b)()],t.prototype,"view",void 0),t=Object(l.a)([Object(b.a)("esri.views.2d.layers.LayerView2D")],t)}},649:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(22),i=r(12),a=r(593),s=r(594),u=i.a.getLogger("esri.views.2d.engine.webgl");function c(e){return Object(s.o)(e.minDataValue)&&Object(s.o)(e.maxDataValue)&&null!=e.minSize&&null!=e.maxSize?a.e.SIZE_MINMAX_VALUE:(e.expression&&"view.scale"===e.expression||e.valueExpression&&"$view.scale"===e.valueExpression)&&Array.isArray(e.stops)?a.e.SIZE_SCALE_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&(Array.isArray(e.stops)||"levels"in e&&e.levels)?a.e.SIZE_FIELD_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&null!=e.valueUnit?a.e.SIZE_UNIT_VALUE:(u.error(new n.a("mapview-bad-type","Found invalid size VisualVariable",e)),a.e.NONE)}},687:function(e,t,r){"use strict";function n(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function i(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){for(var t=0,r=0,n=0;n<e.length;n++){var i=e[n].size;"number"==typeof i&&(t+=i,r++)}return t/r}(e.stops):t}function a(e,t){if(!t)return e;var r=t.filter((function(e){return"size"===e.type})).map((function(t){var r=t.maxSize,n=t.minSize;return(i(r,e)+i(n,e))/2})),n=0,a=r.length;if(0===a)return e;for(var s=0;s<a;s++)n+=r[s];var u=Math.floor(n/a);return Math.max(u,e)}function s(e){var t=e&&e.renderer,r="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return r;var i="visualVariables"in t?a(r,t.visualVariables):r;if("simple"===t.type)return n(i,t.symbol);if("unique-value"===t.type){var s=i;return t.uniqueValueInfos.forEach((function(e){s=n(s,e.symbol)})),s}if("class-breaks"===t.type){var u=i;return t.classBreakInfos.forEach((function(e){u=n(u,e.symbol)})),u}return t.type,i}r.d(t,"a",(function(){return s}))},713:function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return c}));r(90);var n=r(10),i=r(56),a=r(687),s=r(53);function u(e,t,r){var a,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new s.a;if("2d"===r.type)a=t*r.resolution;else if("3d"===r.type){var c=r.overlayPixelSizeInMapUnits(e),o=r.basemapSpatialReference;a=Object(n.k)(o)&&!o.equals(r.spatialReference)?Object(i.f)(o)/Object(i.f)(r.spatialReference):t*c}var l=e.x-a,p=e.y-a,d=e.x+a,h=e.y+a,f=r.spatialReference;return u.xmin=Math.min(l,d),u.ymin=Math.min(p,h),u.xmax=Math.max(l,d),u.ymax=Math.max(p,h),u.spatialReference=f,u}function c(e,t,r){var i=r.toMap(e);return!Object(n.j)(i)&&u(i,Object(a.a)(),r,o).intersects(t)}var o=new s.a},762:function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return o}));var n=r(8),i=r.n(n),a=r(35),s=r(14),u=r(10),c=r(70);function o(e){return l.apply(this,arguments)}function l(){return(l=Object(s.a)(i.a.mark((function e(t){var r,n,s,o,l,p,d,h,f,b=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=b.length>1&&void 0!==b[1]?b[1]:t.popupTemplate,Object(u.k)(r)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,r.getRequiredFields(t.fieldsIndex);case 5:if(n=e.sent,s=r.lastEditInfoEnabled,o=t.objectIdField,l=t.typeIdField,p=t.globalIdField,d=t.relationships,!n.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!s){e.next=19;break}return e.next=16,Object(c.m)(t);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return h=e.t0,f=Object(c.i)(t.fieldsIndex,[].concat(Object(a.a)(n),Object(a.a)(h))),e.abrupt("return",(l&&f.push(l),f&&o&&t.fieldsIndex.has(o)&&-1===f.indexOf(o)&&f.push(o),f&&p&&t.fieldsIndex.has(p)&&-1===f.indexOf(p)&&f.push(p),d&&d.forEach((function(e){var r=e.keyField;f&&r&&t.fieldsIndex.has(r)&&-1===f.indexOf(r)&&f.push(r)})),f));case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e,t){return e.popupTemplate?e.popupTemplate:Object(u.k)(t)&&t.defaultPopupTemplateEnabled&&Object(u.k)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}},848:function(e,t,r){"use strict";var n,i=r(11),a=r(4),s=r(5),u=r(6),c=r(7),o=r(0),l=r(90),p=r(148),d=r(42),h=r(24),f=r(23),b=r(1),y=(r(16),r(13),r(12),r(9)),v=r(33),O=r(82),j=r(98),g=new d.a({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),m=new d.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),k=n=function(e){Object(u.a)(r,e);var t=Object(c.a)(r);function r(e){var n;return Object(a.a)(this,r),(n=t.call(this,e)).where=null,n.geometry=null,n.spatialRelationship="intersects",n.hiddenIds=new Set,n.distance=void 0,n.objectIds=null,n.units=null,n.timeExtent=null,n.enabled=!1,n}return Object(s.a)(r,[{key:"writeWhere",value:function(e,t){t.where=e||"1=1"}},{key:"enable",value:function(){this._set("enabled",!0)}},{key:"createQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.where,r=this.geometry,n=this.spatialRelationship,a=this.timeExtent,s=this.objectIds,u=this.units,c=this.distance;return new j.a(Object(i.a)({geometry:Object(f.a)(r),objectIds:Object(f.a)(s),spatialRelationship:n,timeExtent:Object(f.a)(a),where:t,units:u,distance:c},e))}},{key:"clone",value:function(){var e=this.where,t=this.geometry,r=this.spatialRelationship,i=this.hiddenIds,a=this.timeExtent,s=this.objectIds,u=this.units,c=this.distance,o=new Set;return i.forEach((function(e){return o.add(e)})),new n({geometry:Object(f.a)(t),hiddenIds:o,objectIds:Object(f.a)(s),spatialRelationship:r,timeExtent:Object(f.a)(a),where:e,units:u,distance:c})}}]),r}(h.a);Object(o.a)([Object(b.b)({type:String})],k.prototype,"where",void 0),Object(o.a)([Object(v.a)("where")],k.prototype,"writeWhere",null),Object(o.a)([Object(b.b)({types:l.a,json:{read:O.a,write:!0}})],k.prototype,"geometry",void 0),Object(o.a)([Object(b.b)({type:String,json:{read:{source:"spatialRel",reader:g.read},write:{target:"spatialRel",writer:g.write}}})],k.prototype,"spatialRelationship",void 0),Object(o.a)([Object(b.b)({json:{write:function(e,t,r){return t[r]=Array.from(e)},read:function(e){return new Set(e)}}})],k.prototype,"hiddenIds",void 0),Object(o.a)([Object(b.b)({type:Number,json:{write:{overridePolicy:function(e){return{enabled:e>0}}}}})],k.prototype,"distance",void 0),Object(o.a)([Object(b.b)({type:[Number],json:{write:!0}})],k.prototype,"objectIds",void 0),Object(o.a)([Object(b.b)({type:String,json:{read:m.read,write:{writer:m.write,overridePolicy:function(e){return{enabled:e&&this.distance>0}}}}})],k.prototype,"units",void 0),Object(o.a)([Object(b.b)({type:p.a,json:{write:!0}})],k.prototype,"timeExtent",void 0),Object(o.a)([Object(b.b)({readOnly:!0})],k.prototype,"enabled",void 0);var x=k=n=Object(o.a)([Object(y.a)("esri.views.layers.support.FeatureFilter")],k);t.a=x},944:function(e,t,r){"use strict";r.r(t);var n,i=r(15),a=r(11),s=r(8),u=r.n(s),c=r(14),o=r(4),l=r(5),p=r(6),d=r(7),h=r(0),f=r(114),b=r(1),y=r(13),v=(r(16),r(12)),O=r(9),j=n=function(e){Object(p.a)(r,e);var t=Object(d.a)(r);function r(){var e;return Object(o.a)(this,r),(e=t.apply(this,arguments)).isAggregate=!0,e}return Object(l.a)(r,[{key:"getEffectivePopupTemplate",value:function(){if(this.popupTemplate)return this.popupTemplate;var e=this.sourceLayer&&this.sourceLayer.featureReduction;return e&&"popupTemplate"in e&&e.popupEnabled?e.popupTemplate:null}},{key:"getObjectId",value:function(){return this.objectId}},{key:"clone",value:function(){return new n(Object(a.a)({objectId:this.objectId},this.cloneProperties()))}}]),r}(f.a);Object(h.a)([Object(b.b)({type:Boolean})],j.prototype,"isAggregate",void 0),Object(h.a)([Object(b.b)({type:Number,json:{read:!0}})],j.prototype,"objectId",void 0);var g=j=n=Object(h.a)([Object(O.a)("esri.AggregateGraphic")],j),m=(r(90),r(130)),k=r(37),x=r(22),_=r(23),w=r(10),R=r(25),S=r(30),I=r(183),F=r(687),E=r(145),q=r(98),T=r(592),P=r(627),U=r(628);function C(e,t){return V.apply(this,arguments)}function V(){return(V=Object(c.a)(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:e.t0=t.type,e.next="class-breaks"===e.t0||"simple"===e.t0||"unique-value"===e.t0||"dot-density"===e.t0||"dictionary"===e.t0?5:"heatmap"===e.t0?10:15;break;case 5:return e.next=7,Promise.all([r.e(1),r.e(63)]).then(r.bind(null,1199));case 7:return e.t1=e.sent.default,e.t2=n,e.abrupt("return",new e.t1(e.t2));case 10:return e.next=12,Promise.all([r.e(1),r.e(68)]).then(r.bind(null,1216));case 12:return e.t3=e.sent.default,e.t4=n,e.abrupt("return",new e.t3(e.t4));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var N=r(960),L=r(1015),M=r(35),A=r(36),z=r(382);function J(e){return e.some((function(e){return e.globalId}))}function H(e){return e.filter((function(e){return!e.error})).map((function(e){var t;return null!=(t=e.objectId)?t:e.globalId}))}function G(e,t){var r,n=new Set(e),a=Object(i.a)(t.values());try{for(a.s();!(r=a.n()).done;){var s=r.value;n.add(s)}}catch(u){a.e(u)}finally{a.f()}return n}function Q(e,t){var r,n=new Set(e),a=Object(i.a)(t.values());try{for(a.s();!(r=a.n()).done;){var s=r.value;n.delete(s)}}catch(u){a.e(u)}finally{a.f()}return n}var D=function(e){Object(p.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this))._hasGlobalIds=!1,n._queueProcessor=new z.a({concurrency:1,process:e.process}),n}return Object(l.a)(r,[{key:"destroy",value:function(){this._queueProcessor.clear()}},{key:"updating",get:function(){return this._queueProcessor.length>0}},{key:"push",value:function(e){var t=this,r=this._queueProcessor,n=r.last();switch(e.type){case"update":case"refresh":if((null==n?void 0:n.type)===e.type)return;r.push(e).finally((function(){return t.notifyChange("updating")}));break;case"edit":var a="processed-edit"===(null==n?void 0:n.type)?n:null;a&&r.popLast();var s,u=this._mergeEdits(a,e),c=Object(i.a)(u);try{for(c.s();!(s=c.n()).done;){var o=s.value;r.push(o).finally((function(){return t.notifyChange("updating")}))}}catch(l){c.e(l)}finally{c.f()}}this.notifyChange("updating")}},{key:"_mergeEdits",value:function(e,t){var r,n,i=t.edits,a=i.addedFeatures,s=i.deletedFeatures,u=i.updatedFeatures;if(this._hasGlobalIds=this._hasGlobalIds||J(a)||J(u)||J(s),this._hasGlobalIds)return[e,{type:"processed-edit",edits:{addOrModified:[].concat(Object(M.a)(a),Object(M.a)(u)),removed:s}}];var c=new Set(H(null!=(r=null==e?void 0:e.edits.addOrModified)?r:[])),o=new Set(H(null!=(n=null==e?void 0:e.edits.removed)?n:[])),l=new Set([].concat(Object(M.a)(H(a)),Object(M.a)(H(u)))),p=new Set(H(s));return[{type:"processed-edit",edits:{addOrModified:Array.from(G(Q(c,p),l)).map((function(e){return{objectId:e}})),removed:Array.from(G(Q(o,l),p)).map((function(e){return{objectId:e}}))}}]}}]),r}(A.a);Object(h.a)([Object(b.b)({readOnly:!0})],D.prototype,"updating",null);var B=D=Object(h.a)([Object(O.a)("esri.views.2d.layers.support.FeatureCommandQueue")],D),K=r(167),W=r(372);function Z(e){return Array.isArray(e)}var $=function(e){Object(p.a)(r,e);var t=Object(d.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e))._startupResolver=Object(R.g)(),n.isReady=!1,n}return Object(l.a)(r,[{key:"initialize",value:function(){this._controller=Object(R.d)(),this.addResolvingPromise(this._startWorker(this._controller.signal))}},{key:"destroy",value:function(){this._controller.abort(),this._connection&&this._connection.close()}},{key:"tileRenderer",set:function(e){this.client.tileRenderer=e}},{key:"closed",get:function(){return this._connection.closed}},{key:"startup",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r,n,i){var a,s,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.when();case 2:return a=this._controller.signal,s=Z(n.source)?{transferList:n.source,signal:a}:void 0,c={service:n,config:r,tileInfo:t.tileInfo.toJSON(),tiles:i},e.next=5,this._connection.invoke("startup",c,s);case 5:this._startupResolver.resolve(),this._set("isReady",!0);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"updateTiles",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(R.l)(this._connection.invoke("updateTiles",t)));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=Object(c.a)(u.a.mark((function e(t){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={config:t},e.next=3,this._startupResolver.promise;case 3:return e.abrupt("return",this._connection.invoke("update",r));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"applyUpdate",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("applyUpdate",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setHighlight",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(R.l)(this._connection.invoke("controller.setHighlight",t)));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"refresh",value:function(){var e=Object(c.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(R.l)(this._connection.invoke("controller.refresh")));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"querySummaryStatistics",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.querySummaryStatistics",{query:t.toJSON(),params:r},n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryFeatures",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryFeatures",t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryObjectIds",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryObjectIds",t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryFeatureCount",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryFeatureCount",t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryExtent",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._connection.invoke("controller.queryExtent",t.toJSON(),r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryLatestObservations",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryLatestObservations",t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryStatistics",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryStatistics",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getObjectId",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getObjectId",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDisplayId",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getDisplayId",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeature",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getFeature",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAggregate",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getAggregate",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAggregateValueRanges",value:function(){var e=Object(c.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getAggregateValueRanges"));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"mapValidDisplayIds",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.mapValidDisplayIds",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEdits",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(R.l)(this._connection.invoke("controller.onEdits",t)));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"enableEvent",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",Object(R.l)(this._connection.invoke("controller.enableEvent",{name:t,value:r})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_startWorker",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(W.b)("Pipeline",{client:this.client,strategy:"dedicated",signal:t});case 3:this._connection=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),Object(R.w)(e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()}]),r}(K.a);Object(h.a)([Object(b.b)()],$.prototype,"isReady",void 0),Object(h.a)([Object(b.b)()],$.prototype,"client",void 0),Object(h.a)([Object(b.b)()],$.prototype,"tileRenderer",null);var X,Y=$=Object(h.a)([Object(O.a)("esri.views.2d.layers.support.FeatureLayerProxy")],$),ee=r(891),te=r(341),re=r(216),ne=function(){function e(t){Object(o.a)(this,e),this._tiles=new Map,this.buffer=0,this.acquireTile=t.acquireTile,this.releaseTile=t.releaseTile,this.tileInfoView=t.tileInfoView,this.buffer=t.buffer}return Object(l.a)(e,[{key:"destroy",value:function(){}},{key:"clear",value:function(){var e=this;this._tiles.forEach((function(t){return e._releaseTile(t)}))}},{key:"tileKeys",value:function(){var e=[];return this._tiles.forEach((function(t,r){return e.push(r)})),e}},{key:"update",value:function(e){var t,r=this,n=this.tileInfoView.getTileCoverage(e.state,this.buffer,"closest"),a=n.spans,s=n.lodInfo,u=s.level,c=[],o=[],l=new Set,p=new Set,d=Object(i.a)(a);try{for(d.s();!(t=d.n()).done;)for(var h=t.value,f=h.row,b=h.colFrom,y=h.colTo,v=b;v<=y;v++){var O=re.a.getId(u,f,s.normalizeCol(v),s.getWorldForColumn(v)),j=this._getOrAcquireTile(c,O);l.add(O),j.isReady?j.visible=!0:p.add(j.key)}}catch(g){d.e(g)}finally{d.f()}return p.forEach((function(e){return r._addPlaceholders(l,e)})),this._tiles.forEach((function(e){l.has(e.key.id)||(o.push(e.key.id),r._releaseTile(e))})),te.a.pool.release(n),{hasMissingTiles:p.size>0,added:c,removed:o}}},{key:"_getOrAcquireTile",value:function(e,t){if(!this._tiles.has(t)){var r=this.acquireTile(new re.a(t));e.push(t),this._tiles.set(t,r),r.visible=!1}return this._tiles.get(t)}},{key:"_getTile",value:function(e){return this._tiles.get(e)}},{key:"_releaseTile",value:function(e){this._tiles.delete(e.key.id),this.releaseTile(e)}},{key:"_addPlaceholders",value:function(e,t){var r=this._addPlaceholderChildren(e,t);Math.abs(1-r)<1e-6||this._addPlaceholderParent(e,t)||(this._getTile(t.id).visible=!0)}},{key:"_addPlaceholderChildren",value:function(e,t){var r=this,n=0;return this._tiles.forEach((function(i){n+=r._addPlaceholderChild(e,i,t)})),n}},{key:"_addPlaceholderChild",value:function(e,t,r){return t.key.level<=r.level||!t.hasData||!r.contains(t.key)?0:(t.visible=!0,e.add(t.key.id),1/(1<<2*(t.key.level-r.level)))}},{key:"_addPlaceholderParent",value:function(e,t){for(var r=t.getParentKey(),n=0,i=null;Object(w.k)(r);){if(e.has(r.id))return!0;var a=this._getTile(r.id);if(null!=a&&a.isReady)return a.visible=!0,e.add(a.key.id),!0;null!=a&&a.hasData&&a.patchCount>n&&(n=a.patchCount,i=a),r=r.getParentKey()}return!!i&&(i.visible=!0,e.add(i.key.id),!0)}}]),e}(),ie=r(47),ae=r(46),se=r(106),ue=r(70),ce=r(136),oe=r(24),le=r(848),pe=X=function(e){Object(p.a)(r,e);var t=Object(d.a)(r);function r(){var e;return Object(o.a)(this,r),(e=t.apply(this,arguments)).filter=null,e.includedEffect=null,e.excludedEffect=null,e.excludedLabelsVisible=!1,e}return Object(l.a)(r,[{key:"clone",value:function(){return new X({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}}]),r}(oe.a);Object(h.a)([Object(b.b)({type:le.a,json:{write:!0}})],pe.prototype,"filter",void 0),Object(h.a)([Object(b.b)({json:{write:!0}})],pe.prototype,"includedEffect",void 0),Object(h.a)([Object(b.b)({json:{write:!0}})],pe.prototype,"excludedEffect",void 0),Object(h.a)([Object(b.b)({type:Boolean,json:{write:!0}})],pe.prototype,"excludedLabelsVisible",void 0);var de=pe=X=Object(h.a)([Object(O.a)("esri.views.layers.support.FeatureEffect")],pe),he=r(762),fe=v.a.getLogger("esri.views.layers.FeatureLayerView"),be=function(e){var t=function(e){Object(p.a)(r,e);var t=Object(d.a)(r);function r(){var e;Object(o.a)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i)))._updatingRequiredFieldsPromise=null,e.effect=null,e.filter=null,e.timeExtent=null,e.layer=null,e.requiredFields=[],e.view=null,e}return Object(l.a)(r,[{key:"initialize",value:function(){var e=this;Object(S.a)(this,["layer.renderer","layer.labelingInfo","layer.elevationInfo.featureExpressionInfo","layer.displayField","filter","effect","layer.timeInfo","layer.floorInfo","timeExtent"],(function(){return e._handleRequiredFieldsChange()}),!0),Object(S.b)(this,"view.floors","change",(function(){return e._handleRequiredFieldsChange()})),Object(S.b)(this,"layer.sublayer","change",(function(){return e._handleRequiredFieldsChange()}))}},{key:"availableFields",get:function(){var e=this.layer,t=this.layer.fieldsIndex,r=this.requiredFields;return"outFields"in e&&e.outFields?Object(ue.i)(t,[].concat(Object(M.a)(Object(ue.t)(t,e.outFields)),Object(M.a)(r))):Object(ue.i)(t,r)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(e){fe.error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}},{key:"highlight",value:function(e){throw new Error("missing implementation")}},{key:"createQuery",value:function(){var e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},t=Object(w.k)(this.filter)?this.filter.createQuery(e):new q.a(e);return Object(w.k)(this.timeExtent)&&(t.timeExtent=Object(w.k)(t.timeExtent)?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),t}},{key:"queryFeatures",value:function(e,t){throw new Error("missing implementation")}},{key:"queryObjectIds",value:function(e,t){throw new Error("missing implementation")}},{key:"queryFeatureCount",value:function(e,t){throw new Error("missing implementation")}},{key:"queryExtent",value:function(e,t){throw new Error("missing implementation")}},{key:"_loadArcadeModules",value:function(e){if(e.get("expressionInfos.length"))return Object(ce.e)()}},{key:"_handleRequiredFieldsChange",value:function(){var e=this,t=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",t),t.then((function(){e._updatingRequiredFieldsPromise===t&&e._set("_updatingRequiredFieldsPromise",null)}))}},{key:"_updateRequiredFields",value:function(){var e=Object(c.a)(u.a.mark((function e(){var t,r,n,a,s,c,o,l,p,d,h,f,b,y;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.layer&&this.view){e.next=2;break}return e.abrupt("return");case 2:return t="3d"===this.view.type,r=this.layer,n=this.layer,a=n.fieldsIndex,s=n.objectIdField,c="renderer"in r&&r.renderer,o=r.featureReduction,l=new Set,e.next=12,Object(R.j)([c?c.collectRequiredFields(l,a):null,Object(ue.g)(l,r),t?Object(ue.b)(l,r):null,Object(w.k)(this.filter)?Object(ue.f)(l,r,this.filter):null,this.effect?Object(ue.f)(l,r,this.effect.filter):null,o?Object(ue.c)(l,r,o):null]);case 12:if(p=e.sent,r.timeInfo&&this.timeExtent&&Object(ue.e)(l,r.fieldsIndex,[r.timeInfo.startField,r.timeInfo.endField]),"feature"===r.type&&r.floorInfo&&Object(ue.e)(l,r.fieldsIndex,[r.floorInfo.floorField]),"subtype-group"!==r.type){e.next=18;break}return Object(ue.d)(l,a,r.subtypeField),d=r.sublayers.map((function(e){var t;return Promise.all([null==(t=e.renderer)?void 0:t.collectRequiredFields(l,a),Object(ue.g)(l,e)])})),e.next=18,Object(R.j)(d);case 18:h=Object(i.a)(p);try{for(h.s();!(f=h.n()).done;)(b=f.value).error&&fe.error(b.error)}catch(u){h.e(u)}finally{h.f()}Object(ue.d)(l,a,s),t&&"displayField"in r&&r.displayField&&Object(ue.d)(l,a,r.displayField),y=Array.from(l).sort(),this._set("requiredFields",y);case 23:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"validateFetchPopupFeatures",value:function(e){if(Object(w.j)(e))return null;var t,r=Object(i.a)(e.clientGraphics);try{for(r.s();!(t=r.n()).done;){var n=t.value.layer;if("popupEnabled"in n&&!n.popupEnabled)return new x.a("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:n});if("popupTemplate"in n&&!Object(he.a)(n,e))return new x.a("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:n})}}catch(a){r.e(a)}finally{r.f()}}},{key:"fetchClientPopupFeatures",value:function(){var e=Object(c.a)(u.a.mark((function e(t){var r,n,a,s,c,o,l,p,d,h,f,b=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=Object(w.k)(t)?t.clientGraphics:null)&&0!==r.length){e.next=3;break}return e.abrupt("return",Promise.resolve([]));case 3:return n=[],a=[],e.next=7,this.createPopupQuery(t);case 7:s=e.sent,c=Object(i.a)(r),e.prev=9,c.s();case 11:if((o=c.n()).done){e.next=25;break}if(l=o.value,"popupEnabled"in(p=l.layer)){e.next=16;break}return e.abrupt("continue",23);case 16:if(d=Object(ue.t)(this.layer.fieldsIndex,s.outFields),h=Object(he.a)(p,t),Object(w.k)(h)){e.next=19;break}return e.abrupt("continue",23);case 19:return e.next=21,this._loadArcadeModules(h);case 21:(f=e.sent)&&f.arcadeUtils.hasGeometryOperations(h)||!Object(ue.h)(d,l)?a.push(l):n.push(l);case 23:e.next=11;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(9),c.e(e.t0);case 30:return e.prev=30,c.f(),e.finish(30);case 33:return e.abrupt("return","stream"===this.layer.type||0===a.length?Promise.resolve(n):(s.objectIds=a.map((function(e){return e.attributes[b.layer.objectIdField]})),this.layer.queryFeatures(s).then((function(e){return n.concat(e.features)})).catch((function(){return a}))));case 34:case"end":return e.stop()}}),e,this,[[9,27,30,33]])})));return function(t){return e.apply(this,arguments)}}()},{key:"createPopupQuery",value:function(){var e=Object(c.a)(u.a.mark((function e(t){var r,n,a,s,c,o,l,p,d,h,f,b,y,v;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this.layer.createQuery(),n=new Set,a=!1,s=Object(w.k)(t)&&t.clientGraphics?t.clientGraphics.map((function(e){return e.layer})):[this.layer],c=Object(i.a)(s),e.prev=4,c.s();case 6:if((o=c.n()).done){e.next=25;break}if("popupEnabled"in(l=o.value)){e.next=10;break}return e.abrupt("continue",23);case 10:if(p=Object(he.a)(l,t),Object(w.k)(p)){e.next=13;break}return e.abrupt("continue",23);case 13:return e.next=15,this._loadArcadeModules(p);case 15:return d=e.sent,h=d&&d.arcadeUtils.hasGeometryOperations(p),a=!("point"!==this.layer.geometryType&&!h),e.next=20,Object(he.b)(this.layer,p);case 20:f=e.sent,b=Object(i.a)(f);try{for(b.s();!(y=b.n()).done;)v=y.value,n.add(v)}catch(u){b.e(u)}finally{b.f()}case 23:e.next=6;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(4),c.e(e.t0);case 30:return e.prev=30,c.f(),e.finish(30);case 33:return e.abrupt("return",(r.returnGeometry=a,r.returnZ=a,r.returnM=a,r.outFields=Array.from(n),r.outSpatialReference=this.view.spatialReference,r));case 34:case"end":return e.stop()}}),e,this,[[4,27,30,33]])})));return function(t){return e.apply(this,arguments)}}()},{key:"canResume",value:function(){return!!Object(ie.a)(Object(ae.a)(r.prototype),"canResume",this).call(this)&&(!Object(w.k)(this.timeExtent)||!this.timeExtent.isEmpty)}}]),r}(e);return Object(h.a)([Object(b.b)()],t.prototype,"_updatingRequiredFieldsPromise",void 0),Object(h.a)([Object(b.b)({readOnly:!0})],t.prototype,"availableFields",null),Object(h.a)([Object(b.b)({type:de})],t.prototype,"effect",void 0),Object(h.a)([Object(b.b)({type:le.a})],t.prototype,"filter",void 0),Object(h.a)([Object(b.b)(se.a)],t.prototype,"timeExtent",void 0),Object(h.a)([Object(b.b)()],t.prototype,"layer",void 0),Object(h.a)([Object(b.b)({type:Number})],t.prototype,"maximumNumberOfFeatures",null),Object(h.a)([Object(b.b)({readOnly:!0,type:Boolean})],t.prototype,"maximumNumberOfFeaturesExceeded",null),Object(h.a)([Object(b.b)({readOnly:!0})],t.prototype,"requiredFields",void 0),Object(h.a)([Object(b.b)()],t.prototype,"suspended",void 0),Object(h.a)([Object(b.b)()],t.prototype,"view",void 0),t=Object(h.a)([Object(O.a)("esri.views.layers.FeatureLayerView")],t),t},ye=r(611),ve=r(375),Oe=r(1009),je=r(713),ge=r(464),me=r(53),ke=function(e){return(2147483648&e)>>>31===1};function xe(e){return e&&"openPorts"in e}var _e=v.a.getLogger("esri.views.2d.layers.FeatureLayerView2D"),we=function(e){Object(p.a)(r,e);var t=Object(d.a)(r);function r(){var e;return Object(o.a)(this,r),(e=t.apply(this,arguments))._pipelineIsUpdating=!0,e._commandsQueue=new B({process:function(t){switch(t.type){case"processed-edit":return e._doEdit(t);case"refresh":return e._doRefresh();case"update":return e._doUpdate()}}}),e._visibilityOverrides=new Set,e._effect=null,e._highlightIds=new Map,e._lastPixelBuffer=0,e._updateHighlight=Object(R.i)(Object(c.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._proxy.setHighlight(Array.from(e._highlightIds.keys())));case 1:case"end":return t.stop()}}),t)})))),e._uploadsLocked=!1,e._needsClusterSizeUpdate=!1,e.filter=null,e.effectLists={included:new Oe.a,excluded:new Oe.a},e}return Object(l.a)(r,[{key:"destroy",value:function(){var e,t;Object(w.b)(this._updateClusterSizeTask,(function(e){return e.remove()})),null==(e=this._proxy)||e.destroy(),null==(t=this.tileRenderer)||t.destroy(),this._commandsQueue.destroy()}},{key:"initialize",value:function(){var e=this;this.addResolvingPromise(Promise.all([this._initProxy(),this._initServiceOptions()])),this.handles.add([this.on("valueRangesChanged",(function(t){e._set("_aggregateValueRanges",t.valueRanges)})),Object(S.a)(this,"effect",(function(t){e.effectLists.included.effect=null==t?void 0:t.includedEffect})),Object(S.a)(this,"effect",(function(t){e.effectLists.excluded.effect=null==t?void 0:t.excludedEffect}))])}},{key:"_initProxy",value:function(){var e=Object(c.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("isTable"in this.layer)||!this.layer.isTable){e.next=2;break}throw new x.a("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer});case 2:return this._proxy&&this._proxy.destroy(),t=this._createClientOptions(),e.abrupt("return",(this._set("_proxy",new Y({client:t})),this._proxy.when()));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initServiceOptions",value:function(){var e=Object(c.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this._createServiceOptions();case 3:e.t1=e.sent,e.t0._set.call(e.t0,"_serviceOptions",e.t1);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"labelsVisible",get:function(){var e="subtype-group"===this.layer.type?this.layer.sublayers.items:[this.layer];return!this.suspended&&e.some((function(e){return e.labelingInfo&&e.labelsVisible}))}},{key:"effect",get:function(){return Object(w.s)(this._effect,null)},set:function(e){var t=this._effect;Object(w.k)(t)&&Object(w.k)(t.filter)&&t.filter.enabled&&Object(w.k)(e)&&Object(w.k)(e.filter)&&e.filter.enable(),this._effect=e,this.notifyChange("effect")}},{key:"effects",get:function(){return this.effect&&[this.effect]||[]}},{key:"queryMode",get:function(){return this._serviceOptions.type}},{key:"renderingConfigHash",get:function(){if(!this.layer)return null;var e=this.availableFields,t=this.layer,r=this.view.floors,n=t.definitionExpression,i="subtype-group"!==this.layer.type&&this.layer.labelsVisible&&this.layer.labelingInfo,a="renderer"in t&&t.renderer,s="feature"===t.type?t.gdbVersion:void 0,u="feature"===t.type&&t.historicMoment?t.historicMoment.getTime():void 0,c=this.timeExtent,o="stream"===t.type?"".concat(JSON.stringify(t.geometryDefinition)).concat(t.definitionExpression):null,l=JSON.stringify(this.clips),p=t.featureReduction&&t.featureReduction.toJSON(),d="sublayers"in this.layer&&this.layer.sublayers.items.reduce((function(e,t){return e+"".concat(t.visible?1:0,".").concat(JSON.stringify(t.renderer),".").concat(t.labelsVisible,"\n.").concat(JSON.stringify(t.labelingInfo))}),"");return JSON.stringify({sublayerHash:d,filterHash:Object(w.k)(this.filter)&&this.filter.toJSON(),effectHash:Object(w.k)(this.effect)&&this.effect.toJSON(),streamFilter:o,gdbVersion:s,definitionExpression:n,historicMoment:u,availableFields:e,renderer:a,labelingInfo:i,timeExtent:c,floors:r,clipsHash:l,featureReduction:p})}},{key:"hasEffects",get:function(){return this.effectLists.included.hasEffects||this.effectLists.excluded.hasEffects}},{key:"highlight",value:function(e){var t,r=this;return e instanceof f.a?t=[e.getObjectId()]:"number"==typeof e||"string"==typeof e?t=[e]:k.a.isCollection(e)?t=e.map((function(e){return e&&e.getAttribute(r.layer.objectIdField)})).toArray():Array.isArray(e)&&e.length>0&&(t="number"==typeof e[0]||"string"==typeof e[0]?e:e.map((function(e){return e&&e.getAttribute(r.layer.objectIdField)}))),t&&t.length?(t=t.filter((function(e){return null!=e})),this._addHighlight(t),{remove:function(){return r._removeHighlight(t)}}):{remove:function(){}}}},{key:"hasHighlight",value:function(){return!!this._highlightIds.size}},{key:"hitTest",value:function(e,t){return this._hitTest(e,t)}},{key:"queryStatistics",value:function(){return this._proxy.queryStatistics()}},{key:"querySummaryStatistics",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r,n){var i,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Object(a.a)({},r),r.valueExpression&&(i.viewInfoParams={viewingMode:"map",scale:this.view.scale,spatialReference:null==(s=this.view.spatialReference)?void 0:s.toJSON()}),e.abrupt("return",this._proxy.querySummaryStatistics(this._cleanUpQuery(t),i,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryFeatures",value:function(e,t){var r=this;return this.queryFeaturesJSON(e,t).then((function(e){var t=E.default.fromJSON(e);return t.features.forEach((function(e){return r._setLayersForFeature(e)})),t}))}},{key:"queryFeaturesJSON",value:function(e,t){return this._proxy.queryFeatures(this._cleanUpQuery(e),t)}},{key:"queryObjectIds",value:function(e,t){return this._proxy.queryObjectIds(this._cleanUpQuery(e),t)}},{key:"queryFeatureCount",value:function(e,t){return this._proxy.queryFeatureCount(this._cleanUpQuery(e),t)}},{key:"queryExtent",value:function(e,t){return this._proxy.queryExtent(this._cleanUpQuery(e),t).then((function(e){return{count:e.count,extent:me.a.fromJSON(e.extent)}}))}},{key:"setVisibility",value:function(e,t){t?this._visibilityOverrides.delete(e):this._visibilityOverrides.add(e),this._update()}},{key:"update",value:function(e){if(this._tileStrategy&&this.tileRenderer){var t=this._tileStrategy.update(e),r=t.hasMissingTiles,n=t.added,i=t.removed;(n.length||i.length)&&this._proxy.updateTiles({added:n,removed:i}),r&&this.requestUpdate(),this.notifyChange("updating")}}},{key:"attach",value:function(){var e=this;this.view.timeline.record("".concat(this.layer.title," (FeatureLayer) Attach")),this._tileStrategy=new ne({acquireTile:function(t){return e._acquireTile(t)},releaseTile:function(t){return e._releaseTile(t)},tileInfoView:this.view.featuresTilingScheme,buffer:0}),this.handles.add(Object(S.a)(this,"renderingConfigHash",(function(){return e._update()})),"attach"),"stream"!==this.layer.type&&this.handles.add(this.layer.on("edits",(function(t){return e._edit(t)})),"attach")}},{key:"detach",value:function(){this.container.removeAllChildren(),this.handles.remove("attach"),this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null),this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null),this._tileRendererHash=null}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"fetchPopupFeatures",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r){var n,i,a,s,c=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(w.k)(r)||!r.clientGraphics.length){e.next=5;break}if(!((n=r.clientGraphics[0])instanceof g)){e.next=4;break}return e.abrupt("return",[n]);case 4:r.clientGraphics=r.clientGraphics.filter((function(e){var t=e.layer,r="popupEnabled"in t&&t.popupEnabled,n="popupTemplate"in t&&t.popupTemplate,i=c.view.popup.defaultPopupTemplateEnabled;return r&&(n||i)}));case 5:if(!(i=this.validateFetchPopupFeatures(r))){e.next=8;break}throw i;case 8:if(!Object(w.k)(r)||0!==r.clientGraphics.length){e.next=10;break}return e.abrupt("return",[]);case 10:if(a=this.fetchClientPopupFeatures(r),t){e.next=13;break}return e.abrupt("return",a);case 13:return s=this._fetchServicePopupFeatures(t,r),e.abrupt("return",Object(R.k)([a,s]).then(m.d));case 15:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_fetchServicePopupFeatures",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r){var n,a,s,c,o,l,p,d,h,f,b;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("stream"!==this.layer.type&&"ogc-feature"!==this.layer.type){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,this.createPopupQuery(r);case 4:if(n=e.sent,a=this.layer,s="renderer"in a&&a.renderer,c=Object(w.k)(r)?r.event:null,o=Object(F.a)({renderer:s,event:c}),n.geometry=this.createFetchPopupFeaturesQueryGeometry(t,o),l=new Set,p=a.objectIdField,d=Object(w.k)(r)?r.clientGraphics:null){h=Object(i.a)(d);try{for(h.s();!(f=h.n()).done;)b=f.value,l.add(b.attributes[p])}catch(u){h.e(u)}finally{h.f()}}return e.abrupt("return",a.queryFeatures(n).then((function(e){return e.features.filter((function(e){return!l.has(e.attributes[p])}))})));case 13:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"createFetchPopupFeaturesQueryGeometry",value:function(e,t){return Object(je.a)(e,t,this.view)}},{key:"isUpdating",value:function(){var e,t="renderer"in this.layer&&null!=this.layer.renderer,r=this._commandsQueue.updating,n=null!=this._updatingRequiredFieldsPromise,i=!this._proxy||!this._proxy.isReady,a=this._pipelineIsUpdating,s=null===this.tileRenderer||(null==(e=this.tileRenderer)?void 0:e.updating),u=t&&(r||n||i||a||s);return Object(y.a)("esri-2d-log-updating")&&console.log("Updating FLV2D: ".concat(u,"\n  -> hasRenderer ").concat(t,"\n  -> hasPendingCommand ").concat(r,"\n  -> updatingRequiredFields ").concat(n,"\n  -> updatingProxy ").concat(i,"\n  -> updatingPipeline ").concat(a,"\n  -> updatingTileRenderer ").concat(s,"\n")),u}},{key:"_createClientOptions",value:function(){var e=this;return{setUpdating:function(t){e._set("_pipelineIsUpdating",t)},emitEvent:function(t){e.emit(t.name,t.event)}}}},{key:"_detectQueryMode",value:function(){var e=Object(c.a)(u.a.mark((function e(t){var r,n,i,a,s,c,o,l,p;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("path"in t)||!Object(I.c)(t.path)||"feature"!==this.layer.type&&"subtype-group"!==this.layer.type||"point"!==this.layer.geometryType||this.layer.capabilities.operations.supportsEditing||!Object(y.a)("featurelayer-snapshot-enabled")){e.next=15;break}return e.prev=1,e.next=4,this.layer.queryFeatureCount();case 4:if(!((r=e.sent)<=Object(y.a)("featurelayer-snapshot-point-min-threshold"))){e.next=7;break}return e.abrupt("return",{mode:"snapshot",featureCount:r});case 7:if(n=Object(y.a)("featurelayer-snapshot-point-max-threshold"),i=Object(y.a)("featurelayer-snapshot-point-coverage"),a=this.view.extent,s=this.layer.fullExtent,c=null==s?void 0:s.clone().intersection(a),o=(null==c?void 0:c.width)*(null==c?void 0:c.height),l=(null==s?void 0:s.width)*(null==s?void 0:s.height),p=0===l?0:o/l,!(r<=n&&p>=i)){e.next=10;break}return e.abrupt("return",{mode:"snapshot",featureCount:r});case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),_e.warn("mapview-feature-layer","Encountered an error when querying for featureCount",{error:e.t0});case 15:return e.abrupt("return",{mode:"on-demand"});case 16:case"end":return e.stop()}}),e,this,[[1,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_createServiceOptions",value:function(){var e=Object(c.a)(u.a.mark((function e(){var t,r,n,i,s,c,o,l,p,d,h,f,b,y,v,O;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("stream"!==(r=this.layer).type){e.next=3;break}return e.abrupt("return",null);case 3:if(n=r.capabilities,i=r.objectIdField,s=r.fields.map((function(e){return e.toJSON()})),c=r.fullExtent&&r.fullExtent.toJSON(),o=Object(ee.a)(r.geometryType),l=r.timeInfo&&r.timeInfo.toJSON()||null,p=r.spatialReference?r.spatialReference.toJSON():null,d=Object(a.a)(Object(a.a)({},"customParameters"in r?r.customParameters:void 0),{},{token:"apiKey"in r?r.apiKey:void 0}),h="feature"===r.type?r.globalIdField:null,"ogc-feature"!==r.type){e.next=8;break}f=r.source.getFeatureDefinition(),e.next=15;break;case 8:if(!xe(r.source)){e.next=14;break}return e.next=11,r.source.openPorts();case 11:f=e.sent,e.next=15;break;case 14:r.parsedUrl&&(f=Object(_.a)(r.parsedUrl),"dynamicDataSource"in r&&r.dynamicDataSource&&(f.query={layer:JSON.stringify({source:r.dynamicDataSource})}));case 15:return b=null!=(t="subtypeField"in this.layer&&this.layer.subtypeField)?t:null,e.next=18,this._detectQueryMode(f);case 18:return y=e.sent,v=y.mode,O=y.featureCount,e.abrupt("return",{type:v,subtypeField:b,featureCount:O,globalIdField:h,maxRecordCount:n.query.maxRecordCount,tileMaxRecordCount:n.query.tileMaxRecordCount,capabilities:n,fields:s,fullExtent:c,geometryType:o,objectIdField:i,source:f,timeInfo:l,spatialReference:p,customParameters:d});case 22:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_createMemoryServiceOptions",value:function(){var e=Object(c.a)(u.a.mark((function e(t){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.openPorts();case 2:return r=e.sent,e.abrupt("return",Object(a.a)(Object(a.a)({},this._createServiceOptions()),{},{type:"memory",source:r}));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_cleanUpQuery",value:function(e){var t=q.a.from(e)||this.createQuery();return t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference),t}},{key:"_update",value:function(){var e=Object(c.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._commandsQueue.push({type:"update"}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_edit",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validateEdit(t)){e.next=2;break}return e.abrupt("return",this._commandsQueue.push({type:"edit",edits:t}));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"doRefresh",value:function(){var e=Object(c.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._commandsQueue.push({type:"refresh"}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_validateEdit",value:function(e){var t="globalIdField"in this.layer&&this.layer.globalIdField,r=e.deletedFeatures.some((function(e){return-1===e.objectId||!e.objectId})),n=t&&this.availableFields.includes(t);return r&&!n?(_e.error(new x.a("mapview-apply-edits","Editing the specified service requires the layer's globalIdField, ".concat(t," to be included the layer's outFields for updates to be reflected on the map"))),null):e}},{key:"_doUpdate",value:function(){var e=Object(c.a)(u.a.mark((function e(){var t,r,n,i,a,s,c,o,l,p,d,h,f;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!this.destroyed&&this._hasRequiredSupport(this.layer)&&this._tileStrategy){e.next=3;break}return e.abrupt("return");case 3:return t=this.effect,r=this.filter,e.next=6,this._updateRequiredFields();case 6:return n=this._getEffectiveRenderer(),i=n.renderer,this._set("_effectiveRenderer",i),a=this._createSchemaConfig(),s=Object(ee.a)(this.layer.geometryType),e.next=12,Object(N.a)(i,s,this.layer.featureReduction);case 12:if(c=e.sent,o=this._createConfiguration(a,r,t),this._lastPixelBuffer=0===c?0:Math.max(c,this._lastPixelBuffer),o.schema.source.pixelBuffer=this._lastPixelBuffer,(l=this._createTileRendererHash(i))===this._tileRendererHash){e.next=38;break}return e.next=19,this._initTileRenderer(i);case 19:if(p=this._serviceOptions,this.effects.forEach((function(e){return Object(w.k)(e)&&Object(w.k)(e.filter)&&e.filter.enable()})),this.tileRenderer.onConfigUpdate(i),d={added:this._tileStrategy.tileKeys(),removed:[]},h=this.layer,e.t0="stream"!==h.type&&xe(h.source),!e.t0){e.next=27;break}return e.next=26,h.source.openPorts();case 26:p.source=e.sent;case 27:return e.next=29,this._proxy.startup(this.view.featuresTilingScheme,o,p,d);case 29:if(e.t1=this.hasHighlight(),!e.t1){e.next=33;break}return e.next=33,this._proxy.setHighlight(Array.from(this._highlightIds.keys()));case 33:return e.next=35,this._onceTilesUpdated();case 35:this.tileRenderer.onConfigUpdate(i),e.next=51;break;case 38:return e.next=40,this._proxy.update(o);case 40:return((f=e.sent).mesh||f.targets.aggregate)&&this._lockGPUUploads(),e.prev=42,e.next=45,this._proxy.applyUpdate(f);case 45:e.next=50;break;case 47:e.prev=47,e.t2=e.catch(42),Object(R.m)(e.t2)||_e.error(e.t2);case 50:(f.mesh||f.targets.aggregate)&&this._unlockGPUUploads(),this.effects.forEach((function(e){return Object(w.k)(e)&&Object(w.k)(e.filter)&&e.filter.enable()})),this.tileRenderer.onConfigUpdate(i),this._updateClusterSizeVariable(),this._forceAttributeTextureUpload();case 51:this._tileRendererHash=l,this.tileRenderer.invalidateLabels(),this.requestUpdate(),e.next=56;break;case 54:e.prev=54,e.t3=e.catch(0);case 56:case"end":return e.stop()}}),e,this,[[0,54],[42,47]])})));return function(){return e.apply(this,arguments)}}()},{key:"_doEdit",value:function(){var e=Object(c.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._proxy.onEdits(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),Object(R.m)(e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_doRefresh",value:function(){var e=Object(c.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._lockGPUUploads(),e.prev=1,e.next=4,this._proxy.refresh();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),Object(R.m)(e.t0);case 9:this._unlockGPUUploads();case 10:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"_updateClusterSizeVariable",value:function(){this._needsClusterSizeUpdate&&(this.tileRenderer.onConfigUpdate(this._effectiveRenderer),this._needsClusterSizeUpdate=!1)}},{key:"_createUpdateClusterSizeTask",value:function(e,t){var r=this;return this.watch("_aggregateValueRanges",function(){var n=Object(c.a)(u.a.mark((function n(i){return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r._updateClusterEffectiveRendererSizeVariable(e,t,i),r._needsClusterSizeUpdate=!0,r._uploadsLocked||r._updateClusterSizeVariable();case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}},{key:"_updateClusterEffectiveRendererSizeVariable",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r,n){var i,a,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.dynamicClusterSize&&"visualVariables"in t&&t.visualVariables&&(i=Object(L.c)(t.visualVariables),Object(w.k)(i)&&"cluster_count"===i.field&&(a=t.visualVariables.indexOf(i),t.visualVariables[a]=Object(L.a)(r,n),(s=t.clone()).dynamicClusterSize=!0,this._set("_effectiveRenderer",s)));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_getEffectiveRenderer",value:function(){var e="renderer"in this.layer&&this.layer.renderer,t=this.layer.featureReduction;if(Object(w.k)(this._updateClusterSizeTask)&&(this._updateClusterSizeTask.remove(),this._updateClusterSizeTask=null),t&&"cluster"===t.type&&Object(L.d)(e)){var r=t,n=[],i=Object(L.b)(n,e,r,this._aggregateValueRanges);return Object(w.b)(this._updateClusterSizeTask,(function(e){return e.remove()})),this._updateClusterSizeTask=this._createUpdateClusterSizeTask(i,r),{renderer:i,aggregateFields:n,featureReduction:t}}return{renderer:e,aggregateFields:[],featureReduction:null}}},{key:"_acquireTile",value:function(e){var t=this,r=this.tileRenderer.acquireTile(e);return r.once("attach",(function(){t.requestUpdate()})),r}},{key:"_releaseTile",value:function(e){this.tileRenderer.releaseTile(e)}},{key:"_initTileRenderer",value:function(){var e=Object(c.a)(u.a.mark((function e(t){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C(t,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer});case 2:return r=e.sent,e.abrupt("return",(this.tileRenderer&&(this._tileStrategy.clear(),this.tileRenderer.uninstall(this.container),this.tileRenderer.destroy(),this.tileRenderer=null),this.destroyed?null:(this._proxy.tileRenderer=r,this._set("tileRenderer",r),this.tileRenderer.install(this.container),this.tileRenderer.onConfigUpdate(t),this.requestUpdate(),this.tileRenderer)));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createTileRendererHash",value:function(e){return"".concat("heatmap"===e.type?"heatmap":"symbol",".").concat("dot-density"===e.type)}},{key:"_createFeatureDataHash",value:function(e,t,r){var n=e.getAttributeHash(),i=JSON.stringify(t),a=Object(w.k)(r)&&JSON.stringify(r.filter),s=JSON.stringify(this.timeExtent),u="";return this._visibilityOverrides.forEach((function(e){return u+=e})),"".concat(n,".").concat(i,".").concat(a,".").concat(s,".").concat(u)}},{key:"hasFilter",get:function(){var e=!!("floorInfo"in this.layer&&this.layer.floorInfo&&this.view.floors&&this.view.floors.length);return!!this.filter||e||!!this._visibilityOverrides.size||!!this.timeExtent}},{key:"_injectOverrides",value:function(e){var t=Object(w.k)(e)?e.timeExtent:null,r=Object(w.k)(this.timeExtent)&&Object(w.k)(t)?this.timeExtent.intersection(t):this.timeExtent||t,n=null,i="floorInfo"in this.layer&&this.layer.floorInfo;if(i){var a=Object(w.k)(e)&&e.where;n=this._addFloorFilterClause(a)}if(!this._visibilityOverrides.size&&!r&&!i)return e;var s=Object(w.k)(e)&&e.clone()||new le.a;return s.hiddenIds=this._visibilityOverrides,s.timeExtent=r,n&&(s.where=n),s}},{key:"_addFloorFilterClause",value:function(e){var t=this.layer,r=e||"";if("floorInfo"in t&&t.floorInfo){var n,i=this.view.floors;if(!i||!i.length)return r;null!=(n=t.floorInfo.viewAllLevelIds)&&n.length&&(i=t.floorInfo.viewAllLevelIds);var a=i.filter((function(e){return""!==e})).map((function(e){return"'"+e+"'"}));a.push("''");var s=t.floorInfo.floorField,u="("+s+" IN ({ids}) OR "+s+" IS NULL)";if(u=u.replace("{ids}",a.join(", ")),Object(w.k)(r)&&r.includes(s)){var c=new RegExp("AND \\("+s+".*NULL\\)","g");r=r.replace(c,""),c=new RegExp("\\("+s+".*NULL\\)","g"),r=(r=r.replace(c,"")).replace(/\s+/g," ").trim()}r=""!==r?"("+r+") AND "+u:u}return""!==r?r:null}},{key:"_createConfiguration",value:function(e,t,r){var n="feature"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,i="feature"===this.layer.type?this.layer.gdbVersion:void 0,a=new Array(T.l),s=this._injectOverrides(t);a[0]=Object(w.k)(s)?s.toJSON():null,a[1]=Object(w.k)(r)&&r.filter?r.filter.toJSON():null;var u=Object(U.b)(e);if(Object(w.j)(u))return null;var c=Object(ge.a)();return{definitionExpression:this.layer.definitionExpression,availableFields:this.availableFields,gdbVersion:i,historicMoment:n,devicePixelRatio:window.devicePixelRatio||1,filters:a,schema:u,supportsTextureFloat:c.supportsTextureFloat,maxTextureSize:c.maxTextureSize}}},{key:"_hasRequiredSupport",value:function(e){var t;return!("renderer"in e&&"dot-density"===(null==(t=e.renderer)?void 0:t.type)&&!Object(ge.a)().supportsTextureFloat)||(_e.error(new x.a("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),!1)}},{key:"_onceTilesUpdated",value:function(){return this.requestUpdate(),Object(S.g)(this,"_pipelineIsUpdating",!1)}},{key:"_lockGPUUploads",value:function(){this.tileRenderer&&(this._uploadsLocked=!0,this.tileRenderer.lockGPUUploads())}},{key:"_unlockGPUUploads",value:function(){this.tileRenderer&&(this._uploadsLocked=!1,this.tileRenderer.unlockGPUUploads())}},{key:"_forceAttributeTextureUpload",value:function(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()}},{key:"_createSchemaConfig",value:function(){var e="feature"===this.layer.type?this.layer.historicMoment:null,t="feature"===this.layer.type?this.layer.gdbVersion:null;return{renderer:"renderer"in this.layer&&this.layer.renderer,spatialReference:this.layer.spatialReference,timeExtent:this.layer.timeExtent,definitionExpression:this.layer.definitionExpression,featureReduction:this.layer.featureReduction,fields:this.layer.fields,geometryType:this.layer.geometryType,historicMoment:e,labelsVisible:"labelsVisible"in this.layer&&this.layer.labelsVisible,labelingInfo:"labelingInfo"in this.layer&&this.layer.labelingInfo,availableFields:this.availableFields,effect:this.effect,filter:this.filter,gdbVersion:t,pixelBuffer:0}}},{key:"_addHighlight",value:function(e){var t,r=Object(i.a)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(this._highlightIds.has(n)){var a=this._highlightIds.get(n);this._highlightIds.set(n,a+1)}else this._highlightIds.set(n,1)}}catch(s){r.e(s)}finally{r.f()}this._updateHighlight().catch((function(e){Object(R.m)(e)||_e.error(e)}))}},{key:"_removeHighlight",value:function(e){var t,r=Object(i.a)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(this._highlightIds.has(n)){var a=this._highlightIds.get(n)-1;0===a?this._highlightIds.delete(n):this._highlightIds.set(n,a)}}}catch(s){r.e(s)}finally{r.f()}this._updateHighlight().catch((function(e){Object(R.m)(e)||_e.error(e)}))}},{key:"_setLayersForFeature",value:function(e){var t=this.layer;e.layer=t,e.sourceLayer=t}},{key:"_createHittestResult",value:function(e){return this._setLayersForFeature(e),Object(w.k)(e.geometry)&&(e.geometry.spatialReference=this.view.spatialReference),e}},{key:"_hitTest",value:function(){var e=Object(c.a)(u.a.mark((function e(t,r){var n,i,a,s,c,o=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.suspended&&this.tileRenderer){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this.tileRenderer.hitTest(t,r);case 4:if(0!==(n=e.sent).length){e.next=9;break}return e.next=8,Object(R.a)(1);case 8:return e.abrupt("return",null);case 9:if(i=n[0],ke(i)){e.next=15;break}return e.next=13,this._proxy.getFeature(i);case 13:return a=e.sent,e.abrupt("return",Object(w.b)(a,(function(e){return o._createHittestResult(f.a.fromJSON(e))})));case 15:return e.next=17,this._proxy.getAggregate(i);case 17:if(s=e.sent,!Object(w.j)(s)){e.next=20;break}return e.abrupt("return",null);case 20:if(!Object(w.k)(s.referenceId)){e.next=25;break}return e.next=23,this._proxy.getFeature(s.referenceId);case 23:return c=e.sent,e.abrupt("return",Object(w.b)(c,(function(e){return o._createHittestResult(f.a.fromJSON(e))})));case 25:return e.abrupt("return",this._createHittestResult(g.fromJSON(s)));case 26:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(be(Object(ve.a)(Object(P.a)(ye.a))));Object(h.a)([Object(b.b)()],we.prototype,"_serviceOptions",void 0),Object(h.a)([Object(b.b)()],we.prototype,"_proxy",void 0),Object(h.a)([Object(b.b)()],we.prototype,"_pipelineIsUpdating",void 0),Object(h.a)([Object(b.b)()],we.prototype,"_effectiveRenderer",void 0),Object(h.a)([Object(b.b)()],we.prototype,"_aggregateValueRanges",void 0),Object(h.a)([Object(b.b)()],we.prototype,"_commandsQueue",void 0),Object(h.a)([Object(b.b)()],we.prototype,"labelsVisible",null),Object(h.a)([Object(b.b)({type:le.a})],we.prototype,"filter",void 0),Object(h.a)([Object(b.b)({type:de})],we.prototype,"effect",null),Object(h.a)([Object(b.b)({readOnly:!0})],we.prototype,"effects",null),Object(h.a)([Object(b.b)({readOnly:!0})],we.prototype,"queryMode",null),Object(h.a)([Object(b.b)()],we.prototype,"renderingConfigHash",null),Object(h.a)([Object(b.b)()],we.prototype,"tileRenderer",void 0),Object(h.a)([Object(b.b)()],we.prototype,"updating",void 0);var Re=we=Object(h.a)([Object(O.a)("esri.views.2d.layers.FeatureLayerView2D")],we);t.default=Re}}]);
//# sourceMappingURL=12.8116a6ee.chunk.js.map