{"version":3,"sources":["../node_modules/@arcgis/core/views/layers/WMSLayerView.js","../node_modules/@arcgis/core/views/2d/layers/WMSLayerView2D.js","../node_modules/@arcgis/core/layers/support/ExportWMSImageParameters.js"],"names":["a","i","this","exportImageParameters","p","layer","destroy","e","commitProperty","_get","t","Promise","reject","r","o","popupEnabled","s","createFetchPopupFeaturesQuery","resolve","extent","width","height","m","x","n","y","u","fetchFeatureInfo","prototype","readOnly","l","getLogger","view","supportsSpatialReference","spatialReference","addResolvingPromise","strategy","update","catch","error","imageMaxHeight","imageMaxWidth","_bitmapContainer","container","addChild","fetchSource","fetchImage","bind","requestUpdate","imageRotationSupported","imageNormalizationSupported","hidpi","handles","add","watch","remove","removeChild","removeAllChildren","children","some","h","resolution","c","d","xmin","ymin","xmax","ymax","Math","round","updating","updateRequested","timeExtent","timestamp","refreshTimestamp","visible","scale","_set","sublayers","on","notifyChange","propertyName","visibleSublayers","filter","name","map","join","forEach","minScale","maxScale","unshift","layers","format","imageFormat","request","service","styles","transparent","imageTransparency","version","type","Number"],"mappings":"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","file":"static/js/142.f1182c24.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Error.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/Logger.js\";import{subclass as o}from\"../../core/accessorSupport/decorators/subclass.js\";import{combinedViewLayerTimeExtentProperty as s}from\"../../layers/support/commonProperties.js\";import{ExportWMSImageParameters as p}from\"../../layers/support/ExportWMSImageParameters.js\";const a=a=>{let i=class extends a{initialize(){this.exportImageParameters=new p({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get exportImageVersion(){var e;return null==(e=this.exportImageParameters)||e.commitProperty(\"version\"),this.commitProperty(\"timeExtent\"),(this._get(\"exportImageVersion\")||0)+1}fetchPopupFeatures(e){const{layer:t}=this;if(!e)return Promise.reject(new r(\"wmslayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:t}));const{popupEnabled:o}=t;if(!o)return Promise.reject(new r(\"wmslayerview:fetchPopupFeatures\",\"popupEnabled should be true\",{popupEnabled:o}));const s=this.createFetchPopupFeaturesQuery(e);if(!s)return Promise.resolve([]);const{extent:p,width:a,height:i,x:m,y:n}=s;if(!(p&&a&&i))throw new r(\"wmslayerview:fetchPopupFeatures\",\"WMSLayer does not support fetching features.\",{extent:p,width:a,height:i});const u=t.fetchFeatureInfo(p,a,i,m,n);return Promise.resolve(u?[u]:[])}};return e([t()],i.prototype,\"exportImageParameters\",void 0),e([t({readOnly:!0})],i.prototype,\"exportImageVersion\",null),e([t()],i.prototype,\"layer\",void 0),e([t(s)],i.prototype,\"timeExtent\",void 0),i=e([o(\"esri.layers.mixins.WMSLayerView\")],i),i};export default a;export{a as WMSLayerView};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Error.js\";import r from\"../../../core/Logger.js\";import{isAbortError as i}from\"../../../core/promiseUtils.js\";import{property as s}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../../core/accessorSupport/decorators/subclass.js\";import o from\"../../../geometry/Extent.js\";import{BitmapContainer as n}from\"../engine/BitmapContainer.js\";import{LayerView2DMixin as p}from\"./LayerView2D.js\";import m from\"./support/ExportStrategy.js\";import h from\"../../layers/LayerView.js\";import{RefreshableLayerView as c}from\"../../layers/RefreshableLayerView.js\";import{WMSLayerView as d}from\"../../layers/WMSLayerView.js\";const l=r.getLogger(\"esri.views.2d.layers.WMSLayerView2D\");let u=class extends(d(c(p(h)))){initialize(){const{layer:e,view:r}=this;e.supportsSpatialReference(r.spatialReference)||this.addResolvingPromise(Promise.reject(new t(\"layerview:spatial-reference-incompatible\",\"The spatial references supported by this WMS layer are incompatible with the spatial reference of the view\",{layer:e})))}hitTest(){return null}update(e){this.strategy.update(e).catch((e=>{i(e)||l.error(e)}))}attach(){const{layer:e}=this,{imageMaxHeight:t,imageMaxWidth:r}=e;this._bitmapContainer=new n,this.container.addChild(this._bitmapContainer),this.strategy=new m({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:t,imageMaxWidth:r,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.handles.add(this.watch(\"exportImageVersion\",(()=>this.requestUpdate())),\"exportImageVersion\")}detach(){this.handles.remove(\"exportImageVersion\"),this.strategy.destroy(),this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQuery(e){const{view:t}=this,r=this._bitmapContainer,{x:i,y:s}=e,{spatialReference:a}=t;let n=null,p=0,m=0;if(r.children.some((e=>{const{width:t,height:r,resolution:h,x:c,y:d}=e,l=c+h*t,u=d-h*r;return i>=c&&i<=l&&s<=d&&s>=u&&(n=new o({xmin:c,ymin:u,xmax:l,ymax:d,spatialReference:a}),p=t,m=r,!0)})),!n)return null;const h=n.width/p,c=Math.round((i-n.xmin)/h),d=Math.round((n.ymax-s)/h);return{extent:n,width:p,height:m,x:c,y:d}}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(e,t,r,i){return this.layer.fetchImage(e,t,r,{timeExtent:this.timeExtent,timestamp:this.refreshTimestamp,...i})}};e([s()],u.prototype,\"strategy\",void 0),e([s()],u.prototype,\"updating\",void 0),u=e([a(\"esri.views.2d.layers.WMSLayerView2D\")],u);var y=u;export default y;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Accessor.js\";import{HandleOwnerMixin as s}from\"../../core/HandleOwner.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/Logger.js\";import{subclass as o}from\"../../core/accessorSupport/decorators/subclass.js\";const a={visible:\"visibleSublayers\"};let l=class extends(s(r)){constructor(e){super(e),this.scale=0}set layer(e){this._get(\"layer\")!==e&&(this._set(\"layer\",e),this.handles.remove(\"layer\"),e&&this.handles.add([e.sublayers.on(\"change\",(()=>this.notifyChange(\"visibleSublayers\"))),e.on(\"wms-sublayer-update\",(e=>this.notifyChange(a[e.propertyName])))],\"layer\"))}get layers(){const{visibleSublayers:e}=this;return e.filter((e=>e.name)).map((e=>e.name)).join(\",\")}get version(){this.commitProperty(\"layers\");const e=this.layer;return e&&e.commitProperty(\"imageTransparency\"),(this._get(\"version\")||0)+1}get visibleSublayers(){const{layer:e,scale:r}=this,s=null==e?void 0:e.sublayers,t=[],o=e=>{const{minScale:s,maxScale:a,sublayers:l,visible:i}=e;i&&(0===r||(0===s||r<=s)&&(0===a||r>=a))&&(l?l.forEach(o):t.unshift(e))};return null==s||s.forEach(o),t}toJSON(){const{layer:e,layers:r}=this,{imageFormat:s,imageTransparency:t,version:o}=e;return{format:s,request:\"GetMap\",service:\"WMS\",styles:\"\",transparent:t,version:o,layers:r}}};e([t()],l.prototype,\"layer\",null),e([t({readOnly:!0})],l.prototype,\"layers\",null),e([t({type:Number})],l.prototype,\"scale\",void 0),e([t({readOnly:!0})],l.prototype,\"version\",null),e([t({readOnly:!0})],l.prototype,\"visibleSublayers\",null),l=e([o(\"esri.layers.support.ExportWMSImageParameters\")],l);export{l as ExportWMSImageParameters};\n"],"sourceRoot":""}