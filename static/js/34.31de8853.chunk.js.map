{"version":3,"sources":["../node_modules/@arcgis/core/core/workers/WorkerHandle.js","../node_modules/@arcgis/core/layers/support/LercDecoder.js","../node_modules/@arcgis/core/layers/ElevationLayer.js","../node_modules/@arcgis/core/layers/support/Tilemap.js","../node_modules/@arcgis/core/layers/support/TilemapCache.js","../node_modules/@arcgis/core/layers/support/serviceTileInfoProperty.js","../node_modules/@arcgis/core/layers/mixins/ArcGISCachedService.js"],"names":["h","r","getLogger","s","e","strategy","schedule","ref","t","byteLength","this","invoke","buffer","options","Promise","resolve","o","forEach","delete","destroy","_mainMethod","_listeners","_promise","then","_thread","hasInitialize","broadcast","_connectListener","close","catch","error","i","removed","eventName","callback","threadHandle","push","remove","invokeMethod","getTransferList","transferList","signal","reject","all","on","Map","n","get","set","T","x","copyright","heightModelInfo","path","opacity","operationalLayerType","sourceJSON","type","url","version","_lercDecoder","w","constructed","warn","declaredClass","currentVersion","addResolvingPromise","loadFromPortal","supportedTypes","supportsData","validateItem","typeKeywords","length","toLowerCase","expectedType","l","_fetchImageService","a","responseType","p","noDataValue","returnFileInfo","load","_fetchTileAvailability","getTileUrl","decode","data","values","pixelData","width","height","maxZError","fileInfo","minValue","maxValue","tilemapCache","supportsBlankTile","c","parsedUrl","query","blankTile","ElevationQuery","createSampler","fetchAvailability","f","ssl","replace","read","origin","fetchTile","__isDefault__","v","g","S","y","json","source","prototype","readOnly","u","String","origins","write","service","value","j","m","d","_","location","left","top","_allAvailability","byteSize","_tileAvailabilityBitSet","Math","ceil","Uint8Array","request","row","col","level","tileServers","details","httpStatus","valid","response","definition","fromJSON","validateJSON","Object","freeze","_updateFromData","Array","isArray","_handles","_pendingTilemapRequests","_availableLevels","levels","cacheByteSize","_prefetchingEnabled","_tilemapCache","add","watch","_initializeTilemapDefinition","_initializeAvailableLevels","_tmpTilemapDefinition","_tilemapFromCache","b","fromDefinition","put","getAvailability","layer","tileInfo","updateTileInfo","upsampleTile","fetchTilemap","fetchAvailabilityUpsample","_fetchAvailabilityUpsamplePrefetch","id","has","abort","_prefetches","removeUnordered","_maxPrefetch","clear","size","hasTilemap","initialSize","constructOnly","Number","reader","minScale","maxScale","minLOD","maxLOD","ignoreMinMaxLOD","lods","filter","round","scale","arguments","spatialReference","capabilities","indexOf"],"mappings":"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","file":"static/js/34.31de8853.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{remove as e}from\"../arrayUtils.js\";import{makeHandle as t}from\"../handleUtils.js\";import r from\"../Logger.js\";import{isSome as s}from\"../maybe.js\";import{throwIfAborted as i}from\"../promiseUtils.js\";import{open as o}from\"./workers.js\";const h=r.getLogger(\"esri.core.workers.WorkerHandle\");class n{constructor(e,t,r,s={}){this._mainMethod=t,this._listeners=[],this._promise=o(e,{...s,schedule:r}).then((e=>{if(void 0===this._thread){this._thread=e,this._promise=null,s.hasInitialize&&this.broadcast({},\"initialize\");for(const e of this._listeners)this._connectListener(e)}else e.close()})),this._promise.catch((t=>h.error(`Failed to initialize ${e} worker: ${t}`)))}on(r,i){const o={removed:!1,eventName:r,callback:i,threadHandle:null};return this._listeners.push(o),this._connectListener(o),t((()=>{o.removed=!0,e(this._listeners,o),this._thread&&s(o.threadHandle)&&o.threadHandle.remove()}))}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(e,t){return this.invokeMethod(this._mainMethod,e,t)}invokeMethod(e,t,r){if(this._thread){const s=this.getTransferList(t,e);return this._thread.invoke(e,t,{transferList:s,signal:r})}return this._promise?this._promise.then((()=>(i(r),this.invokeMethod(e,t,r)))):Promise.reject(null)}broadcast(e,t){return this._thread?Promise.all(this._thread.broadcast(t,e)).then((()=>{})):this._promise?this._promise.then((()=>this.broadcast(e,t))):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then((t=>{e.removed||(e.threadHandle=t)}))}}export{n as WorkerHandle};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{unwrap as e,isSome as r}from\"../../core/maybe.js\";import{WorkerHandle as t}from\"../../core/workers/WorkerHandle.js\";class s extends t{constructor(e=null){super(\"LercWorker\",\"_decode\",e,{strategy:\"dedicated\"}),this.schedule=e,this.ref=0}decode(e,r,t){return e&&0!==e.byteLength?this.invoke({buffer:e,options:r},t):Promise.resolve(null)}getTransferList(e){return[e.buffer]}release(){--this.ref<=0&&(o.forEach(((e,r)=>{e===this&&o.delete(r)})),this.destroy())}}const o=new Map;function n(t=null){let n=o.get(e(t));return n||(r(t)?(n=new s((e=>t.schedule(e))),o.set(t,n)):(n=new s,o.set(null,n))),++n.ref,n}export{n as acquireDecoder};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import r from\"../request.js\";import t from\"../core/Error.js\";import o from\"../core/Logger.js\";import{releaseMaybe as i,isSome as s}from\"../core/maybe.js\";import{MultiOriginJSONMixin as a}from\"../core/MultiOriginJSONSupport.js\";import{throwIfAbortError as l,createAbortController as n,throwIfAborted as p}from\"../core/promiseUtils.js\";import{objectToQuery as c}from\"../core/urlUtils.js\";import{property as h}from\"../core/accessorSupport/decorators/property.js\";import\"../core/has.js\";import\"../core/accessorSupport/ensureType.js\";import{reader as m}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as d}from\"../core/accessorSupport/decorators/subclass.js\";import u from\"../geometry/HeightModelInfo.js\";import y from\"./Layer.js\";import{ArcGISCachedService as v}from\"./mixins/ArcGISCachedService.js\";import{ArcGISService as f}from\"./mixins/ArcGISService.js\";import{OperationalLayer as g}from\"./mixins/OperationalLayer.js\";import{PortalLayer as S}from\"./mixins/PortalLayer.js\";import{url as j}from\"./support/commonProperties.js\";import{acquireDecoder as w}from\"./support/LercDecoder.js\";const T=o.getLogger(\"esri.layers.ElevationLayer\");let x=class extends(v(f(g(S(a(y)))))){constructor(...e){super(...e),this.copyright=null,this.heightModelInfo=null,this.path=null,this.opacity=1,this.operationalLayerType=\"ArcGISTiledElevationServiceLayer\",this.sourceJSON=null,this.type=\"elevation\",this.url=null,this.version=null,this._lercDecoder=w()}normalizeCtorArgs(e,r){return\"string\"==typeof e?{url:e,...r}:e}destroy(){this._lercDecoder=i(this._lercDecoder)}set minScale(e){this.constructed&&T.warn(`${this.declaredClass}.minScale support has been removed (since 4.5)`)}get minScale(){}set maxScale(e){this.constructed&&T.warn(`${this.declaredClass}.maxScale support has been removed (since 4.5)`)}get maxScale(){}readVersion(e,r){let t=r.currentVersion;return t||(t=9.3),t}load(e){const r=s(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[\"Image Service\"],supportsData:!1,validateItem:e=>{for(let r=0;r<e.typeKeywords.length;r++)if(\"elevation 3d layer\"===e.typeKeywords[r].toLowerCase())return!0;throw new t(\"portal:invalid-layer-item-type\",\"Invalid layer item type '${type}', expected '${expectedType}' \",{type:\"Image Service\",expectedType:\"Image Service Elevation 3D Layer\"})}},e).catch(l).then((()=>this._fetchImageService(r)))),Promise.resolve(this)}fetchTile(e,t,o,i){const a=s((i=i||{signal:null}).signal)?i.signal:i.signal=n().signal,l={responseType:\"array-buffer\",signal:a},p={noDataValue:i.noDataValue,returnFileInfo:!0};return this.load().then((()=>this._fetchTileAvailability(e,t,o,i))).then((()=>r(this.getTileUrl(e,t,o),l))).then((e=>this._lercDecoder.decode(e.data,p,a))).then((e=>({values:e.pixelData,width:e.width,height:e.height,maxZError:e.fileInfo.maxZError,noDataValue:e.noDataValue,minValue:e.minValue,maxValue:e.maxValue})))}getTileUrl(e,r,t){const o=!this.tilemapCache&&this.supportsBlankTile,i=c({...this.parsedUrl.query,blankTile:!o&&null});return`${this.parsedUrl.path}/tile/${e}/${r}/${t}${i?\"?\"+i:\"\"}`}async queryElevation(e,r){const{ElevationQuery:t}=await import(\"./support/ElevationQuery.js\");p(r);return(new t).query(this,e,r)}async createElevationSampler(e,r){const{ElevationQuery:t}=await import(\"./support/ElevationQuery.js\");p(r);return(new t).createSampler(this,e,r)}_fetchTileAvailability(e,r,t,o){return this.tilemapCache?this.tilemapCache.fetchAvailability(e,r,t,o):Promise.resolve(\"unknown\")}async _fetchImageService(e){if(this.sourceJSON)return this.sourceJSON;const t={query:{f:\"json\",...this.parsedUrl.query},responseType:\"json\",signal:e},o=await r(this.parsedUrl.path,t);o.ssl&&(this.url=this.url.replace(/^http:/i,\"https:\")),this.sourceJSON=o.data,this.read(o.data,{origin:\"service\",url:this.parsedUrl})}get hasOverriddenFetchTile(){return!this.fetchTile.__isDefault__}};e([h({json:{read:{source:\"copyrightText\"}}})],x.prototype,\"copyright\",void 0),e([h({readOnly:!0,type:u})],x.prototype,\"heightModelInfo\",void 0),e([h({type:String,json:{origins:{\"web-scene\":{read:!0,write:!0}},read:!1}})],x.prototype,\"path\",void 0),e([h({type:[\"show\",\"hide\"]})],x.prototype,\"listMode\",void 0),e([h({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},\"portal-item\":{read:!1,write:!1},\"web-document\":{read:!1,write:!1}}}})],x.prototype,\"minScale\",null),e([h({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},\"portal-item\":{read:!1,write:!1},\"web-document\":{read:!1,write:!1}}}})],x.prototype,\"maxScale\",null),e([h({json:{read:!1,write:!1,origins:{\"web-document\":{read:!1,write:!1}}}})],x.prototype,\"opacity\",void 0),e([h({type:[\"ArcGISTiledElevationServiceLayer\"]})],x.prototype,\"operationalLayerType\",void 0),e([h()],x.prototype,\"sourceJSON\",void 0),e([h({json:{read:!1},value:\"elevation\",readOnly:!0})],x.prototype,\"type\",void 0),e([h(j)],x.prototype,\"url\",void 0),e([h()],x.prototype,\"version\",void 0),e([m(\"version\",[\"currentVersion\"])],x.prototype,\"readVersion\",null),x=e([d(\"esri.layers.ElevationLayer\")],x),x.prototype.fetchTile.__isDefault__=!0;var _=x;export default _;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport t from\"../../request.js\";import{constant as i}from\"../../core/arrayUtils.js\";import e from\"../../core/Error.js\";import{clone as a}from\"../../core/lang.js\";class l{constructor(){this.location={left:0,top:0,width:0,height:0},this._allAvailability=\"unknown\",this.byteSize=40}getAvailability(t,i){if(\"unknown\"!==this._allAvailability)return this._allAvailability;const e=(t-this.location.top)*this.location.width+(i-this.location.left),a=e%8,l=e>>3,o=this._tileAvailabilityBitSet;return l<0||l>o.length?\"unknown\":o[l]&1<<a?\"available\":\"unavailable\"}_updateFromData(t){const i=this.location.width,e=this.location.height;let a=!0,l=!0;const o=Math.ceil(i*e/8),n=new Uint8Array(o);let r=0;for(let s=0;s<t.length;s++){const i=s%8;t[s]?(l=!1,n[r]|=1<<i):a=!1,7===i&&++r}l?this._allAvailability=\"unavailable\":a?this._allAvailability=\"available\":(this._allAvailability=\"unknown\",this._tileAvailabilityBitSet=n,this.byteSize+=n.length)}static fromDefinition(a,o){const r=a.service.request||t,{row:s,col:h,width:c,height:m}=a,d={query:{f:\"json\"}};return o=o?{...d,...o}:d,r(n(a),o).then((t=>t.data)).catch((t=>{if(t&&t.details&&422===t.details.httpStatus)return{location:{top:s,left:h,width:c,height:m},valid:!0,data:i(c*m,0)};throw t})).then((t=>{if(t.location&&(t.location.top!==s||t.location.left!==h||t.location.width!==c||t.location.height!==m))throw new e(\"tilemap:location-mismatch\",\"Tilemap response for different location than requested\",{response:t,definition:{top:s,left:h,width:c,height:m}});return l.fromJSON(t)}))}static fromJSON(t){l.validateJSON(t);const i=new l;return i.location=Object.freeze(a(t.location)),i._updateFromData(t.data),Object.freeze(i)}static validateJSON(t){if(!t||!t.location)throw new e(\"tilemap:missing-location\",\"Location missing from tilemap response\");if(!1===t.valid)throw new e(\"tilemap:invalid\",\"Tilemap response was marked as invalid\");if(!t.data)throw new e(\"tilemap:missing-data\",\"Data missing from tilemap response\");if(!Array.isArray(t.data))throw new e(\"tilemap:data-mismatch\",\"Data must be an array of numbers\");if(t.data.length!==t.location.width*t.location.height)throw new e(\"tilemap:data-mismatch\",\"Number of data items does not match width/height of tilemap\")}}function o(t){return`${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`}function n(t){let i;if(\"vector-tile\"===t.service.type)i=`${t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`;else{const e=t.service.tileServers;i=`${e&&e.length?e[t.row%e.length]:t.service.url}/tilemap/${t.level}/${t.row}/${t.col}/${t.width}/${t.height}`}const e=t.service.query;return e&&(i=`${i}?${e}`),i}export default l;export{l as Tilemap,o as tilemapDefinitionId};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import t from\"../../request.js\";import i from\"../../core/Accessor.js\";import l from\"../../core/Error.js\";import r from\"../../core/Handles.js\";import s from\"../../core/Logger.js\";import a from\"../../core/LRUCache.js\";import o from\"../../core/PooledArray.js\";import{onAbort as n,createAbortError as c,isAbortError as h,createAbortController as p,isAborted as m}from\"../../core/promiseUtils.js\";import{waitTicks as u}from\"../../core/scheduling.js\";import{objectToQuery as f}from\"../../core/urlUtils.js\";import{init as v}from\"../../core/watchUtils.js\";import{property as y}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import{cast as _}from\"../../core/accessorSupport/decorators/cast.js\";import{subclass as d}from\"../../core/accessorSupport/decorators/subclass.js\";import{tilemapDefinitionId as b,Tilemap as g}from\"./Tilemap.js\";var w;const T=s.getLogger(\"esri.layers.support.TilemapCache\");let j=w=class extends i{constructor(e){super(e),this._handles=new r,this._pendingTilemapRequests={},this._availableLevels={},this.levels=5,this.cacheByteSize=2097152,this.request=t,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new a(this.cacheByteSize),this._handles.add([this.watch([\"layer.parsedUrl\",\"layer.tileServers?\"],(()=>this._initializeTilemapDefinition())),v(this,\"layer.tileInfo.lods\",(e=>this._initializeAvailableLevels(e)),!0)]),this._initializeTilemapDefinition()}destroy(){this._handles&&(this._handles.destroy(),this._handles=null)}castLevels(e){return e<=2?(T.error(\"Minimum levels for Tilemap is 3, but got \",e),3):e}get size(){return 1<<this.levels}fetchTilemap(e,t,i,r){if(!this._availableLevels[e])return Promise.reject(new l(\"tilemap-cache:level-unavailable\",`Level ${e} is unavailable in the service`));const s=this._tmpTilemapDefinition,a=this._tilemapFromCache(e,t,i,s);if(a)return Promise.resolve(a);const o=r&&r.signal;return r={...r,signal:null},new Promise(((e,t)=>{n(o,(()=>t(c())));const i=b(s);let l=this._pendingTilemapRequests[i];if(!l){l=g.fromDefinition(s,r).then((e=>(this._tilemapCache.put(i,e,e.byteSize),e)));const e=()=>delete this._pendingTilemapRequests[i];this._pendingTilemapRequests[i]=l,l.then(e,e)}l.then(e,t)}))}getAvailability(e,t,i){if(!this._availableLevels[e])return\"unavailable\";const l=this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition);return l?l.getAvailability(t,i):\"unknown\"}getAvailabilityUpsample(e,t,i,l){l.level=e,l.row=t,l.col=i;const r=this.layer.tileInfo;for(r.updateTileInfo(l);;){const e=this.getAvailability(l.level,l.row,l.col);if(\"unavailable\"!==e)return e;if(!r.upsampleTile(l))return\"unavailable\"}}fetchAvailability(e,t,i,r){return this._availableLevels[e]?this.fetchTilemap(e,t,i,r).catch((e=>e)).then((r=>{if(r instanceof g){const s=r.getAvailability(t,i);return\"unavailable\"===s?Promise.reject(new l(\"tile-map:tile-unavailable\",\"Tile is not available\",{level:e,row:t,col:i})):s}if(h(r))throw r;return\"unknown\"})):Promise.reject(new l(\"tilemap-cache:level-unavailable\",`Level ${e} is unavailable in the service`))}fetchAvailabilityUpsample(e,t,i,l,r){l.level=e,l.row=t,l.col=i;const s=this.layer.tileInfo;s.updateTileInfo(l);const a=this.fetchAvailability(e,t,i,r).catch((e=>{if(h(e))throw e;if(s.upsampleTile(l))return this.fetchAvailabilityUpsample(l.level,l.row,l.col,l);throw e}));return this._fetchAvailabilityUpsamplePrefetch(l.id,e,t,i,r,a),a}async _fetchAvailabilityUpsamplePrefetch(e,t,i,l,r,s){if(!this._prefetchingEnabled)return;const a=`prefetch-${e}`;if(this._handles.has(a))return;const o=p();s.then((()=>o.abort()),(()=>o.abort()));let n=!1;const c={remove(){n||(n=!0,o.abort())}};if(this._handles.add(c,a),await u(10,o.signal).catch((()=>{})),n||(n=!0,this._handles.remove(a)),m(o))return;const h={id:e,level:t,row:i,col:l},f={...r,signal:o.signal},v=this.layer.tileInfo;for(let p=0;w._prefetches.length<w._maxPrefetch&&v.upsampleTile(h);++p){const e=this.fetchAvailability(h.level,h.row,h.col,f);w._prefetches.push(e);const t=()=>{w._prefetches.removeUnordered(e)};e.then(t,t)}}_initializeTilemapDefinition(){if(!this.layer.parsedUrl)return;const e=this.layer.parsedUrl,t=e.query;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:t?f(t):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(e,t,i,l){l.level=e,l.row=t-t%this.size,l.col=i-i%this.size;const r=b(l);return this._tilemapCache.get(r)}_initializeAvailableLevels(e){this._availableLevels={},e&&e.forEach((e=>this._availableLevels[e.level]=!0))}get test(){const e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:(t,i,l)=>!!e._tilemapFromCache(t,i,l,e._tmpTilemapDefinition)}}};j._maxPrefetch=4,j._prefetches=new o({initialSize:w._maxPrefetch}),e([y({constructOnly:!0,type:Number})],j.prototype,\"levels\",void 0),e([_(\"levels\")],j.prototype,\"castLevels\",null),e([y({readOnly:!0,type:Number})],j.prototype,\"size\",null),e([y({constructOnly:!0,type:Number})],j.prototype,\"cacheByteSize\",void 0),e([y({constructOnly:!0})],j.prototype,\"layer\",void 0),e([y({constructOnly:!0})],j.prototype,\"request\",void 0),j=w=e([d(\"esri.layers.support.TilemapCache\")],j);export{j as TilemapCache};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport e from\"./TileInfo.js\";const r={type:e,json:{origins:{service:{read:{source:[\"tileInfo\",\"minScale\",\"maxScale\",\"minLOD\",\"maxLOD\"],reader:n}}}}};function n(r,n,l,o){if(!r)return null;const{minScale:i,maxScale:t,minLOD:m,maxLOD:s}=n;if(null!=m&&null!=s)return o&&o.ignoreMinMaxLOD?e.fromJSON(r):e.fromJSON({...r,lods:r.lods.filter((({level:e})=>null!=e&&e>=m&&e<=s))});if(0!==i&&0!==t){const n=e=>Math.round(1e4*e)/1e4,l=i?n(i):1/0,o=t?n(t):-1/0;return e.fromJSON({...r,lods:r.lods.filter((e=>{const r=n(e.scale);return r<=l&&r>=o}))})}return e.fromJSON(r)}export{n as readServiceTileInfo,r as serviceTileInfoProperty};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.20/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../geometry.js\";import{property as r}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/Logger.js\";import{reader as o}from\"../../core/accessorSupport/decorators/reader.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";import{serviceTileInfoProperty as i}from\"../support/serviceTileInfoProperty.js\";import{TilemapCache as p}from\"../support/TilemapCache.js\";import a from\"../../geometry/SpatialReference.js\";const s=s=>{let l=class extends s{constructor(){super(...arguments),this.copyright=null,this.minScale=0,this.maxScale=0,this.spatialReference=null,this.tileInfo=null,this.tilemapCache=null}readMinScale(e,r){return null!=r.minLOD&&null!=r.maxLOD?e:0}readMaxScale(e,r){return null!=r.minLOD&&null!=r.maxLOD?e:0}get supportsBlankTile(){return this.version>=10.2}readTilemapCache(e,r){return r.capabilities&&r.capabilities.indexOf(\"Tilemap\")>-1?new p({layer:this}):null}};return e([r({json:{read:{source:\"copyrightText\"}}})],l.prototype,\"copyright\",void 0),e([r()],l.prototype,\"minScale\",void 0),e([o(\"service\",\"minScale\")],l.prototype,\"readMinScale\",null),e([r()],l.prototype,\"maxScale\",void 0),e([o(\"service\",\"maxScale\")],l.prototype,\"readMaxScale\",null),e([r({type:a})],l.prototype,\"spatialReference\",void 0),e([r({readOnly:!0})],l.prototype,\"supportsBlankTile\",null),e([r(i)],l.prototype,\"tileInfo\",void 0),e([r()],l.prototype,\"tilemapCache\",void 0),e([o(\"service\",\"tilemapCache\",[\"capabilities\"])],l.prototype,\"readTilemapCache\",null),e([r()],l.prototype,\"version\",void 0),l=e([t(\"esri.layers.mixins.ArcGISCachedService\")],l),l};export{s as ArcGISCachedService};\n"],"sourceRoot":""}