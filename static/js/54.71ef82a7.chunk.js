(this["webpackJsonptesting-ant-cra"]=this["webpackJsonptesting-ant-cra"]||[]).push([[54],{1191:function(e,t,i){"use strict";i.r(t);var n=i(4),r=i(5),a=i(6),s=i(7),o=i(0),c=i(25),l=i(56),u=i(41),h=(i(13),i(16),i(12)),d=i(1),f=i(9),b=i(10),v=i(474),p=i(922),g=i(36),O=i(63),m=i(66),y=i(858),_=i(30),j=i(273),w=i(54),x=i(85),k=i(780),S=i(120),M=i(267),T=i(268),R=i(812),P=i(859),C=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e))._unitNormalizer=new P.a,r._handles=new O.a,r._tempStartPosition=Object(x.e)(),r._tempEndPosition=Object(x.e)(),r._tempCornerPosition=Object(x.e)(),r}return Object(r.a)(i,[{key:"initialize",value:function(){var e=this;this._handles.add(Object(_.j)(this.view,"ready",(function(){return e._initialize()}),!0))}},{key:"destroy",value:function(){this._handles=Object(b.e)(this._handles)}},{key:"_initialize",value:function(){var e=this,t=this.view.spatialReference,i=Object(T.g)(t),n=i===T.a?T.d:i;this._sphericalPCPF=n;var r=Object(M.b)(t,n);this._unitNormalizer.spatialReference=r?n:t,this._handles.add(Object(j.d)((function(){return{result:e._computedResult,viewData:e.viewData}}),(function(e){var t=e.result;e.viewData.result=t})))}},{key:"_computedResult",get:function(){var e=this.layer,t=e.startPoint,i=e.endPoint;if(Object(b.j)(t)||Object(b.j)(i))return null;var n=this._euclideanDistances(t,i),r=this._exactGeodesicDistanceAndAngle(t,i,n.horizontal.value);return{directDistance:n.direct,horizontalDistance:n.horizontal,verticalDistance:n.vertical,geodesicDistance:r.distance,geodesicAngle:r.angle}}},{key:"_euclideanDistances",value:function(e,t){var i=this,n=e.clone();n.z=t.z;var r=this._tempStartPosition,a=this._tempEndPosition,s=this._tempCornerPosition,o=this.view.spatialReference,c=this._sphericalPCPF,l=Object(M.b)(o,c)?c:o;Object(M.o)(e,r,l),Object(M.o)(t,a,l),Object(M.o)(n,s,l);var u=Object(w.j)(r,a),h=Object(w.j)(s,a),d=Math.abs(t.z-e.z),f=function(e){return i._unitNormalizer.normalizeDistance(e)},b=f(u),v=f(h),p=f(d);return{direct:new y.a(b,"meters"),horizontal:new y.a(v,"meters"),vertical:new y.a(p,"meters")}}},{key:"_exactGeodesicDistanceAndAngle",value:function(e,t,i){var n=e.spatialReference,r=new S.a({spatialReference:n});r.addPath([e,t]);var a=n.isGeographic&&Object(R.e)(n)?Object(R.c)([r],"meters")[0]:n.isWebMercator?Object(k.geodesicLength)(r,"meters"):void 0,s=a?{distance:a,angle:this._fallbackGeodesicAngle(a,n)}:this._fallbackGeodesicDistance(e,t,i),o=s.distance,c=s.angle;return{distance:new y.a(o,"meters"),angle:new y.a(c,"degrees")}}},{key:"_fallbackGeodesicAngle",value:function(e,t){return e/Object(T.e)(t).metersPerDegree}},{key:"_fallbackGeodesicDistance",value:function(e,t,i){if(Object(M.p)(e,D)){Object(M.p)(t,E);var n=Object(m.g)(D[0]),r=Object(m.g)(D[1]),a=Object(m.g)(E[0]),s=Object(m.g)(E[1]),o=Math.abs(a-n),c=Object(m.b)(Math.sin(r)*Math.sin(s)+Math.cos(r)*Math.cos(s)*Math.cos(o)),l=Object(m.r)(c),u={distance:0};return Object(R.d)(u,[D[0],D[1]],[E[0],E[1]]),{distance:u.distance,angle:l}}var h=e.spatialReference,d=i;return{distance:d,angle:this._fallbackGeodesicAngle(d,h)}}}]),i}(g.a);Object(o.a)([Object(d.b)()],C.prototype,"view",void 0),Object(o.a)([Object(d.b)()],C.prototype,"layer",void 0),Object(o.a)([Object(d.b)()],C.prototype,"viewData",void 0),Object(o.a)([Object(d.b)()],C.prototype,"_computedResult",null),C=Object(o.a)([Object(f.a)("esri.views.3d.layers.analysis.DirectLineMeasurement/DirectLineMeasurementController")],C);var D=Object(x.e)(),E=Object(x.e)(),L=i(8),z=i.n(L),I=i(14),A=i(11),V=(i(168),i(924)),F=i(38),H=i(50),G=i(678),N=i(947),U=i(943),W=i(603),q=i(618),B=i(714),Z=i(697),Y=i(700),Q=i(715),X=i(716),J=i(717),K=i(672),$=i(680),ee=i(681),te=i(688),ie=i(673),ne=i(928),re=i(467),ae=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(e,r,a){return Object(n.a)(this,i),t.call(this,e,r,a)}return Object(r.a)(i,[{key:"initializeProgram",value:function(e){var t=i.shader.get().build();return new ie.a(e.rctx,t,te.a)}},{key:"bindPass",value:function(e,t){Object(J.b)(this.program,t.camera.projectionMatrix),this.program.setUniform1f("width",e.width),this.program.setUniform1f("outlineSize",e.outlineSize),this.program.setUniform4fv("outlineColor",e.outlineColor),this.program.setUniform1f("stripeLength",e.stripeLength),this.program.setUniform4fv("stripeEvenColor",e.stripeEvenColor),this.program.setUniform4fv("stripeOddColor",e.stripeOddColor)}},{key:"bindDraw",value:function(e){Object(J.c)(this.program,e),this.program.rebindTextures()}},{key:"initializePipeline",value:function(){return Object(re.e)({polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:513},depthWrite:re.d,colorWrite:re.c})}},{key:"primitiveType",get:function(){return 5}}]),i}($.a);ae.shader=new K.a(ne.a,(function(){return i.e(195).then(i.bind(null,1182))}));var se=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(){var e;return Object(n.a)(this,i),(e=t.apply(this,arguments)).polygonOffsetEnabled=!1,e}return i}(ee.a);Object(o.a)([Object(ee.b)()],se.prototype,"polygonOffsetEnabled",void 0);var oe=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e,le)).techniqueConfig=new se,r}return Object(r.a)(i,[{key:"getTechniqueConfig",value:function(){return this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset,this.techniqueConfig}},{key:"dispose",value:function(){}},{key:"getPassParameters",value:function(){return this.params}},{key:"intersect",value:function(){}},{key:"createBufferWriter",value:function(){return new pe}},{key:"getGLMaterial",value:function(e){return 0===e.output?new ce(e):void 0}}]),i}(X.a),ce=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e)).updateParameters(),r}return Object(r.a)(i,[{key:"updateParameters",value:function(){this._technique=this._techniqueRep.releaseAndAcquire(ae,this._material.getTechniqueConfig(),this._technique)}},{key:"beginSlot",value:function(e){return 3===e}},{key:"bind",value:function(e){this._technique.bindPass(this._material.getPassParameters(),e)}}]),i}(Q.a),le=Object(A.a)({width:32,outlineSize:.2,outlineColor:[1,.5,0,1],stripeLength:1,stripeEvenColor:[1,1,1,1],stripeOddColor:[1,.5,0,1],polygonOffset:!1},X.b),ue=Object(Y.a)().vec3f("position").vec3f("normal").vec2f("uv0").f32("auxpos1"),he=Object(x.e)(),de=Object(x.e)(),fe=Object(x.e)(),be=Object(x.e)(),ve=Object(x.e)(),pe=function(){function e(){Object(n.a)(this,e),this.vertexBufferLayout=ue}return Object(r.a)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return 2*(e.indices.get("position").length/2+1)}},{key:"write",value:function(e,t,i,n){var r=t.vertexAttributes.get("position").data,a=t.vertexAttributes.get("normal").data,s=r.length/3,o=t&&t.indices&&t.indices.get("position");o&&o.length!==2*(s-1)&&console.warn("MeasurementArrowMaterial does not support indices");for(var c=he,l=de,u=fe,h=be,d=ve,f=e.transformation,b=e.invTranspTransformation,v=i.position,p=i.normal,g=i.uv0,O=0,m=0;m<s;++m){var y=3*m;if(Object(w.t)(c,r[y],r[y+1],r[y+2]),m<s-1){var _=3*(m+1);Object(w.t)(l,r[_],r[_+1],r[_+2]),Object(w.t)(d,a[_],a[_+1],a[_+2]),Object(w.o)(d,d),Object(w.g)(u,l,c),Object(w.o)(u,u),Object(w.d)(h,d,u),Object(w.o)(h,h)}var j=Object(w.j)(c,l);f&&b&&(Object(w.n)(c,c,f),Object(w.n)(l,l,f),Object(w.n)(h,h,b));var x=n+2*m,k=x+1;v.setVec(x,c),v.setVec(k,c),p.setVec(x,h),p.setVec(k,h),g.set(x,0,O),g.set(x,1,-1),g.set(k,0,O),g.set(k,1,1),m<s-1&&(O+=j)}for(var S=i.auxpos1,M=0;M<2*s;++M)S.set(n+M,O)}}]),e}(),ge=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e))._parameters=Oe,r._handles=null,r._origin=Object(x.e)(),r._originTransform=Object(W.d)(),r._arrowCenter=Object(x.e)(),r._renderOccluded=4,r._geometry=null,r._stripeLength=1,r._stripesEnabled=!0,r.applyProps(e),r}return Object(r.a)(i,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial&&this._arrowMaterial.setParameterValues({renderOccluded:e}))}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.geometryChanged()}},{key:"stripeLength",get:function(){return this._stripeLength},set:function(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameterValues({stripeLength:this._stripeLength})}},{key:"stripesEnabled",get:function(){return this._stripesEnabled},set:function(e){if(this._stripesEnabled=e,this.attached){var t=this._stripesEnabled?this._parameters.arrowStripeEvenColor:this._parameters.arrowStripeOddColor;this._arrowMaterial.setParameterValues({stripeEvenColor:t})}}},{key:"createExternalResources",value:function(){var e=this,t=this._stripesEnabled?this._parameters.arrowStripeEvenColor:this._parameters.arrowStripeOddColor;this._arrowMaterial=new oe({outlineColor:this._parameters.arrowOutlineColor,stripeEvenColor:t,stripeOddColor:this._parameters.arrowStripeOddColor,renderOccluded:this.renderOccluded,polygonOffset:!0}),this._handles=new O.a,this._handles.add(this.view.state.watch("camera",(function(){e.viewChanged()})))}},{key:"destroyExternalResources",value:function(){this._arrowMaterial=null,this._handles.destroy(),this._handles=null}},{key:"forEachExternalMaterial",value:function(e){e(this._arrowMaterial)}},{key:"createGeometries",value:function(e){if(!(Object(b.j)(this._geometry)||Object(b.j)(this._geometry.startRenderSpace)||Object(b.j)(this._geometry.endRenderSpace))){var t=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);e.addGeometry(t,this._arrowMaterial,this._originTransform),this.viewChanged()}}},{key:"_createArrowGeometry",value:function(e,t,i,n){var r=this.view.renderCoordsHelper,a=[],s=[],o=function(e,t){var n=q.c.get();Object(w.g)(n,e,i),a.push(n),s.push(t)};if("euclidean"===n.type){n.eval(.5,this._arrowCenter);var c=q.c.get();r.worldUpAtPosition(this._arrowCenter,c),o(e,c),o(t,c)}else{n.eval(.5,this._arrowCenter);for(var l=this._parameters.arrowSubdivisions+1&-2,u=0;u<l;++u){var h=u/(l-1),d=q.c.get(),f=q.c.get();n.eval(h,d),r.worldUpAtPosition(d,f),o(d,f)}}return Z.a.createPolylineGeometry(a,s)}},{key:"geometryChanged",value:function(){this.recreateGeometry()}},{key:"viewChanged",value:function(){if(this.view.ready&&this.attached&&Object(b.k)(this._geometry)){var e=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameterValues({width:this._parameters.arrowWidth*e})}}}]),i}(B.a),Oe={arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128},me=i(819),ye=i(926),_e=i(923),je=i(927),we=i(92),xe=i(169),ke=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e))._params=Object(A.a)({},Me),r._handles=new O.a,r._segmentVisualElement=null,r._triangleVisualElement=null,r._rightAngleQuad=null,r._projectedGeodesicLine=null,r._geodesicStartHint=null,r._geodesicEndHint=null,r._segmentLabel=null,r._verticalLabel=null,r._horizontalLabel=null,r._startPosition=Object(x.e)(),r._endPosition=Object(x.e)(),r._cornerPosition=Object(x.e)(),r._startPositionAtSeaLevel=Object(x.e)(),r._endPositionAtSeaLevel=Object(x.e)(),r._state=0,r._segmentLabelDisplayedMeasurement=1,r._triangleOrientationOverride=null,r.messages=null,r.viewMode=0,r.visualizedMeasurement=0,r.actualVisualizedMeasurement=1,r.visualElementOrientation=0,r.triangleCollapseRatioThreshold=.03,r}return Object(r.a)(i,[{key:"_geodesicDistanceExceeded",get:function(){var e,t=this.layerView.result;return Object(b.k)(t)&&(null==(e=t.horizontalDistance)?void 0:e.value)>this.layer.geodesicDistanceThreshold}},{key:"ready",get:function(){return 1===this._state}},{key:"visible",get:function(){return this.layerView.visible&&!this.layerView.suspended}},{key:"allowVisualElementsOrientationChange",get:function(){return Object(b.j)(this._triangleOrientationOverride)},set:function(e){Object(b.j)(this._triangleOrientationOverride)!==e&&(Object(b.j)(this._triangleOrientationOverride)?this._triangleOrientationOverride=this._getActualVisualElementsOrientation():this._triangleOrientationOverride=null)}},{key:"labels",get:function(){return 2===this.actualVisualizedMeasurement?{direct:this._horizontalLabel,horizontal:this._segmentLabel,vertical:this._verticalLabel}:{direct:this._segmentLabel,horizontal:this._horizontalLabel,vertical:this._verticalLabel}}},{key:"testData",get:function(){return{labels:this.labels,stripeLength:this._segmentVisualElement.stripeLength}}},{key:"initialize",value:function(){var e=this;this._handles.add(Object(_.j)(this.view,"ready",(function(){return e._initialize()}),!0))}},{key:"_initialize",value:function(){var e=this;switch(this._state){case 1:throw new Error("invalid state");case 2:return}var t=this._params,i={attached:!0,view:this.view};this._segmentVisualElement=new ge(Object(A.a)(Object(A.a)({},i),{},{geometry:null,renderOccluded:4})),this._triangleVisualElement=new U.a(Object(A.a)(Object(A.a)({},i),{},{width:t.triangleLineWidth,color:t.triangleColor,renderOccluded:4})),this._rightAngleQuad=new me.a(Object(A.a)(Object(A.a)({},i),{},{color:Se,renderOccluded:4}));var n=Object(A.a)(Object(A.a)({},i),{},{polygonOffset:!0,stippleIntegerRepeats:!1,renderOccluded:4});this._projectedGeodesicLine=new U.a(Object(A.a)(Object(A.a)({},n),{},{width:t.geodesicProjectionLineWidth,color:t.geodesicProjectionLineColor,stipplePattern:Object(je.a)(t.guideStippleLengthPixels)})),this._geodesicStartHint=new U.a(Object(A.a)(Object(A.a)({},n),{},{width:t.guideLineWidth,color:t.geodesicProjectionLineColor,stipplePattern:Object(je.a)(t.guideStippleLengthPixels)})),this._geodesicEndHint=new U.a(Object(A.a)(Object(A.a)({},n),{},{width:t.guideLineWidth,color:t.geodesicProjectionLineColor,stipplePattern:Object(je.a)(t.guideStippleLengthPixels)})),this._segmentLabel=new N.a(Object(A.a)(Object(A.a)({},i),{},{fontSize:t.direcLabelFontSize})),this._verticalLabel=new N.a(Object(A.a)(Object(A.a)({},i),{},{fontSize:t.verticalLabelFontSize})),this._horizontalLabel=new N.a(Object(A.a)(Object(A.a)({},i),{},{fontSize:t.horizontalLabelFontSize})),this._handles.add([Object(j.a)((function(){return e._updateGeometryAndViewMode()})),Object(j.a)((function(){return e._updateVisualElementVisibility()})),Object(j.a)((function(){return e._updateLabelText()})),Object(j.a)((function(){return e._updateLabelVisibility()})),Object(j.a)((function(){return e._updateSegmentStripeLength()})),Object(we.c)(Object(I.a)(z.a.mark((function t(){return z.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._updateMessageBundle());case 1:case"end":return t.stop()}}),t)}))))]),this._state=1,this._updateMessageBundle()}},{key:"destroy",value:function(){2!==this._state&&(this._handles=Object(b.e)(this._handles),this._segmentVisualElement=Object(b.e)(this._segmentVisualElement),this._triangleVisualElement=Object(b.e)(this._triangleVisualElement),this._rightAngleQuad=Object(b.e)(this._rightAngleQuad),this._projectedGeodesicLine=Object(b.e)(this._projectedGeodesicLine),this._geodesicStartHint=Object(b.e)(this._geodesicStartHint),this._geodesicEndHint=Object(b.e)(this._geodesicEndHint),this._segmentLabel=Object(b.e)(this._segmentLabel),this._verticalLabel=Object(b.e)(this._verticalLabel),this._horizontalLabel=Object(b.e)(this._horizontalLabel),this.set("view",null),this._state=2)}},{key:"whenReady",value:function(){var e=Object(I.a)(z.a.mark((function e(){return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(_.j)(this,"ready");case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"whenMessages",value:function(){var e=Object(I.a)(z.a.mark((function e(){return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.whenReady();case 2:return e.next=4,Object(_.j)(this,"messages");case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_updateVisualElementVisibility",value:function(){if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,this.visible)switch(this.viewMode){case 0:break;case 1:this._segmentVisualElement.visible=!0;break;case 2:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case 3:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}},{key:"_updateGeometryAndViewMode",value:function(){var e=this.view.renderCoordsHelper,t=this.layer,i=t.startPoint,n=t.endPoint;if(Object(b.j)(i)||Object(b.j)(n)||i.equals(n)){this.viewMode=0;var r=this.visualizedMeasurement,a=0===r;this.actualVisualizedMeasurement=a?1:r}else{e.toRenderCoords(i,this._startPosition),e.toRenderCoords(n,this._endPosition);var s=this._getActualVisualElementsOrientation(),o=this._updateActualVisualizedMeasurement();this.viewMode=this._computeViewMode(o);var c=this._startPosition,l=this._endPosition,u=1===s?1:-1,h=u*(e.getAltitude(l)-e.getAltitude(c));h<0&&(c=this._endPosition,l=this._startPosition);var d=2===o?new ye.b(this._startPosition,this._endPosition,e.spatialReference):new ye.a(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=d,this._updateSegmentStripeLength(),this._segmentLabelDisplayedMeasurement=o,this.viewMode){case 1:this._updateSegment(d,s);break;case 2:this._updateSegmentAndTriangle(d,s,c,l,u,h);break;case 3:this._updateSegmentAndProjection(s)}}}},{key:"_updateSegment",value:function(e,t){this._segmentLabel.anchor=1===t?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"}}},{key:"_updateSegmentAndTriangle",value:function(e,t,i,n,r,a){var s=this.view,o=s.renderCoordsHelper,c=s.state.camera,l=this._cornerPosition;o.worldUpAtPosition(i,l),Object(w.b)(l,l,r*Math.abs(a)),Object(w.c)(l,l,i),this._triangleVisualElement.geometry=[[[i[0],i[1],i[2]],[l[0],l[1],l[2]],[n[0],n[1],n[2]]]],this._rightAngleQuad.geometry={previous:i,center:l,next:n};var u=new ye.a(i,l),h=new ye.a(l,n),d=function(e,t,i,n,r){var a=Re,s=Pe;r.projectToRenderScreen(i,a),r.projectToRenderScreen(t,s);var o={segment:"bottom",horizontal:"top",vertical:a[0]<s[0]?"left":"right"},c=Ce,l=De;if(Object(_e.b)(e,i,c,r),Object(_e.b)(e,t,l,r),Object(H.h)(c,l)>=Te){var u=Object(m.s)(c[1])===Object(m.s)(l[1]);o.segment=u?Object(N.b)(o.vertical):o.vertical}else{var h=Ee;Object(_e.b)(i,t,h,r),Object(H.h)(h,l)>=Te&&(o.segment=Object(m.s)(h[0])===Object(m.s)(l[0])?Object(N.b)(o.horizontal):o.horizontal)}if(2===n){var d=function(e){return"top"===e?"bottom":"top"};o.segment=d(o.segment),o.horizontal=d(o.horizontal),o.vertical=d(o.vertical)}return o}(i,n,l,t,c);this._segmentLabel.anchor=d.segment,this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:u,sampleLocation:"center"},this._verticalLabel.anchor=d.vertical,this._horizontalLabel.geometry={type:"segment",segment:h,sampleLocation:"center"},this._horizontalLabel.anchor=d.horizontal}},{key:"_updateSegmentAndProjection",value:function(e){var t=this.view.renderCoordsHelper;t.setAltitude(this._startPositionAtSeaLevel,0,this._startPosition),t.setAltitude(this._endPositionAtSeaLevel,0,this._endPosition);var i=new ye.b(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,t.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(i),this._geodesicStartHint.setGeometryFromSegment(new ye.a(this._startPositionAtSeaLevel,this._startPosition)),this._geodesicEndHint.setGeometryFromSegment(new ye.a(this._endPositionAtSeaLevel,this._endPosition)),this._segmentLabel.geometry={type:"segment",segment:i,sampleLocation:"center"},this._segmentLabel.anchor=1===e?"top":"bottom"}},{key:"_updateLabelText",value:function(){if(1===this._state){var e=this._segmentLabel,t=this._horizontalLabel,i=this._verticalLabel,n=this.messages,r=this.layerView.result;if(Object(b.j)(r)||Object(b.j)(n))return e.text=null,t.text=null,void(i.text=null);var a=this._getLabelsText(n,r),s=1===this._segmentLabelDisplayedMeasurement;e.text=s?a.euclideanDistance:a.geodesicDistance,t.text=a.horizontalDistance,i.text=a.verticalDistance,this.notifyChange("labels")}}},{key:"_updateLabelVisibility",value:function(){if(1===this._state){var e=this._segmentLabel,t=this._horizontalLabel,i=this._verticalLabel;if(e.visible=!1,t.visible=!1,i.visible=!1,this.visible)switch(this.viewMode){case 1:e.visible=!0;break;case 2:e.visible=!0,t.visible=!0,i.visible=!0;break;case 3:e.visible=!0}}}},{key:"_getLabelsText",value:function(e,t){var i=t.directDistance,n=t.horizontalDistance,r=t.verticalDistance,a=t.geodesicDistance,s=t.geodesicAngle,o=this.layerView.unit,c=function(e){return Object(A.a)({euclideanDistance:"",geodesicDistance:"",horizontalDistance:"",verticalDistance:""},e)};switch(o){case"metric":return c({euclideanDistance:i&&Object(V.e)(e,i),geodesicDistance:a&&Object(V.e)(e,a),horizontalDistance:n&&Object(V.e)(e,n),verticalDistance:r&&Object(V.f)(e,r)});case"imperial":return c({euclideanDistance:i&&Object(V.c)(e,i),geodesicDistance:a&&Object(V.c)(e,a),horizontalDistance:n&&Object(V.c)(e,n),verticalDistance:r&&Object(V.d)(e,r)});case"degrees":var l=s&&Object(V.b)(e,s,"degrees");return c({euclideanDistance:l,geodesicDistance:l,horizontalDistance:l});case"degrees-minutes-seconds":return c({horizontalDistance:s&&Object(V.a)(s)});default:return c({euclideanDistance:i&&Object(V.b)(e,i,o),geodesicDistance:a&&Object(V.b)(e,a,o),horizontalDistance:n&&Object(V.b)(e,n,o),verticalDistance:r&&Object(V.b)(e,r,o)})}}},{key:"_updateSegmentStripeLength",value:function(){var e=this._measurementArrowStripeLength,t=this._segmentVisualElement;Object(b.k)(e)?(t.stripeLength=e,t.stripesEnabled=!0):t.stripesEnabled=!1}},{key:"_computeViewMode",value:function(e){if(2===e){if(!this._geodesicDistanceExceeded)return 1;if(this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition))return 3}var t=this.layerView.result;if(Object(b.j)(t))return 1;var i=t.verticalDistance,n=t.horizontalDistance,r=i.value,a=n.value;return Math.min(r/a,a/r)<this.triangleCollapseRatioThreshold?1:2}},{key:"_getActualVisualElementsOrientation",value:function(){if(Object(b.k)(this._triangleOrientationOverride))return this._triangleOrientationOverride;var e=this.visualElementOrientation;return 0===e?this.view.state.camera.aboveGround?1:2:e}},{key:"_updateActualVisualizedMeasurement",value:function(){if(0===this.visualizedMeasurement){this.actualVisualizedMeasurement=1;var e=this.layerView.unit;"degrees"!==e&&"degrees-minutes-seconds"!==e||(this.actualVisualizedMeasurement=2),this._geodesicDistanceExceeded&&(this.actualVisualizedMeasurement=2)}else this.actualVisualizedMeasurement=this.visualizedMeasurement;return this.actualVisualizedMeasurement}},{key:"_requiresGeodesicGuideAt",value:function(e){var t=this.view;if(!t.state)return!1;var i=t.state.camera,n=t.renderCoordsHelper,r=i.computeScreenPixelSizeAt(e);return n.getAltitude(e)/r>=10}},{key:"_measurementArrowStripeLength",get:function(){var e=this.view,t=this.layerView,i=t.result,n=t.unit,r=null;if(Object(b.k)(i)){var a=i.directDistance;switch(n){case"metric":r=a&&a.toUnit("meters");break;case"imperial":r=a&&a.toUnit(Object(l.s)(a.value,a.unit));break;case"degrees":case"degrees-minutes-seconds":var s=i.geodesicAngle;r=s&&s.toUnit("degrees");break;default:r=a&&a.toUnit(n)}}if(r){var o=1;return o=Object(m.o)(r.value/30),o*="degrees"===r.unit?Object(T.e)(e.spatialReference).metersPerDegree:Object(l.c)(1,r.unit,"meters")}return null}},{key:"_updateMessageBundle",value:function(){var e=this;Object(xe.a)("esri/core/t9n/Units").then((function(t){e.messages=t,e.view&&e._updateLabelText()}))}}]),i}(g.a);Object(o.a)([Object(d.b)()],ke.prototype,"_state",void 0),Object(o.a)([Object(d.b)()],ke.prototype,"_segmentLabelDisplayedMeasurement",void 0),Object(o.a)([Object(d.b)()],ke.prototype,"_triangleOrientationOverride",void 0),Object(o.a)([Object(d.b)()],ke.prototype,"_geodesicDistanceExceeded",null),Object(o.a)([Object(d.b)()],ke.prototype,"messages",void 0),Object(o.a)([Object(d.b)()],ke.prototype,"view",void 0),Object(o.a)([Object(d.b)()],ke.prototype,"layer",void 0),Object(o.a)([Object(d.b)()],ke.prototype,"layerView",void 0),Object(o.a)([Object(d.b)({readOnly:!0})],ke.prototype,"ready",null),Object(o.a)([Object(d.b)({readOnly:!0})],ke.prototype,"visible",null),Object(o.a)([Object(d.b)()],ke.prototype,"viewMode",void 0),Object(o.a)([Object(d.b)()],ke.prototype,"visualizedMeasurement",void 0),Object(o.a)([Object(d.b)()],ke.prototype,"actualVisualizedMeasurement",void 0),Object(o.a)([Object(d.b)()],ke.prototype,"visualElementOrientation",void 0),Object(o.a)([Object(d.b)()],ke.prototype,"triangleCollapseRatioThreshold",void 0),Object(o.a)([Object(d.b)()],ke.prototype,"allowVisualElementsOrientationChange",null),Object(o.a)([Object(d.b)()],ke.prototype,"labels",null),Object(o.a)([Object(d.b)()],ke.prototype,"testData",null),Object(o.a)([Object(d.b)()],ke.prototype,"_measurementArrowStripeLength",null),ke=Object(o.a)([Object(f.a)("esri.views.3d.layers.DirectLineMeasurement.DirectLineMeasurementView")],ke);var Se=Object(G.c)(1,.5,0,.75),Me={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:.75,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,triangleColor:Se,triangleLineWidth:3,triangleCornerSize:32,triangleSubdivisions:128,arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:Se,guideLineWidth:2,guideLineColor:Se,guideStippleLengthPixels:6,labelDistance:25,direcLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12},Te=Math.cos(Object(m.g)(12)),Re=Object(F.e)(),Pe=Object(F.e)(),Ce=Object(F.d)(),De=Object(F.d)(),Ee=Object(F.d)(),Le=i(611),ze=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e))._userUnit=null,r.type="direct-line-measurement-3d",r.result=null,r}return Object(r.a)(i,[{key:"unit",get:function(){return Object(b.s)(this._userUnit,this._defaultUnit)},set:function(e){this._userUnit=e}},{key:"viewMode",get:function(){return this._analysisView.viewMode}},{key:"visualizedMeasurement",get:function(){return this._analysisView.visualizedMeasurement},set:function(e){this._analysisView.visualizedMeasurement=e}},{key:"actualVisualizedMeasurement",get:function(){return this._analysisView.actualVisualizedMeasurement}},{key:"visualElementOrientation",get:function(){return this._analysisView.visualElementOrientation},set:function(e){this._analysisView.visualElementOrientation=e}},{key:"allowVisualElementsOrientationChange",get:function(){return this._analysisView.allowVisualElementsOrientationChange},set:function(e){this._analysisView.allowVisualElementsOrientationChange=e}},{key:"triangleCollapseRatioThreshold",get:function(){return this._analysisView.triangleCollapseRatioThreshold},set:function(e){this._analysisView.triangleCollapseRatioThreshold=e}},{key:"directLabelText",get:function(){return this._analysisView.labels.direct.text}},{key:"horizontalLabelText",get:function(){return this._analysisView.labels.horizontal.text}},{key:"verticalLabelText",get:function(){return this._analysisView.labels.vertical.text}},{key:"testData",get:function(){return this._analysisView.testData}},{key:"initialize",value:function(){var e=this.view,t=this.layer;this._analysisView=new ke({view:e,layer:t,layerView:this}),this._analysisController=new C({view:e,layer:t,viewData:this})}},{key:"destroy",value:function(){Object(b.e)(this._analysisController),Object(b.e)(this._analysisView)}},{key:"whenReady",value:function(){return this._analysisView.whenReady()}},{key:"whenMessages",value:function(){return this._analysisView.whenMessages()}}]),i}(Object(p.a)(Le.a));Object(o.a)([Object(d.b)(v.a)],ze.prototype,"_defaultUnit",void 0),Object(o.a)([Object(d.b)()],ze.prototype,"_userUnit",void 0),Object(o.a)([Object(d.b)()],ze.prototype,"_analysisView",void 0),Object(o.a)([Object(d.b)()],ze.prototype,"_analysisController",void 0),Object(o.a)([Object(d.b)()],ze.prototype,"type",void 0),Object(o.a)([Object(d.b)()],ze.prototype,"unit",null),Object(o.a)([Object(d.b)()],ze.prototype,"layer",void 0),Object(o.a)([Object(d.b)()],ze.prototype,"result",void 0),Object(o.a)([Object(d.b)({readOnly:!0})],ze.prototype,"viewMode",null),Object(o.a)([Object(d.b)()],ze.prototype,"visualizedMeasurement",null),Object(o.a)([Object(d.b)({readOnly:!0})],ze.prototype,"actualVisualizedMeasurement",null),Object(o.a)([Object(d.b)()],ze.prototype,"visualElementOrientation",null),Object(o.a)([Object(d.b)()],ze.prototype,"allowVisualElementsOrientationChange",null),Object(o.a)([Object(d.b)()],ze.prototype,"triangleCollapseRatioThreshold",null),Object(o.a)([Object(d.b)({readOnly:!0})],ze.prototype,"directLabelText",null),Object(o.a)([Object(d.b)({readOnly:!0})],ze.prototype,"horizontalLabelText",null),Object(o.a)([Object(d.b)({readOnly:!0})],ze.prototype,"verticalLabelText",null),Object(o.a)([Object(d.b)()],ze.prototype,"testData",null);ze=Object(o.a)([Object(f.a)("esri.views.3d.layers.DirectLineMeasurementLayerView3D")],ze);var Ie=i(74),Ae=(i(90),i(738)),Ve=i(861),Fe=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e)).type="direct-line-measurement",r.geodesicDistanceThreshold=1e5,r.startPoint=null,r.endPoint=null,r}return i}(i(166).a);Object(o.a)([Object(d.b)({json:{read:!1},readOnly:!0})],Fe.prototype,"type",void 0),Object(o.a)([Object(d.b)()],Fe.prototype,"geodesicDistanceThreshold",void 0),Object(o.a)([Object(d.b)()],Fe.prototype,"startPoint",void 0),Object(o.a)([Object(d.b)()],Fe.prototype,"endPoint",void 0);var He=Fe=Object(o.a)([Object(f.a)("esri/layers/DirectLineMeasurementLayer")],Fe),Ge=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(){var e;return Object(n.a)(this,i),(e=t.apply(this,arguments))._handles=new O.a,e.layer=new He({visible:!1,listMode:"hide"}),e.cursorPoint=null,e.state="initial",e.active=!1,e}return Object(r.a)(i,[{key:"initialize",value:function(){this.sceneView.map.add(this.layer),this.reset()}},{key:"destroy",value:function(){this._handles=Object(b.e)(this._handles),this.sceneView.map.remove(this.layer),this.layer.destroy()}},{key:"startPoint",get:function(){return this.layer.startPoint},set:function(e){this.layer.startPoint=e}},{key:"startPointSurfaceLocation",set:function(e){this._set("startPointSurfaceLocation",e)}},{key:"endPoint",get:function(){return this.layer.endPoint},set:function(e){this.layer.endPoint=e}},{key:"endPointSurfaceLocation",set:function(e){this._set("endPointSurfaceLocation",e)}},{key:"measurementSurfaceLocation",get:function(){var e=this.startPointSurfaceLocation,t=this.endPointSurfaceLocation;return null==e||null==t||"above-the-surface"===e&&"below-the-surface"===t||"below-the-surface"===e&&"above-the-surface"===t||"on-the-surface"===e&&"on-the-surface"===t?"camera-dependent":"above-the-surface"===e||"above-the-surface"===t?"above-the-surface":"below-the-surface"}},{key:"validMeasurement",get:function(){return Object(b.k)(this.layer.startPoint)&&Object(b.k)(this.layer.endPoint)}},{key:"isMeasuring",get:function(){return!!this.startPoint}},{key:"reset",value:function(){this.clearMeasurement()}},{key:"clearMeasurement",value:function(){this.state="initial",this.startPoint=null,this.endPoint=null,this.cursorPoint=null,this._clearOverride("measurementSurfaceLocation")}},{key:"finishMeasurement",value:function(){if(!this._isOverridden("measurementSurfaceLocation")){var e=this.measurementSurfaceLocation,t="camera-dependent"===e?this.sceneView.state.camera.aboveGround?"above-the-surface":"below-the-surface":e;this._override("measurementSurfaceLocation",t)}this.state="measured"}}]),i}(g.a);Object(o.a)([Object(d.b)()],Ge.prototype,"messages",void 0),Object(o.a)([Object(d.b)({constructOnly:!0})],Ge.prototype,"sceneView",void 0),Object(o.a)([Object(d.b)()],Ge.prototype,"layer",void 0),Object(o.a)([Object(d.b)()],Ge.prototype,"startPoint",null),Object(o.a)([Object(d.b)({value:null})],Ge.prototype,"startPointSurfaceLocation",null),Object(o.a)([Object(d.b)()],Ge.prototype,"endPoint",null),Object(o.a)([Object(d.b)({value:null})],Ge.prototype,"endPointSurfaceLocation",null),Object(o.a)([Object(d.b)()],Ge.prototype,"measurementSurfaceLocation",null),Object(o.a)([Object(d.b)()],Ge.prototype,"cursorPoint",void 0),Object(o.a)([Object(d.b)()],Ge.prototype,"state",void 0),Object(o.a)([Object(d.b)()],Ge.prototype,"active",void 0),Object(o.a)([Object(d.b)({readOnly:!0})],Ge.prototype,"validMeasurement",null),Object(o.a)([Object(d.b)({readOnly:!0})],Ge.prototype,"isMeasuring",null),Ge=Object(o.a)([Object(f.a)("esri.views.3d.interactive.measurementTools.directLineMeasurement3D.DirectLineMeasurement3DModel")],Ge);var Ne,Ue,We=i(27),qe=i(693),Be=i(948),Ze=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Object(n.a)(this,e),this.type=t,this.scenePoint=i,this.mapPoint=r},Ye=i(787),Qe=i(873),Xe=i(854),Je=i(833),Ke={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:.75,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5};(Ue=Ne||(Ne={})).Manipulators="manipulators",Ue.AnalysisViewDestroyed="analysis-view-destroyed",Ue.AnalysisView="analysis-view";var $e=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e))._state="pending",r._visible=!1,r._laserLine=null,r._handles=new O.a,r._cursorPosition=Object(x.e)(),r._startPosition=Object(x.e)(),r._endPosition=Object(x.e)(),r._lastDraggedHandle=null,r.analysisView=null,r._view=e.model.sceneView,r._intersector=new Je.a(r._view.state.viewingMode),r._intersector.options.store=0,r}return Object(r.a)(i,[{key:"normalizeCtorArgs",value:function(e){return Object(A.a)(Object(A.a)({},e),{},{params:e.params?Object(Ye.a)(Ke,e.params):Object(Ye.a)(Ke,{})})}},{key:"initialize",value:function(){this._promise=this._initialize()}},{key:"_initialize",value:function(){var e=Object(I.a)(z.a.mark((function e(){var t,i;return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=this._state,e.next="pending"===e.t0?3:"destroyed"===e.t0?4:5;break;case 3:return e.abrupt("break",5);case 4:return e.abrupt("return",Promise.reject("DirectLineMeasurement3DView already destroyed"));case 5:return t=this.model.layer,e.next=8,this._view.whenLayerView(t);case 8:return i=e.sent,e.next=11,i.whenReady();case 11:return this._set("analysisView",i),this._laserLine=new Qe.a({view:this._view,attached:!0}),this._visible&&this._updateVisibility(this._visible),this._connectToAnalysisView(),this._state="ready",e.abrupt("return",i);case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){switch(this._state){case"pending":return void(this._state="destroyed");case"ready":break;case"destroyed":default:return}this.hide(),this._handles=Object(b.e)(this._handles),this._laserLine=Object(b.e)(this._laserLine),this._state="destroyed"}},{key:"when",value:function(){return this._promise.then((function(){}))}},{key:"whenMessages",value:function(){var e=Object(I.a)(z.a.mark((function e(){return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._promise.then((function(e){return e.whenMessages()})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"requiresCursorPoint",get:function(){return"initial"===this.model.state&&this.model.active}},{key:"visible",get:function(){return this._visible},set:function(e){e?this.show():this.hide()}},{key:"viewMode",get:function(){var e=this.analysisView;return Object(b.k)(e)&&!e.destroyed?e.viewMode:0}},{key:"measurementMode",get:function(){var e=this.analysisView;return Object(b.k)(e)&&!e.destroyed?e.actualVisualizedMeasurement:1}},{key:"unit",get:function(){return Object(b.s)(this._cachedUnit,this._defaultUnit)},set:function(e){this._cachedUnit=e}},{key:"testData",get:function(){var e=this._laserLine.testData,t=Object(b.r)(this.analysisView).testData;return{labels:null==t?void 0:t.labels,stripeLength:null==t?void 0:t.stripeLength,laserLineRenderer:{heightManifoldEnabled:!!Object(b.k)(e)&&e.heightManifoldEnabled,heightManifoldTarget:Object(b.k)(e)?e.heightManifoldTarget:null,pointDistanceEnabled:!!Object(b.k)(e)&&e.pointDistanceEnabled,pointDistanceOrigin:Object(b.k)(e)?e.pointDistanceOrigin:null,pointDistanceTarget:Object(b.k)(e)?e.pointDistanceTarget:null,lineVerticalPlaneEnabled:!!Object(b.k)(e)&&e.lineVerticalPlaneEnabled}}}},{key:"directLabelText",get:function(){var e=this.analysisView;return Object(b.k)(e)&&!e.destroyed?e.directLabelText:null}},{key:"horizontalLabelText",get:function(){var e=this.analysisView;return Object(b.k)(e)&&!e.destroyed?e.horizontalLabelText:null}},{key:"verticalLabelText",get:function(){var e=this.analysisView;return Object(b.k)(e)&&!e.destroyed?e.verticalLabelText:null}},{key:"createManipulators",value:function(){var e=this,t=function(){var t=Object(Be.a)(e._view,e.params.handleColor,e.params.handleOpacity);return t.available=!1,t.radius=e.params.handleRadius,t},i=t(),n=t();this.model.startPoint&&(i.location=Object(b.r)(this.model.startPoint),i.available=!0),this.model.endPoint&&(n.location=Object(b.r)(this.model.endPoint),n.available=!0);var r=function(){var t=e._lastDraggedHandle;i.grabbing&&!n.grabbing&&(t="start"),n.grabbing&&!i.grabbing&&(t="end"),i.grabbing||n.grabbing||(t=null);var r=t!==e._lastDraggedHandle;e._lastDraggedHandle=t,r&&e.visible&&e._updateLaserLine()},a=i.events.on("grab-changed",r),s=n.events.on("grab-changed",r);return this._handles.add([a,s],Ne.Manipulators),{start:i,end:n}}},{key:"show",value:function(){switch(this._state){case"ready":this._visible||this._updateVisibility(!0);break;case"pending":this._visible=!0;break;case"destroyed":default:return}}},{key:"hide",value:function(){switch(this._state){case"ready":this._visible&&this._updateVisibility(!1);break;case"pending":this._visible=!1;break;case"destroyed":default:return}}},{key:"finishMeasurement",value:function(){this.model.finishMeasurement()}},{key:"_connectToAnalysisView",value:function(){var e=this;this._handles.remove(Ne.AnalysisView),this._handles.add([Object(j.d)((function(){return Object(b.c)(e.analysisView,(function(e){return e.destroyed}))}),(function(t){t&&e._handles.remove(Ne.AnalysisView)})),Object(j.d)((function(){return["measured"===e.model.state,e.analysisView]}),(function(e){var t=Object(We.a)(e,2),i=t[0],n=t[1];Object(b.c)(n,(function(e){return e.allowVisualElementsOrientationChange=!i}))})),Object(j.a)((function(){return e._updateLaserLine()})),Object(j.a)((function(){return e._updateCursorPosition()})),Object(j.a)((function(){return e._updateStartPosition()})),Object(j.a)((function(){return e._updateEndPosition()})),Object(j.d)((function(){return{unit:e.unit,layerView:e.analysisView}}),(function(e){var t=e.unit,i=e.layerView;return Object(b.c)(i,(function(e){return e.unit=t}))}))],Ne.AnalysisView)}},{key:"_updateVisibility",value:function(e){this._visible=e,e?(this.model.layer.visible=!0,this._laserLine.style={innerColor:this.params.laserLineInnerColor,innerWidth:this.params.laserLineInnerWidth,glowColor:this.params.laserLineGlowColor,glowWidth:this.params.laserLineGlowWidth,glowFalloff:this.params.laserLineGlowFalloff,globalAlpha:this.params.laserLineGlobalAlpha},this._laserLine.visible=!0,this._updateCursorPosition(),this._updateStartPosition(),this._updateEndPosition(),this._updateLaserLine()):(this.model.layer.visible=!1,this._laserLine.visible=!1,this._view.cursor=null)}},{key:"pick",value:function(e){var t=this._view.spatialReference,i=Object(F.j)(e.screenPoint);this._view.sceneIntersectionHelper.intersectToolIntersectorScreen(i,this._intersector);var n=this._intersector.results.min,r=Object(x.e)();if(!n.getIntersectionPoint(r))return new Ze;var a=this._view.renderCoordsHelper.fromRenderCoords(r,t);if(Object(b.j)(a))return new Ze;var s="TerrainRenderer"===n.intersector?"ground":"feature";return new Ze(s,r,a)}},{key:"getElevation",value:function(e){return this._view.basemapTerrain.ready?Object(b.s)(Object(Xe.a)(this._view.elevationProvider,e),0):0}},{key:"overlappingHandles",value:function(e,t){return Object(Ye.c)(e,t,this._view)<=this.params.handleRadius}},{key:"_updateCursorPosition",value:function(){this.model.cursorPoint&&this._view.renderCoordsHelper.toRenderCoords(this.model.cursorPoint,this._cursorPosition)}},{key:"_updateStartPosition",value:function(){Object(b.k)(this.model.startPoint)&&this._view.renderCoordsHelper.toRenderCoords(this.model.startPoint,this._startPosition)}},{key:"_updateEndPosition",value:function(){Object(b.k)(this.model.endPoint)&&this._view.renderCoordsHelper.toRenderCoords(this.model.endPoint,this._endPosition)}},{key:"_getFocusPosition",value:function(){var e=this.model,t=this.analysisView,i=Object(b.k)(t)&&!t.destroyed&&1===t.visualizedMeasurement,n=1===this.viewMode&&i;switch(e.state){case"drawing":return n?this._startPosition:e.endPoint?this._endPosition:this._startPosition;case"editing":return n?"start"===this._lastDraggedHandle?this._endPosition:this._startPosition:"start"===this._lastDraggedHandle?this._startPosition:this._endPosition;default:return e.cursorPoint?this._cursorPosition:null}}},{key:"_getFocusSpherePosition",value:function(){return"drawing"===this.model.state||"end"===this._lastDraggedHandle?this._startPosition:this._endPosition}},{key:"_updateLaserLine",value:function(){if(this.visible){var e=this.model,t=e.state,i=e.active,n=e.startPoint,r=this._getFocusPosition(),a=this.viewMode,s=this.analysisView,o=this.params.laserLineEnabled&&!!r&&"measured"!==t&&i;if(o&&Object(b.k)(s)&&!s.destroyed){var c=1===s.actualVisualizedMeasurement;this._laserLine.heightManifoldTarget=c?r:null;var l=o&&!!n&&2===s.actualVisualizedMeasurement;this._laserLine.pointDistanceLine=l?{origin:this._getFocusSpherePosition(),target:r}:null;var u=o&&2===a;this._laserLine.lineVerticalPlaneSegment=u?Object(qe.f)(this._startPosition,this._endPosition,et):null}else this._laserLine.heightManifoldTarget=null,this._laserLine.pointDistanceLine=null,this._laserLine.lineVerticalPlaneSegment=null}}}]),i}(g.a);Object(o.a)([Object(d.b)()],$e.prototype,"_view",void 0),Object(o.a)([Object(d.b)()],$e.prototype,"_visible",void 0),Object(o.a)([Object(d.b)()],$e.prototype,"_laserLine",void 0),Object(o.a)([Object(d.b)()],$e.prototype,"params",void 0),Object(o.a)([Object(d.b)()],$e.prototype,"model",void 0),Object(o.a)([Object(d.b)({readOnly:!0})],$e.prototype,"analysisView",void 0),Object(o.a)([Object(d.b)()],$e.prototype,"requiresCursorPoint",null),Object(o.a)([Object(d.b)()],$e.prototype,"visible",null),Object(o.a)([Object(d.b)()],$e.prototype,"viewMode",null),Object(o.a)([Object(d.b)()],$e.prototype,"measurementMode",null),Object(o.a)([Object(d.b)()],$e.prototype,"unit",null),Object(o.a)([Object(d.b)()],$e.prototype,"_cachedUnit",void 0),Object(o.a)([Object(d.b)(v.a)],$e.prototype,"_defaultUnit",void 0),Object(o.a)([Object(d.b)()],$e.prototype,"testData",null),Object(o.a)([Object(d.b)()],$e.prototype,"directLabelText",null),Object(o.a)([Object(d.b)()],$e.prototype,"horizontalLabelText",null),Object(o.a)([Object(d.b)()],$e.prototype,"verticalLabelText",null),$e=Object(o.a)([Object(f.a)("esri.views.3d.interactive.measurementTools.directLineMeasurement3D.DirectLineMeasurement3DView")],$e);var et=Object(qe.d)(),tt=function e(){Object(n.a)(this,e)},it=i(732),nt=i(786),rt=i(132),at=i(55),st=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e))._handles=new O.a,r._cachedPickRequest=new tt,r._cachedPickResult=new Ze,r._isAnyPointerDown=!1,r.startManipulator=null,r.endManipulator=null,r.model=new Ge({sceneView:e.view}),r.measurementView=new $e({model:r.model}),r}return Object(r.a)(i,[{key:"initialize",value:function(){var e=this;this.measurementView.when().then((function(){return e._initialize()}))}},{key:"_initialize",value:function(){var e=this,t=this.measurementView.createManipulators(),i=t.start,n=t.end,r=function(t,i,n){return Object(it.b)(t,(function(t,r,a){var s=Object(Ve.a)(t);r.next(s).next(Object(Ve.b)(e.view)).next((function(e){return"start"!==e.action?e:null})).next((function(r){var a=Object(Ae.a)(r.mapEnd,new at.a);e.model[i]=a,t.location=a,e.model[n]=e._surfaceLocation(a,r.surfaceType)})),a.next(s).next(Object(it.d)(e.model,[i,n])).next((function(){t.location=Object(b.r)(e.model[i])}))}))};this._handles.add([r(i,"startPoint","startPointSurfaceLocation"),r(n,"endPoint","endPointSurfaceLocation")]),[i,n].forEach((function(t){e._handles.add([t.events.on("grab-changed",(function(){var t=i.grabbing||n.grabbing;t&&"measured"===e.model.state&&(e.model.state="editing"),t||(e.model.finishMeasurement(),"editing"===e.model.state&&(e.model.state="measured"))}))])})),this.manipulators.add(i),this.manipulators.add(n),this.startManipulator=i,this.endManipulator=n;var a=this.watch("state",(function(t){switch(t){case"measured":e.complete();break;case"measuring":case"ready":default:e.finishToolCreation()}}));this._handles.add(a),"measured"===this.state?this.complete():this.startToolCreation()}},{key:"destroy",value:function(){this.measurementView.destroy(),this._set("measurementView",null),this.model.destroy(),this._set("model",null),this._handles.destroy(),this._handles=null}},{key:"state",get:function(){var e;return null!=(e=this.model)&&e.isMeasuring?"measured"===this.model.state?"measured":"measuring":"ready"}},{key:"creating",get:function(){return"initial"===this.model.state||"drawing"===this.model.state}},{key:"isSupported",get:function(){return"3d"===this.get("view.type")}},{key:"cursor",get:function(){var e;return null==(e=this.model)||!e.active||"drawing"!==this.model.state&&"initial"!==this.model.state?null:"crosshair"}},{key:"unit",get:function(){return this.measurementView.unit},set:function(e){this.measurementView.unit=e}},{key:"validMeasurement",get:function(){return this.model.validMeasurement}},{key:"activate",value:function(){this.model.active=!0}},{key:"deactivate",value:function(){switch(this.toolState){case"created":case"creating":case"pending":this.model.active=!1}}},{key:"onDetach",value:function(){this.model.reset()}},{key:"onShow",value:function(){this.measurementView.show(),this.created&&this._updateManipulatorVisibility()}},{key:"onHide",value:function(){this.created&&this.measurementView.hide()}},{key:"onInputEvent",value:function(e){switch(e.type){case"immediate-click":this._handleImmediateClick(e);break;case"pointer-move":this._handlePointerMove(e);break;case"pointer-down":this._handlePointerDown();break;case"pointer-up":this._handlePointerUp()}this._updateManipulatorVisibility()}},{key:"_handlePointerMove",value:function(e){this._clearCachedPickRequest();var t=Object(rt.a)(e);"mouse"===e.pointerType&&(this._hoverAt(t),"drawing"===this.model.state&&(this.endManipulator.events.emit("drag",{action:"update",start:t,screenPoint:t}),e.stopPropagation()))}},{key:"_handlePointerDown",value:function(){this._isAnyPointerDown=!0}},{key:"_handlePointerUp",value:function(){this._isAnyPointerDown=!1}},{key:"_handleImmediateClick",value:function(e){if(this._clearCachedPickRequest(),function(e){return"mouse"!==e.pointerType||0===e.button}(e)){var t=Object(rt.a)(e),i=e.pointerType,n=!1;if(this.model.active)switch(this.model.state){case"initial":this.startManipulator.events.emit("drag",{action:"start",pointerType:i,start:t,screenPoint:t}),this.startManipulator.events.emit("drag",{action:"end",start:t,screenPoint:t}),this.model.startPoint&&(this.startManipulator.interactive=!1,this.endManipulator.interactive=!1,this.model.state="drawing",this.endManipulator.events.emit("drag",{action:"start",pointerType:i,start:t,screenPoint:t}),n=!0);break;case"drawing":this.endManipulator.events.emit("drag",{action:"update",start:t,screenPoint:t}),null!=this.model.endPoint&&(this.endManipulator.events.emit("drag",{action:"end",start:t,screenPoint:t}),this.startManipulator.interactive=!0,this.endManipulator.interactive=!0,this.model.finishMeasurement(),n=!0)}n&&e.stopPropagation(),"mouse"===e.pointerType&&this._hoverAt(t)}}},{key:"_hoverAt",value:function(e){var t=this._isAnyPointerDown&&"drawing"!==this.model.state&&"editing"!==this.model.state;if(this.measurementView.requiresCursorPoint&&!t){var i=this._pick(e);i.mapPoint&&(this.model.cursorPoint=i.mapPoint)}else this.model.cursorPoint=null}},{key:"_pick",value:function(e){var t=this._cachedPickRequest.screenPoint;return t&&t.x===e.x&&t.y===e.y||(this._cachedPickRequest.screenPoint=e,this._cachedPickResult=this.measurementView.pick(this._cachedPickRequest)),this._cachedPickResult}},{key:"_clearCachedPickRequest",value:function(){this._cachedPickRequest.screenPoint=null}},{key:"_surfaceLocation",value:function(e,t){return 0===t?"on-the-surface":e.z>=this.measurementView.getElevation(e)?"above-the-surface":"below-the-surface"}},{key:"_updateManipulatorVisibility",value:function(){this.startManipulator.available=null!=this.model.startPoint,this.endManipulator.available=null!=this.model.endPoint}}]),i}(nt.a);Object(o.a)([Object(d.b)({readOnly:!0})],st.prototype,"state",null),Object(o.a)([Object(d.b)({readOnly:!0})],st.prototype,"creating",null),Object(o.a)([Object(d.b)({readOnly:!0})],st.prototype,"isSupported",null),Object(o.a)([Object(d.b)({readOnly:!0})],st.prototype,"cursor",null),Object(o.a)([Object(d.b)({constructOnly:!0})],st.prototype,"model",void 0),Object(o.a)([Object(d.b)({constructOnly:!0})],st.prototype,"measurementView",void 0),Object(o.a)([Object(d.b)()],st.prototype,"unit",null),Object(o.a)([Object(d.b)({readOnly:!0})],st.prototype,"validMeasurement",null);var ot=st=Object(o.a)([Object(f.a)("esri.views.3d.interactive.measurementTools.directLineMeasurement3D.DirectLineMeasurement3DTool")],st),ct=i(857),lt=h.a.getLogger("esri.widgets.DirectLineMeasurement3D.DirectLineMeasurement3DViewModel"),ut=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e)).supportedViewType="3d",r._handles=new O.a,r._userUnitOptions=null,r._userUnit=null,r}return Object(r.a)(i,[{key:"initialize",value:function(){var e=this;this._handles.add([Object(_.a)(this,"unit",(function(t){e.tool&&(e.tool.unit=t)}))])}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null}},{key:"state",get:function(){return this.isDisabled?"disabled":this.tool?this.tool.state:"ready"}},{key:"measurement",get:function(){if(!this.tool)return null;var e={mode:"euclidean",directDistance:{text:null,state:"unavailable"},horizontalDistance:{text:null,state:"unavailable"},verticalDistance:{text:null,state:"unavailable"}},t=this.tool.measurementView.analysisView;if(Object(b.j)(t))return e;var i=t.actualVisualizedMeasurement,n=this.tool.measurementView,r=Object(b.k)(t.result)?"available":"unavailable";switch(i){case 1:return{mode:"euclidean",directDistance:{text:n.directLabelText,state:r},horizontalDistance:{text:n.horizontalLabelText,state:r},verticalDistance:{text:n.verticalLabelText,state:r}};case 2:return{mode:"geodesic",directDistance:{text:null,state:"unavailable"},horizontalDistance:{text:n.directLabelText,state:r},verticalDistance:{text:n.verticalLabelText,state:r}};default:return e}}},{key:"unitOptions",get:function(){return this._filteredOrAllUnits(this._userUnitOptions)},set:function(e){this._userUnitOptions=e,this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))}},{key:"unit",get:function(){return this._userUnit?(this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit),this._userUnit):this._findSelectableUnit(this.defaultUnit)},set:function(e){this._userUnit=e?this._findSelectableUnit(e,this._userUnit):null,this.notifyChange("unit")}},{key:"start",value:function(){return this.createTool()}},{key:"clear",value:function(){this.removeTool()}},{key:"createToolParams",value:function(){var e=this;return{toolConstructor:ot,constructorArguments:function(){return{unit:e.unit}}}}},{key:"logUnsupportedError",value:function(){lt.error("DirectLineMeasurement3D widget is not implemented for MapView")}},{key:"logError",value:function(){lt.error.apply(lt,arguments)}},{key:"_findSelectableUnit",value:function(e,t){var i=this.unitOptions;return-1!==i.indexOf(e)?e:t?this._findSelectableUnit(t):i[0]}},{key:"_filteredOrAllUnits",value:function(e){if(!e)return l.q.slice();var t=e.filter((function(e){return-1!==l.q.indexOf(e)}));return 0===t.length?l.q.slice():t}}]),i}(ct.a);Object(o.a)([Object(d.b)({readOnly:!0})],ut.prototype,"state",null),Object(o.a)([Object(d.b)({readOnly:!0})],ut.prototype,"measurement",null),Object(o.a)([Object(d.b)()],ut.prototype,"tool",void 0),Object(o.a)([Object(d.b)(v.a)],ut.prototype,"defaultUnit",void 0),Object(o.a)([Object(d.b)()],ut.prototype,"unitOptions",null),Object(o.a)([Object(d.b)()],ut.prototype,"unit",null);var ht=ut=Object(o.a)([Object(f.a)("esri.widgets.DirectLineMeasurement3D.DirectLineMeasurement3DViewModel")],ut),dt=i(108),ft=i(80),bt=i(17),vt=(i(51),"esri-direct-line-measurement-3d"),pt={buttonDisabled:"esri-button--disabled",base:"".concat(vt," esri-widget esri-widget--panel"),container:"".concat(vt,"__container"),hint:"".concat(vt,"__hint"),hintText:"".concat(vt,"__hint-text"),panelError:"".concat(vt,"__panel--error"),measurement:"".concat(vt,"__measurement"),measurementItem:"".concat(vt,"__measurement-item"),measurementItemDisabled:"".concat(vt,"__measurement-item--disabled"),measurementItemTitle:"".concat(vt,"__measurement-item-title"),measurementItemValue:"".concat(vt,"__measurement-item-value"),settings:"".concat(vt,"__settings"),units:"".concat(vt,"__units"),unitsLabel:"".concat(vt,"__units-label"),unitsSelect:"".concat(vt,"__units-select esri-select"),unitsSelectWrapper:"".concat(vt,"__units-select-wrapper"),actionSection:"".concat(vt,"__actions"),newMeasurementButton:"".concat(vt,"__clear-button esri-button esri-button--primary"),widgetIcon:"esri-icon-measure-line"},gt=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(e,r){var a;return Object(n.a)(this,i),(a=t.call(this,e,r)).view=null,a.visible=null,a.iconClass=pt.widgetIcon,a.label=void 0,a.messages=null,a.messagesUnits=null,a.viewModel=new ht,a.unitOptions=null,a.unit=null,a}return Object(r.a)(i,[{key:"render",value:function(){var e=this,t=this.viewModel,i=t.isSupported,n=t.active,r=t.state,a=t.measurement,s=t.unit,o="disabled"===r,c="ready"===r,u="measuring"===r||"measured"===r,h=this.messages,d=this.messagesUnits,f=n&&c?Object(bt.a)("section",{key:"esri-direct-line-measurement-3d__hint",class:pt.hint},Object(bt.a)("p",{class:pt.hintText},h.hint)):null,b=i?null:Object(bt.a)("section",{key:"esri-direct-line-measurement-3d__unsupported",class:pt.panelError},Object(bt.a)("p",null,h.unsupported)),v=function(t,i,n){switch(i.state){case"available":return Object(bt.a)("div",{key:"".concat(n,"-enabled"),class:pt.measurementItem},Object(bt.a)("span",{class:pt.measurementItemTitle},t),Object(bt.a)("span",{class:pt.measurementItemValue},i.text));case"unavailable":return Object(bt.a)("div",{key:"".concat(n,"-disabled"),class:e.classes(pt.measurementItem,pt.measurementItemDisabled)},Object(bt.a)("span",{class:pt.measurementItemTitle},t))}},p=u?Object(bt.a)("section",{key:"esri-direct-line-measurement-3d__measurement",class:pt.measurement},v(h.direct,a.directDistance,"direct"),v(h.horizontal,a.horizontalDistance,"horizontal"),v(h.vertical,a.verticalDistance,"vertical")):null,g="".concat(this.id,"__units"),O=Object(bt.a)("label",{class:pt.unitsLabel,for:g},h.unit),m=Object(bt.a)("div",{class:pt.unitsSelectWrapper},Object(bt.a)("select",{class:pt.unitsSelect,id:g,onchange:this._changeUnit,bind:this,value:s},this.viewModel.unitOptions.map((function(e){var t;return Object(bt.a)("option",{key:e,value:e},Object(l.l)(e)?d.systems[e]:null==(t=d.units[e])?void 0:t.pluralCapitalized)})))),y=Object(bt.a)("section",{key:"esri-direct-line-measurement-3d__units",class:pt.units},O,m),_=u?Object(bt.a)("div",{key:"settings",class:pt.settings},y):null,j=!i||n&&!u?null:Object(bt.a)("div",{class:pt.actionSection},Object(bt.a)("button",{disabled:o,class:this.classes(pt.newMeasurementButton,o&&pt.buttonDisabled),bind:this,onclick:this._newMeasurement,type:"button"},h.newMeasurement)),w=this.visible?Object(bt.a)("div",{class:pt.container},b,f,_,p,j):null;return Object(bt.a)("div",{key:this,class:pt.base,role:"presentation"},w)}},{key:"_newMeasurement",value:function(){Object(c.l)(this.viewModel.start())}},{key:"_changeUnit",value:function(e){var t=e.target,i=t.options[t.selectedIndex];i&&(this.unit=i.value)}}]),i}(Ie.a);Object(o.a)([Object(u.a)("viewModel.view")],gt.prototype,"view",void 0),Object(o.a)([Object(u.a)("viewModel.visible")],gt.prototype,"visible",void 0),Object(o.a)([Object(u.a)("viewModel.active")],gt.prototype,"active",void 0),Object(o.a)([Object(d.b)()],gt.prototype,"iconClass",void 0),Object(o.a)([Object(d.b)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],gt.prototype,"label",void 0),Object(o.a)([Object(d.b)()],gt.prototype,"localeStrings",void 0),Object(o.a)([Object(d.b)(),Object(ft.a)("esri/widgets/DirectLineMeasurement3D/t9n/DirectLineMeasurement3D")],gt.prototype,"messages",void 0),Object(o.a)([Object(d.b)(),Object(ft.a)("esri/core/t9n/Units")],gt.prototype,"messagesUnits",void 0),Object(o.a)([Object(d.b)({type:ht})],gt.prototype,"viewModel",void 0),Object(o.a)([Object(u.a)("viewModel.unitOptions")],gt.prototype,"unitOptions",void 0),Object(o.a)([Object(u.a)("viewModel.unit")],gt.prototype,"unit",void 0),Object(o.a)([Object(dt.a)()],gt.prototype,"_newMeasurement",null),Object(o.a)([Object(dt.a)()],gt.prototype,"_changeUnit",null);var Ot=gt=Object(o.a)([Object(f.a)("esri.widgets.DirectLineMeasurement3D")],gt);t.default=Ot},611:function(e,t,i){"use strict";var n=i(4),r=i(5),a=i(6),s=i(7),o=i(0),c=i(36),l=i(112),u=i(113),h=i(295),d=i(12),f=i(167),b=i(1),v=(i(13),i(16),i(9)),p=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e)).layer=null,r.parent=null,r}return Object(r.a)(i,[{key:"initialize",value:function(){var e=this;this.when().catch((function(t){if("layerview:create-error"!==t.name){var i=e.layer&&e.layer.id||"no id",n=e.layer&&e.layer.title||"no title";throw d.a.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '".concat(n,"', id: '").concat(i,"')"),t),t}}))}},{key:"fullOpacity",get:function(){var e=function(e){return null==e?1:e};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))}},{key:"suspended",get:function(){return!this.canResume()}},{key:"suspendInfo",get:function(){return this.getSuspendInfo()}},{key:"legendEnabled",get:function(){return!this.suspended&&!0===this.layer.legendEnabled}},{key:"updating",get:function(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}},{key:"updatingProgress",get:function(){return this.updating?0:1}},{key:"visible",get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}},{key:"canResume",value:function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}},{key:"getSuspendInfo",value:function(){var e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}},{key:"isUpdating",value:function(){return!1}}]),i}(Object(u.b)(Object(h.a)(Object(f.b)(l.a.EventedMixin(c.a)))));Object(o.a)([Object(b.b)()],p.prototype,"fullOpacity",null),Object(o.a)([Object(b.b)()],p.prototype,"layer",void 0),Object(o.a)([Object(b.b)()],p.prototype,"parent",void 0),Object(o.a)([Object(b.b)({readOnly:!0})],p.prototype,"suspended",null),Object(o.a)([Object(b.b)({readOnly:!0})],p.prototype,"suspendInfo",null),Object(o.a)([Object(b.b)({readOnly:!0})],p.prototype,"legendEnabled",null),Object(o.a)([Object(b.b)({type:Boolean,readOnly:!0})],p.prototype,"updating",null),Object(o.a)([Object(b.b)({readOnly:!0})],p.prototype,"updatingProgress",null),Object(o.a)([Object(b.b)()],p.prototype,"visible",null);var g=p=Object(o.a)([Object(v.a)("esri.views.layers.LayerView")],p);t.a=g},650:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n,r,a={exports:{}};n=a,void 0!==(r=function(){function e(e,i,r){r=r||2;var a,s,o,l,u,h,d,f=i&&i.length,b=f?i[0]*r:e.length,v=t(e,0,b,r,!0),p=[];if(!v||v.next===v.prev)return p;if(f&&(v=c(e,i,v,r)),e.length>80*r){a=o=e[0],s=l=e[1];for(var g=r;g<b;g+=r)(u=e[g])<a&&(a=u),(h=e[g+1])<s&&(s=h),u>o&&(o=u),h>l&&(l=h);d=0!==(d=Math.max(o-a,l-s))?1/d:0}return n(v,p,r,a,s,d),p}function t(e,t,i,n,r){var a,s;if(r===M(e,t,i,n)>0)for(a=t;a<i;a+=n)s=x(a,e[a],e[a+1],s);else for(a=i-n;a>=t;a-=n)s=x(a,e[a],e[a+1],s);return s&&O(s,s.next)&&(k(s),s=s.next),s}function i(e,t){if(!e)return e;t||(t=e);var i,n=e;do{if(i=!1,n.steiner||!O(n,n.next)&&0!==g(n.prev,n,n.next))n=n.next;else{if(k(n),(n=t=n.prev)===n.next)break;i=!0}}while(i||n!==t);return t}function n(e,t,c,l,u,h,f){if(e){!f&&h&&d(e,l,u,h);for(var b,v,p=e;e.prev!==e.next;)if(b=e.prev,v=e.next,h?a(e,l,u,h):r(e))t.push(b.i/c),t.push(e.i/c),t.push(v.i/c),k(e),e=v.next,p=v.next;else if((e=v)===p){f?1===f?n(e=s(i(e),t,c),t,c,l,u,h,2):2===f&&o(e,t,c,l,u,h):n(i(e),t,c,l,u,h,1);break}}}function r(e){var t=e.prev,i=e,n=e.next;if(g(t,i,n)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(v(t.x,t.y,i.x,i.y,n.x,n.y,r.x,r.y)&&g(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function a(e,t,i,n){var r=e.prev,a=e,s=e.next;if(g(r,a,s)>=0)return!1;for(var o=r.x<a.x?r.x<s.x?r.x:s.x:a.x<s.x?a.x:s.x,c=r.y<a.y?r.y<s.y?r.y:s.y:a.y<s.y?a.y:s.y,l=r.x>a.x?r.x>s.x?r.x:s.x:a.x>s.x?a.x:s.x,u=r.y>a.y?r.y>s.y?r.y:s.y:a.y>s.y?a.y:s.y,h=f(o,c,t,i,n),d=f(l,u,t,i,n),b=e.prevZ,p=e.nextZ;b&&b.z>=h&&p&&p.z<=d;){if(b!==e.prev&&b!==e.next&&v(r.x,r.y,a.x,a.y,s.x,s.y,b.x,b.y)&&g(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,p!==e.prev&&p!==e.next&&v(r.x,r.y,a.x,a.y,s.x,s.y,p.x,p.y)&&g(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;b&&b.z>=h;){if(b!==e.prev&&b!==e.next&&v(r.x,r.y,a.x,a.y,s.x,s.y,b.x,b.y)&&g(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&v(r.x,r.y,a.x,a.y,s.x,s.y,p.x,p.y)&&g(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function s(e,t,n){var r=e;do{var a=r.prev,s=r.next.next;!O(a,s)&&m(a,r,r.next,s)&&j(a,s)&&j(s,a)&&(t.push(a.i/n),t.push(r.i/n),t.push(s.i/n),k(r),k(r.next),r=e=s),r=r.next}while(r!==e);return i(r)}function o(e,t,r,a,s,o){var c=e;do{for(var l=c.next.next;l!==c.prev;){if(c.i!==l.i&&p(c,l)){var u=w(c,l);return c=i(c,c.next),u=i(u,u.next),n(c,t,r,a,s,o),void n(u,t,r,a,s,o)}l=l.next}c=c.next}while(c!==e)}function c(e,n,r,a){var s,o,c,h=[];for(s=0,o=n.length;s<o;s++)(c=t(e,n[s]*a,s<o-1?n[s+1]*a:e.length,a,!1))===c.next&&(c.steiner=!0),h.push(b(c));for(h.sort(l),s=0;s<h.length;s++)u(h[s],r),r=i(r,r.next);return r}function l(e,t){return e.x-t.x}function u(e,t){if(t=function(e,t){var i,n=t,r=e.x,a=e.y,s=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var o=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=r&&o>s){if(s=o,o===r){if(a===n.y)return n;if(a===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!i)return null;if(r===s)return i;var c,l=i,u=i.x,d=i.y,f=1/0;n=i;do{r>=n.x&&n.x>=u&&r!==n.x&&v(a<d?r:s,a,u,d,a<d?s:r,a,n.x,n.y)&&(c=Math.abs(a-n.y)/(r-n.x),j(n,e)&&(c<f||c===f&&(n.x>i.x||n.x===i.x&&h(i,n)))&&(i=n,f=c)),n=n.next}while(n!==l);return i}(e,t)){var n=w(t,e);i(t,t.next),i(n,n.next)}}function h(e,t){return g(e.prev,e,t.prev)<0&&g(t.next,e,e.next)<0}function d(e,t,i,n){var r=e;do{if(null===r.z&&(r.z=f(r.x,r.y,t,i,n)),r.prev.next!==r||r.next.prev!==r)return r.prev.next=r,r.next.prev=r,d(e,t,i,n);r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,i,n,r,a,s,o,c,l=1;do{for(i=e,e=null,a=null,s=0;i;){for(s++,n=i,o=0,t=0;t<l&&(o++,n=n.nextZ);t++);for(c=l;o>0||c>0&&n;)0!==o&&(0===c||!n||i.z<=n.z)?(r=i,i=i.nextZ,o--):(r=n,n=n.nextZ,c--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;i=n}a.nextZ=null,l*=2}while(s>1)}(r)}function f(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function b(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function v(e,t,i,n,r,a,s,o){return(r-s)*(t-o)-(e-s)*(a-o)>=0&&(e-s)*(n-o)-(i-s)*(t-o)>=0&&(i-s)*(a-o)-(r-s)*(n-o)>=0}function p(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&m(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(j(e,t)&&j(t,e)&&function(e,t){var i=e,n=!1,r=(e.x+t.x)/2,a=(e.y+t.y)/2;do{i.y>a!=i.next.y>a&&i.next.y!==i.y&&r<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(g(e.prev,e,t.prev)||g(e,t.prev,t))||O(e,t)&&g(e.prev,e,e.next)>0&&g(t.prev,t,t.next)>0)}function g(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function O(e,t){return e.x===t.x&&e.y===t.y}function m(e,t,i,n){var r=_(g(e,t,i)),a=_(g(e,t,n)),s=_(g(i,n,e)),o=_(g(i,n,t));return r!==a&&s!==o||!(0!==r||!y(e,i,t))||!(0!==a||!y(e,n,t))||!(0!==s||!y(i,e,n))||!(0!==o||!y(i,t,n))}function y(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function _(e){return e>0?1:e<0?-1:0}function j(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function w(e,t){var i=new S(e.i,e.x,e.y),n=new S(t.i,t.x,t.y),r=e.next,a=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,a.next=n,n.prev=a,n}function x(e,t,i,n){var r=new S(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function k(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function S(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function M(e,t,i,n){for(var r=0,a=t,s=i-n;a<i;a+=n)r+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return r}return e.deviation=function(e,t,i,n){var r=t&&t.length,a=r?t[0]*i:e.length,s=Math.abs(M(e,0,a,i));if(r)for(var o=0,c=t.length;o<c;o++){var l=t[o]*i,u=o<c-1?t[o+1]*i:e.length;s-=Math.abs(M(e,l,u,i))}var h=0;for(o=0;o<n.length;o+=3){var d=n[o]*i,f=n[o+1]*i,b=n[o+2]*i;h+=Math.abs((e[d]-e[b])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[b+1]-e[d+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},e.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},n=0,r=0;r<e.length;r++){for(var a=0;a<e[r].length;a++)for(var s=0;s<t;s++)i.vertices.push(e[r][a][s]);r>0&&(n+=e[r-1].length,i.holes.push(n))}return i},e}())&&(n.exports=r);var s=a.exports},696:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return l}));var n,r=i(598),a=i(729),s=i(597);function o(e){e.fragment.include(a.a),e.fragment.uniforms.add("uShadowMapTex","sampler2D"),e.fragment.uniforms.add("uShadowMapNum","int"),e.fragment.uniforms.add("uShadowMapDistance","vec4"),e.fragment.uniforms.add("uShadowMapMatrix","mat4",4),e.fragment.uniforms.add("uDepthHalfPixelSz","float"),e.fragment.code.add(Object(s.a)(n||(n=Object(r.a)(["int chooseCascade(float _linearDepth, out mat4 mat) {\nvec4 distance = uShadowMapDistance;\nfloat depth = _linearDepth;\nint i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\nmat = i == 0 ? uShadowMapMatrix[0] : i == 1 ? uShadowMapMatrix[1] : i == 2 ? uShadowMapMatrix[2] : uShadowMapMatrix[3];\nreturn i;\n}\nvec3 lightSpacePosition(vec3 _vpos, mat4 mat) {\nvec4 lv = mat * vec4(_vpos, 1.0);\nlv.xy /= lv.w;\nreturn 0.5 * lv.xyz + vec3(0.5);\n}\nvec2 cascadeCoordinates(int i, vec3 lvpos) {\nreturn vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n}\nfloat readShadowMapDepth(vec2 uv, sampler2D _depthTex) {\nreturn rgba2float(texture2D(_depthTex, uv));\n}\nfloat posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {\nreturn readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;\n}\nfloat filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {\nfloat texSize = 0.5 / halfPixelSize;\nvec2 st = fract((vec2(halfPixelSize) + uv) * texSize);\nfloat s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);\nfloat s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);\nfloat s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);\nfloat s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);\nreturn mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n}\nfloat readShadowMap(const in vec3 _vpos, float _linearDepth) {\nmat4 mat;\nint i = chooseCascade(_linearDepth, mat);\nif (i >= uShadowMapNum) { return 0.0; }\nvec3 lvpos = lightSpacePosition(_vpos, mat);\nif (lvpos.z >= 1.0) { return 0.0; }\nif (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }\nvec2 uv = cascadeCoordinates(i, lvpos);\nreturn filterShadow(uv, lvpos, uDepthHalfPixelSz, uShadowMapTex);\n}"]))))}function c(e,t){t.shadowMappingEnabled&&(t.shadowMap.bind(e),t.shadowMap.bindView(e,t.origin))}function l(e,t,i){t.shadowMappingEnabled&&t.shadowMap.bindView(e,i)}},741:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var n,r,a,s=i(598),o=i(597);function c(e,t){0===t.output&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(Object(o.a)(n||(n=Object(s.a)(["void forwardLinearDepth() { linearDepth = gl_Position.w; }"]))))):1===t.output||3===t.output?(e.varyings.add("linearDepth","float"),e.vertex.uniforms.add("cameraNearFar","vec2"),e.vertex.code.add(Object(o.a)(r||(r=Object(s.a)(["void forwardLinearDepth() {\nlinearDepth = (-position_view().z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);\n}"]))))):e.vertex.code.add(Object(o.a)(a||(a=Object(s.a)(["void forwardLinearDepth() {}"]))))}},746:function(e,t,i){"use strict";i.d(t,"a",(function(){return _}));var n,r,a,s=i(598),o=i(597);function c(e){var t=e.fragment.code;t.add(Object(o.a)(n||(n=Object(s.a)(["vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n{\nreturn ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n}"])))),t.add(Object(o.a)(r||(r=Object(s.a)(["float integratedRadiance(float cosTheta2, float roughness)\n{\nreturn (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n}"])))),t.add(Object(o.a)(a||(a=Object(s.a)(["vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n{\nfloat cosTheta2 = 1.0 - RdotNG * RdotNG;\nfloat intRadTheta = integratedRadiance(cosTheta2, roughness);\nfloat ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\nfloat sky = 2.0 - ground;\nreturn (ground * ambientGround + sky * ambientSky) * 0.5;\n}"]))))}var l,u,h,d,f,b,v,p,g,O,m,y=i(782);function _(e,t){var i=e.fragment.code;e.include(y.a),3===t.pbrMode||4===t.pbrMode?(i.add(Object(o.a)(l||(l=Object(s.a)(["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent = ",";\n    "])),t.useCustomDTRExponentForWater?"2.2":"2.0")),i.add(Object(o.a)(u||(u=Object(s.a)(["vec3 fresnelReflection(float angle, vec3 f0, float f90) {\nreturn f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n}"])))),i.add(Object(o.a)(h||(h=Object(s.a)(["float normalDistributionWater(float NdotH, float roughness)\n{\nfloat r2 = roughness * roughness;\nfloat NdotH2 = NdotH * NdotH;\nfloat denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\nreturn r2 / denom;\n}"])))),i.add(Object(o.a)(d||(d=Object(s.a)(["float geometricOcclusionKelemen(float LoH)\n{\nreturn 0.25 / (LoH * LoH);\n}"])))),i.add(Object(o.a)(f||(f=Object(s.a)(["vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n{\nvec3  F = fresnelReflection(props.VdotH, F0, F0Max);\nfloat dSun = normalDistributionWater(props.NdotH, roughness);\nfloat V = geometricOcclusionKelemen(props.LdotH);\nfloat diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);\nfloat strengthSunHaze  = 1.2;\nfloat dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;\nreturn ((dSun + dSunHaze) * V) * F;\n}\nvec3 tonemapACES(const vec3 x) {\nreturn (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n}"]))))):1!==t.pbrMode&&2!==t.pbrMode||(e.include(c),i.add(Object(o.a)(b||(b=Object(s.a)(["struct PBRShadingInfo\n{\nfloat NdotL;\nfloat NdotV;\nfloat NdotH;\nfloat VdotH;\nfloat LdotH;\nfloat NdotNG;\nfloat RdotNG;\nfloat NdotAmbDir;\nfloat NdotH_Horizon;\nvec3 skyRadianceToSurface;\nvec3 groundRadianceToSurface;\nvec3 skyIrradianceToSurface;\nvec3 groundIrradianceToSurface;\nfloat averageAmbientRadiance;\nfloat ssao;\nvec3 albedoLinear;\nvec3 f0;\nvec3 f90;\nvec3 diffuseColor;\nfloat metalness;\nfloat roughness;\n};"])))),i.add(Object(o.a)(v||(v=Object(s.a)(["float normalDistribution(float NdotH, float roughness)\n{\nfloat a = NdotH * roughness;\nfloat b = roughness / (1.0 - NdotH * NdotH + a * a);\nreturn b * b * INV_PI;\n}"])))),i.add(Object(o.a)(p||(p=Object(s.a)(["const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);\nconst vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);\nconst vec2 c2 = vec2(-1.04, 1.04);\nvec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\nreturn c2 * a004 + r.zw;\n}"])))),i.add(Object(o.a)(g||(g=Object(s.a)(["vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\nvec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\nvec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\nvec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;\nvec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\nvec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;\nvec3 specularComponent = specularColor * indirectSpecular;\nreturn (diffuseComponent + specularComponent);\n}"])))),i.add(Object(o.a)(O||(O=Object(s.a)(["float gamutMapChanel(float x, vec2 p){\nreturn (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n}"])))),i.add(Object(o.a)(m||(m=Object(s.a)(["vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\nvec3 outColor;\nvec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\noutColor.x = gamutMapChanel(inColor.x, p) ;\noutColor.y = gamutMapChanel(inColor.y, p) ;\noutColor.z = gamutMapChanel(inColor.z, p) ;\nreturn outColor;\n}"])))))}},760:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var n=i(66);function r(e,t,i){var r,l=e.byteLength/(4*t),u=new Uint32Array(e,0,l*t),h=new Uint32Array(l),d=null!=(r=null==i?void 0:i.minReduction)?r:0,f=(null==i?void 0:i.originalIndices)||null,b=f?f.length:0,v=(null==i?void 0:i.componentOffsets)||null,p=0;if(v)for(var g=0;g<v.length-1;g++){var O=v[g+1]-v[g];O>p&&(p=O)}else p=l;var m=Math.floor(1.1*p)+1;(null==c||c.length<2*m)&&(c=new Uint32Array(Object(n.p)(2*m)));for(var y=0;y<2*m;y++)c[y]=0;for(var _=0,j=!!v&&!!f,w=j?b:l,x=j?new Uint32Array(b):null,k=1.96,S=0!==d?Math.ceil(4*k*k/(d*d)*d*(1-d)):w,M=1,T=v?v[1]:w,R=0;R<w;R++){if(R===S){var P=1-_/R;if(P+k*Math.sqrt(P*(1-P)/R)<d)return null;S*=2}if(R===T){for(var C=0;C<2*m;C++)c[C]=0;if(f)for(var D=v[M-1];D<v[M];D++)x[D]=h[f[D]];T=v[++M]}for(var E=j?f[R]:R,L=E*t,z=o(u,L,t),I=z%m,A=_;0!==c[2*I+1];){if(c[2*I]===z){var V=c[2*I+1]-1;if(a(u,L,V*t,t)){A=h[V];break}}++I>=m&&(I-=m)}A===_&&(c[2*I]=z,c[2*I+1]=E+1,_++),h[E]=A}if(0!==d&&1-_/l<d)return null;if(j){for(var F=v[M-1];F<x.length;F++)x[F]=h[f[F]];h=x}var H=new Uint32Array(t*_);_=0;for(var G=0;G<w;G++)h[G]===_&&(s(u,(j?f[G]:G)*t,H,_*t,t),_++);if(f&&!j){for(var N=new Uint32Array(b),U=0;U<N.length;U++)N[U]=h[f[U]];h=N}return{buffer:H.buffer,indices:h,uniqueCount:_}}function a(e,t,i,n){for(var r=0;r<n;r++)if(e[t+r]!==e[i+r])return!1;return!0}function s(e,t,i,n,r){for(var a=0;a<r;a++)i[n+a]=e[t+a]}function o(e,t,i){for(var n=0,r=0;r<i;r++)n=(n=e[t+r]+n|0)+(n<<11)+(n>>>2)|0;return n>>>0}var c=null},766:function(e,t,i){"use strict";var n=i(4),r=i(5),a=i(12),s=i(66),o=i(10),c=i(38),l=i(236),u=i(603),h=i(50),d=i(91),f=i(54),b=i(85),v=i(443),p=i(463),g=i(781),O=i(647),m=i(736),y=i(365),_=a.a.getLogger("esri.views.3d.webgl-engine.lib.Camera"),j=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Object(n.a)(this,e),this._viewUp=Object(b.e)(),this._viewForward=Object(b.e)(),this._viewRight=Object(b.e)(),this._ray=Object(O.c)(),this._viewport=Object(p.g)(0,0,1,1),this._padding=Object(p.g)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Object(d.e)(1,1e3),this._viewDirty=!0,this._viewMatrix=Object(u.d)(),this._projectionDirty=!0,this._projectionMatrix=Object(u.d)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Object(u.d)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Object(u.d)(),this._frustumDirty=!0,this._frustum=Object(g.b)(),this._fullViewport=Object(p.e)(),this.pixelRatio=1,this.relativeElevation=0,Object(o.k)(t)&&Object(f.h)(this._ray.origin,t),this._center=Object(o.k)(i)?Object(b.c)(i):Object(b.e)(),this._up=Object(o.k)(r)?Object(b.c)(r):Object(b.g)(0,0,1)}return Object(r.a)(e,[{key:"eye",get:function(){return this._ray.origin},set:function(e){this._compareAndSetView(e,this._ray.origin)}},{key:"center",get:function(){return this._center},set:function(e){this._compareAndSetView(e,this._center)}},{key:"ray",get:function(){return Object(f.g)(this._ray.direction,this.center,this.eye),this._ray}},{key:"up",get:function(){return this._up},set:function(e){this._compareAndSetView(e,this._up)}},{key:"viewMatrix",get:function(){return this._ensureViewClean(),this._viewMatrix},set:function(e){Object(l.d)(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"viewForward",get:function(){return this._ensureViewClean(),this._viewForward}},{key:"viewUp",get:function(){return this._ensureViewClean(),this._viewUp}},{key:"viewRight",get:function(){return this._ensureViewClean(),this._viewRight}},{key:"nearFar",get:function(){return this._nearFar}},{key:"near",get:function(){return this._nearFar[0]},set:function(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"far",get:function(){return this._nearFar[1]},set:function(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"viewport",get:function(){return this._viewport},set:function(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}},{key:"x",get:function(){return this._viewport[0]},set:function(e){e+=this._padding[3],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"y",get:function(){return this._viewport[1]},set:function(e){e+=this._padding[2],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"width",get:function(){return this._viewport[2]},set:function(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"height",get:function(){return this._viewport[3]},set:function(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"fullWidth",get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(e){this.width=e-(this._padding[1]+this._padding[3])}},{key:"fullHeight",get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(e){this.height=e-(this._padding[0]+this._padding[2])}},{key:"fullViewport",get:function(){return this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}},{key:"aspect",get:function(){return this.width/this.height}},{key:"padding",get:function(){return this._padding},set:function(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),Object(v.c)(this._padding,e),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"viewProjectionMatrix",get:function(){return this._viewProjectionDirty&&(Object(l.m)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}},{key:"projectionMatrix",get:function(){if(this._projectionDirty){var e=this.width,t=this.height,i=this.near*Math.tan(this.fovY/2),n=i*this.aspect;Object(l.k)(this._projectionMatrix,-n*(1+2*this._padding[3]/e),n*(1+2*this._padding[1]/e),-i*(1+2*this._padding[2]/t),i*(1+2*this._padding[0]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix},set:function(e){Object(l.d)(this._projectionMatrix,e),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fov",get:function(){return this._fov},set:function(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fovX",get:function(){return Object(y.b)(this._fov,this.width,this.height)},set:function(e){this._fov=Object(y.d)(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fovY",get:function(){return Object(y.c)(this._fov,this.width,this.height)},set:function(e){this._fov=Object(y.e)(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"distance",get:function(){return Object(f.j)(this._center,this.eye)}},{key:"frustum",get:function(){return this._recomputeFrustum(),this._frustum}},{key:"viewInverseTransposeMatrix",get:function(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Object(l.a)(this._viewInverseTransposeMatrix,this.viewMatrix),Object(l.e)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}},{key:"depthNDCToWorld",value:function(e){var t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}},{key:"perRenderPixelRatio",get:function(){return Math.tan(this.fovX/2)/(this.width/2)}},{key:"perScreenPixelRatio",get:function(){return this.perRenderPixelRatio*this.pixelRatio}},{key:"aboveGround",get:function(){return this.relativeElevation&&this.relativeElevation>=0}},{key:"copyFrom",value:function(e){Object(f.h)(this._ray.origin,e.eye),Object(f.h)(this._center,e.center),Object(f.h)(this._up,e.up),Object(v.c)(this._viewport,e.viewport),Object(v.c)(this._padding,e.padding),Object(h.c)(this._nearFar,e.nearFar),this._fov=e.fov,this.relativeElevation=e.relativeElevation;var t=e;return this._viewDirty=t._viewDirty,this._viewDirty||(Object(l.d)(this._viewMatrix,e.viewMatrix),Object(f.h)(this._viewRight,e.viewRight),Object(f.h)(this._viewUp,e.viewUp),Object(f.h)(this._viewForward,e.viewForward)),t._projectionDirty?this._projectionDirty=!0:(Object(l.d)(this._projectionMatrix,e.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||(Object(g.a)(e.frustum,this._frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Object(l.d)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Object(v.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}},{key:"copyViewFrom",value:function(e){this.eye=e.eye,this.center=e.center,this.up=e.up}},{key:"clone",value:function(){return(new e).copyFrom(this)}},{key:"equals",value:function(e){return Object(f.l)(this.eye,e.eye)&&Object(f.l)(this._center,e.center)&&Object(f.l)(this._up,e.up)&&Object(v.g)(this._viewport,e.viewport)&&Object(v.g)(this._padding,e.padding)&&Object(h.k)(this._nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}},{key:"almostEquals",value:function(e){if(this.pixelRatio!==e.pixelRatio||Math.abs(e.fov-this._fov)>=.001)return!1;var t=5e-4;Object(f.x)(k,e.eye,e.center),Object(f.x)(S,this.eye,this._center);var i=Object(f.e)(k,S),n=Object(f.y)(k),r=Object(f.y)(S);return i*i>=(1-1e-10)*n*r&&Object(f.z)(e.eye,this.eye)<Math.max(n,r)*t*t&&Object(v.i)(e.padding,this._padding)<.5&&Object(v.i)(e.viewport,this._viewport)<.5}},{key:"computeRenderPixelSizeAt",value:function(e){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(e))}},{key:"computeRenderPixelSizeAtDist",value:function(e){return e*this.perRenderPixelRatio}},{key:"computeScreenPixelSizeAt",value:function(e){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(e))}},{key:"viewDirectionDistance",value:function(e){return Math.abs(Object(m.c)(this.viewForward,Object(f.g)(k,e,this.eye)))}},{key:"computeScreenPixelSizeAtDist",value:function(e){return e*this.perScreenPixelRatio}},{key:"computeDistanceFromRadius",value:function(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}},{key:"getScreenCenter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(c.g)();return e[0]=(this.padding[3]+this.width/2)/this.pixelRatio,e[1]=(this.padding[0]+this.height/2)/this.pixelRatio,e}},{key:"getRenderCenter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return e||(e=Object(c.e)()),e[0]=this.padding[3]+this.width*t,e[1]=this.padding[2]+this.height*i,e.length>2&&(e[2]=.5),e}},{key:"setGLViewport",value:function(e){var t=this.viewport,i=this.padding;e.setViewport(t[0]-i[3],t[1]-i[2],t[2]+i[1]+i[3],t[3]+i[0]+i[2])}},{key:"applyProjection",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e!==w&&Object(f.h)(w,e),w[3]=1,i&&(t[2]=-w[2]),Object(v.m)(w,w,this.projectionMatrix),Object(f.b)(w,w,1/Math.abs(w[3]));var n=this.fullViewport;return t[0]=Object(s.m)(0,n[0]+n[2],.5+.5*w[0]),t[1]=Object(s.m)(0,n[1]+n[3],.5+.5*w[1]),i||(t[2]=.5*(w[2]+1)),t}},{key:"projectToScreen",value:function(e,t){this.projectToRenderScreen(e,M),this.renderToScreen(M,t)}},{key:"projectToRenderScreen",value:function(e,t){if(w[0]=e[0],w[1]=e[1],w[2]=e[2],w[3]=1,Object(v.m)(w,w,this.viewProjectionMatrix),0===w[3])return null;Object(f.b)(w,w,1/Math.abs(w[3]));var i=this.fullViewport;return"x"in t?(t.x=Object(s.m)(0,i[0]+i[2],.5+.5*w[0]),t.y=Object(s.m)(0,i[1]+i[3],.5+.5*w[1])):(t[0]=Object(s.m)(0,i[0]+i[2],.5+.5*w[0]),t[1]=Object(s.m)(0,i[1]+i[3],.5+.5*w[1]),t.length>2&&(t[2]=.5*(w[2]+1))),t}},{key:"unprojectFromScreen",value:function(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,M),t)}},{key:"unprojectFromRenderScreen",value:function(e,t){if(Object(l.m)(x,this.projectionMatrix,this.viewMatrix),!Object(l.a)(x,x))return null;var i=this.fullViewport;return w[0]=2*(e[0]-i[0])/i[2]-1,w[1]=2*(e[1]-i[1])/i[3]-1,w[2]=2*e[2]-1,w[3]=1,Object(v.m)(w,w,x),0===w[3]?null:(t[0]=w[0]/w[3],t[1]=w[1]/w[3],t[2]=w[2]/w[3],t)}},{key:"constrainWindowSize",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i,r=e*this.pixelRatio,a=t*this.pixelRatio,s=Math.max(r-i/2,0),o=Math.max(this.fullHeight-a-n/2,0),c=-Math.min(r-i/2,0),l=-Math.min(this.fullHeight-a-n/2,0);return[s,o,i-c- -Math.min(this.fullWidth-r-i/2,0),n-l- -Math.min(a-n/2,0)]}},{key:"computeUp",value:function(e){1===e?this.computeUpGlobal():this.computeUpLocal()}},{key:"screenToRender",value:function(e,t){var i=e[0]*this.pixelRatio,n=this.fullHeight-e[1]*this.pixelRatio;return t[0]=i,t[1]=n,t}},{key:"renderToScreen",value:function(e,t){var i=e[0]/this.pixelRatio,n=(this.fullHeight-e[1])/this.pixelRatio;t[0]=i,t[1]=n}},{key:"computeUpGlobal",value:function(){Object(f.g)(k,this.center,this.eye);var e=Object(f.m)(this.center);e<1?(Object(f.t)(this._up,0,0,1),this._markViewDirty()):Math.abs(Object(f.e)(k,this.center))>.9999*Object(f.m)(k)*e||(Object(f.d)(this._up,k,this.center),Object(f.d)(this._up,this._up,k),Object(f.o)(this._up,this._up),this._markViewDirty())}},{key:"computeUpLocal",value:function(){Object(f.s)(k,this.eye,this.center),Math.abs(k[2])<=.9999&&(Object(f.b)(k,k,k[2]),Object(f.t)(this._up,-k[0],-k[1],1-k[2]),Object(f.o)(this._up,this._up),this._markViewDirty())}},{key:"_compareAndSetView",value:function(e,t){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?Object(f.l)(e,t)||(Object(f.h)(t,e),this._markViewDirty()):_.warn("Camera vector contains invalid number, ignoring value")}},{key:"_markViewDirty",value:function(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}},{key:"_recomputeFrustum",value:function(){this._frustumDirty&&(Object(g.c)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}},{key:"_ensureViewClean",value:function(){this._viewDirty&&(Object(l.l)(this._viewMatrix,this.eye,this._center,this._up),Object(f.t)(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),Object(f.t)(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),Object(f.t)(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}]),e}(),w=Object(p.e)(),x=Object(u.d)(),k=Object(b.e)(),S=Object(b.e)(),M=Object(c.e)();t.a=j},767:function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return w})),i.d(t,"c",(function(){return j}));var n=i(4),r=i(5),a=i(10),s=i(146),o=i(616),c=i(236),l=i(603),u=i(686),h=i(656),d=i(54),f=i(752),b=i(85),v=i(463),p=i(764),g=function(){function e(){Object(n.a)(this,e),this._transform=Object(l.d)(),this._transformInverse=new O({value:this._transform},c.a,l.d),this._transformInverseTranspose=new O(this._transformInverse,c.e,l.d),this._transformTranspose=new O({value:this._transform},c.e,l.d),this._transformInverseRotation=new O({value:this._transform},s.i,o.b)}return Object(r.a)(e,[{key:"invalidateLazyTransforms",value:function(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}},{key:"transform",get:function(){return this._transform}},{key:"inverse",get:function(){return this._transformInverse.value}},{key:"inverseTranspose",get:function(){return this._transformInverseTranspose.value}},{key:"inverseRotation",get:function(){return this._transformInverseRotation.value}},{key:"transpose",get:function(){return this._transformTranspose.value}},{key:"setTransformMatrix",value:function(e){Object(c.d)(this._transform,e)}},{key:"multiplyTransform",value:function(e){Object(c.m)(this._transform,this._transform,e)}},{key:"set",value:function(e){Object(c.d)(this._transform,e),this.invalidateLazyTransforms()}},{key:"setAndInvalidateLazyTransforms",value:function(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this.invalidateLazyTransforms()}}]),e}(),O=function(){function e(t,i,r){Object(n.a)(this,e),this.original=t,this.update=i,this.dirty=!0,this.transform=r()}return Object(r.a)(e,[{key:"invalidate",value:function(){this.dirty=!0}},{key:"value",get:function(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}]),e}(),m=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(n.a)(this,e),this.offset=t,this.tmpVertex=Object(b.e)()}return Object(r.a)(e,[{key:"applyToVertex",value:function(e,t,i){var n=e+this.localOrigin[0],r=t+this.localOrigin[1],a=i+this.localOrigin[2],s=this.offset/Math.sqrt(n*n+r*r+a*a);return this.tmpVertex[0]=e+n*s,this.tmpVertex[1]=t+r*s,this.tmpVertex[2]=i+a*s,this.tmpVertex}},{key:"applyToAabb",value:function(e){var t=e[0]+this.localOrigin[0],i=e[1]+this.localOrigin[1],n=e[2]+this.localOrigin[2],r=e[3]+this.localOrigin[0],a=e[4]+this.localOrigin[1],s=e[5]+this.localOrigin[2],o=this.offset/Math.sqrt(t*t+i*i+n*n);e[0]+=t*o,e[1]+=i*o,e[2]+=n*o;var c=this.offset/Math.sqrt(r*r+a*a+s*s);return e[3]+=r*c,e[4]+=a*c,e[5]+=s*c,e}}]),e}(),y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(n.a)(this,e),this.offset=t,this.componentLocalOriginLength=0,this.tmpVertex=Object(b.e)(),this.mbs=Object(v.e)(),this.obb={center:Object(b.e)(),halfSize:Object(f.b)(),quaternion:null}}return Object(r.a)(e,[{key:"localOrigin",set:function(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}},{key:"applyToVertex",value:function(e,t,i){var n=e,r=t,a=i+this.componentLocalOriginLength,s=this.offset/Math.sqrt(n*n+r*r+a*a);return this.tmpVertex[0]=e+n*s,this.tmpVertex[1]=t+r*s,this.tmpVertex[2]=i+a*s,this.tmpVertex}},{key:"applyToAabb",value:function(e){var t=e[0],i=e[1],n=e[2]+this.componentLocalOriginLength,r=e[3],a=e[4],s=e[5]+this.componentLocalOriginLength,o=this.offset/Math.sqrt(t*t+i*i+n*n);e[0]+=t*o,e[1]+=i*o,e[2]+=n*o;var c=this.offset/Math.sqrt(r*r+a*a+s*s);return e[3]+=r*c,e[4]+=a*c,e[5]+=s*c,e}},{key:"applyToMbs",value:function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/t;return this.mbs[0]=e[0]+e[0]*i,this.mbs[1]=e[1]+e[1]*i,this.mbs[2]=e[2]+e[2]*i,this.mbs[3]=e[3]+e[3]*this.offset/t,this.mbs}},{key:"applyToObb",value:function(e){var t=e.center,i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this.obb.center[0]=t[0]+t[0]*i,this.obb.center[1]=t[1]+t[1]*i,this.obb.center[2]=t[2]+t[2]*i,Object(d.r)(this.obb.halfSize,e.halfSize,e.quaternion),Object(d.c)(this.obb.halfSize,this.obb.halfSize,e.center);var n=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*n,this.obb.halfSize[1]+=this.obb.halfSize[1]*n,this.obb.halfSize[2]+=this.obb.halfSize[2]*n,Object(d.g)(this.obb.halfSize,this.obb.halfSize,e.center),Object(u.a)(x,e.quaternion),Object(d.r)(this.obb.halfSize,this.obb.halfSize,x),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=e.quaternion,this.obb}}]),e}(),_=new(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(n.a)(this,e),this.offset=t,this.sphere=Object(p.b)(),this.tmpVertex=Object(b.e)()}return Object(r.a)(e,[{key:"applyToVertex",value:function(e,t,i){var n=this.objectTransform.transform,r=n[0]*e+n[4]*t+n[8]*i+n[12],a=n[1]*e+n[5]*t+n[9]*i+n[13],s=n[2]*e+n[6]*t+n[10]*i+n[14],o=this.offset/Math.sqrt(r*r+a*a+s*s);r+=r*o,a+=a*o,s+=s*o;var c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*r+c[4]*a+c[8]*s+c[12],this.tmpVertex[1]=c[1]*r+c[5]*a+c[9]*s+c[13],this.tmpVertex[2]=c[2]*r+c[6]*a+c[10]*s+c[14],this.tmpVertex}},{key:"applyToMinMax",value:function(e,t){var i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;var n=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*n,t[1]+=t[1]*n,t[2]+=t[2]*n}},{key:"applyToAabb",value:function(e){var t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;var i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}},{key:"applyToBoundingSphere",value:function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/t;return this.sphere[0]=e[0]+e[0]*i,this.sphere[1]=e[1]+e[1]*i,this.sphere[2]=e[2]+e[2]*i,this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}}]),e}());function j(e){return Object(a.k)(e)?(_.offset=e,_):null}new y;new m;var w="terrain",x=Object(h.b)()},787:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return b})),i.d(t,"d",(function(){return u})),i.d(t,"e",(function(){return d}));var n=i(11),r=i(23),a=i(38),s=(i(236),i(50)),o=i(54),c=i(85);Object(c.e)();function l(e,t){return Object(n.a)(Object(n.a)({},e),Object(r.a)(t))}function u(e,t,i,n){for(;e.length<t;)e.push(i());if(n)for(;e.length>t;)n(e.pop());else e.length=t}function h(e,t){if(Object(o.t)(t,0,0,0),e.length>0){for(var i=0;i<e.length;++i)Object(o.c)(t,t,e[i]);Object(o.b)(t,t,1/e.length)}}function d(e,t,i,n){n.projectToRenderScreen(e,g),n.projectToRenderScreen(t,m),Object(s.a)(i,y,O),Object(s.f)(i,i)}function f(e,t,i){var n=i.state.camera;i.renderCoordsHelper.toRenderCoords(e,v),n.projectToRenderScreen(v,p),i.state.camera.renderToScreen(p,t)}function b(e,t,i){return f(e,_,i),f(t,j,i),Object(s.d)(_,j)}var v=Object(c.e)(),p=Object(a.e)(),g=Object(a.e)(),O=g,m=Object(a.e)(),y=m,_=(Object(a.g)(),Object(a.g)()),j=Object(a.g)()},788:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c}));var n,r=i(598),a=i(820),s=i(597);function o(e){e.fragment.uniforms.add("texWaveNormal","sampler2D"),e.fragment.uniforms.add("texWavePerturbation","sampler2D"),e.fragment.uniforms.add("waveParams","vec4"),e.fragment.uniforms.add("waveDirection","vec2"),e.include(a.b),e.fragment.code.add(Object(s.a)(n||(n=Object(r.a)(["const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);\nvec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\nreturn 2.0 * texture2D(_tex, _uv).rg - 1.0;\n}\nfloat sampleNoiseTexture(vec2 _uv) {\nreturn texture2D(texWavePerturbation, _uv).b;\n}\nvec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\nreturn 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n}\nfloat computeProgress(vec2 uv, float time) {\nreturn fract(time);\n}\nfloat computeWeight(vec2 uv, float time) {\nfloat progress = computeProgress(uv, time);\nreturn 1.0 - abs(1.0 - 2.0 * progress);\n}\nvec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\nfloat flowStrength = waveParams[2];\nfloat flowOffset = waveParams[3];\nvec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;\nfloat progress = computeProgress(uv, time + phaseOffset);\nfloat weight = computeWeight(uv, time + phaseOffset);\nvec2 result = uv;\nresult -= flowVector * (progress + flowOffset);\nresult += phaseOffset;\nresult += (time - progress) * FLOW_JUMP;\nreturn vec3(result, weight);\n}\nconst float TIME_NOISE_TEXTURE_REPEAT = 0.3737;\nconst float TIME_NOISE_STRENGTH = 7.77;\nvec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\nfloat waveStrength = waveParams[0];\nvec2 waveMovement = time * -_waveDir;\nfloat timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\nvec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\nvec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\nvec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\nvec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\nvec3 mixNormal = normalize(normal_A + normal_B);\nmixNormal.xy *= waveStrength;\nmixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\nreturn mixNormal;\n}\nvec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {\nfloat waveTextureRepeat = waveParams[1];\nvec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\nfloat foam  = normals2FoamIntensity(normal, waveParams[0]);\nreturn vec4(normal, foam);\n}"]))))}function c(e,t){e.setUniform4f("waveParams",t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset),e.setUniform2f("waveDirection",t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)}},789:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o}));var n,r=i(598),a=i(597);function s(e){e.vertex.uniforms.add("camPos","vec3").add("perScreenPixelRatio","float").add("screenSize","float"),e.vertex.code.add(Object(a.a)(n||(n=Object(r.a)(["float computeRenderPixelSizeAt( vec3 pWorld ){\nvec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);\nfloat viewDirectionDistance = abs(dot(viewForward, pWorld - camPos));\nreturn viewDirectionDistance*perScreenPixelRatio;\n}\nvec3 screenSizeScaling(vec3 position, vec3 anchor){\nreturn position * screenSize * computeRenderPixelSizeAt(anchor) + anchor;\n}"]))))}function o(e,t,i){e.setUniform1f("perScreenPixelRatio",i.camera.perScreenPixelRatio),e.setUniform1f("screenSize",t.screenSize)}},809:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return o}));var n=i(15),r=i(650),a=i(269),s=i(760);function o(e){var t,i=c(e.rings,e.hasZ,1),a=[],o=0,l=0,u=Object(n.a)(i.polygons);try{var h=function(){var e=t.value,n=e.count,s=e.index,c=new Float64Array(i.position.buffer,3*s*i.position.BYTES_PER_ELEMENT,3*n),u=e.holeIndices.map((function(e){return e-s})),h=new Uint32Array(Object(r.a)(c,u,3));a.push({position:c,faces:h}),o+=c.length,l+=h.length};for(u.s();!(t=u.n()).done;)h()}catch(b){u.e(b)}finally{u.f()}var d=function(e,t,i){if(1===e.length)return e[0];var r,a=new Float64Array(t),s=new Uint32Array(i),o=0,c=0,l=0,u=Object(n.a)(e);try{for(u.s();!(r=u.n()).done;){for(var h=r.value,d=0;d<h.position.length;d++)a[o++]=h.position[d];for(var f=0;f<h.faces.length;f++)s[c++]=h.faces[f]+l;l=o/3}}catch(b){u.e(b)}finally{u.f()}return{position:a,faces:s}}(a,o,l),f=Object(s.a)(d.position.buffer,6,{originalIndices:d.faces});return d.position=new Float64Array(f.buffer),d.faces=f.indices,d}function c(e,t,i){for(var n=e.length,r=new Array(n),a=new Array(n),s=new Array(n),o=0,c=0,h=0,d=0,f=0;f<n;++f)d+=e[f].length;for(var b=new Float64Array(3*d),v=0,p=n-1;p>=0;p--){var g=e[p],O=1===i&&u(g);if(O&&1!==n)r[o++]=g;else{for(var m=g.length,y=0;y<o;++y)m+=r[y].length;var _={index:v,pathLengths:new Array(o+1),count:m,holeIndices:new Array(o)};_.pathLengths[0]=g.length,g.length>0&&(s[h++]={index:v,count:g.length}),v=O?l(g,g.length-1,-1,b,v,g.length,t):l(g,0,1,b,v,g.length,t);for(var j=0;j<o;++j){var w=r[j];_.holeIndices[j]=v,_.pathLengths[j+1]=w.length,w.length>0&&(s[h++]={index:v,count:w.length}),v=l(w,0,1,b,v,w.length,t)}o=0,_.count>0&&(a[c++]=_)}}for(var x=0;x<o;++x){var k=r[x];k.length>0&&(s[h++]={index:v,count:k.length}),v=l(k,0,1,b,v,k.length,t)}return c<n&&(a.length=c),h<n&&(s.length=h),{position:b,polygons:a,outlines:s}}function l(e,t,i,n,r,a,s){r*=3;for(var o=0;o<a;++o){var c=e[t];n[r++]=c[0],n[r++]=c[1],n[r++]=s?c[2]:0,t+=i}return r/3}function u(e){return!Object(a.g)(e,!1,!1)}},819:function(e,t,i){"use strict";i.d(t,"a",(function(){return j}));var n=i(35),r=i(4),a=i(5),s=i(6),o=i(7),c=i(63),l=i(10),u=i(236),h=i(603),d=i(54),f=i(85),b=i(443),v=i(678),p=i(618),g=i(714),O=i(720),m=i(697),y=i(832),_=i(719),j=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e))._handles=new c.a,n._quadMaterial=null,n._outlineMaterial=null,n._maxSize=0,n._position=Object(f.e)(),n._up=Object(f.e)(),n._right=Object(f.e)(),n._renderOccluded=4,n._color=Object(v.c)(1,0,0,1),n._outlineColor=Object(v.c)(0,0,0,1),n._outlineSize=0,n._size=32,n._outlineRenderOccluded=16,n.applyProps(e),n}return Object(a.a)(i,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}},{key:"color",get:function(){return this._color},set:function(e){Object(b.c)(this._color,e),this._updateQuadMaterial()}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){Object(b.c)(this._outlineColor,e),this._updateOutlineMaterial()}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){var t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this._updateTransform())}},{key:"outlineRenderOccluded",get:function(){return this._outlineRenderOccluded},set:function(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}},{key:"geometry",set:function(e){var t=e.previous,i=e.center,n=e.next;this._maxSize=Math.min(Object(d.j)(i,t),Object(d.j)(i,n))/3,Object(d.o)(this._up,Object(d.g)(this._up,t,i)),Object(d.o)(this._right,Object(d.g)(this._right,n,i)),Object(d.h)(this._position,i),this.recreateGeometry()}},{key:"createExternalResources",value:function(){var e=this;this._quadMaterial=new y.a(this.quadMaterialParameters),this._outlineMaterial=new _.a(this.outlineMaterialParameters),this._handles.add(this.view.state.watch("camera",(function(){return e._updateTransform()})))}},{key:"destroyExternalResources",value:function(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}},{key:"forEachExternalMaterial",value:function(e){e(this._quadMaterial),e(this._outlineMaterial)}},{key:"createGeometries",value:function(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}},{key:"_createQuadGeometry",value:function(e){var t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}},{key:"_createOutlineGeometry",value:function(e){if(0!==this._outlineSize){var t=Object(d.c)(p.c.get(),this._up,this._right),i=m.a.createPolylineGeometry([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}}},{key:"_updateTransform",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.object,t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),n=Math.min(this._maxSize,i);Object(u.i)(w),Object(u.s)(w,w,this._position),Object(u.r)(w,w,[n,n,n]),Object(l.k)(e)&&(e.transformation=w)}},{key:"_quadGeometryData",value:function(e,t){var i=Object(d.c)(p.c.get(),e,t);return new O.a([["position",{size:3,data:[0,0,0].concat(Object(n.a)(t),Object(n.a)(e),Object(n.a)(i)),exclusive:!0}]],[["position",new Uint16Array([0,1,2,1,2,3])]])}},{key:"quadMaterialParameters",get:function(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}},{key:"_updateQuadMaterial",value:function(){this._quadMaterial&&this._quadMaterial.setParameterValues(this.quadMaterialParameters)}},{key:"outlineMaterialParameters",get:function(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}},{key:"_updateOutlineMaterial",value:function(){this._outlineMaterial&&this._outlineMaterial.setParameterValues(this.outlineMaterialParameters)}}]),i}(g.a),w=Object(h.d)()},820:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return o}));var n,r,a=i(598),s=i(597);function o(e){e.fragment.code.add(Object(s.a)(n||(n=Object(a.a)(["float normals2FoamIntensity(vec3 n, float waveStrength){\nfloat normalizationFactor =  max(0.015, waveStrength);\nreturn max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n}"]))))}function c(e){e.fragment.code.add(Object(s.a)(r||(r=Object(a.a)(["vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\nreturn foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n}"]))))}},821:function(e,t,i){"use strict";i.d(t,"a",(function(){return R})),i.d(t,"b",(function(){return T}));var n,r,a,s,o,c,l,u,h,d,f=i(598),b=i(741),v=i(626),p=i(695),g=i(674),O=i(643),m=i(636),y=i(860),_=i(696),j=i(881),w=i(788),x=i(657),k=i(675),S=i(597),M=i(617);function T(e){var t=new M.a;return t.include(p.a,{linearDepth:!1}),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3"),t.vertex.uniforms.add("waterColor","vec4"),0!==e.output&&7!==e.output||(t.include(y.a,e),t.include(b.a,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(Object(S.a)(n||(n=Object(f.a)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vuv = uv0;\n        vpos = position;\n\n        vnormal = getLocalUp(vpos, localOrigin);\n        vtbnMatrix = getTBNMatrix(vnormal);\n\n        ","\n\n        gl_Position = transformPosition(proj, view, vpos);\n        ","\n      }\n    "])),S.a.float(x.c),e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"",0===e.output?"forwardLinearDepth();":""))),e.multipassTerrainEnabled&&(t.fragment.include(O.a),t.include(m.b,e)),7===e.output&&(t.include(v.a,e),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(Object(S.a)(r||(r=Object(f.a)(["\n        void main() {\n          discardBySlice(vpos);\n          ","\n\n          gl_FragColor = vec4(waterColor.a);\n        }\n      "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""))),0===e.output&&(t.include(w.a,e),t.include(v.a,e),e.receiveShadows&&t.include(_.a,e),t.include(j.a,e),t.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float").add("view","mat4"),t.fragment.include(k.a),t.fragment.code.add(Object(S.a)(a||(a=Object(f.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        vec3 localUp = vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v = -normalize(vpos - camPos);\n        float shadow = ",";\n        vec4 vPosView = view*vec4(vpos, 1.0);\n        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);\n\n        // gamma correction\n        gl_FragColor = delinearizeGamma(final);\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n        ","\n      }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.receiveShadows?Object(S.a)(s||(s=Object(f.a)(["1.0 - readShadowMap(vpos, linearDepth)"]))):"1.0",e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),2===e.output&&(t.include(y.a,e),t.include(w.a,e),t.include(v.a,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),t.vertex.code.add(Object(S.a)(o||(o=Object(f.a)(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vuv = uv0;\n          vpos = position;\n\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),S.a.float(x.c))),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add(Object(S.a)(c||(c=Object(f.a)(["void main() {\ndiscardBySlice(vpos);\nvec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\ntangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);\ngl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n}"]))))),5===e.output&&(t.varyings.add("vpos","vec3"),t.vertex.code.add(Object(S.a)(l||(l=Object(f.a)(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),S.a.float(x.c))),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(Object(S.a)(u||(u=Object(f.a)(["void main() {\ngl_FragColor = waterColor;\n}"]))))),4===e.output&&(t.include(g.a),t.varyings.add("vpos","vec3"),t.vertex.code.add(Object(S.a)(h||(h=Object(f.a)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vpos = position;\n        gl_Position = transformPosition(proj, view, vpos);\n      }\n    "])),S.a.float(x.c))),t.include(v.a,e),t.fragment.code.add(Object(S.a)(d||(d=Object(f.a)(["void main() {\ndiscardBySlice(vpos);\noutputHighlight();\n}"]))))),t}var R=Object.freeze({__proto__:null,build:T})},822:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return c}));var n,r=i(598),a=i(815),s=i(597),o=i(617);function c(){var e=new o.a;return e.include(a.a),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("color","vec4"),e.fragment.code.add(Object(s.a)(n||(n=Object(r.a)(["void main() {\nvec4 texColor = texture2D(tex, uv);\ngl_FragColor = texColor * color;\n}"])))),e}var l=Object.freeze({__proto__:null,build:c})},823:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n=i(10),r=i(38),a=i(50),s=i(54),o=i(647),c=i(618);function l(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(o.c)();return u(e,e.screenToRender(t,Object(r.b)(c.c.get())),i)}function u(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(o.c)(),l=Object(r.b)(Object(a.c)(c.c.get(),t));if(l[2]=0,!e.unprojectFromRenderScreen(l,i.origin))return null;var u=Object(r.b)(Object(a.c)(c.c.get(),t));u[2]=1;var h=e.unprojectFromRenderScreen(u,c.c.get());return Object(n.j)(h)?null:(Object(s.g)(i.direction,h,i.origin),i)}},824:function(e,t,i){"use strict";i.d(t,"a",(function(){return w})),i.d(t,"b",(function(){return j}));var n,r,a,s,o,c,l,u,h,d=i(598),f=i(789),b=i(626),v=i(695),p=i(643),g=i(636),O=i(657),m=i(675),y=i(597),_=i(617);function j(e){var t=new _.a;return t.include(v.a,{linearDepth:!1}),t.include(f.a,{}),t.include(b.a,e),t.fragment.include(m.a),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.fragment.uniforms.add("color","vec4"),t.attributes.add("position","vec3"),t.varyings.add("vWorldPosition","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add("offset","vec3"),e.shadingEnabled&&(t.vertex.uniforms.add("viewNormal","mat4"),t.fragment.uniforms.add("shadedColor","vec4").add("shadingDirection","vec3"),t.attributes.add("normal","vec3"),t.varyings.add("vViewNormal","vec3")),t.vertex.code.add(Object(y.a)(n||(n=Object(d.a)(["\n    void main(void) {\n      vWorldPosition = ",";\n  "])),e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position")),e.shadingEnabled&&t.vertex.code.add(Object(y.a)(r||(r=Object(d.a)(["vec3 worldNormal = normal;\nvViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;"])))),t.vertex.code.add(Object(y.a)(a||(a=Object(d.a)(["\n    ","\n    gl_Position = transformPosition(proj, view, vWorldPosition);\n  }\n  "])),e.multipassTerrainEnabled?"depth = (view * vec4(vWorldPosition, 1.0)).z;":"")),e.multipassTerrainEnabled&&(t.fragment.include(p.a),t.include(g.b,e)),t.fragment.code.add(Object(y.a)(s||(s=Object(d.a)(["\n    void main() {\n      discardBySlice(vWorldPosition);\n      ","\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"")),e.shadingEnabled?t.fragment.code.add(Object(y.a)(o||(o=Object(d.a)(["vec3 viewNormalNorm = normalize(vViewNormal);\nfloat shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);\nvec4 finalColor = mix(color, shadedColor, shadingFactor);"])))):t.fragment.code.add(Object(y.a)(c||(c=Object(d.a)(["vec4 finalColor = color;"])))),t.fragment.code.add(Object(y.a)(l||(l=Object(d.a)(["\n      if (finalColor.a < ",") {\n        discard;\n      }\n      ","\n\n      ","\n    }\n    "])),y.a.float(O.c),7===e.output?Object(y.a)(u||(u=Object(d.a)(["gl_FragColor = vec4(finalColor.a);"]))):"",0===e.output?Object(y.a)(h||(h=Object(d.a)(["gl_FragColor = highlightSlice(finalColor, vWorldPosition); ",""])),e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""):"")),t}var w=Object.freeze({__proto__:null,build:j})},833:function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var n=i(15),r=i(4),a=i(5),s=(i(13),i(10)),o=i(603),c=i(54),l=i(85),u=i(647),h=function e(){Object(r.a)(this,e),this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=2},d=i(834),f=i(767),b=i(737),v=1e-5,p=function(){function e(t){Object(r.a)(this,e),this.options=new h,this.results=new d.b,this.transform=new f.a,this.performanceInfo={queryDuration:0,numObjectsTested:0},this.tolerance=v,this.verticalOffset=null,this._ray={origin:Object(l.e)(),direction:Object(l.e)()},this._rayEndPoint=Object(l.e)(),this._rayStartPointTransformed=Object(l.e)(),this._rayEndPointTransformed=Object(l.e)(),this.viewingMode=null==t?1:t}return Object(a.a)(e,[{key:"ray",get:function(){return this._ray}},{key:"rayBeginPoint",get:function(){return this._ray.origin}},{key:"rayEndPoint",get:function(){return this._rayEndPoint}},{key:"reset",value:function(e,t){this.resetWithRay(Object(u.e)(e,t,this._ray))}},{key:"resetWithRay",value:function(e){e!==this._ray&&Object(u.b)(e,this._ray),0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,Object(c.c)(this._rayEndPoint,this._ray.origin,this._ray.direction),this._numObjectsTested=0,this.results.init(this._ray)}},{key:"intersect",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0;this.point=i,this.camera=r,this.filterPredicate=o,this.tolerance=null==a?v:a;var l=Object(f.c)(this.verticalOffset);Object(s.k)(t)&&t.length>0&&function(){var i,r=c?function(t){c(t)&&e.intersectObject(t)}:function(t){e.intersectObject(t)},a=Object(n.a)(t);try{for(a.s();!(i=a.n()).done;){var o=i.value,u=o.getSpatialQueryAccelerator&&o.getSpatialQueryAccelerator();Object(s.k)(u)?(Object(s.k)(l)?u.forEachAlongRayWithVerticalOffset(e._ray.origin,e._ray.direction,r,l):u.forEachAlongRay(e._ray.origin,e._ray.direction,r),e.options.selectionMode&&e.options.hud&&u.forEachDegenerateObject(r)):o.objects.forAll((function(e){return r(e)}))}}catch(h){a.e(h)}finally{a.f()}}(),this.sortResults()}},{key:"intersectObject",value:function(e){var t=this;this._numObjectsTested++;var i=e.geometryRecords;if(i){var r,a,l=e.id,u=e.transformation,h=Object(f.c)(this.verticalOffset),v=Object(n.a)(i);try{var p=function(){var i=a.value,n=i.geometry,f=i.material,v=i.instanceParameters;if(Object(b.d)(v))return"continue";r=n.id,t.transform.setAndInvalidateLazyTransforms(u,i.getShaderTransformation()),Object(c.n)(t._rayStartPointTransformed,t._ray.origin,t.transform.inverse),Object(c.n)(t._rayEndPointTransformed,t._rayEndPoint,t.transform.inverse);var p=t.transform.transform;Object(s.k)(h)&&(h.objectTransform=t.transform),f.intersect(n,v,t.transform.transform,t,t._rayStartPointTransformed,t._rayEndPointTransformed,(function(i,n,a,c,u,h){if(i>=0){if(Object(s.k)(t.filterPredicate)&&!t.filterPredicate(t._ray.origin,t._rayEndPoint,i))return;var f="Object3D ".concat(l);if(u)return void((null==t.results.hud.dist||i<t.results.hud.dist)&&t.results.hud.set(e,f,i,n,o.a,c,h,r,a));var b=function(t){return t.set(e,f,i,n,p,c,null,r,a)};if((null==t.results.min.drapedLayerOrder||c>=t.results.min.drapedLayerOrder)&&(null==t.results.min.dist||i<t.results.min.dist)&&b(t.results.min),0!==t.options.store&&(null==t.results.max.drapedLayerOrder||c<t.results.max.drapedLayerOrder)&&(null==t.results.max.dist||i>t.results.max.dist)&&b(t.results.max),2===t.options.store){var v=new d.a(t._ray);b(v),t.results.all.push(v)}}}),i.shaderTransformation)};for(v.s();!(a=v.n()).done;)p()}catch(g){v.e(g)}finally{v.f()}}}},{key:"sortResults",value:function(){this.results.all.sort((function(e,t){return e.dist!==t.dist?e.dist-t.dist:e.drapedLayerOrder!==t.drapedLayerOrder?(void 0!==e.drapedLayerOrder?e.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==t.drapedLayerOrder?t.drapedLayerOrder:Number.MAX_VALUE):(void 0!==t.drapedLayerGraphicOrder?t.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==e.drapedLayerGraphicOrder?e.drapedLayerGraphicOrder:Number.MIN_VALUE)}))}}]),e}();p.DEFAULT_TOLERANCE=v},834:function(e,t,i){"use strict";i.d(t,"a",(function(){return J})),i.d(t,"b",(function(){return X}));var n=i(4),r=i(5),a=i(236),s=i(603),o=i(54),c=i(85),l=i(443),u=i(463),h=i(15),d=(i(13),i(12)),f=i(66),b=i(728),v=i(693),p=i(704),g=i(647),O=i(736),m=i(618),y=d.a.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");function _(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G;return{plane:Object(p.d)(e.plane),origin:Object(c.c)(e.origin),basis1:Object(c.c)(e.basis1),basis2:Object(c.c)(e.basis2)}}function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_();return w(e.origin,e.basis1,e.basis2,t)}function w(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_();return Object(o.h)(n.origin,e),Object(o.h)(n.basis1,t),Object(o.h)(n.basis2,i),x(n),F(n,"fromValues()"),n}function x(e){Object(p.h)(e.basis2,e.basis1,e.origin,e.plane)}function k(e,t,i){e!==i&&j(e,i);var n=Object(o.b)(m.c.get(),z(e),t);return Object(o.c)(i.origin,i.origin,n),i.plane[3]-=t,i}function S(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_(),i=(e[2]-e[0])/2,n=(e[3]-e[1])/2;return Object(o.t)(t.origin,e[0]+i,e[1]+n,0),Object(o.t)(t.basis1,i,0,0),Object(o.t)(t.basis2,0,n,0),Object(p.g)(0,0,1,0,t.plane),t}function M(e,t,i){return!!Object(p.l)(e.plane,t,i)&&I(e,i)}function T(e,t,i){var n=N.get();H(e,t,n,N.get());var r,a=Number.POSITIVE_INFINITY,s=Object(h.a)(B);try{for(s.s();!(r=s.n()).done;){var c=V(e,r.value,U.get()),l=m.c.get();if(Object(p.j)(n,c,l)){var u=Object(o.s)(m.c.get(),t.origin,l),d=Math.abs(Object(f.b)(Object(o.e)(t.direction,u)));d<a&&(a=d,Object(o.h)(i,l))}}}catch(b){s.e(b)}finally{s.f()}return a===Number.POSITIVE_INFINITY?R(e,t,i):i}function R(e,t,i){if(M(e,t,i))return i;var n=N.get(),r=N.get();H(e,t,n,r);var a,s=Number.POSITIVE_INFINITY,c=Object(h.a)(B);try{for(c.s();!(a=c.n()).done;){var l=V(e,a.value,U.get()),u=m.c.get();if(Object(p.k)(n,l,u)){var d=Object(g.d)(t,u);if(!Object(p.n)(r,u))continue;d<s&&(s=d,Object(o.h)(i,u))}}}catch(f){c.e(f)}finally{c.f()}return D(e,t.origin)<s&&P(e,t.origin,i),i}function P(e,t,i){var n=Object(p.q)(e.plane,t,m.c.get()),r=Object(v.i)(A(e,e.basis1),n,-1,1,m.c.get()),a=Object(v.i)(A(e,e.basis2),n,-1,1,m.c.get());return Object(o.g)(i,Object(o.c)(m.c.get(),r,a),e.origin),i}function C(e,t,i){var n=e.origin,r=e.basis1,a=e.basis2,s=Object(o.g)(m.c.get(),t,n),c=Object(O.c)(r,s),l=Object(O.c)(a,s),u=Object(O.c)(z(e),s);return Object(o.t)(i,c,l,u)}function D(e,t){var i=C(e,t,m.c.get()),n=e.basis1,r=e.basis2,a=Object(o.m)(n),s=Object(o.m)(r),c=Math.max(Math.abs(i[0])-a,0),l=Math.max(Math.abs(i[1])-s,0),u=i[2];return c*c+l*l+u*u}function E(e,t){return Object(p.n)(e.plane,t)&&I(e,t)}function L(e,t){var i=-e.plane[3];return Object(O.c)(z(e),t)-i}function z(e){return Object(p.p)(e.plane)}function I(e,t){var i=Object(o.g)(m.c.get(),t,e.origin),n=Object(o.q)(e.basis1),r=Object(o.q)(e.basis2),a=Object(o.e)(e.basis1,i),s=Object(o.e)(e.basis2,i);return-a-n<0&&a-n<0&&-s-r<0&&s-r<0}function A(e,t){var i=U.get();return Object(o.h)(i.origin,e.origin),Object(o.h)(i.vector,t),i}function V(e,t,i){var n=e.basis1,r=e.basis2,a=e.origin,s=Object(o.b)(m.c.get(),n,t.origin[0]),c=Object(o.b)(m.c.get(),r,t.origin[1]);Object(o.c)(i.origin,s,c),Object(o.c)(i.origin,i.origin,a);var l=Object(o.b)(m.c.get(),n,t.direction[0]),u=Object(o.b)(m.c.get(),r,t.direction[1]);return Object(o.b)(i.vector,Object(o.c)(l,l,u),2),i}function F(e,t){Math.abs(Object(o.e)(e.basis1,e.basis2)/(Object(o.m)(e.basis1)*Object(o.m)(e.basis2)))>1e-6&&y.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(Object(o.e)(e.basis1,z(e)))>1e-6&&y.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Object(o.e)(z(e),e.origin)-e.plane[3])>1e-6&&y.warn(t,"Plane offset is not consistent with plane origin")}function H(e,t,i,n){var r=z(e);Object(p.h)(r,t.direction,t.origin,i),Object(p.h)(Object(p.p)(i),r,t.origin,n)}var G={plane:Object(p.d)(),origin:Object(c.g)(0,0,0),basis1:Object(c.g)(1,0,0),basis2:Object(c.g)(0,1,0)},N=new b.a(p.d),U=new b.a(v.d),W=Object(c.e)(),q=new b.a((function(){return{origin:null,basis1:null,basis2:null,plane:null}})),B=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Z=Object(s.d)(),Y=Object(s.d)(),Q=(Object.freeze({__proto__:null,BoundedPlaneClass:function e(){Object(n.a)(this,e),this.plane=Object(p.d)(),this.origin=Object(c.e)(),this.basis1=Object(c.e)(),this.basis2=Object(c.e)()},create:_,wrap:function(e,t,i){var n=q.get();return n.origin=e,n.basis1=t,n.basis2=i,n.plane=Object(p.t)(0,0,0,0),x(n),n},copy:j,copyWithoutVerify:function(e,t){Object(o.h)(t.origin,e.origin),Object(o.h)(t.basis1,e.basis1),Object(o.h)(t.basis2,e.basis2),Object(p.c)(e.plane,t.plane)},fromValues:w,updateUnboundedPlane:x,elevate:k,setExtent:function(e,t,i){return S(t,i),k(i,L(e,e.origin),i),i},fromAABoundingRect:S,intersectRay:M,intersectRayClosestSilhouette:function(e,t,i){if(M(e,t,i))return i;var n=T(e,t,m.c.get());return Object(o.c)(i,t.origin,Object(o.b)(m.c.get(),t.direction,Object(o.j)(t.origin,n)/Object(o.m)(t.direction))),i},closestPointOnSilhouette:T,closestPoint:R,projectPoint:P,projectPointLocal:C,distance2:D,distance:function(e,t){return Math.sqrt(D(e,t))},distanceToSilhouette:function(e,t){var i,n=Number.NEGATIVE_INFINITY,r=Object(h.a)(B);try{for(r.s();!(i=r.n()).done;){var a=V(e,i.value,U.get()),s=Object(v.e)(a,t);s>n&&(n=s)}}catch(o){r.e(o)}finally{r.f()}return Math.sqrt(n)},extrusionContainsPoint:E,axisAt:function(e,t,i,n){return function(e,t,i){switch(t){case 0:Object(o.h)(i,e.basis1),Object(o.o)(i,i);break;case 1:Object(o.h)(i,e.basis2),Object(o.o)(i,i);break;case 2:Object(o.h)(i,z(e))}return i}(e,i,n)},altitudeAt:L,setAltitudeAt:function(e,t,i,n){var r=L(e,t),a=Object(o.b)(W,z(e),i-r);return Object(o.c)(n,t,a),n},equals:function(e,t){return Object(o.l)(e.basis1,t.basis1)&&Object(o.l)(e.basis2,t.basis2)&&Object(o.l)(e.origin,t.origin)},transform:function(e,t,i){return e!==i&&j(e,i),Object(a.a)(Z,t),Object(a.e)(Z,Z),Object(o.n)(i.basis1,e.basis1,Z),Object(o.n)(i.basis2,e.basis2,Z),Object(o.n)(Object(p.p)(i.plane),Object(p.p)(e.plane),Z),Object(o.n)(i.origin,e.origin,t),Object(p.r)(i.plane,i.origin,i.plane),i},rotate:function(e,t,i,n){return e!==n&&j(e,n),Object(a.c)(Y,Object(a.i)(Y),t,i),Object(o.n)(n.basis1,e.basis1,Y),Object(o.n)(n.basis2,e.basis2,Y),x(n),n},normal:z,UP:G}),i(743));var X=function(){function e(){Object(n.a)(this,e),this.min=new J,this.max=new J,this.hud=new J,this.ground=new J}return Object(r.a)(e,[{key:"init",value:function(e){this.min.init(e),this.max.init(e),this.hud.init(e),this.ground.init(e),this.all=[]}}]),e}(),J=function(){function e(t){Object(n.a)(this,e),this.normal=Object(c.e)(),this.transformation=Object(s.d)(),this._ray=Object(g.c)(),this.init(t)}return Object(r.a)(e,[{key:"ray",get:function(){return this._ray}},{key:"hasIntersectionPoint",get:function(){return null!=this.dist}},{key:"distanceInRenderSpace",get:function(){if(null!=this.dist)return Object(o.b)(K,this.ray.direction,this.dist),Object(o.m)(K)}},{key:"getIntersectionPoint",value:function(e){return!!this.hasIntersectionPoint&&(Object(o.b)(K,this.ray.direction,this.dist),Object(o.c)(e,this.ray.origin,K),!0)}},{key:"getTransformedNormal",value:function(e){return Object(o.h)($,this.normal),$[3]=0,Object(l.m)($,$,this.transformation),Object(o.h)(e,$),Object(o.o)(e,e),e}},{key:"init",value:function(e){this.dist=void 0,this.target=void 0,this.name=void 0,this.drapedLayerOrder=void 0,this.drapedLayerGraphicOrder=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",e?Object(g.b)(e,this._ray):this._ray=Object(g.c)()}},{key:"set",value:function(e,t,i,n,r,s,l,u,h,d){e instanceof Q.a&&(e={type:"stage",obj:e}),this.dist=i,Object(o.h)(this.normal,n),Object(a.d)(this.transformation,r),this.target=e,this.name=t,this.drapedLayerOrder=s,this.center=l?Object(c.c)(l):null,this.geometryId=u,this.triangleNr=h,this.drapedLayerGraphicOrder=d}},{key:"copyFrom",value:function(e){Object(g.b)(e.ray,this._ray),this.dist=e.dist,this.target=e.target,this.name=e.name,this.drapedLayerOrder=e.drapedLayerOrder,this.center=e.center?Object(c.c)(e.center):null,this.geometryId=e.geometryId,this.triangleNr=e.triangleNr,this.intersector=e.intersector,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,Object(o.h)(this.normal,e.normal),Object(a.d)(this.transformation,e.transformation)}}]),e}(),K=(Object(c.e)(),Object(c.e)()),$=Object(u.e)()},835:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return u}));var n,r,a=i(598),s=i(643),o=i(597);function c(e){e.fragment.uniforms.add("lastFrameColorMap","sampler2D"),e.fragment.uniforms.add("reprojectionMat","mat4"),e.fragment.uniforms.add("rpProjectionMat","mat4"),e.fragment.code.add(Object(o.a)(n||(n=Object(a.a)(["vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n{\nvec4 zw = rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\nvec4 reprojectedCoord = reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\nreprojectedCoord.xy /= reprojectedCoord.w;\nreturn reprojectedCoord.xy * 0.5 + 0.5;\n}"]))))}function l(e,t){e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("depthMapView","sampler2D"),e.fragment.uniforms.add("ssrViewMat","mat4"),e.fragment.uniforms.add("invResolutionHeight","float"),e.fragment.include(s.a),e.include(c),e.fragment.code.add(Object(o.a)(r||(r=Object(a.a)(["\n  const int maxSteps = ","\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos = startPosition;\n    vec3 viewPosEnd = startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 = 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos += dir;\n\n    vec4 projectedCoordVanishingPoint = applyProjectionMat(rpProjectionMat, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 = 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength = length(projectedCoordDir);\n    float maxSt = float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P = projectedCoordStart.xy;\n    vec3 Q = Q0;\n    float k = k0;\n    float rayStartZ = -startPosition.z; // estimated ray start depth value\n    float rayEndZ = -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ = -startPosition.z;\n    float rayDiffZ = 0.0;\n    float dDepth;\n    float depth;\n    float rayDiffZOld = 0.0;\n\n    // early outs\n    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)\n      return vec3(P, 0.0);\n\n    for(int i = 0; i < maxSteps-1; i++)\n    {\n      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ = prevEstimateZ;\n      dDepth = -rayStartZ - depth;\n      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ = rayEndZ- rayStartZ;\n      prevEstimateZ = rayEndZ;\n\n      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)\n      {\n          return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P += dP;\n      Q.z += dQ.z;\n      k += dk;\n      rayDiffZOld = rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "])),t.highStepCount?"150;":"75;"))}function u(e,t){var i,n;t.ssrEnabled&&(e.bindTexture(t.linearDepthTexture,"depthMapView"),e.setUniform2fv("nearFar",t.camera.nearFar),e.setUniformMatrix4fv("ssrViewMat",t.camera.viewMatrix),e.setUniform1f("invResolutionHeight",1/t.camera.height),n=t,(i=e).bindTexture(n.lastFrameColorTexture,"lastFrameColorMap"),i.setUniformMatrix4fv("reprojectionMat",n.reprojectionMat),i.setUniformMatrix4fv("rpProjectionMat",n.camera.projectionMatrix))}},858:function(e,t,i){"use strict";var n=i(4),r=i(5),a=i(56),s=function(){function e(t,i){Object(n.a)(this,e),this.measure=Object(a.o)(i),this.value=t,this.unit=i}return Object(r.a)(e,[{key:"isBaseUnit",get:function(){return Object(a.k)(this.unit)}},{key:"toUnit",value:function(t){return new e(Object(a.c)(this.value,this.unit,t),t)}},{key:"toBaseUnit",value:function(){return this.toUnit(Object(a.b)(this.unit))}}]),e}();t.a=s},859:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i(4),r=i(5),a=i(56),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Object(n.a)(this,e),this.spatialReference=t}return Object(r.a)(e,[{key:"spatialReference",get:function(){return this._spatialReference},set:function(e){e!==this._spatialReference&&(this._spatialReference=e,this._updateNormalizationFactors())}},{key:"normalizeDistance",value:function(e){return e*this._metersPerDistanceUnit}},{key:"normalizeElevation",value:function(e){return e*this._metersPerElevationUnit}},{key:"normalizeArea",value:function(e){return e*this._squareMetersPerAreaUnit}},{key:"_updateNormalizationFactors",value:function(){this._metersPerDistanceUnit=Object(a.f)(this._spatialReference,1),this._metersPerElevationUnit=Object(a.f)(this._spatialReference,1),this._squareMetersPerAreaUnit=this._metersPerDistanceUnit*this._metersPerDistanceUnit}}]),e}()},860:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n,r,a,s,o=i(598),c=i(597);function l(e,t){1===t.viewingMode?e.vertex.code.add(Object(c.a)(n||(n=Object(o.a)(["vec3 getLocalUp(in vec3 pos, in vec3 origin) {\nreturn normalize(pos + origin);\n}"])))):e.vertex.code.add(Object(c.a)(r||(r=Object(o.a)(["vec3 getLocalUp(in vec3 pos, in vec3 origin) {\nreturn vec3(0.0, 0.0, 1.0);\n}"])))),1===t.viewingMode?e.vertex.code.add(Object(c.a)(a||(a=Object(o.a)(["mat3 getTBNMatrix(in vec3 n) {\nvec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));\nvec3 b = normalize(cross(n, t));\nreturn mat3(t, b, n);\n}"])))):e.vertex.code.add(Object(c.a)(s||(s=Object(o.a)(["mat3 getTBNMatrix(in vec3 n) {\nvec3 t = vec3(1.0, 0.0, 0.0);\nvec3 b = normalize(cross(n, t));\nreturn mat3(t, b, n);\n}"]))))}},861:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return h}));var n=i(11),r=(i(66),i(10)),a=i(38),s=(i(54),i(85)),o=(i(267),i(704),i(647)),c=(i(736),i(618),i(756),i(823),i(833)),l=i(767);i(732);function u(e){var t=null;return function(i){switch(i.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":Object(r.k)(t)&&(t.remove(),t=null)}return i}}function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=new c.a(e.state.viewingMode);i.options.selectionMode=!0,i.options.store=0,i.options.hud=!1;var o,u=Object(a.g)(),h={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},d=Object(s.e)(),f=Object(r.s)(t,e.spatialReference),b=function(t){e.map.ground&&e.map.ground.opacity<1?h.exclude.add(l.b):h.exclude.delete(l.b),e.sceneIntersectionHelper.intersectIntersectorScreen(Object(a.j)(t,u),i,h);var n,r=i.results.min;if(r.getIntersectionPoint(d))n="TerrainRenderer"===r.intersector?0:1;else{if(!i.results.ground.getIntersectionPoint(d))return null;n=0}return{location:e.renderCoordsHelper.fromRenderCoords(d,f),surfaceType:n}};return function(e){if("start"===e.action){var t=b(e.screenStart);o=Object(r.k)(t)?t.location:null}if(Object(r.j)(o))return null;var i=b(e.screenEnd);return Object(r.k)(i)&&Object(r.k)(i.location)?Object(n.a)(Object(n.a)({},e),{},{mapStart:o,mapEnd:i.location,surfaceType:i.surfaceType}):null}}Object(s.e)(),Object(s.e)(),Object(o.c)()},881:function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var n,r=i(598),a=i(820),s=i(597);function o(e){e.fragment.code.add(Object(s.a)(n||(n=Object(r.a)(["const float GAMMA = 2.2;\nconst float INV_GAMMA = 0.4545454545;\nvec4 delinearizeGamma(vec4 color) {\nreturn vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n}\nvec3 linearizeGamma(vec3 color) {\nreturn pow(color, vec3(GAMMA));\n}"]))))}var c,l,u,h,d=i(746),f=i(835);function b(e,t){e.include(d.a,t),e.include(o),e.include(a.a),t.ssrEnabled&&e.include(f.a,t),e.fragment.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.775).add("waterSeeColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]),e.fragment.code.add(Object(s.a)(c||(c=Object(r.a)(["PBRShadingWater shadingInfo;\nvec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\nfloat exponent = pow((1.0 - cosTheta), fresnelSky[2]);\nreturn mix(zenit, horizon, exponent);\n}"])))),e.fragment.code.add(Object(s.a)(l||(l=Object(r.a)(["vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {\nfloat reflectionHit = 0.;\nvec3 seaWaterColor = linearizeGamma(color);\nvec3 h = normalize(l + v);\nshadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\nshadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\nshadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\nshadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\nshadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\nshadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\nfloat upDotV = max(dot(localUp,v), 0.0);\nvec3 skyHorizon = linearizeGamma(skyColor);\nvec3 skyZenit = linearizeGamma(skyZenitColor);\nvec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\nfloat upDotL = max(dot(localUp,l),0.0);\nfloat daytimeMod = 0.1 + upDotL * 0.9;\nskyColor *= daytimeMod;\nfloat shadowModifier = clamp(shadow, 0.8, 1.0);\nvec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\nvec3 reflSky = fresnelModifier * skyColor * shadowModifier;\nvec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\nvec3 specular = vec3(0.0);\nif(upDotV > 0.0 && upDotL > 0.0) {\nvec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\nvec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\nspecular = shadingInfo.NdotL * incidentLight * specularSun;\n}\nvec3 foam = vec3(0.0);\nif(upDotV > 0.0) {\nfoam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n}"])))),t.ssrEnabled?e.fragment.code.add(Object(s.a)(u||(u=Object(r.a)(["vec4 viewPosition = vec4(positionView.xyz, 1.0);\nvec3 viewDir = normalize(viewPosition.xyz);\nvec4 viewNormalVectorCoordinate = ssrViewMat *vec4(n, 0.0);\nvec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);\nvec4 viewUp = ssrViewMat *vec4(localUp, 0.0);\nfloat correctionViewingFactor = pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);\nvec3 viewNormalCorrected = mix(viewUp.xyz, viewNormal, correctionViewingFactor);\nvec3 reflected = normalize(reflect(viewDir, viewNormalCorrected));\nvec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);\nvec3 reflectedColor = vec3(0.0);\nif (hitCoordinate.z > 0.0)\n{\nvec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);\nvec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\nfloat heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);\nreflectionHit = waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;\nreflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;\n}\nfloat seeColorMod =  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);\nreturn tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);\n}"])))):e.fragment.code.add(Object(s.a)(h||(h=Object(r.a)(["return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);\n}"]))))}},922:function(e,t,i){"use strict";i.d(t,"a",(function(){return g}));var n=i(8),r=i.n(n),a=i(14),s=i(4),o=i(5),c=i(47),l=i(46),u=i(6),h=i(7),d=i(0),f=i(30),b=i(1),v=(i(13),i(16),i(12),i(9)),p=i(452),g=function(e){var t=function(e){Object(u.a)(i,e);var t=Object(h.a)(i);function i(){var e;return Object(s.a)(this,i),(e=t.apply(this,arguments)).slicePlaneEnabled=!1,e.supportsHeightUnitConversion=!1,e}return Object(o.a)(i,[{key:"postscript",value:function(e){Object(c.a)(Object(l.a)(i.prototype),"postscript",this).call(this,e),Object(p.b)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}},{key:"_validateHeightModelInfo",value:function(){var e=Object(a.a)(r.a.mark((function e(){var t,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(f.g)(this.view.defaultsFromMap,"isHeightModelInfoSearching"),this.handles.add(t),e.next=4,t;case 4:if(!(i=Object(p.c)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion))){e.next=7;break}throw i;case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),i}(e);return Object(d.a)([Object(b.b)()],t.prototype,"view",void 0),Object(d.a)([Object(b.b)()],t.prototype,"slicePlaneEnabled",void 0),t=Object(d.a)([Object(v.a)("esri.views.3d.layers.LayerView3D")],t)}},923:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c}));i(11),i(23);var n=i(38),r=(i(236),i(50)),a=i(54),s=i(85);Object(s.e)();function o(e,t){if(Object(a.t)(t,0,0,0),e.length>0){for(var i=0;i<e.length;++i)Object(a.c)(t,t,e[i]);Object(a.b)(t,t,1/e.length)}}function c(e,t,i,n){n.projectToRenderScreen(e,l),n.projectToRenderScreen(t,h),Object(r.a)(i,d,u),Object(r.f)(i,i)}Object(s.e)(),Object(n.e)();var l=Object(n.e)(),u=l,h=Object(n.e)(),d=h;Object(n.g)(),Object(n.g)(),Object(n.g)()},924:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return c})),i.d(t,"e",(function(){return a})),i.d(t,"f",(function(){return s}));var n=i(480);function r(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";return Object(n.b)(e,t.toUnit(i).value,i,r,a)}function a(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";if("length"!==t.measure)throw new Error("quantity is not a length");return Object(n.h)(e,t.value,t.unit,i,r)}function s(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";if("length"!==t.measure)throw new Error("quantity is not a length");return Object(n.i)(e,t.value,t.unit,i,r)}function o(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";if("length"!==t.measure)throw new Error("quantity is not a length");return Object(n.e)(e,t.value,t.unit,i,r)}function c(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";if("length"!==t.measure)throw new Error("quantity is not a length");return Object(n.f)(e,t.value,t.unit,i,r)}function l(e){if("angle"!==e.measure)throw new Error("quantity is not an angle");return Object(n.a)(e.value,e.unit)}},926:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return d}));var n=i(4),r=i(5),a=i(54),s=i(85),o=i(267),c=i(268),l=i(618),u=i(477),h=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(s.e)(),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(s.e)();Object(n.a)(this,e),this.startRenderSpace=t,this.endRenderSpace=i,this.type="euclidean"}return Object(r.a)(e,[{key:"eval",value:function(e,t,i){return Object(a.f)(t,this.startRenderSpace,this.endRenderSpace,e),i&&(Object(a.g)(i,this.endRenderSpace,this.startRenderSpace),Object(a.o)(i,i)),t}},{key:"createRenderGeometry",value:function(e,t){var i=[],n=[],r=function(t,r){var s=b;Object(a.g)(s,t,e),i.push([s[0],s[1],s[2]]),n.push([r[0],r[1],r[2]])},s=t.worldUpAtPosition(this.eval(.5,f),l.c.get());return r(this.startRenderSpace,s),r(this.endRenderSpace,s),{points:i,normals:n}}}]),e}(),d=function(){function e(t,i,r){Object(n.a)(this,e),this.startRenderSpace=t,this.endRenderSpace=i,this.renderSpatialReference=r,this.type="geodesic",this._start=Object(s.e)(),this._end=Object(s.e)(),this._pcpf=Object(c.g)(r),this._project=Object(o.b)(r,this._pcpf),this._projectIn(t,this._start),this._projectIn(i,this._end)}return Object(r.a)(e,[{key:"_projectIn",value:function(e,t){this._project?Object(o.r)(e,this.renderSpatialReference,t,this._pcpf):Object(a.h)(t,e)}},{key:"eval",value:function(e,t,i){if(this._project)if(i){var n=b;Object(u.f)(this._start,this._end,e,t,n),Object(a.c)(v,t,n),Object(o.r)(t,this._pcpf,t,this.renderSpatialReference),Object(o.r)(v,this._pcpf,v,this.renderSpatialReference),Object(a.g)(i,v,t),Object(a.o)(i,i)}else Object(u.e)(this._start,this._end,e,t),Object(o.r)(t,this._pcpf,t,this.renderSpatialReference);else Object(a.f)(t,this._start,this._end,e),i&&(Object(a.g)(i,this._end,this._start),Object(a.o)(i,i));return t}},{key:"createRenderGeometry",value:function(e,t){for(var i=[],n=[],r=function(t,r){var s=v;Object(a.g)(s,t,e),i.push([s[0],s[1],s[2]]),n.push([r[0],r[1],r[2]])},s=0;s<128;++s){var o=s/127,c=f,l=b;this.eval(o,c),t.worldUpAtPosition(c,l),r(c,l)}return{points:i,normals:n}}}]),e}();var f=Object(s.e)(),b=Object(s.e)(),v=Object(s.e)()},927:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));i(10);function n(e){return[e,e]}},928:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return c}));var n,r,a=i(598),s=i(597),o=i(617);function c(){var e=new o.a;e.vertex.uniforms.add("proj","mat4").add("view","mat4").add("width","float"),e.attributes.add("position","vec3"),e.attributes.add("normal","vec3"),e.attributes.add("uv0","vec2"),e.attributes.add("auxpos1","float"),e.varyings.add("vtc","vec2"),e.varyings.add("vlength","float"),e.varyings.add("vradius","float"),e.vertex.code.add(Object(s.a)(n||(n=Object(a.a)(["void main(void) {\nvec3 bitangent = normal;\nvtc = uv0;\nvlength = auxpos1;\nvradius = 0.5 * width;\nvec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);\ngl_Position = proj * pos;\n}"])))),e.fragment.uniforms.add("outlineSize","float").add("outlineColor","vec4").add("stripeLength","float").add("stripeEvenColor","vec4").add("stripeOddColor","vec4");var t=1/Math.sqrt(2);return e.fragment.code.add(Object(s.a)(r||(r=Object(a.a)(["\n    const float INV_SQRT2 = ",";\n\n    vec4 arrowColor(vec2 tc, float len) {\n      float d = INV_SQRT2 * (tc.x - abs(tc.y));\n      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\n      d = min(d, 1.0 - abs(tc.y));\n\n      if (d < 0.0) {\n        return vec4(0.0);\n      } else if (d < outlineSize) {\n        return outlineColor;\n      } else {\n        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;\n      }\n    }\n\n    void main(void) {\n      vec2 ntc = vec2(vtc.x / vradius, vtc.y);\n      vec4 color = arrowColor(ntc, vlength / vradius);\n      if (color.a == 0.0) {\n        discard;\n      }\n      gl_FragColor = color;\n    }\n  "])),s.a.float(t))),e}var l=Object.freeze({__proto__:null,build:c})},943:function(e,t,i){"use strict";i.d(t,"a",(function(){return Wt}));var n=i(4),r=i(5),a=i(6),s=i(7),o=i(10),c=i(236),l=i(603),u=i(54),h=i(85),d=i(443),f=i(678),b=i(714),v=i(15),p=i(66),g=i(137),O=i(267),m=(i(809),i(463)),y=(m.b,m.a),_=(i(853),i(8)),j=i.n(_),w=i(14),x=i(27),k=i(0),S=i(36),M=i(63),T=i(12),R=i(242),P=i(195),C=i(493),D=i(30),E=i(1),L=(i(13),i(16),i(9)),z=i(91),I=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(){var e;return Object(n.a)(this,i),(e=t.apply(this,arguments)).SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,e.SCENEVIEW_LOCKING_LOG=!1,e.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED=!0,e.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,e.DECONFLICTOR_SHOW_VISIBLE=!1,e.DECONFLICTOR_SHOW_INVISIBLE=!1,e.DECONFLICTOR_SHOW_GRID=!1,e.LABELS_SHOW_BORDER=!1,e.OVERLAY_DRAW_DEBUG_TEXTURE=!1,e.OVERLAY_SHOW_CENTER=!1,e.SHOW_POI=!1,e.TESTS_DISABLE_UPDATE_THRESHOLDS=!1,e.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1,e.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1,e.DRAW_MESH_GEOMETRY_NORMALS=!1,e.FEATURE_TILE_FETCH_SHOW_TILES=!1,e.FEATURE_TILE_TREE_SHOW_TILES=!1,e.TERRAIN_TILE_TREE_SHOW_TILES=!1,e.I3S_TREE_SHOW_TILES=!1,e.I3S_SHOW_MODIFICATIONS=!1,e.ENABLE_PROFILE_DEPTH_RANGE=!1,e.DISABLE_FAST_UPDATES=!1,e.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,e.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,e.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,e}return i}(S.a);Object(k.a)([Object(E.b)()],I.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),Object(k.a)([Object(E.b)()],I.prototype,"SCENEVIEW_LOCKING_LOG",void 0),Object(k.a)([Object(E.b)()],I.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED",void 0),Object(k.a)([Object(E.b)()],I.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),Object(k.a)([Object(E.b)()],I.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),Object(k.a)([Object(E.b)()],I.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),Object(k.a)([Object(E.b)()],I.prototype,"DECONFLICTOR_SHOW_GRID",void 0),Object(k.a)([Object(E.b)()],I.prototype,"LABELS_SHOW_BORDER",void 0),Object(k.a)([Object(E.b)()],I.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),Object(k.a)([Object(E.b)()],I.prototype,"OVERLAY_SHOW_CENTER",void 0),Object(k.a)([Object(E.b)()],I.prototype,"SHOW_POI",void 0),Object(k.a)([Object(E.b)()],I.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0),Object(k.a)([Object(E.b)()],I.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0),Object(k.a)([Object(E.b)()],I.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),Object(k.a)([Object(E.b)()],I.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),Object(k.a)([Object(E.b)()],I.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),Object(k.a)([Object(E.b)()],I.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),Object(k.a)([Object(E.b)()],I.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),Object(k.a)([Object(E.b)()],I.prototype,"I3S_TREE_SHOW_TILES",void 0),Object(k.a)([Object(E.b)()],I.prototype,"I3S_SHOW_MODIFICATIONS",void 0),Object(k.a)([Object(E.b)()],I.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0),Object(k.a)([Object(E.b)()],I.prototype,"DISABLE_FAST_UPDATES",void 0),Object(k.a)([Object(E.b)()],I.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),Object(k.a)([Object(E.b)()],I.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),Object(k.a)([Object(E.b)()],I.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);var A=new(I=Object(k.a)([Object(L.a)("esri.views.3d.support.DebugFlags")],I)),V=i(142),F=function e(t,i){Object(n.a)(this,e),this.vec3=t,this.id=i};function H(e,t,i,n){return new F(Object(h.g)(e,t,i),n)}var G=function(){function e(t,i){Object(n.a)(this,e),this.index=t,this.renderTargets=i,this.extent=Object(V.h)(),this.resolution=0,this.viewport=Object(V.h)(),this.renderLocalOrigin=H(0,0,0,"O"),this.pixelRatio=1,this.canvasGeometries={extents:[Object(V.h)(),Object(V.h)(),Object(V.h)()],numViews:0},this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=t,this.validTargets=new Array(i.renderTargets.length).fill(!1)}return Object(r.a)(e,[{key:"getValidTarget",value:function(e){return this.validTargets[e]?this.renderTargets.getTarget(e):null}},{key:"needsColorWithoutRasterImage",get:function(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}},{key:"getColorTexture",value:function(e){var t=1===e?this.renderTargets.getTarget(0):2===e?this.renderTargets.getTarget(2):this.renderTargets.getTarget(4);return t?t.getTexture():null}},{key:"getNormalTexture",value:function(e){var t=1===e?this.renderTargets.getTarget(3):null;return t?t.getTexture():null}},{key:"draw",value:function(e,t){var i,n=this.computeRenderTargetValidityBitfield(),r=this.needsColorWithoutRasterImage,a=Object(v.a)(this.renderTargets.renderTargets);try{for(a.s();!(i=a.n()).done;){var s=i.value;1===s.type&&!1===r?this.validTargets[s.type]=!1:this.validTargets[s.type]=e.drawTarget(this,s,t)}}catch(o){a.e(o)}finally{a.f()}return n^this.computeRenderTargetValidityBitfield()?0:1}},{key:"computeRenderTargetValidityBitfield",value:function(){var e=this.validTargets;return+e[0]|+e[1]<<1|+e[2]<<2|+e[3]<<3|+e[4]<<4}},{key:"setupGeometryViewsCyclical",value:function(e){this.setupGeometryViewsDirect();var t=.001*e.range;if(this.extent[0]-t<=e.min){var i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Object(V.p)(this.extent,e.range,0,i)}if(this.extent[2]+t>=e.max){var n=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Object(V.p)(this.extent,-e.range,0,n)}}},{key:"setupGeometryViewsDirect",value:function(){this.canvasGeometries.numViews=1,Object(V.q)(this.canvasGeometries.extents[0],this.extent),Object(d.l)(this.viewport,0,0,this.resolution,this.resolution)}},{key:"hasSomeSizedView",value:function(){for(var e=0;e<this.canvasGeometries.numViews;e++){var t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}},{key:"applyViewport",value:function(e){var t=this.viewport;0===this.index?e.setViewport(t[0],t[1],t[2],t[3]):e.setViewport(t[0]+this.resolution,t[1],t[2],t[3])}}]),e}();var N=i(442),U=i(144),W=i(440),q=(i(102),i(338),i(539),i(143)),B=i(266),Z=function(){function e(t,i){Object(n.a)(this,e),this.size=Object(N.a)(),this._fbo=null,this._fbo=new W.a(t,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:i,maxAnisotropy:8,width:0,height:0})}return Object(r.a)(e,[{key:"dispose",value:function(){this._fbo=Object(o.f)(this._fbo)}},{key:"getTexture",value:function(){return this._fbo?this._fbo.colorTexture:null}},{key:"isValid",value:function(){return null!==this._fbo}},{key:"resize",value:function(e,t){this.size[0]=e,this.size[1]=t,this._fbo.resize(this.size[0],this.size[1])}},{key:"bind",value:function(e){e.bindFramebuffer(this._fbo)}},{key:"generateMipMap",value:function(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}},{key:"disposeRenderTargetMemory",value:function(){var e;null==(e=this._fbo)||e.resize(0,0)}},{key:"gpuMemoryUsage",get:function(){var e,t;return null!=(e=null==(t=this._fbo)?void 0:t.gpuMemoryUsage)?e:0}}]),e}(),Y=function(){function e(t){Object(n.a)(this,e),this.renderTargets=null;var i=function(e,i){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return{type:i,fbo:new Z(t,n),renderPass:e,valid:!1,lastUsed:1/0}};this.renderTargets=[i(0,0),i(0,1),i(5,2,!1),i(3,3),i(0,4)]}return Object(r.a)(e,[{key:"getTarget",value:function(e){return this.renderTargets[e].fbo}},{key:"dispose",value:function(){var e,t=Object(v.a)(this.renderTargets);try{for(t.s();!(e=t.n()).done;){e.value.fbo.dispose()}}catch(i){t.e(i)}finally{t.f()}}},{key:"disposeRenderTargetMemory",value:function(){var e,t=Object(v.a)(this.renderTargets);try{for(t.s();!(e=t.n()).done;){e.value.fbo.disposeRenderTargetMemory()}}catch(i){t.e(i)}finally{t.f()}}},{key:"validateUsageForTarget",value:function(e,t,i){if(e)t.lastUsed=i;else if(i-t.lastUsed>Q)t.fbo.disposeRenderTargetMemory(),t.lastUsed=1/0;else if(t.lastUsed<1/0)return!0;return!1}},{key:"gpuMemoryUsage",get:function(){return this.renderTargets.reduce((function(e,t){return e+t.fbo.gpuMemoryUsage}),0)}}]),e}(),Q=1e3,X=function e(t){Object(n.a)(this,e),this.technique=t,this.refCount=0,this.refZeroFrame=0},J=function(){function e(t){Object(n.a)(this,e),this._context=t,this._perConstructorInstances=new Map,this._frameCounter=0,this._keepAliveFrameCount=1200}return Object(r.a)(e,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}},{key:"dispose",value:function(){this._perConstructorInstances.forEach((function(e){return e.forEach((function(e){return e.technique.dispose()}))})),this._perConstructorInstances.clear()}},{key:"acquire",value:function(e,t){var i=this,n=t.key,r=this._perConstructorInstances.get(e);r||(r=new Map,this._perConstructorInstances.set(e,r));var a=r.get(n);if(void 0===a){var s=new e(this._context,t,(function(){return i.release(s)}));a=new X(s),r.set(n,a)}return++a.refCount,a.technique}},{key:"releaseAndAcquire",value:function(e,t,i){if(Object(o.k)(i)){if(t.key===i.key)return i;i.release()}return this.acquire(e,t)}},{key:"release",value:function(e){if(!Object(o.j)(e)){var t=this._perConstructorInstances.get(e.constructor).get(e.key);--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter)}}},{key:"frameUpdate",value:function(){var e=this;this._frameCounter++,this._perConstructorInstances.forEach((function(t,i){t.forEach((function(i,n){0===i.refCount&&i.refZeroFrame+e._keepAliveFrameCount<e._frameCounter&&(i.technique.dispose(),t.delete(n))})),0===t.size&&e._perConstructorInstances.delete(i)}))}},{key:"hotReload",value:function(){var e=Object(w.a)(j.a.mark((function e(){var t,i=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Array,this._perConstructorInstances.forEach((function(e,n){var r=function(){var e=Object(w.a)(j.a.mark((function e(t,n){var r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.shader,e.t0=r,!e.t0){e.next=6;break}return e.next=5,r.reload();case 5:t.forEach((function(e){e.technique.reload(i._context)}));case 6:case"end":return e.stop()}}),e)})));return function(t,i){return e.apply(this,arguments)}}();t.push(r(e,n))})),e.next=4,Promise.all(t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),K=i(916),$=i(766),ee=[{output:0,name:"color"},{output:1,name:"depth"},{output:2,name:"normal"},{output:3,name:"depthShadowMap"},{output:4,name:"highlight"},{output:5,name:"draped"},{output:6,name:"occlusion"},{output:7,name:"alpha"}];function te(e,t){return e+"_"+ee.find((function(e){return e.output===t})).name}var ie=i(365),ne=T.a.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRep"),re=function(){function e(t){Object(n.a)(this,e),this.refCnt=0,this.glMaterial=t}return Object(r.a)(e,[{key:"incRefCnt",value:function(){++this.refCnt}},{key:"decRefCnt",value:function(){--this.refCnt,Object(ie.a)(this.refCnt>=0)}},{key:"getRefCnt",value:function(){return this.refCnt}},{key:"getGLMaterial",value:function(){return this.glMaterial}}]),e}(),ae=function(){function e(t,i,r){Object(n.a)(this,e),this._textureRep=t,this._techniqueRep=i,this.onMaterialChanged=r,this._id2glMaterialRef=new Map}return Object(r.a)(e,[{key:"dispose",value:function(){this._textureRep.dispose()}},{key:"acquire",value:function(e,t){this.ownMaterial(e);var i=te(e.id,t),n=this._id2glMaterialRef.get(i);if(null==n){var r=e.getGLMaterial({material:e,techniqueRep:this._techniqueRep,textureRep:this._textureRep,output:t});return(n=new re(r)).incRefCnt(),this._id2glMaterialRef.set(i,n),r}return n.incRefCnt(),n.getGLMaterial()}},{key:"release",value:function(e,t){var i=te(e.id,t),n=this._id2glMaterialRef.get(i);if(n.decRefCnt(),0===n.getRefCnt()){var r=n.getGLMaterial();r&&r.dispose(),this._id2glMaterialRef.delete(i)}}},{key:"materialChanged",value:function(e){var t,i=Object(v.a)(ee);try{for(i.s();!(t=i.n()).done;){var n=t.value;if(5!==n.output&&6!==n.output){var r=this._id2glMaterialRef.get(te(e.id,n.output));if(r&&r.getGLMaterial()){var a=r.getGLMaterial();a.updateParameters&&a.updateParameters()}}}}catch(s){i.e(s)}finally{i.f()}this.onMaterialChanged&&this.onMaterialChanged(e)}},{key:"ownMaterial",value:function(e){Object(o.k)(e.materialRepository)&&e.materialRepository!==this&&ne.error("Material is already owned by a different material repository"),e.materialRepository=this}}]),e}(),se=i(794),oe=i(35),ce=i(720),le=i(743),ue=i(768),he=i(719),de=0,fe=function(){function e(t){Object(n.a)(this,e),this._originSR=t,this.ROOT_ORIGIN_ID="rg_root_"+de++,this._origins=new Map,this._gridSize=125e4,this._objects=new Map}return Object(r.a)(e,[{key:"getOrigin",value:function(e){var t=this._origins.get(this.ROOT_ORIGIN_ID);if(null==t){if(Object(o.k)(be))return this._origins.set(this.ROOT_ORIGIN_ID,H(be[0],be[1],be[2],this.ROOT_ORIGIN_ID)),this.getOrigin(e);var i=H(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);return this._origins.set(this.ROOT_ORIGIN_ID,i),i}var n=this._gridSize,r=Math.round(e[0]/n),a=Math.round(e[1]/n),s=Math.round(e[2]/n),c="".concat("rg_").concat(r,"/").concat(a,"/").concat(s),l=this._origins.get(c),h=.5*n;if(Object(u.g)(ve,e,t.vec3),ve[0]=Math.abs(ve[0]),ve[1]=Math.abs(ve[1]),ve[2]=Math.abs(ve[2]),ve[0]<h&&ve[1]<h&&ve[2]<h){if(l){var d=Math.max.apply(Math,Object(oe.a)(ve));if(Object(u.g)(ve,e,l.vec3),ve[0]=Math.abs(ve[0]),ve[1]=Math.abs(ve[1]),ve[2]=Math.abs(ve[2]),Math.max.apply(Math,Object(oe.a)(ve))<d)return l}return t}return l||(l=H(r*n,a*n,s*n,c),this._origins.set(c,l)),l}},{key:"_drawOriginBox",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,0,1],i=window.view,n=i._stage,r=t.toString();if(!this._objects.has(r)){this._material=new he.a({width:2,color:t}),n.add(this._material);var a=new ue.a({isPickable:!1}),s=new le.a({castShadow:!1});n.add(s),a.add(s),n.add(a),this._objects.set(r,s)}for(var o=this._objects.get(r),c=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],u=c.length,h=new Array(3*u),d=new Uint16Array(2*(u-1)),f=.5*this._gridSize,b=0;b<u;b++)h[3*b+0]=e[0]+(1&c[b]?f:-f),h[3*b+1]=e[1]+(2&c[b]?f:-f),h[3*b+2]=e[2]+(4&c[b]?f:-f),b>0&&(d[2*b+0]=b-1,d[2*b+1]=b);Object(O.k)(h,this._originSR,0,h,i.renderSpatialReference,0,u);var v=new ce.a([["position",{size:3,data:h,exclusive:!0}]],[["position",d]],2);n.add(v),o.addGeometry(v,this._material,l.a)}},{key:"test",get:function(){var e=this;return{get gridSize(){return e._gridSize},set gridSize(t){e._gridSize=t}}}}]),e}(),be=null;var ve=Object(h.e)(),pe=i(834),ge=function(){function e(t){Object(n.a)(this,e),this.rctx=t,this.camera=null,this.lastFrameCamera=new $.a,this.pass=0,this.slot=0,this.highlightDepthTexture=null,this.renderOccludedMask=Oe,this.hasOccludees=!1}return Object(r.a)(e,[{key:"resetRenderOccludedMask",value:function(){this.renderOccludedMask=Oe}},{key:"isHighlightPass",get:function(){return 5===this.pass}}]),e}(),Oe=13,me=function(){function e(){Object(n.a)(this,e),this.adds=new P.a,this.removes=new P.a,this.updates=new P.a({allocator:function(e){return e||new ye},deallocator:function(e){return e.renderGeometry=null,e}})}return Object(r.a)(e,[{key:"clear",value:function(){this.adds.clear(),this.removes.clear(),this.updates.clear()}},{key:"prune",value:function(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}]),e}(),ye=function e(){Object(n.a)(this,e)},_e=function e(){Object(n.a)(this,e),this.adds=new Array,this.removes=new Array,this.updates=new Array},je=i(716);function we(e){return e.data.indexCount>=1}var xe=i(773),ke=function(){function e(t){Object(n.a)(this,e),null==t?t=16:t<65536&&(t=Object(p.p)(t)),this._array=new Float32Array(t),this._size=0}return Object(r.a)(e,[{key:"resize",value:function(e,t){if(this._size=e,this._size>this._array.length){for(var i=this._array.length||1;i<this._size;)i*=2;var n=new Float32Array(i);return t&&n.set(this._array),this._array=n,!0}var r=2*this._size;if(r<=this._array.length){for(var a=this._array.length;a>=r;)a=Math.floor(a/2);var s=new Float32Array(a);return t&&s.set(this._array.subarray(0,a)),this._array=s,!0}return!1}},{key:"append",value:function(e){var t=this._size;this.resize(this._size+e.length,!0),this._array.set(e,t)}},{key:"erase",value:function(e,t){for(var i=e;i<t;++i)this._array[i]=0}},{key:"array",get:function(){return this._array}},{key:"size",get:function(){return this._size}}]),e}(),Se=i(715),Me=i(626),Te=i(674),Re=i(636),Pe=i(696),Ce=i(835),De=i(788),Ee=i(717),Le=i(672),ze=i(680),Ie=i(681),Ae=i(688),Ve=i(706),Fe=i(673),He=i(821),Ge=i(467),Ne=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(e,r,a){var s;return Object(n.a)(this,i),(s=t.call(this,e,r,a))._textureRepository=e.waterTextureRepository,s}return Object(r.a)(i,[{key:"initializeProgram",value:function(e){var t=i.shader.get(),n=this.configuration,r=t.build({OITEnabled:0===n.transparencyPassType,output:n.output,viewingMode:e.viewingMode,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:n.receiveShadows,pbrMode:3,useCustomDTRExponentForWater:!0,ssrEnabled:n.useSSR,highStepCount:!0,multipassTerrainEnabled:n.multipassTerrainEnabled,cullAboveGround:n.cullAboveGround});return new Fe.a(e.rctx,r,Ae.a)}},{key:"ensureResource",value:function(e){return this._textureRepository.ready||this._textureRepository.updating||this._textureRepository.loadTextures(e),this._textureRepository.ready?2:1}},{key:"bindPass",value:function(e,t){Object(Ee.b)(this.program,t.camera.projectionMatrix),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(Re.a)(this.program,t)),0===this.configuration.output&&(t.lighting.setUniforms(this.program,!1),Object(Ce.b)(this.program,t)),0!==this.configuration.output&&2!==this.configuration.output||(Object(De.b)(this.program,e),this._textureRepository.bind(this.program)),this.program.setUniform4fv("waterColor",e.color),4===this.configuration.output&&Object(Te.b)(this.program,t)}},{key:"bindDraw",value:function(e){Object(Ee.c)(this.program,e),this.program.rebindTextures(),0!==this.configuration.output&&7!==this.configuration.output||Object(Ee.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),0===this.configuration.output&&Object(Pe.b)(this.program,e),0!==this.configuration.output&&7!==this.configuration.output&&4!==this.configuration.output||Object(Me.c)(this.program,this.configuration,e)}},{key:"setPipelineState",value:function(e){var t=this.configuration,i=3===e,n=2===e;return Object(Ge.e)({blending:2!==t.output&&4!==t.output&&t.transparent?i?Ve.f:Object(Ve.a)(e):null,depthTest:{func:Object(Ve.b)(e)},depthWrite:i?t.writeDepth&&Ge.d:Object(Ve.c)(e),colorWrite:Ge.c,polygonOffset:i||n?null:Object(Ve.g)(t.enableOffset)})}},{key:"initializePipeline",value:function(){return this.setPipelineState(this.configuration.transparencyPassType)}}]),i}(ze.a);Ne.shader=new Le.a(He.a,(function(){return i.e(198).then(i.bind(null,1178))}));var Ue=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(){var e;return Object(n.a)(this,i),(e=t.apply(this,arguments)).output=0,e.receiveShadows=!1,e.slicePlaneEnabled=!1,e.transparent=!1,e.enableOffset=!0,e.writeDepth=!1,e.useSSR=!1,e.isDraped=!1,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return i}(Ie.a);Object(k.a)([Object(Ie.b)({count:8})],Ue.prototype,"output",void 0),Object(k.a)([Object(Ie.b)()],Ue.prototype,"receiveShadows",void 0),Object(k.a)([Object(Ie.b)()],Ue.prototype,"slicePlaneEnabled",void 0),Object(k.a)([Object(Ie.b)()],Ue.prototype,"transparent",void 0),Object(k.a)([Object(Ie.b)()],Ue.prototype,"enableOffset",void 0),Object(k.a)([Object(Ie.b)()],Ue.prototype,"writeDepth",void 0),Object(k.a)([Object(Ie.b)()],Ue.prototype,"useSSR",void 0),Object(k.a)([Object(Ie.b)()],Ue.prototype,"isDraped",void 0),Object(k.a)([Object(Ie.b)({count:4})],Ue.prototype,"transparencyPassType",void 0),Object(k.a)([Object(Ie.b)()],Ue.prototype,"multipassTerrainEnabled",void 0),Object(k.a)([Object(Ie.b)()],Ue.prototype,"cullAboveGround",void 0);var We=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e)).updateParameters(),r}return Object(r.a)(i,[{key:"updateParameters",value:function(e){this._technique=this._techniqueRep.releaseAndAcquire(Ne,this._material.getTechniqueConfig(this._output,e),this._technique)}},{key:"beginSlot",value:function(e){if(2===this._output)return 22===e;if(5===this._output)return null==e;if(4===this._output)return 3===e;var t=3;return this._material.params.transparent&&(t=this._material.params.writeDepth?5:8),e===t}},{key:"setElapsedTimeUniform",value:function(e){var t=.001*this._material.animation.time;e.setUniform1f("timeElapsed",t*this._material.params.animationSpeed)}},{key:"_updateShadowState",value:function(e){e.shadowMappingEnabled!==this._material.params.receiveShadows&&this._material.setParameterValues({receiveShadows:e.shadowMappingEnabled})}},{key:"_updateSSRState",value:function(e){e.ssrEnabled!==this._material.params.ssrEnabled&&this._material.setParameterValues({ssrEnabled:e.ssrEnabled})}},{key:"ensureResources",value:function(e){return this._technique.ensureResource(e)}},{key:"ensureParameters",value:function(e){0===this._output&&(this._updateShadowState(e),this._updateSSRState(e)),this.updateParameters(e)}},{key:"bind",value:function(e){this._technique.bindPass(this._material.params,e),2!==this._output&&0!==this._output||this.setElapsedTimeUniform(this._technique.program)}}]),i}(Se.a),qe=function e(t,i,r,a,s,o){Object(n.a)(this,e),this.from=t,this.to=i,this.isVisible=r,this.hasHighlights=a,this.hasOccludees=s,this.transformation=o,null!=o&&(this.transformationNormal=Object(l.c)(o),Object(c.a)(this.transformationNormal,this.transformationNormal),Object(c.e)(this.transformationNormal,this.transformationNormal))};function Be(e,t){var i=function(e){return{first:e.from,count:e.to-e.from}};if(0!==e.length){var n=e[e.length-1];if(function(e,t){return e.first+e.count>=t.from}(n,t)){var r=t.from-n.first+t.to-t.from;n.count=r}else e.push(i(t))}else e.push(i(t))}var Ze=i(737),Ye=i(275);i(72);function Qe(e,t,i){Object(o.k)(i)&&(i.drawCalls+=e,i.triangles+=t)}Ye.a;var Xe=i(302),Je=function(){function e(t,i,r){Object(n.a)(this,e),this.type="MergedRenderer",this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._rctx=t,this._material=r,this._materialRep=i,this._glMaterials=Object(Ze.a)(this._material,this._materialRep),this._bufferWriter=r.createBufferWriter()}return Object(r.a)(e,[{key:"dispose",value:function(){Object(Ze.e)(this._material,this._materialRep),this._dataByOrigin&&(this._dataByOrigin.forEach((function(e){e.vao.dispose(!0),e.vao=null})),this._dataByOrigin.clear(),this._dataByOrigin=null),this._glMaterials&&(this._glMaterials.forEach((function(e){e&&e.dispose()})),this._glMaterials.clear(),this._glMaterials=null)}},{key:"isEmpty",get:function(){return 0===this._dataByOrigin.size}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasOccludees",get:function(){return this._hasOccludees}},{key:"hasWater",get:function(){return!this.isEmpty&&Object(R.a)(this._glMaterials,(function(e){return e instanceof We}))}},{key:"rendersOccluded",get:function(){return!this.isEmpty&&1!==this._material.renderOccluded}},{key:"modify",value:function(e){this.updateGeometries(e.updates),this.addAndRemoveGeometries(e.adds,e.removes),this.updateRenderCommands()}},{key:"addAndRemoveGeometries",value:function(e,t){var i=this,n=this._bufferWriter,r=n.vertexBufferLayout,a=r.stride/4,s=this._dataByOrigin,c=function(e,t,i,n){var r,a=new Map,s=t.vertexBufferLayout.stride/4,c=function(i,n){var r=i.origin;if(!Object(o.j)(r)){var c=e.get(r.id),l=a.get(r.id);null==l&&(l={optimalCount:null==c?0:c.optimalCount,sparseCount:null==c?0:c.buffer.size,toAdd:[],toRemove:[],origin:r.vec3},a.set(r.id,l));var u=t.elementCount(i.data)*s;n?(l.optimalCount+=u,l.sparseCount+=u,l.toAdd.push(i)):(l.optimalCount-=u,l.toRemove.push(i))}},l=Object(v.a)(i);try{for(l.s();!(r=l.n()).done;){c(r.value,!0)}}catch(d){l.e(d)}finally{l.f()}var u,h=Object(v.a)(n);try{for(h.s();!(u=h.n()).done;){c(u.value,!1)}}catch(d){h.e(d)}finally{h.f()}return a}(s,n,e,t);c.forEach((function(e,t){c.delete(t);var n=e.optimalCount,o=e.sparseCount,l=s.get(t);if(null==l)Object(ie.a)(n>0),l=i.createData(r,n,e.origin),s.set(t,l);else if(0===n)return l.vao.dispose(!0),l.vao=null,void s.delete(t);var u=n<e.sparseCount/2,h=u?n:o,d=$e,f=l.buffer.size,b=l.buffer.array,v=l.buffer.resize(h,!1);u||v?i.removeAndRebuild(l,e.toRemove,a,b,d):e.toRemove.length>0?(i.removeByErasing(l,e.toRemove,a,d),e.toAdd.length>0&&(d.end=f)):(d.begin=f,d.end=f);var p=et;Object(ie.j)(p,-e.origin[0],-e.origin[1],-e.origin[2]),i.append(l,e.toAdd,a,p,d);var g=l.vao.vertexBuffers.geometry;if(g.byteSize!==l.buffer.array.buffer.byteLength)g.setData(l.buffer.array);else{var O=d.begin,m=d.end;if(O<m){var y=l.buffer.array,_=4*O,j=4*m;g.setSubData(y,_,_,j)}}l.drawCommandsDirty=!0}))}},{key:"updateGeometries",value:function(e){var t,i=this._bufferWriter,n=i.vertexBufferLayout.stride/4,r=Object(v.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value,s=a.updateType,o=a.renderGeometry,c=this._dataByOrigin.get(o.origin.id),l=c&&c.instances.get(o.id);if(!l)return;if(1&s&&(l.isVisible=o.instanceParameters.visible),9&s){var u=o.instanceParameters.visible;l.hasHighlights=!!o.instanceParameters.highlights&&u}if(16&s&&(l.hasOccludees=!!o.instanceParameters.occludees),6&s){var h=c.buffer.array,d=c.vao;Object(Ze.c)(o,tt,it),i.write({transformation:tt,invTranspTransformation:it},o.data,i.vertexBufferLayout.createView(h.buffer),l.from),Object(ie.a)(l.from+i.elementCount(o.data)===l.to,"material VBO layout has changed"),d.vertexBuffers.geometry.setSubData(h,l.from*n*4,l.from*n*4,l.to*n*4)}c.drawCommandsDirty=!0}}catch(f){r.e(f)}finally{r.f()}}},{key:"updateRenderCommands",value:function(){var e=this;this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((function(t){t.hasHiddenInstances=!1,t.hasHighlights=!1,t.hasOccludees=!1,Object(R.a)(t.instances,(function(i){return i.isVisible?(i.hasHighlights&&(e._hasHighlights=!0,t.hasHighlights=!0),i.hasOccludees&&(e._hasOccludees=!0,t.hasOccludees=!0)):t.hasHiddenInstances=!0,t.hasHiddenInstances&&t.hasHighlights&&t.hasOccludees}))}));this._dataByOrigin.forEach((function(e){e.drawCommandsDirty&&(function(e){if(e.drawCommandsDefault=null,e.drawCommandsHighlight=null,e.drawCommandsOccludees=null,e.drawCommandsShadowHighlightRest=null,e.stats={default:0,highlight:0,occludees:0,shadowHighlightRest:0},0!==e.instances.size){if(!Ke(e)){var t=4*e.buffer.size/Object(Xe.d)(e.vao.layout.geometry);return e.drawCommandsDefault=[{first:0,count:t}],void(e.stats={default:t,highlight:0,occludees:0,shadowHighlightRest:0})}var i=function(e){return e.sort((function(e,t){return e.from===t.from?e.to>t.to?1:e.to<t.to?-1:0:e.from>t.from?1:e.from<t.from?-1:0}))}(Object(oe.a)(e.instances.values()));e.drawCommandsDefault=[],e.drawCommandsHighlight=[],e.drawCommandsOccludees=[],e.drawCommandsShadowHighlightRest=[];var n,r=Object(v.a)(i);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.isVisible&&(a.hasOccludees?Be(e.drawCommandsOccludees,a):Be(e.drawCommandsDefault,a),a.hasHighlights?Be(e.drawCommandsHighlight,a):Be(e.drawCommandsShadowHighlightRest,a))}}catch(o){r.e(o)}finally{r.f()}var s=function(e){var t,i=0,n=Object(v.a)(e);try{for(n.s();!(t=n.n()).done;)i+=t.value.count}catch(o){n.e(o)}finally{n.f()}return i/3};e.stats={default:s(e.drawCommandsDefault),highlight:s(e.drawCommandsHighlight),occludees:s(e.drawCommandsOccludees),shadowHighlightRest:s(e.drawCommandsShadowHighlightRest)}}}(e),e.drawCommandsDirty=!1)}))}},{key:"updateLogic",value:function(e){return this._material.update(e)}},{key:"render",value:function(e,t,i,n){var r=this,a=this._rctx,s=this._glMaterials.get(t),c=5===t||7===t,l=6===t,u=!(c||l);if(3===t&&null===e&&(e=22),!s||2!==s.ensureResources(a)||null!=e&&!s.beginSlot(e)||c&&!this._hasHighlights)return!1;s.ensureParameters(i);var h=s.getPipelineState(e,!1);a.setPipelineState(h);var d=s.technique;a.useProgram(d.program),s.bind(i);var f=!1;return this._dataByOrigin.forEach((function(t){if(!(Object(o.j)(t.drawCommandsDefault)&&Object(o.j)(t.drawCommandsHighlight)&&Object(o.j)(t.drawCommandsOccludees)&&Object(o.j)(t.drawCommandsShadowHighlightRest))&&(!c||t.hasHighlights)){i.origin=t.origin,d.bindDraw(i,{},{}),d.ensureAttributeLocations(t.vao),a.bindVAO(t.vao);var b=d.primitiveType,v=c?t.drawCommandsHighlight:l&&Ke(t)?t.drawCommandsShadowHighlightRest:t.drawCommandsDefault;if(Object(o.k)(v)){r.renderCommands(a,b,v);var p=c?t.stats.highlight:l&&Ke(t)?t.stats.shadowHighlightRest:t.stats.default;Qe(v.length,p,n),f=!0}if(u){var g=t.drawCommandsOccludees;if(Object(o.k)(g)){var O=s.getPipelineState(e,!0);a.setPipelineState(O),r.renderCommands(a,b,g),a.setPipelineState(h),Qe(g.length,t.stats.occludees,n),f=!0}}}})),f}},{key:"renderCommands",value:function(e,t,i){for(var n=0;n<i.length;n++)e.drawArrays(t,i[n].first,i[n].count)}},{key:"createData",value:function(e,t,i){return{instances:new Map,vao:new B.a(this._rctx,this._material.vertexAttributeLocations,{geometry:Object(xe.a)(e)},{geometry:U.a.createVertex(this._rctx,35044)}),buffer:new ke(t),optimalCount:0,origin:i,hasHiddenInstances:!1,hasHighlights:!1,hasOccludees:!1,drawCommandsDirty:!1,drawCommandsDefault:null,drawCommandsOccludees:null,drawCommandsHighlight:null,drawCommandsShadowHighlightRest:null,stats:{default:0,highlight:0,occludees:0,shadowHighlightRest:0}}}},{key:"removeAndRebuild",value:function(e,t,i,n,r){var a,s=Object(v.a)(t);try{for(s.s();!(a=s.n()).done;){var o=a.value.id,c=e.instances.get(o);e.optimalCount-=(c.to-c.from)*i,e.instances.delete(o)}}catch(b){s.e(b)}finally{s.f()}var l=0,u=e.buffer.array;r.begin=0,r.end=0;var h=-1,d=-1,f=0;e.instances.forEach((function(e){var t=e.from*i,r=e.to*i,a=r-t;h!==d&&d!==t?(u.set(n.subarray(h,d),f),f+=d-h,h=t):-1===h&&(h=t),d=r,e.from=l/i,l+=a,e.to=l/i})),h!==d&&u.set(n.subarray(h,d),f),r.end=l}},{key:"removeByErasing",value:function(e,t,i,n){n.begin=1/0,n.end=-1/0;var r,a=-1,s=-1,o=Object(v.a)(t);try{for(o.s();!(r=o.n()).done;){var c=r.value.id,l=e.instances.get(c),u=l.from*i,h=l.to*i;a!==s&&s!==u?(e.buffer.erase(a,s),a=u):-1===a&&(a=u),s=h,e.instances.delete(c),e.optimalCount-=h-u,u<n.begin&&(n.begin=u),h>n.end&&(n.end=h)}}catch(d){o.e(d)}finally{o.f()}a!==s&&e.buffer.erase(a,s)}},{key:"append",value:function(e,t,i,n,r){var a,s=this._bufferWriter,l=Object(v.a)(t);try{for(l.s();!(a=l.n()).done;){var u=a.value,h=Object(o.k)(u.transformation)?Object(c.m)(tt,n,u.transformation):n;Object(c.a)(it,h),Object(c.e)(it,it);var d=r.end;s.write({transformation:h,invTranspTransformation:it},u.data,s.vertexBufferLayout.createView(e.buffer.array.buffer),r.end/i);var f=s.elementCount(u.data)*i,b=d+f;Object(ie.a)(null==e.instances.get(u.id));var p=u.instanceParameters.visible,g=!!u.instanceParameters.highlights&&p,O=!!u.instanceParameters.occludees,m=new qe(d/i,b/i,p,g,O);e.instances.set(u.id,m),e.optimalCount+=f,r.end+=f}}catch(y){l.e(y)}finally{l.f()}}},{key:"test",get:function(){return{material:this._material,glMaterials:this._glMaterials}}}]),e}();function Ke(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}var $e={begin:0,end:0},et=Object(l.d)(),tt=Object(l.d)(),it=Object(l.d)(),nt=Je,rt=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(){var e;return Object(n.a)(this,i),(e=t.apply(this,arguments))._pending=new at,e._changes=new me,e._materialRenderers=new Map,e._sortedMaterialRenderers=new P.a,e._hasHighlights=!1,e._hasWater=!1,e}return Object(r.a)(i,[{key:"dispose",value:function(){this._changes.prune(),this._materialRenderers.forEach((function(e){return e.dispose()})),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear()}},{key:"updating",get:function(){return!this._pending.empty||this._changes.updates.length>0}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return Object(R.a)(this._materialRenderers,(function(e){return e.rendersOccluded}))}},{key:"stopAnimationsAtTime",value:function(e){this._sortedMaterialRenderers.forAll((function(t){return Object(o.c)(t.material.animation,(function(t){return t.stopAtTime(e)}))}))}},{key:"isEmpty",get:function(){return!this.updating&&0===this._materialRenderers.size}},{key:"commitChanges",value:function(){var e=this;if(!this.updating)return!1;this._processAddsRemoves();var t=function(e){var t=new Map,i=function(e){var i=t.get(e);return i||(i=new _e,t.set(e,i)),i};return e.adds.forAll((function(e){we(e)&&i(e.material).adds.push(e)})),e.removes.forAll((function(e){we(e)&&i(e.material).removes.push(e)})),e.updates.forAll((function(e){we(e.renderGeometry)&&i(e.renderGeometry.material).updates.push(e)})),t}(this._changes),i=!1,n=!1,r=!1;return t.forEach((function(t,a){var s=e._materialRenderers.get(a);if(!s&&t.adds.length>0&&(s=new nt(e.rctx,e.materialRepository,a),e._materialRenderers.set(a,s),i=!0,n=!0,r=!0),s){var o=n||s.hasHighlights,c=r||s.hasWater;s.modify(t),n=n||o!==s.hasHighlights,r=r||c!==s.hasWater,s.isEmpty&&(e._materialRenderers.delete(a),s.dispose(),i=!0)}})),this._changes.clear(),i&&this.updateSortedMaterialRenderers(),n&&(this._hasHighlights=Object(R.a)(this._materialRenderers,(function(e){return e.hasHighlights}))),r&&(this._hasWater=Object(R.a)(this._materialRenderers,(function(e){return e.hasWater}))),this.notifyChange("updating"),!0}},{key:"add",value:function(e){if(0!==e.length){var t,i=this._pending.empty,n=Object(v.a)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this._pending.adds.add(r)}}catch(a){n.e(a)}finally{n.f()}i&&this.notifyChange("updating")}}},{key:"remove",value:function(e){var t,i=this._pending.empty,n=Object(v.a)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this._pending.adds.has(r)?(this._pending.removed.add(r),this._pending.adds.delete(r)):this._pending.removed.has(r)||this._pending.removes.add(r)}}catch(a){n.e(a)}finally{n.f()}i&&!this._pending.empty&&this.notifyChange("updating")}},{key:"modify",value:function(e,t){var i,n=0===this._changes.updates.length,r=Object(v.a)(e);try{for(r.s();!(i=r.n()).done;){var a=i.value,s=this._changes.updates.pushNew();s.renderGeometry=a,s.updateType=t}}catch(o){r.e(o)}finally{r.f()}n&&this._changes.updates.length>0&&this.notifyChange("updating")}},{key:"updateLogic",value:function(e){var t=!1;return this._sortedMaterialRenderers.forAll((function(i){var n=i.materialRenderer;n.updateLogic&&n.updateLogic(e)&&(t=!0)})),t}},{key:"render",value:function(e,t){for(var i=0;i<this._sortedMaterialRenderers.length;i++){var n=this._sortedMaterialRenderers.data[i];Object(je.c)(n.material,e)&&n.materialRenderer.render(null,e.pass,t,null)}}},{key:"updateSortedMaterialRenderers",value:function(){var e=this;this._sortedMaterialRenderers.clear();var t=0;this._materialRenderers.forEach((function(i,n){n.insertOrder=t++,e._sortedMaterialRenderers.push({material:n,materialRenderer:i})})),this._sortedMaterialRenderers.sort((function(e,t){var i=t.material.renderPriority-e.material.renderPriority;return 0!==i?i:e.material.insertOrder-t.material.insertOrder}))}},{key:"_processAddsRemoves",value:function(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(var e=0;e<this._changes.updates.length;){var t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}},{key:"test",get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}}]),i}(S.a);Object(k.a)([Object(E.b)()],rt.prototype,"rctx",void 0),Object(k.a)([Object(E.b)()],rt.prototype,"materialRepository",void 0),Object(k.a)([Object(E.b)()],rt.prototype,"updating",null),rt=Object(k.a)([Object(L.a)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],rt);var at=function(){function e(){Object(n.a)(this,e),this.adds=new Set,this.removes=new Set,this.removed=new Set}return Object(r.a)(e,[{key:"empty",get:function(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}},{key:"has",value:function(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}},{key:"clear",value:function(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}]),e}(),st=i(822),ot=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(){return Object(n.a)(this,i),t.apply(this,arguments)}return Object(r.a)(i,[{key:"initializeProgram",value:function(e){var t=i.shader.get().build();return new Fe.a(e.rctx,t,Ae.a)}},{key:"initializePipeline",value:function(){return this.configuration.hasAlpha?Object(Ge.e)({blending:Object(Ge.f)(770,1,771,771),colorWrite:Ge.c}):Object(Ge.e)({colorWrite:Ge.c})}}]),i}(ze.a);ot.shader=new Le.a(st.a,(function(){return i.e(188).then(i.bind(null,1179))}));var ct=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(){var e;return Object(n.a)(this,i),(e=t.apply(this,arguments)).hasAlpha=!1,e}return i}(Ie.a);Object(k.a)([Object(Ie.b)()],ct.prototype,"hasAlpha",void 0);var lt=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(h.e)();Object(n.a)(this,e),this.intensity=t},ut=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(h.e)(),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(h.g)(.57735,.57735,.57735);Object(n.a)(this,e),this.intensity=t,this.direction=i},ht=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(h.e)(),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(h.g)(.57735,.57735,.57735),r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Object(n.a)(this,e),this.intensity=t,this.direction=i,this.castShadows=r},dt=function e(){Object(n.a)(this,e),this.r=[0],this.g=[0],this.b=[0]};function ft(e,t,i){(i=i||e).length=e.length;for(var n=0;n<e.length;n++)i[n]=e[n]*t[n];return i}function bt(e,t,i){(i=i||e).length=e.length;for(var n=0;n<e.length;n++)i[n]=e[n]*t;return i}function vt(e,t,i){(i=i||e).length=e.length;for(var n=0;n<e.length;n++)i[n]=e[n]+t[n];return i}function pt(e){return(e+1)*(e+1)}function gt(e,t,i){var n=e[0],r=e[1],a=e[2],s=i||[];return s.length=pt(t),t>=0&&(s[0]=.28209479177),t>=1&&(s[1]=.4886025119*n,s[2]=.4886025119*a,s[3]=.4886025119*r),t>=2&&(s[4]=1.09254843059*n*r,s[5]=1.09254843059*r*a,s[6]=.31539156525*(3*a*a-1),s[7]=1.09254843059*n*a,s[8]=.54627421529*(n*n-r*r)),s}function Ot(e,t){var i,n,r=(i=t.r.length,Object(p.e)(Math.floor(Math.sqrt(i)-1),0,2)),a=Object(v.a)(e);try{for(a.s();!(n=a.n()).done;){var s=n.value;Object(u.p)(kt,s.direction),gt(kt,r,wt),ft(wt,St),bt(wt,s.intensity[0],xt),vt(t.r,xt),bt(wt,s.intensity[1],xt),vt(t.g,xt),bt(wt,s.intensity[2],xt),vt(t.b,xt)}}catch(o){a.e(o)}finally{a.f()}return t}function mt(e,t,i,n){(function(e,t){var i=pt(e),n=t||{r:[],g:[],b:[]};n.r.length=n.g.length=n.b.length=i;for(var r=0;r<i;r++)n.r[r]=n.g[r]=n.b[r]=0})(t,n),Object(u.t)(i.intensity,0,0,0);var r=!1,a=yt,s=_t,o=jt;a.length=0,s.length=0,o.length=0;var c,l=Object(v.a)(e);try{for(l.s();!(c=l.n()).done;){var h=c.value;h instanceof ht&&!r?(Object(u.h)(i.direction,h.direction),i.intensity[0]=h.intensity[0],i.intensity[1]=h.intensity[1],i.intensity[2]=h.intensity[2],i.castShadows=h.castShadows,r=!0):h instanceof ht||h instanceof ut?a.push(h):h instanceof lt?s.push(h):h instanceof dt&&o.push(h)}}catch(p){l.e(p)}finally{l.f()}Ot(a,n),function(e,t){gt(kt,0,wt);var i,n=Object(v.a)(e);try{for(n.s();!(i=n.n()).done;){var r=i.value;t.r[0]+=wt[0]*St[0]*r.intensity[0]*4*Math.PI,t.g[0]+=wt[0]*St[0]*r.intensity[1]*4*Math.PI,t.b[0]+=wt[0]*St[0]*r.intensity[2]*4*Math.PI}}catch(p){n.e(p)}finally{n.f()}}(s,n);var d,f=Object(v.a)(o);try{for(f.s();!(d=f.n()).done;){var b=d.value;vt(n.r,b.r),vt(n.g,b.g),vt(n.b,b.b)}}catch(p){f.e(p)}finally{f.f()}}var yt=[],_t=[],jt=[],wt=[0],xt=[0],kt=Object(h.e)(),St=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398],Mt=function(){function e(){Object(n.a)(this,e),this._shOrder=2,this._ambientBoost=.4,this._oldSunlight={direction:Object(h.e)(),ambient:{color:Object(h.e)(),intensity:1},diffuse:{color:Object(h.e)(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new dt,this._mainLight={intensity:Object(h.e)(),direction:Object(h.g)(1,0,0),castShadows:!1}}return Object(r.a)(e,[{key:"lightingMainDirection",get:function(){return this._mainLight.direction}},{key:"setLightDirectionUniform",value:function(e){e.setUniform3fv("lightingMainDirection",this._mainLight.direction)}},{key:"setUniforms",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t?(1-this.groundLightingFactor)*(1-this.globalFactor):0;e.setUniform1f("lightingFixedFactor",i),e.setUniform1f("lightingGlobalFactor",this.globalFactor),this.setLightDirectionUniform(e),e.setUniform3fv("lightingMainIntensity",this._mainLight.intensity),e.setUniform1f("ambientBoostFactor",this._ambientBoost);var n=this._sphericalHarmonics;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",n.r[0],n.g[0],n.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",n.r[0],n.r[1],n.r[2],n.r[3]),e.setUniform4f("lightingAmbientSH_G",n.g[0],n.g[1],n.g[2],n.g[3]),e.setUniform4f("lightingAmbientSH_B",n.b[0],n.b[1],n.b[2],n.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",n.r[0],n.g[0],n.b[0]),e.setUniform4f("lightingAmbientSH_R1",n.r[1],n.r[2],n.r[3],n.r[4]),e.setUniform4f("lightingAmbientSH_G1",n.g[1],n.g[2],n.g[3],n.g[4]),e.setUniform4f("lightingAmbientSH_B1",n.b[1],n.b[2],n.b[3],n.b[4]),e.setUniform4f("lightingAmbientSH_R2",n.r[5],n.r[6],n.r[7],n.r[8]),e.setUniform4f("lightingAmbientSH_G2",n.g[5],n.g[6],n.g[7],n.g[8]),e.setUniform4f("lightingAmbientSH_B2",n.b[5],n.b[6],n.b[7],n.b[8]))}},{key:"set",value:function(e){mt(e,this._shOrder,this._mainLight,this._sphericalHarmonics),Object(u.h)(this._oldSunlight.direction,this._mainLight.direction);var t=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,Object(u.b)(this._oldSunlight.diffuse.color,this._mainLight.intensity,t),Object(u.h)(Tt,this._oldSunlight.diffuse.color),Object(u.b)(Tt,Tt,this._ambientBoost*this.globalFactor),Object(u.c)(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,Tt)}},{key:"old",get:function(){return this._oldSunlight}}]),e}(),Tt=Object(h.e)(),Rt=function(){function e(t){Object(n.a)(this,e),this._rctx=t,this.cache=new Map}return Object(r.a)(e,[{key:"dispose",value:function(){this.cache.forEach((function(e){return e.texture=Object(o.f)(e.texture)})),this.cache.clear()}},{key:"acquire",value:function(e){var t=this;if(Object(o.j)(e))return null;var i=this.patternId(e),n=this.cache.get(i);if(n)return n.refCount++,n.bind;var r=this.patternToTextureData(e,2),a=r.length/2,s={refCount:1,texture:null,bind:function(e){return Object(o.j)(s.texture)&&(s.texture=new q.a(t._rctx,{width:r.length,height:1,internalFormat:6406,pixelFormat:6406,dataType:5121,wrapMode:33071},r)),e.bindTexture(s.texture,"stipplePatternTexture"),a}};return this.cache.set(i,s),s.bind}},{key:"release",value:function(e){if(!Object(o.j)(e)){var t=this.patternId(e),i=this.cache.get(t);i&&(i.refCount--,0===i.refCount&&(Object(o.k)(i.texture)&&i.texture.dispose(),this.cache.delete(t)))}}},{key:"swap",value:function(e,t){var i=this.acquire(t);return this.release(e),i}},{key:"patternId",value:function(e){return e.join(",")}},{key:"patternToTextureData",value:function(e,t){var i,n=e.reduce((function(e,t){return e+t}))*t,r=new Uint8Array(n),a=!0,s=0,o=Object(v.a)(e);try{for(o.s();!(i=o.n()).done;){for(var c=i.value,l=0;l<c*t;l++)r[s++]=a?255:0;a=!a}}catch(u){o.e(u)}finally{o.f()}return r}}]),e}(),Pt=i(478),Ct=T.a.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer"),Dt=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e))._overlays=null,r._overlayRenderTarget=null,r._hasHighlights=!1,r._rendersOccluded=!1,r._hasWater=!1,r._lighting=new Mt,r._handles=new M.a,r._layerRenderers=new Map,r._sortedLayerRenderersDirty=!1,r._sortedLayerRenderers=new P.a,r._geometries=new Map,r.globalUnitScale=1,r.longitudeCyclical=null,r}return Object(r.a)(i,[{key:"initialize",value:function(){var e=this,t=this.view._stage.renderView;this._rctx=t.renderingContext,this._renderContext=new ge(this._rctx);var i=t.waterTextureRepository;this._stippleTextureRepository=new Rt(t.renderingContext),this._shaderTechniqueRepository=new J({rctx:this._rctx,viewingMode:2,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:i}),this._handles.add([Object(D.a)(i,"loadingState",(function(){return e.emitContentChanged()})),Object(D.a)(this,"spatialReference",(function(t){return e._localOrigins=new fe(t)}))]),this._materialRepository=new ae(t.textureRepository,this._shaderTechniqueRepository),this._materialRepository.onMaterialChanged=function(t){(t.renderOccluded&Vt)>0!==e._rendersOccluded&&e.updateRendersOccluded(),e.emitContentChanged(),e.notifyChange("updating")},this._lighting.groundLightingFactor=1,this._lighting.globalFactor=0,this._lighting.set([new lt(Object(h.g)(1,1,1))]),this._bindParameters={slot:null,highlightDepthTexture:Object(se.a)(this._rctx),camera:zt,inverseViewport:Object(z.a)(),origin:null,screenToWorldRatio:null,screenToWorldRatioGlobalWM:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMat:null,ssrEnabled:!1,lighting:this._lighting,transparencyPassType:3,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,cullAboveGround:!1,multipassGeometryEnabled:!1,highlightColorTexture:null},this._handles.add(this.view.resourceController.scheduler.registerTask(Pt.b.STAGE,this))}},{key:"dispose",value:function(){this._handles.destroy(),this._layerRenderers.forEach((function(e){return e.dispose()})),this._layerRenderers.clear(),this._debugTextureTechnique=Object(o.p)(this._debugTextureTechnique),this._debugPatternTexture=Object(o.f)(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=Object(o.f)(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Object(o.f)(this._shaderTechniqueRepository),this._temporaryFBO=Object(o.f)(this._temporaryFBO),this._quadVAO=Object(o.f)(this._quadVAO),this._overlayRenderTarget=Object(o.f)(this._overlayRenderTarget)}},{key:"updating",get:function(){return this._sortedLayerRenderersDirty||Object(R.a)(this._layerRenderers,(function(e){return e.updating}))}},{key:"hasOverlays",get:function(){return Object(o.k)(this._overlays)&&Object(o.k)(this._overlayRenderTarget)}},{key:"gpuMemoryUsage",get:function(){return Object(o.k)(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}},{key:"collectUnusedRenderTargetMemory",value:function(e){var t=!1;if(Object(o.k)(this._overlayRenderTarget)){var i,n=Object(v.a)(this._overlayRenderTarget.renderTargets);try{for(n.s();!(i=n.n()).done;){var r=i.value,a=this.overlays[0].validTargets[r.type]||!this.overlays[1].validTargets[r.type];t=this._overlayRenderTarget.validateUsageForTarget(a,r,e)||t}}catch(s){n.e(s)}finally{n.f()}}return t}},{key:"overlays",get:function(){return Object(o.s)(this._overlays,[])}},{key:"ensureDrapeTargets",value:function(e){Object(o.k)(this._overlays)&&this._overlays.forEach((function(t){t.hasTargetWithoutRasterImage=Object(C.a)(e,(function(e){return 1===e.drapeTargetType}))}))}},{key:"ensureDrapeSources",value:function(e){Object(o.k)(this._overlays)&&this._overlays.forEach((function(t){t.hasDrapedFeatureSource=Object(R.a)(e,(function(e,t){return 1===t.drapeSourceType})),t.hasDrapedRasterSource=Object(R.a)(e,(function(e,t){return 0===t.drapeSourceType}))}))}},{key:"ensureOverlays",value:function(e,t){Object(o.j)(this._overlays)&&(this._overlayRenderTarget=new Y(this._rctx),this._overlays=[new G(0,this._overlayRenderTarget),new G(1,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}},{key:"disposeOverlays",value:function(){Object(o.k)(this._overlayRenderTarget)&&this._overlayRenderTarget.disposeRenderTargetMemory()}},{key:"running",get:function(){return this.updating}},{key:"runTask",value:function(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},n=!1,r=Object(v.a)(this._layerRenderers);try{for(r.s();!(t=r.n()).done;){var a=Object(x.a)(t.value,2),s=a[0],c=a[1];if(e.done)break;i(s)&&(c.commitChanges()&&(n=!0,e.madeProgress()),c.isEmpty&&(this._sortedLayerRenderersDirty=!0,this._layerRenderers.delete(s),this._handles.remove(s)))}}catch(l){r.e(l)}finally{r.f()}this._sortedLayerRenderersDirty&&(this.updateSortedLayerRenderers(),n=!0),n&&(Object(o.k)(this._overlays)&&0===this._layerRenderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.emitContentChanged(),this.updateHasHighlights(),this.updateRendersOccluded(),this.updateHasWater())}},{key:"processSyncLayers",value:function(){this.runTask(Pt.c,(function(e){return 1===e.updatePolicy}))}},{key:"addGeometries",value:function(e,t,i){var n,r=Object(v.a)(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;Object(o.j)(a.origin)&&(a.origin=this._localOrigins.getOrigin(a.boundingSphere)),this._geometries.set(a.id,a)}}catch(s){r.e(s)}finally{r.f()}this.ensureLayerRenderer(t).add(e),2===i&&this.notifyGraphicGeometryChanged(e,t)}},{key:"removeGeometries",value:function(e,t,i){var n,r=Object(v.a)(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;this._geometries.delete(Object(o.r)(a.id))}}catch(c){r.e(c)}finally{r.f()}var s=this._layerRenderers.get(t);s&&(s.remove(e),2===i&&this.notifyGraphicGeometryChanged(e,t))}},{key:"updateGeometries",value:function(e,t,i){var n=this._layerRenderers.get(t);if(n)switch(n.modify(e,i),i){case 4:case 2:return this.notifyGraphicGeometryChanged(e,t);case 1:return this.notifyGraphicVisibilityChanged(e,t)}else Ct.warn("Attempted to update geometry for nonexistent layer")}},{key:"notifyGraphicGeometryChanged",value:function(e,t){if(!Object(o.j)(t.notifyGraphicGeometryChanged)){var i,n,r=Object(v.a)(e);try{for(r.s();!(n=r.n()).done;){var a=n.value.graphicUid;Object(o.k)(a)&&a!==i&&(t.notifyGraphicGeometryChanged(a),i=a)}}catch(s){r.e(s)}finally{r.f()}}}},{key:"notifyGraphicVisibilityChanged",value:function(e,t){if(!Object(o.j)(t.notifyGraphicVisibilityChanged)){var i,n,r=Object(v.a)(e);try{for(r.s();!(n=r.n()).done;){var a=n.value.graphicUid;Object(o.k)(a)&&a!==i&&(t.notifyGraphicVisibilityChanged(a),i=a)}}catch(s){r.e(s)}finally{r.f()}}}},{key:"updateHighlights",value:function(e,t){var i=this._layerRenderers.get(t);i?i.modify(e,8):Ct.warn("Attempted to update highlights for nonexistent layer")}},{key:"isEmpty",value:function(){return 0===this._geometries.size&&!A.OVERLAY_DRAW_DEBUG_TEXTURE}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return this._rendersOccluded}},{key:"updateLogic",value:function(e){var t=!1;return this._layerRenderers.forEach((function(i){i.updateLogic(e)&&(t=!0)})),t}},{key:"updateLayerOrder",value:function(){this._sortedLayerRenderersDirty=!0}},{key:"drawTarget",value:function(e,t,i){var n=this,r=e.canvasGeometries;if(0===r.numViews)return!1;var a=e.pixelRatio*i;this._screenToWorldRatio=a*Math.abs(r.extents[0][2]-r.extents[0][0])/Math.abs(e.viewport[2]-e.viewport[0]);var s=t.renderPass;if(this.isEmpty()||5===s&&!this.hasHighlights||3===s&&!this.hasWater)return!1;if(!e.hasSomeSizedView())return!1;var c=t.fbo,l=2*e.resolution,u=e.resolution,h=1===t.type?2:4===t.type?1:0;if(!c.isValid())return!1;c.resize(l,u);var d=this._rctx;if(zt.pixelRatio=a||1,this._renderContext.pass=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToWorldRatioGlobalWM=this._screenToWorldRatio*this.globalUnitScale,e.applyViewport(this._rctx),c.bind(d),0===e.index&&(d.setClearColor(0,0,0,0),d.clearSafe(16384)),1===h&&(this._renderContext.renderOccludedMask=Vt),A.OVERLAY_DRAW_DEBUG_TEXTURE&&1!==h)for(var f=0;f<r.numViews;f++)this.setViewParameters(r.extents[f],e,zt),this.drawDebugTexture(e.resolution,Lt[e.index%Lt.length]);return this._layerRenderers.size>0&&this._sortedLayerRenderers.forAll((function(t){var i=t.layerView,a=t.renderer;if(2!==h||!Object(o.k)(i)||0!==i.drapeSourceType){var f=Object(o.k)(i)&&Object(o.k)(i.fullOpacity)&&i.fullOpacity<1&&0===s;f&&(n.bindTemporaryFramebuffer(n._rctx,l,u),d.clearSafe(16384));for(var b=0;b<r.numViews;b++)n.setViewParameters(r.extents[b],e,zt),a.render(n._renderContext,n._bindParameters);f&&Object(o.k)(n._temporaryFBO)&&(c.bind(d),n.view._stage.renderView.compositingHelper.composite(n._temporaryFBO.getTexture(),2,Object(o.r)(Object(o.r)(i).fullOpacity),3,e.index))}})),d.bindFramebuffer(null),c.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}},{key:"bindTemporaryFramebuffer",value:function(e,t,i){Object(o.j)(this._temporaryFBO)&&(this._temporaryFBO=new Z(e,!1)),this._temporaryFBO.resize(t,i),this._temporaryFBO.bind(e)}},{key:"reloadShaders",value:function(){var e=Object(w.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._shaderTechniqueRepository.hotReload();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"intersect",value:function(e,t,i){var n=this,r=0;this._geometries.forEach((function(a){if(!i||i(a)){n.intersectRenderGeometry(a,t,0,e,r);var s=n.longitudeCyclical;s&&(a.boundingSphere[0]-a.boundingSphere[3]<s.min&&n.intersectRenderGeometry(a,t,s.range,e,r),a.boundingSphere[0]+a.boundingSphere[3]>s.max&&n.intersectRenderGeometry(a,t,-s.range,e,r)),r++}}))}},{key:"intersectRenderGeometry",value:function(e,t,i,n,r){var a=this;if(e.instanceParameters.visible){var s=0;Object(o.k)(e.transformation)&&(i+=e.transformation[12],s=e.transformation[13]),It[0]=t[0]-i,It[1]=t[1]-s,It[2]=1,At[0]=t[0]-i,At[1]=t[1]-s,At[2]=0,e.screenToWorldRatio=this._screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),n,It,At,(function(t,i,s){a.addIntersectionResult(s,e.material.renderPriority,r,n,e.layerUid,e.graphicUid)}),e.calculateShaderTransformation,!0)}}},{key:"addIntersectionResult",value:function(e,t,i,n,r,a){var s={type:"external",metadata:{layerUid:r,graphicUid:a}},o=function(r){r.set(s,null,n.results.ground.dist,n.results.ground.normal,n.results.ground.transformation,t,null,null,e,i),r.intersector="OverlayRenderer"};if((null==n.results.min.drapedLayerOrder||t>=n.results.min.drapedLayerOrder)&&(null==n.results.min.dist||n.results.ground.dist<=n.results.min.dist)&&o(n.results.min),0!==n.options.store&&(null==n.results.max.drapedLayerOrder||t<n.results.max.drapedLayerOrder)&&(null==n.results.max.dist||n.results.ground.dist>n.results.max.dist)&&o(n.results.max),2===n.options.store){var c=new pe.a(n.ray);o(c),n.results.all.push(c)}}},{key:"stopAnimationsAtTime",value:function(e){this._sortedLayerRenderers.forAll((function(t){return t.renderer.stopAnimationsAtTime(e)}))}},{key:"ensureLayerRenderer",value:function(e){var t=this,i=this._layerRenderers.get(e);return i||(i=new rt({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(e,i),this._sortedLayerRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(e.watch("fullOpacity",(function(){return t.emitContentChanged()})),e),this._handles.add(Object(D.a)(i,"updating",(function(){return t.notifyChange("updating")})),e)),i}},{key:"updateSortedLayerRenderers",value:function(){var e=this;if(this._sortedLayerRenderersDirty&&(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0!==this._layerRenderers.size)){var t=new Set(this._layerRenderers.values());this.view.allLayerViews.forEach((function(i){var n=i,r=e._layerRenderers.get(n);r&&(e._sortedLayerRenderers.push(new Et(n,r)),t.delete(r))})),t.forEach((function(t){return e._sortedLayerRenderers.push(new Et(null,t))}))}}},{key:"setViewParameters",value:function(e,t,i){i.viewport=t.viewport,Object(c.o)(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),Object(c.i)(i.viewMatrix),Object(c.s)(i.viewMatrix,i.viewMatrix,[-e[0],-e[1],0]),this._renderContext.camera=i,this._bindParameters.camera=i,this._bindParameters.inverseViewport[0]=1/i.fullViewport[2],this._bindParameters.inverseViewport[1]=1/i.fullViewport[3]}},{key:"emitContentChanged",value:function(){this.onContentChanged&&this.onContentChanged()}},{key:"updateHasWater",value:function(){var e=Object(R.a)(this._layerRenderers,(function(e){return e.hasWater}));e!==this._hasWater&&(this._hasWater=e,this.onHasWaterChanged&&this.onHasWaterChanged(e))}},{key:"updateHasHighlights",value:function(){var e=Object(R.a)(this._layerRenderers,(function(e){return e.hasHighlights}));e!==this._hasHighlights&&(this._hasHighlights=e,this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this._hasHighlights))}},{key:"updateRendersOccluded",value:function(){var e=Object(R.a)(this._layerRenderers,(function(e){return e.rendersOccluded}));e!==this._rendersOccluded&&(this._rendersOccluded=e,this.onRendersOccludedChanged&&this.onRendersOccludedChanged(this.rendersOccluded))}},{key:"drawDebugTexture",value:function(e,t){var i=this._rctx;this.ensureDebugPatternResources(e,e);var n=this._debugTextureTechnique.program;i.useProgram(n),i.setPipelineState(this._debugTextureTechnique.pipeline),n.setUniform4f("color",t[0],t[1],t[2],1),n.bindTexture(this._debugPatternTexture,"tex"),i.bindVAO(this._quadVAO),i.drawArrays(5,0,Object(Xe.f)(this._quadVAO,"geometry"))}},{key:"ensureDebugPatternResources",value:function(e,t){if(!this._debugPatternTexture){for(var i=new Uint8Array(e*t*4),n=0,r=0;r<t;r++)for(var a=0;a<e;a++){var s=Math.floor(a/10),o=Math.floor(r/10);s<2||o<2||10*s>e-20||10*o>t-20?(i[n++]=255,i[n++]=255,i[n++]=255,i[n++]=255):(i[n++]=255,i[n++]=255,i[n++]=255,i[n++]=1&s&&1&o?1&a^1&r?0:255:1&s^1&o?0:128)}this._debugPatternTexture=new q.a(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},i);var c=new ct;c.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(ot,c),this._quadVAO=Object(se.b)(this._rctx)}}},{key:"test",get:function(){return{layerRenderers:this._layerRenderers}}}]),i}(Object(K.b)(S.a));Object(k.a)([Object(K.c)()],Dt.prototype,"_shaderTechniqueRepository",void 0),Object(k.a)([Object(K.c)()],Dt.prototype,"_stippleTextureRepository",void 0),Object(k.a)([Object(E.b)({constructOnly:!0})],Dt.prototype,"view",void 0),Object(k.a)([Object(E.b)()],Dt.prototype,"globalUnitScale",void 0),Object(k.a)([Object(E.b)()],Dt.prototype,"spatialReference",void 0),Object(k.a)([Object(E.b)({type:Boolean,readOnly:!0})],Dt.prototype,"updating",null),Dt=Object(k.a)([Object(L.a)("esri.views.3d.terrain.OverlayRenderer")],Dt);var Et=function e(t,i){Object(n.a)(this,e),this.layerView=t,this.renderer=i},Lt=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],zt=new $.a;zt.near=1,zt.far=1e4,zt.relativeElevation=null;var It=Object(h.e)(),At=Object(h.e)(),Vt=4;function Ft(e){var t=[],i=[];!function(e,t,i){for(var n=e.attributeData.position,r=e.removeDuplicateStartEnd,a=function(e){var t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(n)&&1===r,s=n.length/3-(a?1:0),o=new Uint32Array(2*(s-1)),c=a?Object(g.m)(n,0,n.length-3):n,l=0,u=0;u<s-1;u++)o[l++]=u,o[l++]=u+1;t.push(["position",{size:3,data:c,exclusive:a}]),i.push(["position",o])}(e,i,t);var n=i[0][1].data,r=t[0][1].length,a=new Uint16Array(r);return function(e,t,i){var n=e.attributeData.mapPosition;Object(o.j)(n)||(i.push(["mapPos",i[0][1]]),t.push(["mapPos",{size:3,data:n}]))}(e,i,t),function(e,t,i,n){if(Object(o.k)(e.attributeData.colorFeature))return;var r=e.attributeData.color;t.push(["color",{size:4,data:Object(o.s)(r,y)}]),i.push(["color",n])}(e,i,t,a),function(e,t,i,n){if(Object(o.k)(e.attributeData.sizeFeature))return;var r=e.attributeData.size;t.push(["size",{size:1,data:[Object(o.s)(r,1)]}]),i.push(["size",n])}(e,i,t,a),function(e,t,i,n){var r=e.attributeData.colorFeature;Object(o.j)(r)||(t.push(["colorFeatureAttribute",{size:1,data:new Float32Array([r])}]),i.push(["color",n]))}(e,i,t,a),function(e,t,i,n){var r=e.attributeData.sizeFeature;Object(o.j)(r)||(t.push(["sizeFeatureAttribute",{size:1,data:new Float32Array([r])}]),i.push(["sizeFeatureAttribute",n]))}(e,i,t,a),function(e,t,i,n){var r=e.attributeData.opacityFeature;Object(o.j)(r)||(t.push(["opacityFeatureAttribute",{size:1,data:new Float32Array([r])}]),i.push(["opacityFeatureAttribute",n]))}(e,i,t,a),function(e,t,i,n){if("round"!==e.join)return;var r=n.length/3,a=new Float32Array(r),s=Gt,c=Nt;Object(u.t)(s,0,0,0);for(var l=Object(o.s)(e.uniformSize,1),h=-1;h<r;++h){var d=h<0?r+h:h,f=(h+1)%r;if(Object(u.t)(c,n[3*f+0]-n[3*d+0],n[3*f+1]-n[3*d+1],n[3*f+2]-n[3*d+2]),Object(u.o)(c,c),h>=0){var b=(Math.PI-Object(p.b)(Object(u.e)(s,c)))*Ut*1*Ht(l);a[h]=Math.max(Math.floor(b),0)}Object(u.b)(s,c,-1)}t.push(["subdivisions",{size:1,data:a}]),i.push(["subdivisions",i[0][1]])}(e,i,t,n),new ce.a(i,t,2)}function Ht(e){return 1.863798+-2.0062872/Math.pow(1+e/18.2313,.8856294)}var Gt=Object(h.e)(),Nt=Object(h.e)(),Ut=4/Math.PI,Wt=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e))._renderOccluded=4,r._width=1,r._color=Object(f.c)(1,0,1,1),r._innerWidth=1,r._innerColor=null,r._stipplePattern=null,r._stippleOffColor=null,r._stippleIntegerRepeats=!1,r._writeDepthEnabled=!0,r._falloff=0,r._polygonOffset=!1,r.applyProps(e),r}return Object(r.a)(i,[{key:"setGeometryFromExtent",value:function(e){var t=this.view.spatialReference,i=Object(h.e)(),n=Object(h.e)(),r=100,a=[];Object(u.t)(i,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),Object(u.t)(i,e[2],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),Object(u.t)(i,e[2],e[3],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),Object(u.t)(i,e[0],e[3],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),Object(u.t)(i,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),Object(u.t)(i,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),this.geometry=[a]}},{key:"setGeometryFromFrustum",value:function(e){var t=[];e.lines.forEach((function(e){t.push([e.origin[0],e.origin[1],e.origin[2]]),t.push([e.endpoint[0],e.endpoint[1],e.endpoint[2]])})),this.geometry=[t]}},{key:"setGeometryFromBoundedPlane",value:function(e){var t=[],i=e.origin,n=e.basis1,r=e.basis2,a=.5,s=Object(h.e)(),o=Object(h.e)(),c=Object(h.e)(),l=Object(h.e)();s[0]=i[0]-n[0]*a-r[0]*a,s[1]=i[1]-n[1]*a-r[1]*a,s[2]=i[2]-n[2]*a-r[2]*a,o[0]=i[0]-n[0]*a+r[0]*a,o[1]=i[1]-n[1]*a+r[1]*a,o[2]=i[2]-n[2]*a+r[2]*a,c[0]=i[0]+n[0]*a+r[0]*a,c[1]=i[1]+n[1]*a+r[1]*a,c[2]=i[2]+n[2]*a+r[2]*a,l[0]=i[0]+n[0]*a-r[0]*a,l[1]=i[1]+n[1]*a-r[1]*a,l[2]=i[2]+n[2]*a-r[2]*a,t.push([s[0],s[1],s[2]]),t.push([o[0],o[1],o[2]]),t.push([c[0],c[1],c[2]]),t.push([l[0],l[1],l[2]]),t.push([s[0],s[1],s[2]]),this.geometry=[t]}},{key:"setGeometryFromSegment",value:function(e){var t=e.endRenderSpace;Object(c.i)(qt),Object(c.s)(qt,qt,t),this.transform=qt;var i=e.createRenderGeometry(t,this.view.renderCoordsHelper).points;this.geometry=[i]}},{key:"setGeometryFromSegments",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.b;Object(c.i)(qt),Object(c.s)(qt,qt,i),this.transform=qt,this.geometry=e.map((function(e){return e.createRenderGeometry(i,t.view.renderCoordsHelper).points}))}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.recreateGeometry()}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this._updateMaterial())}},{key:"color",get:function(){return this._color},set:function(e){Object(d.g)(e,this._color)||(Object(d.c)(this._color,e),this._updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(e){Object(o.k)(e)?!Object(o.j)(this._innerColor)&&Object(d.g)(e,this._innerColor)||(this._innerColor=Object(d.c)(Object(f.b)(),e),this._updateMaterial()):Object(o.k)(this._innerColor)&&(this._innerColor=null,this._updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(e){var t=Object(o.k)(e)!==Object(o.k)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(e){(Object(o.j)(e)||Object(o.j)(this._stippleOffColor)||!Object(d.g)(e,this._stippleOffColor))&&(this._stippleOffColor=Object(o.k)(e)?Object(f.a)(e):null,this._updateMaterial())}},{key:"stippleIntegerRepeats",get:function(){return this._stippleIntegerRepeats},set:function(e){this._stippleIntegerRepeats!==e&&(this._stippleIntegerRepeats=e,this._updateMaterial())}},{key:"writeDepthEnabled",get:function(){return this._writeDepthEnabled},set:function(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}},{key:"polygonOffset",get:function(){return this._polygonOffset},set:function(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}},{key:"createExternalResources",value:function(){this._material=new he.a(this.materialParameters)}},{key:"destroyExternalResources",value:function(){this._material=null}},{key:"createGeometries",value:function(e){var t=this._createLineGeometries();if(0!==t.length)for(var i=0;i<t.length;++i){var n=Ft(t[i]);e.addGeometry(n,this._material)}}},{key:"forEachExternalMaterial",value:function(e){e(this._material)}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:!1,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,stippleIntegerRepeats:this._stippleIntegerRepeats,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}},{key:"_updateMaterial",value:function(){this.attached&&this._material.setParameterValues(this.materialParameters)}},{key:"_createLineGeometries",value:function(){var e=this.geometry;if(Object(o.j)(e)||0===e.length)return[];var t=[];return e.forEach((function(e){var i=e.length,n=new Float64Array(3*i);e.forEach((function(e,t){n[3*t+0]=e[0],n[3*t+1]=e[1],n[3*t+2]=e[2]}));var r={attributeData:{position:n},removeDuplicateStartEnd:0};t.push(r)})),t}}]),i}(b.a),qt=Object(l.d)()},947:function(e,t,i){"use strict";i.d(t,"a",(function(){return D})),i.d(t,"b",(function(){return L}));var n=i(4),r=i(5),a=i(6),s=i(7),o=i(63),c=i(10),l=i(38),u=i(50),h=i(54),d=i(85),f=i(787),b=i(852),v=i(0),p=i(36),g=i(1),O=(i(13),i(16),i(12),i(9)),m=(i(149),function e(t,i,n){for(var r=0,a=i.length;r<a;r++){var s=i[r];Array.isArray(s)?e(t,s,n):null!=s&&!1!==s&&("string"==typeof s&&(s={vnodeSelector:"",properties:void 0,children:void 0,text:s.toString(),domNode:null}),n.push(s))}});function y(e,t,i){if(Array.isArray(t))i=t,t=void 0;else if(t&&("string"==typeof t||t.hasOwnProperty("vnodeSelector"))||i&&("string"==typeof i||i.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");var n,r;return i&&1===i.length&&"string"==typeof i[0]?n=i[0]:i&&(m(e,i,r=[]),0===r.length&&(r=void 0)),{vnodeSelector:e,properties:t,children:r,text:""===n?void 0:n,domNode:null}}i(243);var _=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e)).startX=0,r.startY=0,r.endX=0,r.endY=0,r.width=1,r.color=[0,0,0,.5],r.visible=!0,r}return Object(r.a)(i,[{key:"startPosition",get:function(){return[this.startX,this.startY]},set:function(e){this._set("startX",e[0]),this._set("startY",e[1])}},{key:"endPosition",get:function(){return[this.endX,this.endY]},set:function(e){this._set("endX",e[0]),this._set("endY",e[1])}},{key:"strokeStyle",get:function(){var e=this.color;return"rgba(".concat(e[0],", ").concat(e[1],", ").concat(e[2],", ").concat(e[3],")")}},{key:"lineCap",get:function(){return"round"}},{key:"render",value:function(){var e=this.calculateCoordinates(j),t=e.height,i=e.left,n=e.top,r=e.width,a=e.x1,s=e.x2,o=e.y1,c=e.y2,l="stroke: ".concat(this.strokeStyle,"; stroke-width: ").concat(this.width,"; stroke-linecap: ").concat(this.lineCap,";");return y("div",{classes:{"esri-line-overlay-item":!0},styles:{left:i+"px",top:n+"px",width:r+"px",height:t+"px",visibility:this.visible?"visible":"hidden"}},[y("svg",{width:r,height:t},[y("line",{x1:a,y1:o,x2:s,y2:c,style:l})])])}},{key:"renderCanvas",value:function(e){if(this.visible){e.strokeStyle=this.strokeStyle,e.lineWidth=this.width,e.lineCap=this.lineCap;var t=this.calculateCoordinates(j);e.beginPath(),e.moveTo(t.left+t.x1,t.top+t.y1),e.lineTo(t.left+t.x2,t.top+t.y2),e.stroke()}}},{key:"calculateCoordinates",value:function(e){var t=Math.min(this.startX,this.endX),i=Math.max(this.startX,this.endX),n=Math.min(this.startY,this.endY),r=Math.max(this.startY,this.endY),a=this.width;return e.left=t-a,e.top=n-a,e.width=i-t+2*a,e.height=Math.max(20,r-n+2*a),e.x1=this.startX-t+a,e.y1=this.startY-n+a,e.x2=this.endX-t+a,e.y2=this.endY-n+a,e}}]),i}(p.a);Object(v.a)([Object(g.b)()],_.prototype,"startX",void 0),Object(v.a)([Object(g.b)()],_.prototype,"startY",void 0),Object(v.a)([Object(g.b)()],_.prototype,"endX",void 0),Object(v.a)([Object(g.b)()],_.prototype,"endY",void 0),Object(v.a)([Object(g.b)()],_.prototype,"startPosition",null),Object(v.a)([Object(g.b)()],_.prototype,"endPosition",null),Object(v.a)([Object(g.b)()],_.prototype,"width",void 0),Object(v.a)([Object(g.b)()],_.prototype,"color",void 0),Object(v.a)([Object(g.b)()],_.prototype,"visible",void 0),Object(v.a)([Object(g.b)({readOnly:!0})],_.prototype,"strokeStyle",null),_=Object(v.a)([Object(O.a)("esri.views.overlay.LineOverlayItem")],_);var j={left:0,top:0,width:0,height:0,x1:0,y1:0,x2:0,y2:0},w=_,x=i(27),k=i(15),S={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"},M=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e)).x=0,r.y=0,r.text="-",r.fontSize=14,r.anchor="center",r.visible=!0,r.backgroundColor="rgba(0, 0, 0, 0.6)",r.textColor="white",r.textShadowColor=[0,0,0],r.textShadowSize=1,r}return Object(r.a)(i,[{key:"position",get:function(){return[this.x,this.y]},set:function(e){this._set("x",e[0]),this._set("y",e[1])}},{key:"padding",get:function(){return.5*this.fontSize}},{key:"render",value:function(){return y("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",backgroundColor:this.backgroundColor,color:this.textColor,padding:this.padding+"px",borderRadius:this.padding+"px",textShadow:"0 0 ".concat(this.textShadowSize,"px rgb(").concat(this.textShadowColor[0],", ").concat(this.textShadowColor[1],", ").concat(this.textShadowColor[2],")")}},[this.text])}},{key:"renderCanvas",value:function(e){if(this.visible){var t=e.font.replace(/^(.*?)px/,"");e.font="".concat(this.fontSize,"px ").concat(t);var i=this.padding,n=this.padding,r=e.measureText(this.text).width,a=this.fontSize,s=T[this.anchor];e.textAlign="center",e.textBaseline="middle";var o=r+2*i,c=a+2*i,l=this.x+s.x*o,u=this.y+s.y*c;this.roundedRect(e,l,u,o,c,n),e.fillStyle=this.backgroundColor,e.fill();var h=this.x+(s.x+.5)*o,d=this.y+(s.y+.5)*c;this._renderTextShadow(e,this.text,h,d),e.fillStyle=this.textColor,e.fillText(this.text,h,d)}}},{key:"_renderTextShadow",value:function(e,t,i,n){e.lineJoin="miter",e.fillStyle="rgba(".concat(this.textShadowColor[0],", ").concat(this.textShadowColor[1],", ").concat(this.textShadowColor[2],", ").concat(1/R.length,")");var r,a=this.textShadowSize,s=Object(k.a)(R);try{for(s.s();!(r=s.n()).done;){var o=Object(x.a)(r.value,2),c=o[0],l=o[1];e.fillText(t,i+a*c,n+a*l)}}catch(u){s.e(u)}finally{s.f()}}},{key:"roundedRect",value:function(e,t,i,n,r,a){e.beginPath(),e.moveTo(t,i+a),e.arcTo(t,i,t+a,i,a),e.lineTo(t+n-a,i),e.arcTo(t+n,i,t+n,i+a,a),e.lineTo(t+n,i+r-a),e.arcTo(t+n,i+r,t+n-a,i+r,a),e.lineTo(t+a,i+r),e.arcTo(t,i+r,t,i+r-a,a),e.closePath()}},{key:"_cssClasses",value:function(){var e={"esri-text-overlay-item":!0};for(var t in S)e[S[t]]=this.anchor===t;return e}}]),i}(p.a);Object(v.a)([Object(g.b)()],M.prototype,"x",void 0),Object(v.a)([Object(g.b)()],M.prototype,"y",void 0),Object(v.a)([Object(g.b)()],M.prototype,"position",null),Object(v.a)([Object(g.b)()],M.prototype,"text",void 0),Object(v.a)([Object(g.b)()],M.prototype,"fontSize",void 0),Object(v.a)([Object(g.b)()],M.prototype,"anchor",void 0),Object(v.a)([Object(g.b)()],M.prototype,"visible",void 0),Object(v.a)([Object(g.b)()],M.prototype,"padding",null),M=Object(v.a)([Object(O.a)("esri.views.overlay.TextOverlayItem")],M);for(var T={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},R=[],P=0;P<360;P+=22.5)R.push([Math.cos(Math.PI*P/180),Math.sin(Math.PI*P/180)]);var C=M,D=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e.view))._handles=new o.a,r._textItem=null,r._calloutItem=null,r._showCallout=!0,r._showText=!0,r._geometry=null,r._text=null,r._fontSize=14,r._distance=25,r._anchor="right",r.applyProps(e),r}return Object(r.a)(i,[{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this._updateLabelPosition()}},{key:"textItem",get:function(){return this._textItem}},{key:"text",get:function(){return this._text},set:function(e){this._text=e,this.attached&&(this._textItem.text=this._text)}},{key:"fontSize",get:function(){return this._fontSize},set:function(e){this._fontSize=e,this.attached&&(this._textItem.fontSize=this._fontSize)}},{key:"distance",get:function(){return this._distance},set:function(e){this._distance!==e&&(this._distance=e,this._updateLabelPosition())}},{key:"anchor",get:function(){return this._anchor},set:function(e){this._anchor!==e&&(this._anchor=e,this._updateLabelPosition())}},{key:"overlaps",value:function(e){return!!this.attached&&this.textItem.visible&&e.textItem.visible&&this.view.overlay.overlaps(this._textItem,e.textItem)}},{key:"_updateLabelPosition",value:function(){if(this.attached){if(this._showText=!1,this._showCallout=!1,Object(c.k)(this.geometry)&&this.view._stage)switch(this.geometry.type){case"point":if(this._computeLabelPositionFromPoint(this.geometry.point,U)){if(this.geometry.callout){var e=this.view.state.camera,t=this.geometry.callout.distance;Object(u.i)(N,N,[0,this.geometry.callout.offset]),e.renderToScreen(N,U),Object(u.r)(H,0,1),Object(u.b)(H,H,t*e.pixelRatio),Object(u.i)(H,H,N),e.renderToScreen(H,W),this._showCallout=this._updatePosition(U,W)}else this._textItem.position=[U[0],U[1]],this._textItem.anchor="center";this._showText=!0}break;case"corner":this._computeLabelPositionFromCorner(this.geometry,this._distance,U,W)&&(this._showCallout=this._updatePosition(U,W),this._showText=!0);break;case"segment":this._computeLabelPositionFromSegment(this.geometry,this._distance,this._anchor,U,W)&&(this._showText=!0,this._showCallout=this._updatePosition(U,W))}this.updateVisibility(this.visible)}}},{key:"_computeLabelPositionFromPoint",value:function(e,t){var i=this.view.state.camera;return i.projectToRenderScreen(e,N),!(N[2]<0||N[2]>1)&&(i.renderToScreen(N,t),!0)}},{key:"_computeLabelPositionFromCorner",value:function(e,t,i,n){if(!e)return!1;var r=this.view.state.camera;return E(e.left,1,r,V),Object(u.n)(V,V),E(e.right,0,r,F),Object(u.i)(H,V,F),Object(u.n)(H,H),Object(u.f)(H,H),r.projectToRenderScreen(e.left.endRenderSpace,N),!(N[2]<0||N[2]>1)&&(r.renderToScreen(N,i),Object(u.b)(H,H,t*r.pixelRatio),Object(u.i)(H,H,N),r.renderToScreen(H,n),!0)}},{key:"_computeLabelPositionFromSegment",value:function(e,t,i,n,r){if(!e)return!1;var a=e.segment,s=this.view.state.camera;Object(f.e)(a.startRenderSpace,a.endRenderSpace,V,s),Object(u.r)(H,-V[1],V[0]);var o=!1;switch(i){case"top":o=H[1]<0;break;case"bottom":o=H[1]>0;break;case"left":o=H[0]>0;break;case"right":o=H[0]<0}if(o&&Object(u.n)(H,H),0===Object(u.l)(H))switch(i){case"top":H[1]=1;break;case"bottom":H[1]=-1;break;case"left":H[0]=-1;break;case"right":H[0]=1}return a.eval(Q[e.sampleLocation],G),s.projectToRenderScreen(G,N),!(N[2]<0||N[2]>1)&&(s.renderToScreen(N,n),Object(u.b)(H,H,t*s.pixelRatio),Object(u.i)(H,H,N),s.renderToScreen(H,r),!0)}},{key:"_updatePosition",value:function(e,t){if(t){var i=t[0]-e[0],n=t[1]-e[1];return this._textItem.position=[t[0],t[1]],this._textItem.anchor=Math.abs(i)>Math.abs(n)?i>0?"left":"right":n>0?"top":"bottom",this._calloutItem.startPosition=[e[0],e[1]],this._calloutItem.endPosition=[t[0],t[1]],!0}return this._textItem.position=[e[0],e[1]],this._textItem.anchor="center",!1}},{key:"createResources",value:function(){var e=this;this._textItem=new C({visible:!0}),this._textItem.text=Object(c.r)(this._text),this._textItem.fontSize=this._fontSize,this._calloutItem=new w({visible:!0,width:2}),this._updateLabelPosition(),this.view.overlay.items.addMany([this._textItem,this._calloutItem]),this._handles.add(this.view.state.watch("camera",(function(){return e._updateLabelPosition()})))}},{key:"destroyResources",value:function(){this.view.overlay&&!this.view.overlay.destroyed&&this.view.overlay.items.removeMany([this._textItem,this._calloutItem]),this._handles.removeAll()}},{key:"updateVisibility",value:function(e){this._textItem.visible=this._showText&&e,this._calloutItem.visible=this._showCallout&&e}}]),i}(b.a);function E(e,t,i,n){e.eval(t,z,A),Object(h.c)(I,z,A),i.projectToRenderScreen(z,q),i.projectToRenderScreen(I,Z),Object(u.a)(n,Y,B),Object(u.f)(n,n)}function L(e){switch(e){case"top":return"bottom";case"right":return"left";case"bottom":return"top";case"left":return"right"}}var z=Object(d.e)(),I=Object(d.e)(),A=Object(d.e)(),V=Object(l.d)(),F=Object(l.d)(),H=Object(l.d)(),G=Object(d.e)(),N=Object(l.e)(),U=Object(l.g)(),W=Object(l.g)(),q=Object(l.e)(),B=q,Z=Object(l.e)(),Y=Z,Q={start:0,center:.5,end:1}},948:function(e,t,i){"use strict";i.d(t,"a",(function(){return De}));var n=i(10),r=i(236),a=i(54),s=i(463),o=i(618),c=i(738),l=i(15),u=i(4),h=i(5),d=(i(90),i(300)),f=i(112),b=i(66),v=i(38),p=i(72),g=i(146),O=i(616),m=i(603),y=i(50),_=i(85),j=i(267),w=i(268),x=i(142),k=i(693),S=i(704),M=i(647),T=i(854),R=i(823),P=i(766),C=i(743),D=i(768),E=i(55),L=function(){function e(t){for(var i in Object(u.a)(this,e),this.idHint=0,this.camera=new P.a,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=Object(m.d)(),this._worldFrame=null,this._renderLocation=Object(_.e)(),this._renderLocationDirty=!0,this._location=new E.a({x:0,y:0,z:0}),this._elevationAlignedLocation=new E.a,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=0,this._focused=!1,this.events=new f.a.EventEmitter,this._screenLocation={screenPointArray:Object(v.g)(),renderScreenPointArray:Object(v.e)(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayer=null,this._materialIdReferences=null,this._location.spatialReference=t.view.spatialReference,t)this[i]=t[i];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera)}return Object(h.a)(e,[{key:"destroy",value:function(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this.camera=null}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}},{key:"renderObjects",get:function(){return this._renderObjects},set:function(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}},{key:"available",get:function(){return this._available},set:function(e){e!==this._available&&(this._available=e,this._updateEngineObject())}},{key:"disableDisplay",value:function(){var e=this;return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:Object(p.d)((function(){e._noDisplayCount--,0===e._noDisplayCount&&e._updateEngineObject()}))}}},{key:"radius",get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}},{key:"worldSized",get:function(){return this._worldSized},set:function(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}},{key:"modelTransform",get:function(){return this._modelTransform},set:function(e){z(e)&&(this._screenLocationDirty=!0),Object(r.d)(this._modelTransform,e),this._updateEngineObject()}},{key:"renderLocation",get:function(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=Object(m.d)()),function(e,t,i){switch(e.viewingMode){case"local":return Object(r.i)(i),!0;case"global":var n=Object(w.e)(e.renderCoordsHelper.spatialReference);Object(j.t)(t,0,U,0,n.radius),Object(j.c)(Object(b.g)(U[1]),Object(b.g)(U[0]),i)}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation},set:function(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}},{key:"location",get:function(){return this._location},set:function(e){Object(c.a)(e,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}},{key:"elevationAlignedLocation",get:function(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation},set:function(e){Object(c.a)(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}},{key:"_updateElevationAlignedLocation",value:function(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;var e=Object(n.k)(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=this.location.spatialReference,this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}},{key:"grabbableForEvent",value:function(){return!0}},{key:"grabbing",get:function(){return this._grabbing},set:function(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}},{key:"hovering",get:function(){return this._hovering},set:function(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}},{key:"selected",get:function(){return this._selected},set:function(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}},{key:"state",get:function(){return this._state},set:function(e){e!==this._state&&(this._state=e,this._updateEngineObject())}},{key:"updateStateEnabled",value:function(e,t){t?this.state|=e:this.state&=~e}},{key:"_setFocused",value:function(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}},{key:"focused",get:function(){return this._focused}},{key:"screenLocation",get:function(){return this.ensureScreenLocation(),this._screenLocation}},{key:"ensureScreenLocation",value:function(){if(this._screenLocationDirty){var e;if(this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,z(this._modelTransform)){var t=this._calculateModelTransformOffset(Y);e=Object(a.c)(t,t,this.renderLocation)}else e=this.renderLocation;this.camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}}},{key:"applyObjectTransform",get:function(){return this._applyObjectTransform},set:function(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}},{key:"intersectionDistance",value:function(e,t){if(!this.available)return null;var i=Object(v.j)(e,I),r=this._getCollisionRadius(t),s=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if(Object(y.j)(this.screenLocation.screenPointArray,i)<r*r)return this.screenLocation.renderScreenPointArray[2]+s;break;case"line":var c=this.collisionType.paths,u=this._getWorldToScreenObjectScale(),h=this._calculateObjectTransform(u,G),f=r*this.screenLocation.pixelSize,b=Object(R.a)(this.camera,i,V);if(Object(n.j)(b))return null;var p,O=Object(l.a)(c);try{for(O.s();!(p=O.n()).done;){var m=p.value;if(0!==m.length)for(var j=Object(a.n)(U,m[0],h),w=1;w<m.length;w++){var x=Object(a.n)(W,m[w],h),M=Object(k.b)(Object(k.f)(j,x,A),b);if(null!=M&&M<f*f){var T=Object(a.c)(o.c.get(),j,x);Object(a.b)(T,T,.5);var P=Object(v.a)(o.c.get());return this.camera.projectToRenderScreen(T,P),P[2]+s}Object(a.h)(j,x)}}}catch(me){O.e(me)}finally{O.f()}break;case"disc":var C,D=this.collisionType.direction,E=null!=(C=this.collisionType.offset)?C:_.b,L=this._getWorldToScreenObjectScale(),z=this._calculateObjectTransform(L,G),H=r*this.screenLocation.pixelSize,Y=Object(R.a)(this.camera,i,V);if(Object(n.j)(Y))return null;var Q=Object(g.e)(F,z),X=Object(a.u)(B,D,Q),J=Object(a.n)(Z,E,z);Object(S.f)(J,X,N);var K=q;if(Object(S.l)(N,Y,K)&&Object(a.i)(K,J)<H*H)return this.screenLocation.renderScreenPointArray[2]+s;break;case"ribbon":var $=this.collisionType,ee=$.paths,te=$.direction,ie=this._getWorldToScreenObjectScale(),ne=this._calculateObjectTransform(ie,G),re=r*this.camera.computeScreenPixelSizeAt(this.renderLocation),ae=Object(R.a)(this.camera,i,V);if(Object(n.j)(ae))return null;var se=Object(g.e)(F,ne),oe=Object(a.u)(B,te,se),ce=this._calculateModelTransformPosition(Z);Object(S.f)(ce,oe,N);var le=q;if(!Object(S.l)(N,ae,le))break;var ue,he=Object(l.a)(ee);try{for(he.s();!(ue=he.n()).done;){var de=ue.value;if(0!==de.length)for(var fe=Object(a.n)(U,de[0],ne),be=1;be<de.length;be++){var ve=Object(a.n)(W,de[be],ne),pe=Object(k.e)(Object(k.f)(fe,ve,A),le);if(null!=pe&&pe<re*re){var ge=Object(a.c)(o.c.get(),fe,ve);Object(a.b)(ge,ge,.5);var Oe=Object(v.a)(o.c.get());return this.camera.projectToRenderScreen(ge,Oe),Oe[2]+s}Object(a.h)(fe,ve)}}}catch(me){he.e(me)}finally{he.f()}break;default:Object(d.a)(this.collisionType)}return null}},{key:"attach",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{manipulator3D:{}};if(this.view._stage){var i=t.manipulator3D;if(Object(n.j)(i.engineLayerId)){var r=new D.a({isPickable:!1,updatePolicy:1});this.view._stage.add(r),i.engineLayerId=r.id,this._engineLayer=r}else null!=(e=this.view._stage)&&e.getObject&&(this._engineLayer=this.view._stage.getObject(i.engineLayerId));i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._materialIdReferences=i.materialIdReferences,Object(n.j)(this._materialIdReferences)&&(this._materialIdReferences=new Map,i.materialIdReferences=this._materialIdReferences),this.camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),Object(j.b)(this._location.spatialReference,this.view.spatialReference)||(this.location=new E.a({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}}},{key:"detach",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{manipulator3D:{}},t=e.manipulator3D;t.engineLayerReferences--;var i=0===t.engineLayerReferences;i&&(t.engineLayerId=null),this._removeResourcesFromStage(i),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}},{key:"onViewChange",value:function(){this.camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}},{key:"onElevationChange",value:function(e){Object(j.n)(this.location,Q,e.spatialReference),Object(x.f)(e.extent,Q)&&(this.location=this._location)}},{key:"_evaluateElevationAlignment",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.location;if(Object(n.j)(this.elevationInfo))return!1;var t=null,i=0,r=Object(n.s)(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":t=Object(n.s)(Object(T.a)(this.view.elevationProvider,e,"ground"),0);break;case"relative-to-ground":i=Object(n.s)(Object(T.a)(this.view.elevationProvider,e,"ground"),0)+r;break;case"relative-to-scene":i=Object(n.s)(Object(T.a)(this.view.elevationProvider,e,"scene"),0)+r;break;case"absolute-height":i=r}return(i!==this._elevation.offset||t!==this._elevation.override)&&(this._elevation.offset=i,this._elevation.override=t,!0)}},{key:"_updateEngineObject",value:function(){if(this._attached)if(this.available){var e=this._getWorldToScreenObjectScale(),t=G;if(!0===this.autoScaleRenderObjects){var i=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(i,t)}else this._calculateObjectTransform(e,t);var n,r=this._ensureEngineResources().objectsByState,a=(this.focused?2:1)|(this.selected?8:4),s=this._noDisplayCount>0,o=Object(l.a)(r);try{for(o.s();!(n=o.n()).done;){var c=n.value,u=c.stateMask,h=c.objects;if(s){var d,f=Object(l.a)(h);try{for(f.s();!(d=f.n()).done;){d.value.setVisible(!1)}}catch(_){f.e(_)}finally{f.f()}}else{var b=!(0!=(15&u))||(a&u)==(15&u),v=!(0!=(65520&u))||(this.state&u)==(65520&u);if(b&&v){var p,g=Object(l.a)(h);try{for(g.s();!(p=g.n()).done;){var O=p.value;O.setVisible(!0),O.transformation=t}}catch(_){g.e(_)}finally{g.f()}}else{var m,y=Object(l.a)(h);try{for(y.s();!(m=y.n()).done;){m.value.setVisible(!1)}}catch(_){y.e(_)}finally{y.f()}}}}}catch(_){o.e(_)}finally{o.f()}}else this._removeResourcesFromStage()}},{key:"_ensureEngineResources",value:function(){if(Object(n.j)(this._engineResources)){var e=Object(n.r)(this._engineLayer),t=[],i=new Set;this.renderObjects.forEach((function(e){var n=e.material;i.has(n)||(t.push(n),i.add(n))}));var r=new Map;this._renderObjects.forEach((function(e){var t=new C.a({castShadow:!1});!function(e,t){var i=t.geometry,n=t.material,r=t.transform;Array.isArray(i)?i.forEach((function(t){return e.addGeometry(t,n,r)})):e.addGeometry(i,n,r)}(t,e);var i=e.stateMask||0,n=r.get(i)||[];n.push(t),r.set(i,n)}));var a=[];r.forEach((function(e,t){return a.push({stateMask:t,objects:e})})),this._engineResources={objectsByState:a,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}},{key:"_addResourcesToStage",value:function(){var e=this;if(!this._engineResourcesAddedToStage&&!Object(n.j)(this._engineResources)){var t=this._engineResources,i=t.objectsByState,r=t.layer;t.materials.forEach((function(t){var i=Object(n.r)(e._materialIdReferences),r=i.get(t.id)||0;0===r&&e.view._stage.add(t),i.set(t.id,r+1)})),i.forEach((function(t){var i=t.objects;r.addMany(i),e.view._stage.addMany(i)})),this._engineResourcesAddedToStage=!0}}},{key:"_removeResourcesFromStage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._engineResourcesAddedToStage&&!Object(n.j)(this._engineResources)){var i=this._engineResources,r=i.objectsByState,a=i.layer,s=i.materials;r.forEach((function(t){var i=t.objects;a.removeMany(i),e.view._stage.removeMany(i)})),s.forEach((function(t){var i=Object(n.r)(e._materialIdReferences),r=i.get(t.id);1===r?(e.view._stage.remove(t),i.delete(t.id)):i.set(t.id,r-1)})),t&&this.view._stage.remove(a),this._engineResourcesAddedToStage=!1}}},{key:"_getCollisionRadius",value:function(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}},{key:"_getFocusedSize",value:function(e,t){return e*(t?this.focusMultiplier:1)}},{key:"_getWorldToScreenObjectScale",value:function(){return this._worldSized?1:this.screenLocation.pixelSize}},{key:"_calculateModelTransformPosition",value:function(e){var t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,H);return Object(a.t)(e,i[12],i[13],i[14])}},{key:"_calculateModelTransformOffset",value:function(e){var t=this._calculateModelTransformPosition(e);return Object(a.g)(e,t,this.renderLocation)}},{key:"_calculateObjectTransform",value:function(e,t){return Object(r.h)(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&Object(r.m)(t,t,this._worldFrame),Object(r.m)(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,Object(n.k)(this._applyObjectTransform)&&this._applyObjectTransform(t),t}},{key:"test",get:function(){var e=!1;if(Object(n.k)(this._engineResources))for(var t in this._engineResources.objectsByState){var i,r=this._engineResources.objectsByState[t],a=Object(l.a)(r.objects);try{for(a.s();!(i=a.n()).done;){if(i.value.isVisible){e=!0;break}}}catch(s){a.e(s)}finally{a.f()}if(e)break}return{areAnyResourcesVisible:e}}}]),e}();function z(e){return 0!==e[12]||0!==e[13]||0!==e[14]}var I=Object(v.g)(),A=Object(k.d)(),V=Object(M.c)(),F=Object(O.b)(),H=Object(m.d)(),G=Object(m.d)(),N=Object(S.d)(),U=Object(_.e)(),W=Object(_.e)(),q=Object(_.e)(),B=Object(_.e)(),Z=Object(_.e)(),Y=Object(_.e)(),Q=new E.a({x:0,y:0,z:0,spatialReference:null}),X=(i(919),i(697)),J=i(832),K=i(11),$=i(6),ee=i(7),te=i(625),ie=i(682),ne=i(700),re=i(715),ae=i(716),se=i(365),oe=i(783),ce=i(694),le=i(0),ue=i(789),he=i(626),de=i(636),fe=i(717),be=i(672),ve=i(680),pe=i(681),ge=i(706),Oe=i(673),me=i(824),ye=i(467),_e=function(e){Object($.a)(i,e);var t=Object(ee.a)(i);function i(){return Object(u.a)(this,i),t.apply(this,arguments)}return Object(h.a)(i,[{key:"initializeProgram",value:function(e){var t=i.shader.get(),n=this.configuration,r=t.build({output:n.output,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:n.screenSizeEnabled,shadingEnabled:n.shadingEnabled,OITEnabled:0===n.transparencyPassType,multipassTerrainEnabled:n.multipassTerrainEnabled,cullAboveGround:n.cullAboveGround});return new Oe.a(e.rctx,r,we)}},{key:"bindPass",value:function(e,t){var i=this.configuration,n=i.screenSizeEnabled,r=i.shadingEnabled,a=e.color,s=e.shadingTint,o=e.shadingDirection;Object(fe.b)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("color",a),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(de.a)(this.program,t)),r&&(this.program.setUniform4fv("shadedColor",this.blendColor(xe,s,a)),this.program.setUniform3fv("shadingDirection",o),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix)),n&&Object(ue.b)(this.program,e,t)}},{key:"bindDraw",value:function(e){Object(fe.c)(this.program,e),Object(fe.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(he.c)(this.program,this.configuration,e),this.program.rebindTextures()}},{key:"blendColor",value:function(e,t,i){var n=1-t[3],r=t[3]+i[3]*n;return 0===r?(e[3]=r,e):(e[0]=(t[0]*t[3]+i[0]*i[3]*n)/r,e[1]=(t[1]*t[3]+i[1]*i[3]*n)/r,e[2]=(t[2]*t[3]+i[2]*i[3]*n)/r,e[3]=i[3],e)}},{key:"setPipelineState",value:function(e){var t=this.configuration,i=3===e,n=2===e;return Object(ye.e)({blending:0!==t.output&&7!==t.output||!t.transparent?null:i?ge.f:Object(ge.a)(e),culling:Object(ye.b)(t.cullFace),depthTest:{func:n?513:t.shadingEnabled?515:513},depthWrite:i?t.writeDepth&&ye.d:Object(ge.c)(e),colorWrite:ye.c,polygonOffset:i||n?null:ge.d})}},{key:"initializePipeline",value:function(){return this.setPipelineState(this.configuration.transparencyPassType)}}]),i}(ve.a);_e.shader=new be.a(me.a,(function(){return i.e(197).then(i.bind(null,1181))}));var je=function(e){Object($.a)(i,e);var t=Object(ee.a)(i);function i(){var e;return Object(u.a)(this,i),(e=t.apply(this,arguments)).output=0,e.cullFace=0,e.slicePlaneEnabled=!1,e.transparent=!1,e.writeDepth=!0,e.screenSizeEnabled=!0,e.shadingEnabled=!0,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return i}(pe.a);Object(le.a)([Object(pe.b)({count:8})],je.prototype,"output",void 0),Object(le.a)([Object(pe.b)({count:3})],je.prototype,"cullFace",void 0),Object(le.a)([Object(pe.b)()],je.prototype,"slicePlaneEnabled",void 0),Object(le.a)([Object(pe.b)()],je.prototype,"transparent",void 0),Object(le.a)([Object(pe.b)()],je.prototype,"writeDepth",void 0),Object(le.a)([Object(pe.b)()],je.prototype,"screenSizeEnabled",void 0),Object(le.a)([Object(pe.b)()],je.prototype,"shadingEnabled",void 0),Object(le.a)([Object(pe.b)({count:4})],je.prototype,"transparencyPassType",void 0),Object(le.a)([Object(pe.b)()],je.prototype,"multipassTerrainEnabled",void 0),Object(le.a)([Object(pe.b)()],je.prototype,"cullAboveGround",void 0);var we=new Map([["position",0],["normal",1],["offset",2]]),xe=Object(s.e)(),ke=function(e){Object($.a)(i,e);var t=Object(ee.a)(i);function i(e){var n;return Object(u.a)(this,i),(n=t.call(this,e,Me)).supportsEdges=!0,n.techniqueConfig=new je,n._vertexAttributeLocations=we,n}return Object(h.a)(i,[{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.screenSizeEnabled=this.params.screenSizeEnabled,this.techniqueConfig.shadingEnabled=this.params.shadingEnabled,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}},{key:"getPassParameters",value:function(){return this.params}},{key:"intersect",value:function(e,t,i,n,r,s,o){var c=this;if(this.params.screenSizeEnabled){var l=e.vertexAttributes.get("offset"),u={applyToVertex:function(e,t,i,r){var s=Object(a.t)(Re,l.data[3*r+0],l.data[3*r+1],l.data[3*r+2]),o=Object(a.t)(Pe,e,t,i);return Object(a.b)(s,s,c.params.screenSize*n.camera.computeRenderPixelSizeAt(s)),Object(a.c)(o,o,s),[o[0],o[1],o[2]]},applyToAabb:function(e){var t=Object(te.b)(e,Re);return Object(te.n)(e,c.params.screenSize*n.camera.computeRenderPixelSizeAt(t))}};Object(ce.d)(e,t,n,r,s,u,o)}else Object(ce.d)(e,t,n,r,s,void 0,o)}},{key:"getGLMaterial",value:function(e){return 0===e.output||7===e.output||4===e.output?new Se(e):void 0}},{key:"createBufferWriter",value:function(){return new Te(this.params.screenSizeEnabled)}}]),i}(ae.a),Se=function(e){Object($.a)(i,e);var t=Object(ee.a)(i);function i(e){var n;return Object(u.a)(this,i),(n=t.call(this,e)).updateParameters(),n}return Object(h.a)(i,[{key:"updateParameters",value:function(e){this._technique=this._techniqueRep.releaseAndAcquire(_e,this._material.getTechniqueConfig(this._output,e),this._technique)}},{key:"beginSlot",value:function(e){if(4===this._output)return 3===e;var t=3;return this._technique.configuration.transparent&&(t=this._technique.configuration.writeDepth?5:8),e===t}},{key:"ensureParameters",value:function(e){this.updateParameters(e)}},{key:"bind",value:function(e){this._technique.bindPass(this._material.getPassParameters(),e)}}]),i}(re.a),Me=Object(K.a)({color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:Object(a.o)(Object(_.e)(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,screenSizeEnabled:!1,screenSize:14,shadingEnabled:!0},ae.b),Te=function(){function e(t){Object(u.a)(this,e),this.screenSizeEnabled=t;var i=Object(ne.a)().vec3f("position").vec3f("normal");this.screenSizeEnabled&&i.vec3f("offset"),this.vertexBufferLayout=i}return Object(h.a)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get("position").length}},{key:"write",value:function(e,t,i,n){if(Object(oe.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,n),this.screenSizeEnabled){if(!t.vertexAttributes.has("offset"))throw new Error("offset vertex attribute required for screenSizeEnabled ShadedColorMaterial");var r=t.vertexAttributes.get("offset"),a=t.indices.get("offset");Object(se.a)(3===r.size);var s=i.getField("offset",ie.u);if(!s)throw new Error("unable to acquire view for offset");Object(oe.e)(a,r.data,e.invTranspTransformation,s,n)}}}]),e}(),Re=Object(_.e)(),Pe=Object(_.e)();function Ce(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=Object(s.g)(e[0],e[1],e[2],e.length>3?e[3]:1),r=e[3]<1;return i?new ke({color:n,transparent:r,writeDepth:!0,cullFace:2,renderOccluded:t}):new J.a({color:n,transparent:r,writeDepth:!0,cullFace:2,renderOccluded:t})}function De(e,t,i){return new L({view:e,renderObjects:[{geometry:X.a.createSphereGeometry(1,32,32),material:Ce(Object(s.g)(t[0],t[1],t[2],null!=i?i:1))}]})}}}]);
//# sourceMappingURL=54.71ef82a7.chunk.js.map